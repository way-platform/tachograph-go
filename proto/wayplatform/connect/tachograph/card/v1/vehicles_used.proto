edition = "2023";

package wayplatform.connect.tachograph.card.v1;

import "google/protobuf/timestamp.proto";
import "wayplatform/connect/tachograph/dd/v1/bcd_string.proto";
import "wayplatform/connect/tachograph/dd/v1/string_value.proto";
import "wayplatform/connect/tachograph/dd/v1/vehicle_registration_identification.proto";

// Represents the content of the EF_Vehicles_Used file.
//
// The file structure is specified in Appendix 2, Section 4.2.1.
//
//     EF Vehicles_Used
//     └─CardVehiclesUsed
//
// The data type `CardVehiclesUsed` is specified in the Data Dictionary, Section 2.38.
//
// ASN.1 Definition:
//
//     CardVehiclesUsed ::= SEQUENCE {
//         vehiclePointerNewestRecord INTEGER(0..NoOfCardVehicleRecords-1),
//         cardVehicleRecords SET SIZE(NoOfCardVehicleRecords) OF CardVehicleRecord
//     }
message VehiclesUsed {
  // Represents a record for a single period of use of a vehicle.
  //
  // The data type `CardVehicleRecord` is specified in the Data Dictionary, Section 2.37.
  //
  // ASN.1 Definition:
  //
  //     CardVehicleRecord ::= SEQUENCE {
  //         vehicleOdometerBegin OdometerShort,
  //         vehicleOdometerEnd OdometerShort,
  //         vehicleFirstUse TimeReal,
  //         vehicleLastUse TimeReal,
  //         vehicleRegistration VehicleRegistrationIdentification,
  //         vuDataBlockCounter VuDataBlockCounter,
  //         vehicleIdentificationNumber VehicleIdentificationNumber -- Gen2
  //     }
  message Record {
    // The vehicle odometer value at the beginning of the period of use, in kilometers.
    //
    // See Data Dictionary, Section 2.113, `OdometerShort`.
    // ASN.1 Definition:
    //
    //     OdometerShort ::= INTEGER(0..999999)
    int32 vehicle_odometer_begin_km = 1;

    // The vehicle odometer value at the end of the period of use, in kilometers.
    //
    // See Data Dictionary, Section 2.113, `OdometerShort`.
    // ASN.1 Definition:
    //
    //     OdometerShort ::= INTEGER(0..999999)
    int32 vehicle_odometer_end_km = 2;

    // The date and time of the beginning of the period of use.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp vehicle_first_use = 3;

    // The date and time of the end of the period of use.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp vehicle_last_use = 4;

    // The VRN and registering Member State of the vehicle.
    //
    // See Data Dictionary, Section 2.166, `VehicleRegistrationIdentification`.
    dd.v1.VehicleRegistrationIdentification vehicle_registration = 5;

    // The value of the VuDataBlockCounter at last extraction.
    //
    // See Data Dictionary, Section 2.189, `VuDataBlockCounter`.
    // ASN.1 Definition:
    //
    //     VuDataBlockCounter ::= BCDstring(SIZE(2))
    dd.v1.BcdString vu_data_block_counter = 6;

    // The Vehicle Identification Number (VIN). (Gen2 only)
    //
    // See Data Dictionary, Section 2.164, `VehicleIdentificationNumber`.
    // ASN.1 Definition:
    //
    //     VehicleIdentificationNumber ::= IA5String(SIZE(17))
    wayplatform.connect.tachograph.dd.v1.StringValue vehicle_identification_number = 7;
  }

  // Index of the last updated vehicle record.
  // Corresponds to `vehiclePointerNewestRecord`.
  //
  // See Data Dictionary, Section 2.38.
  // ASN.1 Definition:
  //
  //     INTEGER(0..NoOfCardVehicleRecords-1)
  int32 newest_record_index = 1;

  // The set of records for vehicles used.
  // Corresponds to `cardVehicleRecords`.
  repeated Record records = 2;

  // Digital signature for the EF_Vehicles_Used file content.
  //
  // See Data Dictionary, Section 2.149, `Signature`.
  // ASN.1 Definition:
  //
  //     Signature ::= OCTET STRING (SIZE(128 for Gen1))
  bytes signature = 3;
}
