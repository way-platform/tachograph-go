edition = "2023";

package wayplatform.connect.tachograph.card.v1;

import "google/protobuf/timestamp.proto";
import "wayplatform/connect/tachograph/dd/v1/calibration_purpose.proto";
import "wayplatform/connect/tachograph/dd/v1/equipment_type.proto";
import "wayplatform/connect/tachograph/dd/v1/extended_serial_number.proto";
import "wayplatform/connect/tachograph/dd/v1/string_value.proto";
import "wayplatform/connect/tachograph/dd/v1/vehicle_registration_identification.proto";

// Represents the content of the EF_Calibration file.
//
// The file structure is specified in Appendix 2, Section 4.3.1.
//
//     EF Calibration
//     └─WorkshopCardCalibrationData
//
// The data type `WorkshopCardCalibrationData` is specified in the Data Dictionary, Section 2.235.
//
// ASN.1 Specification:
//
//     WorkshopCardCalibrationData ::= SEQUENCE {
//         calibrationTotalNumber INTEGER(0..NoOfCalibrationRecords),
//         calibrationPointerNewestRecord INTEGER(0..NoOfCalibrationRecords-1),
//         calibrationRecords SET SIZE(NoOfCalibrationRecords) OF WorkshopCardCalibrationRecord
//     }
message Calibration {
  // Represents an extended seal identifier.
  // See Data Dictionary, Section 2.71.
  message ExtendedSealIdentifier {
    // Code of the manufacturer of the seal.
    dd.v1.StringValue manufacturer_code = 1;
    // Identifier for the seal, unique for the manufacturer.
    dd.v1.StringValue seal_identifier = 2;
  }

  // Represents a single seal record.
  // See Data Dictionary, Section 2.130.
  message SealRecord {
    // Type of equipment the seal is attached to.
    dd.v1.EquipmentType equipment_type = 1;
    // Identifier of the seal.
    ExtendedSealIdentifier extended_seal_identifier = 2;
  }

  // Represents seal data stored on a card.
  // See Data Dictionary, Section 2.128.
  message SealDataCard {
    // The set of seal records.
    repeated SealRecord seal_records = 1;
  }

  // Represents a single calibration record.
  //
  // The data type `WorkshopCardCalibrationRecord` is specified in the Data Dictionary, Section 2.236.
  //
  // ASN.1 Definition (Gen1):
  //
  //     WorkshopCardCalibrationRecord ::= SEQUENCE {
  //         calibrationPurpose CalibrationPurpose,
  //         vehicleIdentificationNumber VehicleIdentificationNumber,
  //         vehicleRegistration VehicleRegistrationIdentification,
  //         wVehicleCharacteristicConstant W-VehicleCharacteristicConstant,
  //         kConstantOfRecordingEquipment K-ConstantOfRecordingEquipment,
  //         lTyreCircumference L-TyreCircumference,
  //         tyreSize TyreSize,
  //         authorisedSpeed SpeedAuthorised,
  //         oldOdometerValue OdometerShort,
  //         newOdometerValue OdometerShort,
  //         oldTimeValue TimeReal,
  //         newTimeValue TimeReal,
  //         nextCalibrationDate TimeReal,
  //         vuPartNumber VuPartNumber,
  //         vuSerialNumber ExtendedSerialNumber,
  //         sensorSerialNumber SensorSerialNumber
  //     }
  //
  // ASN.1 Definition (Gen2):
  //
  //     WorkshopCardCalibrationRecord ::= SEQUENCE {
  //         // ...all Gen1 fields plus:
  //         sensorGNSSSerialNumber SensorGNSSSerialNumber,
  //         rcmSerialNumber RemoteCommunicationModuleSerialNumber,
  //         sealDataCard SealDataCard
  //     }
  message Record {
    // The purpose of the calibration.
    //
    // See Data Dictionary, Section 2.8, `CalibrationPurpose`.
    // ASN.1 Specification:
    //
    //     CalibrationPurpose ::= OCTET STRING (SIZE(1))
    dd.v1.CalibrationPurpose calibration_purpose = 1;

    // The Vehicle Identification Number.
    //
    // See Data Dictionary, Section 2.164, `VehicleIdentificationNumber`.
    // ASN.1 Definition:
    //
    //     VehicleIdentificationNumber ::= IA5String(SIZE(17))
    wayplatform.connect.tachograph.dd.v1.StringValue vehicle_identification_number = 3;

    // The vehicle registration identifier.
    //
    // See Data Dictionary, Section 2.166, `VehicleRegistrationIdentification`.
    // ASN.1 Definition:
    //
    //     VehicleRegistrationIdentification ::= SEQUENCE { ... }
    dd.v1.VehicleRegistrationIdentification vehicle_registration = 4;

    // The vehicle characteristic constant.
    //
    // See Data Dictionary, Section 2.239, `W-VehicleCharacteristicConstant`.
    // ASN.1 Definition:
    //
    //     W-VehicleCharacteristicConstant ::= INTEGER(0..65535)
    int32 w_vehicle_characteristic_constant = 5;

    // The constant of the recording equipment.
    //
    // See Data Dictionary, Section 2.85, `K-ConstantOfRecordingEquipment`.
    // ASN.1 Definition:
    //
    //     K-ConstantOfRecordingEquipment ::= INTEGER(0..65535)
    int32 k_constant_of_recording_equipment = 6;

    // The tyre circumference in 1/8ths of a mm.
    //
    // See Data Dictionary, Section 2.91, `L-TyreCircumference`.
    // ASN.1 Definition:
    //
    //     L-TyreCircumference ::= INTEGER(0..65535)
    int32 l_tyre_circumference_eighths_mm = 7;

    // The tyre size designation.
    //
    // See Data Dictionary, Section 2.163, `TyreSize`.
    // ASN.1 Definition:
    //
    //     TyreSize ::= IA5String(SIZE(15))
    wayplatform.connect.tachograph.dd.v1.StringValue tyre_size = 8;

    // The authorised speed in km/h.
    //
    // See Data Dictionary, Section 2.156, `SpeedAuthorised`.
    // ASN.1 Definition:
    //
    //     SpeedAuthorised ::= INTEGER(0..255)
    int32 authorised_speed_kmh = 9;

    // The odometer value before calibration in km.
    //
    // See Data Dictionary, Section 2.113, `OdometerShort`.
    // ASN.1 Definition:
    //
    //     OdometerShort ::= INTEGER(0..999999)
    int32 old_odometer_km = 10;

    // The odometer value after calibration in km.
    //
    // See Data Dictionary, Section 2.113, `OdometerShort`.
    // ASN.1 Definition:
    //
    //     OdometerShort ::= INTEGER(0..999999)
    int32 new_odometer_km = 11;

    // The time value before calibration.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp old_time = 12;

    // The time value after calibration.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp new_time = 13;

    // The date of the next calibration.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp next_calibration_date = 14;

    // The part number of the Vehicle Unit.
    //
    // See Data Dictionary, Section 2.217, `VuPartNumber`.
    // ASN.1 Definition:
    //
    //     VuPartNumber ::= IA5String(SIZE(16))
    wayplatform.connect.tachograph.dd.v1.StringValue vu_part_number = 15;

    // The serial number of the Vehicle Unit.
    //
    // See Data Dictionary, Section 2.72, `ExtendedSerialNumber`.
    // ASN.1 Specification:
    //
    //     ExtendedSerialNumber ::= SEQUENCE { ... }
    dd.v1.ExtendedSerialNumber vu_serial_number = 16;

    // The serial number of the motion sensor.
    //
    // See Data Dictionary, Section 2.148, `SensorSerialNumber`.
    // ASN.1 Specification:
    //
    //     SensorSerialNumber ::= ExtendedSerialNumber
    dd.v1.ExtendedSerialNumber sensor_serial_number = 17;

    // --- Gen2+ fields ---

    // The serial number of the external GNSS facility.
    // See Data Dictionary, Section 2.139, `SensorGNSSSerialNumber`.
    dd.v1.ExtendedSerialNumber sensor_gnss_serial_number = 18;

    // The serial number of the remote communication module.
    // See Data Dictionary, Section 2.123, `RemoteCommunicationModuleSerialNumber`.
    dd.v1.ExtendedSerialNumber rcm_serial_number = 19;

    // Information about seals attached to vehicle components.
    // See Data Dictionary, Section 2.128, `SealDataCard`.
    SealDataCard seal_data_card = 20;
  }

  // Total number of calibrations performed with the card.
  // Corresponds to `calibrationTotalNumber`.
  //
  // See Data Dictionary, Section 2.235.
  // ASN.1 Specification:
  //
  //     INTEGER(0..NoOfCalibrationRecords)
  int32 calibration_total_count = 1;

  // Index of the last updated record.
  // Corresponds to `calibrationPointerNewestRecord`.
  //
  // See Data Dictionary, Section 2.235.
  // ASN.1 Specification:
  //
  //     INTEGER(0..NoOfCalibrationRecords-1)
  int32 newest_record_index = 2;

  // The set of calibration records.
  // Corresponds to `calibrationRecords`.
  repeated Record records = 3;
}
