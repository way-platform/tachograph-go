edition = "2023";

package wayplatform.connect.tachograph.card.v1;

import "google/protobuf/timestamp.proto";
import "wayplatform/connect/tachograph/datadictionary/v1/full_card_number.proto";
import "wayplatform/connect/tachograph/datadictionary/v1/vehicle_registration_identification.proto";

// Represents the content of the EF_Controller_Activity_Data file.
//
// The file structure is specified in Appendix 2, Section 4.4.1.
//
//     EF Controller_Activity_Data
//     └─ControlCardControlActivityData
//
// The data type `ControlCardControlActivityData` is specified in the Data Dictionary, Section 2.51.
//
// ASN.1 Specification:
//
//     ControlCardControlActivityData ::= SEQUENCE {
//         controlPointerNewestRecord INTEGER(0..NoOfControlActivityRecords-1),
//         controlActivityRecords SET SIZE(NoOfControlActivityRecords) OF
//         controlActivityRecord SEQUENCE {
//             controlType ControlType,
//             controlTime TimeReal,
//             controlledCardNumber FullCardNumber,
//             controlledVehicleRegistration VehicleRegistrationIdentification,
//             controlDownloadPeriodBegin TimeReal,
//             controlDownloadPeriodEnd TimeReal
//         }
//     }
message ControllerActivityData {
  // Represents a single control activity record.
  // See Data Dictionary, Section 2.51.
  message Record {
    // The type of the control.
    //
    // ASN.1 Specification:
    //
    //     ControlType ::= OCTET STRING (SIZE(1))
    bytes control_type = 1;

    // The date and time of the control.
    //
    // ASN.1 Specification:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp control_time = 2;

    // The full card number of the card that was controlled.
    //
    // ASN.1 Specification:
    //
    //     FullCardNumber ::= SEQUENCE { ... }
    datadictionary.v1.FullCardNumber controlled_card_number = 3;

    // The vehicle registration of the vehicle in which the control happened.
    //
    // ASN.1 Specification:
    //
    //     VehicleRegistrationIdentification ::= SEQUENCE { ... }
    datadictionary.v1.VehicleRegistrationIdentification controlled_vehicle_registration = 4;

    // The beginning of the downloaded period, if any.
    //
    // ASN.1 Specification:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp control_download_period_begin = 5;

    // The end of the downloaded period, if any.
    //
    // ASN.1 Specification:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp control_download_period_end = 6;
  }

  // Index of the last updated record in the ring buffer.
  int32 newest_record_index = 1;

  // The set of control activity records.
  repeated Record records = 2;
}