edition = "2023";

package wayplatform.connect.tachograph.vu.v1;

import "google/protobuf/timestamp.proto";
import "wayplatform/connect/tachograph/dd/v1/activity_change_info.proto";
import "wayplatform/connect/tachograph/dd/v1/card_slot_number.proto";
import "wayplatform/connect/tachograph/dd/v1/date.proto";
import "wayplatform/connect/tachograph/dd/v1/entry_type_daily_work_period.proto";
import "wayplatform/connect/tachograph/dd/v1/full_card_number.proto";
import "wayplatform/connect/tachograph/dd/v1/full_card_number_and_generation.proto";
import "wayplatform/connect/tachograph/dd/v1/generation.proto";
import "wayplatform/connect/tachograph/dd/v1/geo_coordinates.proto";
import "wayplatform/connect/tachograph/dd/v1/holder_name.proto";
import "wayplatform/connect/tachograph/dd/v1/nation_numeric.proto";
import "wayplatform/connect/tachograph/dd/v1/operation_type.proto";
import "wayplatform/connect/tachograph/dd/v1/position_authentication_status.proto";
import "wayplatform/connect/tachograph/dd/v1/previous_vehicle_info.proto";
import "wayplatform/connect/tachograph/dd/v1/specific_condition_record.proto";
import "wayplatform/connect/tachograph/dd/v1/specific_condition_type.proto";
import "wayplatform/connect/tachograph/dd/v1/vehicle_registration_identification.proto";
import "wayplatform/connect/tachograph/dd/v1/version.proto";

// Represents the consolidated data structure for an Activities transfer.
//
// This message corresponds to the data defined in the regulation document:
// Appendix 7, Section 2.2.6.3: "Positive Response Transfer Data Activities".
message Activities {
  // Represents a card insertion and withdrawal record.
  //
  // Binary Layout:
  //   Gen1: 130 bytes total
  //     - cardHolderName: 72 bytes
  //     - fullCardNumber: 19 bytes
  //     - cardExpiryDate: 4 bytes
  //     - cardInsertionTime: 4 bytes
  //     - vehicleOdometerValueAtInsertion: 3 bytes
  //     - cardSlotNumber: 1 byte
  //     - cardWithdrawalTime: 4 bytes
  //     - vehicleOdometerValueAtWithdrawal: 3 bytes
  //     - previousVehicleInfo: 19 bytes (15 vehicle reg + 4 cardWithdrawalTime)
  //     - manualInputFlag: 1 byte
  //
  //   Gen2: 132 bytes total
  //     - cardHolderName: 72 bytes
  //     - fullCardNumberAndGeneration: 20 bytes
  //     - cardExpiryDate: 4 bytes
  //     - cardInsertionTime: 4 bytes
  //     - vehicleOdometerValueAtInsertion: 3 bytes
  //     - cardSlotNumber: 1 byte
  //     - cardWithdrawalTime: 4 bytes
  //     - vehicleOdometerValueAtWithdrawal: 3 bytes
  //     - previousVehicleInfo: 20 bytes (15 vehicle reg + 4 cardWithdrawalTime + 1 vuGeneration)
  //     - manualInputFlag: 1 byte
  //
  // See Data Dictionary, Section 2.177, `VuCardIWRecord`.
  //
  // ASN.1 Definition (Gen1):
  //
  //     VuCardIWRecord ::= SEQUENCE {
  //         cardHolderName HolderName,
  //         fullCardNumber FullCardNumber,
  //         cardExpiryDate Datef,
  //         cardInsertionTime TimeReal,
  //         vehicleOdometerValueAtInsertion OdometerShort,
  //         cardSlotNumber CardSlotNumber,
  //         cardWithdrawalTime TimeReal,
  //         vehicleOdometerValueAtWithdrawal OdometerShort,
  //         previousVehicleInfo PreviousVehicleInfo,
  //         manualInputFlag ManualInputFlag
  //     }
  //
  // For Gen2, `fullCardNumber` is replaced by `fullCardNumberAndGeneration`.
  message CardIWRecord {
    // The name of the card holder.
    //
    // See Data Dictionary, Section 2.83, `HolderName`.
    dd.v1.HolderName card_holder_name = 1;

    // The full card number of the inserted card.
    // For Gen2 records, this will include the card generation.
    // For Gen1 records, the `generation` field within this message will be unset.
    //
    // See Data Dictionary, Section 2.73, `FullCardNumber` and 2.74, `FullCardNumberAndGeneration`.
    dd.v1.FullCardNumberAndGeneration full_card_number_and_generation = 2;

    // The expiry date of the card.
    //
    // See Data Dictionary, Section 2.57, `Datef`.
    // ASN.1 Definition:
    //
    //     Datef ::= OCTET STRING(SIZE(4))
    dd.v1.Date card_expiry_date = 3;

    // The time the card was inserted.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp card_insertion_time = 4;

    // The odometer value at the time of card insertion in kilometers.
    //
    // See Data Dictionary, Section 2.113, `OdometerShort`.
    // ASN.1 Definition:
    //
    //     OdometerShort ::= INTEGER(0..999999)
    int32 odometer_at_insertion_km = 5;

    // The slot the card was inserted into.
    //
    // See Data Dictionary, Section 2.33, `CardSlotNumber`.
    dd.v1.CardSlotNumber card_slot_number = 6;

    // The time the card was withdrawn.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp card_withdrawal_time = 8;

    // The odometer value at the time of card withdrawal in kilometers.
    //
    // See Data Dictionary, Section 2.113, `OdometerShort`.
    // ASN.1 Definition:
    //
    //     OdometerShort ::= INTEGER(0..999999)
    int32 odometer_at_withdrawal_km = 9;

    // Information about the previous vehicle used.
    //
    // See Data Dictionary, Section 2.118, `PreviousVehicleInfo`.
    dd.v1.PreviousVehicleInfo previous_vehicle_info = 10;

    // Indicates if manual entries were made.
    //
    // See Data Dictionary, Section 2.93, `ManualInputFlag`.
    bool manual_input_flag = 11;
  }

  // Represents a place record for the beginning or end of a daily work period.
  //
  // See Data Dictionary, Section 2.117, `PlaceRecord` and 2.116a, `PlaceAuthRecord`.
  message PlaceRecord {
    // Time of the entry.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp entry_time = 1;

    // Type of entry (begin or end).
    //
    // See Data Dictionary, Section 2.66, `EntryTypeDailyWorkPeriod`.
    dd.v1.EntryTypeDailyWorkPeriod entry_type = 2;

    // Country code.
    //
    // See Data Dictionary, Section 2.101, `NationNumeric`.
    // ASN.1 Definition:
    //
    //     NationNumeric ::= INTEGER (0..255)
    dd.v1.NationNumeric country = 4;

    // Region code. This is not a number, but a single-byte identifier.
    //
    // The name `RegionNumeric` is a misnomer; it distinguishes this type from
    // `RegionAlpha`. The value is an opaque byte whose meaning is defined by
    // an external enumeration.
    //
    // For Gen2, the list of codes for each country is maintained by the EU's
    // Joint Research Centre (JRC) and can be looked up on their website:
    // https://dtlab.jrc.ec.europa.eu/
    //
    // See Data Dictionary, Section 2.122, `RegionNumeric`.
    // ASN.1 Definition:
    //
    //     RegionNumeric ::= OCTET STRING (SIZE (1))
    bytes region = 6;

    // Odometer value at the time of entry in kilometers.
    //
    // See Data Dictionary, Section 2.113, `OdometerShort`.
    // ASN.1 Definition:
    //
    //     OdometerShort ::= INTEGER(0..999999)
    int32 odometer_km = 7;
  }

  // Represents a GNSS position record with authentication status.
  //
  // This corresponds to GNSSPlaceAuthRecord (Gen2v2+), which is a 12-byte
  // structure used in VU border crossing and load/unload records.
  //
  // Binary Layout: 12 bytes total
  //   - timeStamp: 4 bytes
  //   - gnssAccuracy: 1 byte
  //   - geoCoordinates: 6 bytes (3 bytes latitude + 3 bytes longitude)
  //   - authenticationStatus: 1 byte
  //
  // See Data Dictionary, Section 2.79c, `GNSSPlaceAuthRecord`.
  //
  // ASN.1 Definition:
  //
  //     GNSSPlaceAuthRecord ::= SEQUENCE {
  //         timeStamp TimeReal,
  //         gnssAccuracy GNSSAccuracy,
  //         geoCoordinates GeoCoordinates,
  //         authenticationStatus PositionAuthenticationStatus
  //     }
  message GnssRecord {
    // Timestamp of the position fix.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    google.protobuf.Timestamp timestamp = 1;

    // Accuracy of the GNSS fix.
    //
    // See Data Dictionary, Section 2.77, `GNSSAccuracy`.
    int32 gnss_accuracy = 2;

    // Geographic coordinates of the position.
    //
    // See Data Dictionary, Section 2.76, `GeoCoordinates`.
    wayplatform.connect.tachograph.dd.v1.GeoCoordinates geo_coordinates = 3;

    // Authentication status of the GNSS position (Gen2v2+).
    //
    // See Data Dictionary, Section 2.117a, `PositionAuthenticationStatus`.
    dd.v1.PositionAuthenticationStatus authentication_status = 5;

    // Preserved raw protocol value when authentication_status is UNRECOGNIZED.
    int32 unrecognized_authentication_status = 6;
  }

  // Represents a border crossing record (Gen2v2+).
  //
  // Binary Layout: 57 bytes total
  //   - cardNumberAndGenDriverSlot: 20 bytes
  //   - cardNumberAndGenCodriverSlot: 20 bytes
  //   - countryLeft: 1 byte
  //   - countryEntered: 1 byte
  //   - gnssPlaceAuthRecord: 12 bytes (4 + 1 + 6)
  //   - vehicleOdometerValue: 3 bytes
  //
  // See Data Dictionary, Section 2.203a, `VuBorderCrossingRecord`.
  //
  // ASN.1 Definition:
  //
  //     VuBorderCrossingRecord ::= SEQUENCE {
  //         cardNumberAndGenDriverSlot   FullCardNumberAndGeneration,
  //         cardNumberAndGenCodriverSlot FullCardNumberAndGeneration,
  //         countryLeft                  NationNumeric,
  //         countryEntered               NationNumeric,
  //         gnssPlaceAuthRecord          GNSSPlaceAuthRecord,
  //         vehicleOdometerValue         OdometerShort
  //     }
  message BorderCrossingRecord {
    // Card information for the driver slot.
    dd.v1.FullCardNumberAndGeneration card_number_driver_slot = 1;

    // Card information for the co-driver slot.
    dd.v1.FullCardNumberAndGeneration card_number_codriver_slot = 2;

    // Country the vehicle is leaving.
    //
    // See Data Dictionary, Section 2.101, `NationNumeric`.
    dd.v1.NationNumeric country_left = 3;

    // Country the vehicle is entering.
    //
    // See Data Dictionary, Section 2.101, `NationNumeric`.
    dd.v1.NationNumeric country_entered = 5;

    // Position of the vehicle at the time of crossing.
    //
    // See Data Dictionary, Section 2.79c, `GNSSPlaceAuthRecord`.
    GnssRecord place_record = 7;

    // Odometer value at the time of crossing in kilometers.
    //
    // See Data Dictionary, Section 2.113, `OdometerShort`.
    // ASN.1 Definition:
    //
    //     OdometerShort ::= INTEGER(0..999999)
    int32 odometer_km = 8;
  }

  // Represents a load/unload operation record (Gen2v2+).
  //
  // Binary Layout: 60 bytes total
  //   - timeStamp: 4 bytes
  //   - operationType: 1 byte
  //   - cardNumberAndGenDriverSlot: 20 bytes
  //   - cardNumberAndGenCodriverSlot: 20 bytes
  //   - gnssPlaceAuthRecord: 12 bytes (4 + 1 + 6)
  //   - vehicleOdometerValue: 3 bytes
  //
  // See Data Dictionary, Section 2.208a, `VuLoadUnloadRecord`.
  //
  // ASN.1 Definition:
  //
  //     VuLoadUnloadRecord ::= SEQUENCE {
  //         timeStamp                    TimeReal,
  //         operationType                OperationType,
  //         cardNumberAndGenDriverSlot   FullCardNumberAndGeneration,
  //         cardNumberAndGenCodriverSlot FullCardNumberAndGeneration,
  //         gnssPlaceAuthRecord          GNSSPlaceAuthRecord,
  //         vehicleOdometerValue         OdometerShort
  //     }
  message LoadUnloadRecord {
    // Timestamp of the operation.
    google.protobuf.Timestamp timestamp = 1;

    // Type of operation (load, unload, or both).
    wayplatform.connect.tachograph.dd.v1.OperationType operation_type = 2;

    // Card information for the driver slot.
    dd.v1.FullCardNumberAndGeneration card_number_driver_slot = 3;

    // Card information for the co-driver slot.
    dd.v1.FullCardNumberAndGeneration card_number_codriver_slot = 4;

    // Position of the vehicle at the time of the operation.
    //
    // See Data Dictionary, Section 2.79c, `GNSSPlaceAuthRecord`.
    GnssRecord place_record = 5;

    // Odometer value at the time of the operation in kilometers.
    //
    // See Data Dictionary, Section 2.113, `OdometerShort`.
    // ASN.1 Definition:
    //
    //     OdometerShort ::= INTEGER(0..999999)
    int32 odometer_km = 6;
  }

  // The generation of the vehicle unit, parsed from the raw transfer data.
  // This is a discriminator field used for parsing.
  dd.v1.Generation generation = 1;

  // The version of the interface, parsed from the raw transfer data.
  // This is a discriminator field used for parsing.
  wayplatform.connect.tachograph.dd.v1.Version version = 2;

  // Date of the downloaded day.
  //
  // See Data Dictionary, Section 2.162, `TimeReal`.
  // ASN.1 Definition:
  //
  //     TimeReal ::= INTEGER (0..2^32-1)
  google.protobuf.Timestamp date_of_day = 3;

  // Odometer value at midnight in kilometers.
  //
  // See Data Dictionary, Section 2.114, `OdometerValueMidnight`.
  // ASN.1 Definition:
  //
  //     OdometerValueMidnight ::= OdometerShort ::= INTEGER(0..999999)
  int32 odometer_midnight_km = 4;

  // Card insertion and withdrawal data.
  // Corresponds to `VuCardIWData` (DD 2.176) or `VuCardIWRecordArray` (DD 2.178).
  repeated CardIWRecord card_iw_data = 5;

  // Driver activity changes.
  // Corresponds to `VuActivityDailyData` (DD 2.170) or `VuActivityDailyRecordArray` (DD 2.171).
  repeated dd.v1.ActivityChangeInfo activity_changes = 6;

  // Daily work period place entries.
  // Corresponds to `VuPlaceDailyWorkPeriodData` (DD 2.218) or `VuPlaceDailyWorkPeriodRecordArray` (DD 2.220).
  repeated PlaceRecord places = 7;

  // Specific conditions data.
  // Corresponds to `VuSpecificConditionData` (DD 2.227) or `VuSpecificConditionRecordArray` (DD 2.228).
  //
  // See Data Dictionary, Section 2.152, `SpecificConditionRecord`.
  repeated dd.v1.SpecificConditionRecord specific_conditions = 8;

  // Gen2+ Fields: GNSS positions recorded at 3-hour accumulated driving time intervals.
  // Corresponds to `VuGNSSADRecordArray` (DD 2.204).
  repeated GnssRecord gnss_accumulated_driving = 9;

  // Gen2v2+ Fields: Border crossing records.
  // Corresponds to `VuBorderCrossingRecordArray` (DD 2.203b).
  repeated BorderCrossingRecord border_crossings = 10;

  // Gen2v2+ Fields: Load/unload operation records.
  // Corresponds to `VuLoadUnloadRecordArray` (DD 2.208b).
  repeated LoadUnloadRecord load_unload_operations = 11;

  // Signature for Gen1 data (RSA, 128 bytes).
  //
  // See Data Dictionary, Section 2.149, `Signature`.
  bytes signature_gen1 = 12;

  // Signature for Gen2 data (ECC).
  //
  // See Data Dictionary, Section 2.149, `Signature`.
  bytes signature_gen2 = 13;
}
