edition = "2023";

package wayplatform.connect.tachograph.vu.v1;

// Represents the data structure for a Gen2 Events and Faults transfer.
// This structure is used for both v1 (TREP 0x23) and v2 (TREP 0x33).
// See Appendix 7, Section 2.2.6.4.
message EventsAndFaultsGen2 {

  message FaultRecord {
    // See Appendix 1, 2.201
    uint32 fault_type = 1;
    uint32 record_purpose = 2;
    uint32 begin_time_seconds = 3;
    uint32 end_time_seconds = 4;
    string card_number = 5;
    uint32 card_generation = 6;
  }

  message EventRecord {
    // See Appendix 1, 2.198
    uint32 event_type = 1;
    uint32 record_purpose = 2;
    uint32 begin_time_seconds = 3;
    uint32 end_time_seconds = 4;
    string card_number = 5;
    uint32 card_generation = 6;
    uint32 similar_events_number = 7;
  }

  message OverSpeedingControlData {
    // See Appendix 1, 2.212
    uint32 last_control_time_seconds = 1;
    uint32 first_overspeed_since_last_control_seconds = 2;
    uint32 number_of_overspeed_since_last_control = 3;
  }

  message OverSpeedingEventRecord {
    // See Appendix 1, 2.215
    uint32 event_type = 1;
    uint32 record_purpose = 2;
    uint32 begin_time_seconds = 3;
    uint32 end_time_seconds = 4;
    uint32 max_speed_kmph = 5;
    uint32 average_speed_kmph = 6;
    string card_number = 7;
    uint32 card_generation = 8;
  }

  message TimeAdjustmentRecord {
    // See Appendix 1, 2.232
    uint32 old_time_seconds = 1;
    uint32 new_time_seconds = 2;
    string workshop_name = 3;
    string workshop_address = 4;
    string workshop_card_number = 5;
    uint32 workshop_card_generation = 6;
  }

  repeated FaultRecord faults = 1;
  repeated EventRecord events = 2;
  OverSpeedingControlData overspeeding_control = 3;
  repeated OverSpeedingEventRecord overspeeding_events = 4;
  repeated TimeAdjustmentRecord time_adjustments = 5;

  // Gen2 signature (ECC). See Appendix 1, 2.149.
  bytes signature = 6;
}
