edition = "2023";

package wayplatform.connect.tachograph.vu.v1;

import "wayplatform/connect/tachograph/vu/v1/activities.proto";
import "wayplatform/connect/tachograph/vu/v1/card_download.proto";
import "wayplatform/connect/tachograph/vu/v1/detailed_speed.proto";
import "wayplatform/connect/tachograph/vu/v1/download_interface_version.proto";
import "wayplatform/connect/tachograph/vu/v1/events_and_faults.proto";
import "wayplatform/connect/tachograph/vu/v1/overview.proto";
import "wayplatform/connect/tachograph/vu/v1/technical_data.proto";
import "wayplatform/connect/tachograph/vu/v1/transfer_type.proto";

// VehicleUnitFile completely encapsulates the content of a file downloaded from a Vehicle Unit (VU).
// These files typically have a .DDD, .V1B, or .C1B extension.
//
// The structure preserves the exact sequence of data blocks (transfers) as they appear in the
// original file, which is essential for ensuring perfect round-trip parsing and writing.
message VehicleUnitFile {
  // A Transfer represents a single data block within the downloaded file.
  // It acts as a manually tagged union, where the `type` field is the tag.
  // The structure of a transfer is defined in Appendix 7 of the regulation.
  message Transfer {
    // The semantic type of the data in this transfer, corresponding
    // directly to the TREP value from the raw file. This serves as the
    // discriminator for the payload fields below.
    //
    // The application should use this `type` to determine which of the payload
    // fields is valid for this transfer. For example, if the type is
    // OVERVIEW_GEN1, OVERVIEW_GEN2_V1, or OVERVIEW_GEN2_V2, the `overview` field
    // will be populated.
    TransferType type = 1;

    // The payload fields. Only one of these will be populated for any given Transfer.
    DownloadInterfaceVersion download_interface_version = 2;
    Overview overview = 3;
    Activities activities = 4;
    EventsAndFaults events_and_faults = 5;
    DetailedSpeed detailed_speed = 6;
    TechnicalData technical_data = 7;
    CardDownload card_download = 8;
  }

  // A VehicleUnitFile consists of a sequence of transfers, preserving the
  // order from the original downloaded file.
  repeated Transfer transfers = 1;
}
