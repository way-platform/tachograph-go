edition = "2023";

package wayplatform.connect.tachograph.vu.v1;

import "google/protobuf/timestamp.proto";
import "wayplatform/connect/tachograph/dd/v1/event_fault_record_purpose.proto";
import "wayplatform/connect/tachograph/dd/v1/event_fault_type.proto";
import "wayplatform/connect/tachograph/dd/v1/full_card_number_and_generation.proto";
import "wayplatform/connect/tachograph/dd/v1/generation.proto";
import "wayplatform/connect/tachograph/dd/v1/string_value.proto";

// Represents the consolidated data structure for an Events and Faults transfer.
//
// This message corresponds to the data defined in the regulation document:
// Appendix 7, Section 2.2.6.4: "Positive Response Transfer Data Events and Faults".
message EventsAndFaults {
  // The generation of the vehicle unit, parsed from the raw transfer data.
  // This is a discriminator field used for parsing.
  dd.v1.Generation generation = 1;

  // Represents a vehicle unit fault record.
  //
  // See Data Dictionary, Section 2.201, `VuFaultRecord`.
  //
  // Note: This protobuf message simplifies the four card number fields from the
  // raw record into a single `card_identifier` field.
  //
  // ASN.1 Definition (Gen1):
  //
  //     VuFaultRecord ::= SEQUENCE {
  //         faultType EventFaultType,
  //         faultRecordPurpose EventFaultRecordPurpose,
  //         faultBeginTime TimeReal,
  //         faultEndTime TimeReal,
  //         cardNumberDriverSlotBegin FullCardNumber,
  //         cardNumberCodriverSlotBegin FullCardNumber,
  //         cardNumberDriverSlotEnd FullCardNumber,
  //         cardNumberCodriverSlotEnd FullCardNumber
  //     }
  //
  // ASN.1 Definition (Gen2):
  //
  //     VuFaultRecord ::= SEQUENCE {
  //         faultType EventFaultType,
  //         faultRecordPurpose EventFaultRecordPurpose,
  //         faultBeginTime TimeReal,
  //         faultEndTime TimeReal,
  //         cardNumberAndGenDriverSlotBegin FullCardNumberAndGeneration,
  //         cardNumberAndGenCodriverSlotBegin FullCardNumberAndGeneration,
  //         cardNumberAndGenDriverSlotEnd FullCardNumberAndGeneration,
  //         cardNumberAndGenCodriverSlotEnd FullCardNumberAndGeneration,
  //         manufacturerSpecificEventFaultData ManufacturerSpecificEventFaultData
  //     }
  message FaultRecord {
    // Type of the fault.
    //
    // See Data Dictionary, Section 2.70, `EventFaultType`.
    dd.v1.EventFaultType fault_type = 1;
    int32 unrecognized_fault_type = 2;

    // Purpose for which the fault has been recorded.
    //
    // See Data Dictionary, Section 2.69, `EventFaultRecordPurpose`.
    dd.v1.EventFaultRecordPurpose record_purpose = 3;
    int32 unrecognized_record_purpose = 4;

    // Date and time of the beginning of the fault.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp begin_time = 5;

    // Date and time of the end of the fault.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp end_time = 6;

    // The card number and generation of the driver/workshop associated with the event.
    // This field is a simplification, combining multiple card number fields from the raw record.
    //
    // See Data Dictionary, Section 2.74, `FullCardNumberAndGeneration`.
    // ASN.1 Definition:
    //
    //     FullCardNumberAndGeneration ::= SEQUENCE {
    //         fullcardNumber FullCardNumber,
    //         generation Generation
    //     }
    dd.v1.FullCardNumberAndGeneration card_identifier = 7;
  }

  // Represents a vehicle unit event record.
  //
  // See Data Dictionary, Section 2.198, `VuEventRecord`.
  //
  // Note: This protobuf message simplifies the four card number fields from the
  // raw record into a single `card_identifier` field.
  //
  // ASN.1 Definition (Gen1):
  //
  //     VuEventRecord ::= SEQUENCE {
  //         eventType EventFaultType,
  //         eventRecordPurpose EventFaultRecordPurpose,
  //         eventBeginTime TimeReal,
  //         eventEndTime TimeReal,
  //         cardNumberDriverSlotBegin FullCardNumber,
  //         cardNumberCodriverSlotBegin FullCardNumber,
  //         cardNumberDriverSlotEnd FullCardNumber,
  //         cardNumberCodriverSlotEnd FullCardNumber,
  //         similarEventsNumber SimilarEventsNumber
  //     }
  //
  // ASN.1 Definition (Gen2):
  //
  //     VuEventRecord ::= SEQUENCE {
  //         eventType EventFaultType,
  //         eventRecordPurpose EventFaultRecordPurpose,
  //         eventBeginTime TimeReal,
  //         eventEndTime TimeReal,
  //         cardNumberAndGenDriverSlotBegin FullCardNumberAndGeneration,
  //         cardNumberAndGenCodriverSlotBegin FullCardNumberAndGeneration,
  //         cardNumberAndGenDriverSlotEnd FullCardNumberAndGeneration,
  //         cardNumberAndGenCodriverSlotEnd FullCardNumberAndGeneration,
  //         similarEventsNumber SimilarEventsNumber,
  //         manufacturerSpecificEventFaultData ManufacturerSpecificEventFaultData
  //     }
  message EventRecord {
    // Type of the event.
    //
    // See Data Dictionary, Section 2.70, `EventFaultType`.
    dd.v1.EventFaultType event_type = 1;
    int32 unrecognized_event_type = 2;

    // Purpose for which the event has been recorded.
    //
    // See Data Dictionary, Section 2.69, `EventFaultRecordPurpose`.
    dd.v1.EventFaultRecordPurpose record_purpose = 3;
    int32 unrecognized_record_purpose = 4;

    // Date and time of the beginning of the event.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp begin_time = 5;

    // Date and time of the end of the event.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp end_time = 6;

    // The card number and generation of the driver/workshop associated with the event.
    // This field is a simplification, combining multiple card number fields from the raw record.
    //
    // See Data Dictionary, Section 2.74, `FullCardNumberAndGeneration`.
    // ASN.1 Definition:
    //
    //     FullCardNumberAndGeneration ::= SEQUENCE {
    //         fullcardNumber FullCardNumber,
    //         generation Generation
    //     }
    dd.v1.FullCardNumberAndGeneration card_identifier = 7;

    // Number of similar events on the same day.
    //
    // See Data Dictionary, Section 2.151, `SimilarEventsNumber`.
    // ASN.1 Definition:
    //
    //     SimilarEventsNumber ::= INTEGER(0..255)
    int32 similar_events_number = 8;
  }

  // Represents overspeeding control data.
  //
  // See Data Dictionary, Section 2.212, `VuOverSpeedingControlData`.
  //
  // ASN.1 Definition:
  //
  //     VuOverSpeedingControlData ::= SEQUENCE {
  //         lastOverspeedControlTime TimeReal,
  //         firstOverspeedSince TimeReal,
  //         numberOfOverspeedSince OverspeedNumber
  //     }
  message OverSpeedingControlData {
    // Date and time of the last overspeeding control.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp last_control_time = 1;

    // Date and time of the first overspeeding since the last control.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp first_overspeed_since_last_control = 2;

    // Number of overspeeding events since the last control.
    //
    // See Data Dictionary, Section 2.116, `OverspeedNumber`.
    // ASN.1 Definition:
    //
    //     OverspeedNumber ::= INTEGER (0..255)
    int32 number_of_overspeed_since_last_control = 3;
  }

  // Represents an overspeeding event record.
  //
  // See Data Dictionary, Section 2.215, `VuOverSpeedingEventRecord`.
  //
  // ASN.1 Definition (Gen1):
  //
  //     VuOverSpeedingEventRecord ::= SEQUENCE {
  //         eventType EventFaultType,
  //         eventRecordPurpose EventFaultRecordPurpose,
  //         eventBeginTime TimeReal,
  //         eventEndTime TimeReal,
  //         maxSpeedValue SpeedMax,
  //         averageSpeedValue SpeedAverage,
  //         cardNumberDriverSlotBegin FullCardNumber,
  //         similarEventsNumber SimilarEventsNumber
  //     }
  //
  // ASN.1 Definition (Gen2):
  //
  //     VuOverSpeedingEventRecord ::= SEQUENCE {
  //         eventType EventFaultType,
  //         eventRecordPurpose EventFaultRecordPurpose,
  //         eventBeginTime TimeReal,
  //         eventEndTime TimeReal,
  //         maxSpeedValue SpeedMax,
  //         averageSpeedValue SpeedAverage,
  //         cardNumberAndGenDriverSlotBegin FullCardNumberAndGeneration,
  //         similarEventsNumber SimilarEventsNumber
  //     }
  message OverSpeedingEventRecord {
    // Type of the event (always 'Over speeding').
    //
    // See Data Dictionary, Section 2.70, `EventFaultType`.
    dd.v1.EventFaultType event_type = 1;
    int32 unrecognized_event_type = 2;

    // Purpose for which the event has been recorded.
    //
    // See Data Dictionary, Section 2.69, `EventFaultRecordPurpose`.
    dd.v1.EventFaultRecordPurpose record_purpose = 3;
    int32 unrecognized_record_purpose = 4;

    // Date and time of the beginning of the event.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp begin_time = 5;

    // Date and time of the end of the event.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp end_time = 6;

    // Maximum speed measured during the event in km/h.
    //
    // See Data Dictionary, Section 2.158, `SpeedMax`.
    // ASN.1 Definition:
    //
    //     SpeedMax ::= Speed ::= INTEGER(0..255)
    int32 max_speed_kmh = 7;

    // Average speed measured during the event in km/h.
    //
    // See Data Dictionary, Section 2.157, `SpeedAverage`.
    // ASN.1 Definition:
    //
    //     SpeedAverage ::= Speed ::= INTEGER(0..255)
    int32 average_speed_kmh = 8;

    // The card number and generation of the driver who caused the event.
    //
    // See Data Dictionary, Section 2.74, `FullCardNumberAndGeneration`.
    // ASN.1 Definition (Gen2):
    //
    //     cardNumberAndGenDriverSlotBegin FullCardNumberAndGeneration
    dd.v1.FullCardNumberAndGeneration card_identifier = 9;

    // Number of similar events on the same day.
    //
    // See Data Dictionary, Section 2.151, `SimilarEventsNumber`.
    // ASN.1 Definition:
    //
    //     SimilarEventsNumber ::= INTEGER(0..255)
    int32 similar_events_number = 10;
  }

  // Represents a time adjustment record.
  //
  // See Data Dictionary, Section 2.232, `VuTimeAdjustmentRecord`.
  //
  // Note: The ASN.1 definition in the Data Dictionary is incomplete. Annex IC,
  // requirement 125, mandates the inclusion of the workshop card's expiry date,
  // which is added to this message as `workshop_card_expiry_date`.
  //
  // ASN.1 Definition (Gen1):
  //
  //     VuTimeAdjustmentRecord ::= SEQUENCE {
  //         oldTimeValue TimeReal,
  //         newTimeValue TimeReal,
  //         workshopName Name,
  //         workshopAddress Address,
  //         workshopCardNumber FullCardNumber
  //     }
  //
  // ASN.1 Definition (Gen2):
  //
  //     VuTimeAdjustmentRecord ::= SEQUENCE {
  //         oldTimeValue TimeReal,
  //         newTimeValue TimeReal,
  //         workshopName Name,
  //         workshopAddress Address,
  //         workshopCardNumberAndGeneration FullCardNumberAndGeneration
  //     }
  message TimeAdjustmentRecord {
    // Time value before adjustment.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp old_time = 1;

    // Time value after adjustment.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp new_time = 2;

    // Name of the workshop that performed the adjustment.
    //
    // See Data Dictionary, Section 2.99, `Name`.
    // ASN.1 Definition:
    //
    //     Name ::= SEQUENCE { codePage INTEGER(0..255), name OCTET STRING (SIZE(36)) }
    wayplatform.connect.tachograph.dd.v1.StringValue workshop_name = 3;

    // Address of the workshop.
    //
    // See Data Dictionary, Section 2.2, `Address`.
    // ASN.1 Definition:
    //
    //     Address ::= SEQUENCE { codePage INTEGER(0..255), address OCTET STRING (SIZE(36)) }
    wayplatform.connect.tachograph.dd.v1.StringValue workshop_address = 4;

    // The card number and generation of the workshop that performed the adjustment.
    //
    // See Data Dictionary, Section 2.74, `FullCardNumberAndGeneration`.
    dd.v1.FullCardNumberAndGeneration workshop_card_identifier = 5;

    // Expiry date of the workshop card used for the adjustment.
    //
    // This field is required by Annex IC, requirement 125, but is missing from the
    // `VuTimeAdjustmentRecord` definition in Data Dictionary 2.232.
    //
    // See Data Dictionary, Section 2.162, `TimeReal`.
    // ASN.1 Definition:
    //
    //     TimeReal ::= INTEGER (0..2^32-1)
    google.protobuf.Timestamp workshop_card_expiry_date = 6;
  }

  // All faults stored or on-going in the VU.
  // Corresponds to `VuFaultData` (DD 2.200) or `VuFaultRecordArray` (DD 2.202).
  repeated FaultRecord faults = 2;

  // All events (except over speeding) stored or on-going in the VU.
  // Corresponds to `VuEventData` (DD 2.197) or `VuEventRecordArray` (DD 2.199).
  repeated EventRecord events = 3;

  // Data related to the last overspeeding control.
  // Corresponds to `VuOverSpeedingControlData` (DD 2.212) or `VuOverSpeedingControlDataRecordArray` (DD 2.213).
  OverSpeedingControlData overspeeding_control = 4;

  // All overspeeding events stored in the VU.
  // Corresponds to `VuOverSpeedingEventData` (DD 2.214) or `VuOverSpeedingEventRecordArray` (DD 2.216).
  repeated OverSpeedingEventRecord overspeeding_events = 5;

  // All time adjustment events stored in the VU (outside a full calibration).
  // Corresponds to `VuTimeAdjustmentData` (DD 2.229) or `VuTimeAdjustmentRecordArray` (DD 2.233).
  repeated TimeAdjustmentRecord time_adjustments = 6;

  // Signature for Gen1 data (RSA, 128 bytes).
  //
  // See Data Dictionary, Section 2.149, `Signature`.
  bytes signature_gen1 = 7;

  // Signature for Gen2 data (ECC).
  //
  // See Data Dictionary, Section 2.149, `Signature`.
  bytes signature_gen2 = 8;
}
