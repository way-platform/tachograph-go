<!DOCTYPE html>
<html>
<head>

      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
      <title>Consolidated TEXT: 32016R0799 — EN — 21.08.2023</title>
      <link type="text/css" rel="stylesheet" href="http://publications.europa.eu/resource/presentation-style-sheet/clg/clg.css"/>
   
</head>
<body>
<p class="title-annex-1" id="id-cda937b7-0b5a-4cc9-84a2-05e52fb5775f">Appendix 11</p>
<p class="title-gr-seq-level-1" id="id-93457085-a322-4b6b-996d-60dd27d021e5">
               <span class="boldface">COMMON SECURITY MECHANISMS</span>
            </p>
<table width="100%" border="0" cellspacing="0" cellpadding="3">
               <colgroup><col width="15%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td colspan="2">
                     <p class="title-toc" id="id-59028feb-ae00-44cf-91c8-d19358a2edf9">TABLE OF CONTENTS</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">
                  </p></td>
                  <td valign="top">
                     <p class="toc-item">PREAMBLE</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">PART A</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">FIRST-GENERATION TACHOGRAPH SYSTEM</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">INTRODUCTION</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">1.1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">References</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">1.2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Notations and abbreviated terms</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">CRYPTOGRAPHIC SYSTEMS AND ALGORITHMS</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">2.1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Cryptographic systems</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">2.2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Cryptographic algorithms</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">2.2.1</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">RSA algorithm</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">2.2.2</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Hash algorithm</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">2.2.3</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Data Encryption Algorithm</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">3.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">KEYS AND CERTIFICATES</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">3.1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Keys generation and distribution</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">3.1.1</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">RSA Keys generation and distribution</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">3.1.2</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">RSA Test keys</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">3.1.3</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Motion sensor keys</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">3.1.4</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">T-DES session keys generation and distribution</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">3.2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Keys</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">3.3.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Certificates</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">3.3.1</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Certificates content</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">3.3.2</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Certificates issued</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">3.3.3</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Certificate verification and unwrapping</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">4.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">MUTUAL AUTHENTICATION MECHANISM</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">5.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">VU-CARDS DATA TRANSFER CONFIDENTIALITY, INTEGRITY AND AUTHENTICATION MECHANISMS</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">5.1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Secure Messaging</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">5.2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Treatment of Secure Messaging errors</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">5.3.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Algorithm to compute Cryptographic Checksums</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">5.4.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Algorithm to compute cryptograms for confidentiality DOs</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">6.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">DATA DOWNLOAD DIGITAL SIGNATURE MECHANISMS</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">6.1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Signature generation</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">6.2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Signature verification</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">PART B</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">SECOND-GENERATION TACHOGRAPH SYSTEM</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">7.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">INTRODUCTION</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">7.1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">References</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">7.2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Notations and Abbreviations</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">7.3.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Definitions</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">8.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">CRYPTOGRAPHIC SYSTEMS AND ALGORITHMS</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">8.1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Cryptographic Systems</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">8.2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Cryptographic Algorithms</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">8.2.1</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Symmetric Algorithms</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">8.2.2</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Asymmetric Algorithms and Standardized Domain Parameters</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">8.2.3</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Hashing algorithms</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">8.2.4</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Cipher Suites</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">KEYS AND CERTIFICATES</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Asymmetric Key Pairs and Public Key Certificates</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.1.1</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">General</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.1.2</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">European Level</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.1.3</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Member State Level</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.1.4</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Equipment Level: Vehicle Units</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.1.5</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Equipment Level: Tachograph Cards</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.1.6</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Equipment Level: External GNSS Facilities</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.1.7</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Overview: Certificate Replacement</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Symmetric Keys</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.2.1</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Keys for Securing VU — Motion Sensor Communication</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.2.2</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Keys for Securing DSRC Communication</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.3.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Certificates</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.3.1</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">General</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.3.2</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Certificate Content</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">9.3.3</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Requesting Certificates</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">10.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">VU- CARD MUTUAL AUTHENTICATION AND SECURE MESSAGING</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">10.1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">General</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">10.2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Mutual Certificate Chain Verification</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">10.2.1</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Card Certificate Chain Verification by VU</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">10.2.2</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">VU Certificate Chain Verification by Card</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">10.3.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">VU Authentication</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">10.4.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Chip Authentication and Session Key Agreement</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">10.5.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Secure Messaging</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">10.5.1</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">General</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">10.5.2</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Secure Message Structure</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">10.5.3</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Secure Messaging Session Abortion</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">11.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">VU — EXTERNAL GNSS FACILITY COUPLING, MUTUAL AUTHENTICATION AND SECURE MESSAGING</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">11.1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">General</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">11.2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">VU and External GNSS Facility Coupling</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">11.3.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Mutual Certificate Chain Verification</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">11.3.1</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">General</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">11.3.2</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">During VU — EGF Coupling</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">11.3.3</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">During Normal Operation</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">11.4.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">VU Authentication, Chip Authentication and Session Key Agreement</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">11.5.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Secure Messaging</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">12.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">VU — MOTION SENSOR PAIRING AND COMMUNICATION</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">12.1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">General</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">12.2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">VU — Motion Sensor Pairing Using Different Key Generations</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">12.3.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">VU — Motion Sensor Pairing and Communication using AES</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">12.4.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">VU — Motion Sensor Pairing For Different Equipment Generations</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">13.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">SECURITY FOR REMOTE COMMUNICATION OVER DSRC</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">13.1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">General</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">13.2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Tachograph Payload Encryption and MAC Generation</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">13.3.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Verification and Decryption of Tachograph Payload</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">14.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">SIGNING DATA DOWNLOADS AND VERIFYING SIGNATURES</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">14.1.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">General</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">14.2.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Signature generation</p>
                  </td>
               </tr>
               <tr>
                  <td valign="top">
                     <p class="toc-item">14.3.</p>
                  </td>
                  <td valign="top">
                     <p class="toc-item">Signature verification</p>
                  </td>
               </tr>
            </tbody></table>
<p class="title-gr-seq-level-2" id="id-6f61e71f-ee7c-42dd-8947-815b7b37e934">PREAMBLE</p>
<p class="norm">This Appendix specifies the security mechanisms ensuring</p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">mutual authentication between different components of the tachograph system.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">confidentiality, integrity, authenticity and/or non-repudiation of data transferred between different components of the tachograph system or downloaded to external storage media.</div>
               </div>
            </div>
<p class="norm">This Appendix consists of two parts. Part A defines the security mechanisms for the first-generation tachograph system (digital tachograph). Part B defines the security mechanisms for the second-generation tachograph system (smart tachograph).</p>
<p class="norm">The mechanisms specified in Part A of this Appendix shall apply if at least one of the components of the tachograph system involved in a mutual authentication and/or data transfer process is of the first generation.</p>
<p class="norm">The mechanisms specified in Part B of this Appendix shall apply if both components of the tachograph system involved in the mutual authentication and/or data transfer process are of the second generation.</p>
<p class="norm">Appendix 15 provides more information regarding the use of first generation components in combination with second-generation components.</p>
<p class="title-gr-seq-level-2" id="id-149602e8-2d16-4bf9-bd37-8f55e15405fd">PART A</p>
<p class="title-gr-seq-level-2" id="id-248cc71d-0099-429f-9728-3bd8816bdffd">
               <span class="boldface">FIRST-GENERATION TACHOGRAPH SYSTEM</span>
            </p>
<p class="title-gr-seq-level-3" id="id-4b855caa-6cc9-4986-9d45-7cfd940d0aba">1.   <span class="boldface">INTRODUCTION</span>
            </p>
<p class="title-gr-seq-level-4" id="id-ab2d827e-55b5-4f6d-85fb-5ee04df3bccb">1.1.   <span class="boldface">
                  <span class="boldface">References</span>
               </span>
            </p>
<p class="norm">The following references are used in this Appendix:</p>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">SHA-1</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">National Institute of Standards and Technology (NIST). <span class="italics">FIPS Publication 180-1: Secure Hash Standard</span>. April 1995.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">PKCS1</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">RSA Laboratories. PKCS # 1: <span class="italics">RSA Encryption Standard</span>. Version 2.0. October 1998.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">TDES</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">National Institute of Standards and Technology (NIST). <span class="italics">FIPS Publication 46-3: Data Encryption Standard</span>. Draft 1999.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">TDES-OP</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">ANSI X9.52, Triple Data Encryption Algorithm Modes of Operation. 1998.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ISO/IEC 7816-4</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Information Technology — Identification cards — Integrated circuit(s) cards with contacts — Part 4: Interindustry commands for interexchange. First edition: 1995 + Amendment 1: 1997.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ISO/IEC 7816-6</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Information Technology — Identification cards — Integrated circuit(s) cards with contacts — Part 6: Interindustry data elements. First edition: 1996 + Cor 1: 1998.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ISO/IEC 7816-8</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Information Technology — Identification cards — Integrated circuit(s) cards with contacts — Part 8: Security related interindustry commands. First edition 1999.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ISO/IEC 9796-2</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Information Technology — Security techniques — Digital signature schemes giving message recovery — Part 2: Mechanisms using a hash function. First edition: 1997.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ISO/IEC 9798-3</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Information Technology — Security techniques — Entity authentication mechanisms — Part 3: Entity authentication using a public key algorithm. Second edition 1998.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ISO 16844-3</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Road vehicles — Tachograph systems — Part 3: Motion sensor interface.</p>
                  </td>
               </tr>
            </tbody></table>
<p class="title-gr-seq-level-4" id="id-431477d1-66c9-4f3b-9459-f67f2deafa33">1.2.   <span class="boldface">
                  <span class="boldface">Notations and abbreviated terms</span>
               </span>
            </p>
<p class="norm">The following notations and abbreviated terms are used in this Appendix:</p>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">(K<span class="subscript">a</span>, K<span class="subscript">b</span>, K<span class="subscript">c</span>)</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">a key bundle for use by the Triple Data Encryption Algorithm,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CA</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Certification Authority,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CAR</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Certification Authority Reference,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CC</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Cryptographic Checksum,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CG</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Cryptogram,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CH</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Command Header,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CHA</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Certificate Holder Authorisation,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CHR</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Certificate Holder Reference,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">D()</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Decryption with DES,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">DE</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Data Element,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">DO</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Data Object,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">
                        <span class="italics">d</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">RSA private key, private exponent,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">
                        <span class="italics">e</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">RSA public key, public exponent,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">E()</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Encryption with DES,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">EQT</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Equipment,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">
                        <span class="italics">Hash()</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">hash value, an output of <span class="italics">Hash</span>,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">
                        <span class="italics">Hash</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">hash function,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">KID</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Key Identifier,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">Km</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">TDES key. Master Key defined in ISO 16844-3.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">Km<span class="subscript">VU</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">TDES key inserted in vehicle units.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">Km<span class="subscript">WC</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">TDES key inserted in workshop cards.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">
                        <span class="italics">m</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">message representative, an integer between 0 and <span class="italics">n</span>-1,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">
                        <span class="italics">n</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">RSA keys, modulus,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">PB</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Padding Bytes,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">PI</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Padding Indicator byte (for use in Cryptogram for confidentiality DO),</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">PV</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Plain Value,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">
                        <span class="italics">s</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">signature representative, an integer between 0 and <span class="italics">n</span>-1,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">SSC</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Send Sequence Counter,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">SM</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Secure Messaging,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">TCBC</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">TDEA Cipher Block Chaining Mode of Operation</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">TDEA</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Triple Data Encryption Algorithm,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">TLV</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Tag Length Value,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">VU</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Vehicle Unit,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.C</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">the certificate of user X issued by a certification authority,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.CA</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">a certification authority of user X,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.CA.PK <span class="subscript">o</span> X.C</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">the operation of unwrapping a certificate to extract a public key. It is an infix operator, whose left operand is the public key of a certification authority, and whose right operand is the certificate issued by that certification authority. The outcome is the public key of the user X whose certificate is the right operand,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.PK</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">RSA public key of a user X,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.PK[I]</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">RSA encipherment of some information I, using the public key of user X,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.SK</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">RSA private key of a user X,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.SK[I]</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">RSA encipherment of some information I, using the private key of user X,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">‘xx’</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">an Hexadecimal value,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">||</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">concatenation operator.</p>
                  </td>
               </tr>
            </tbody></table>
<p class="title-gr-seq-level-3" id="id-410f9ecf-b9ed-489b-9b21-ef4e23942c1a">2.   <span class="boldface">CRYPTOGRAPHIC SYSTEMS AND ALGORITHMS</span>
            </p>
<p class="title-gr-seq-level-4" id="id-9c870b6b-8ecc-4130-8d24-19064d923ca7">2.1.   <span class="boldface">
                  <span class="boldface">Cryptographic systems</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_001<span style="word-spacing: NaNpt"> </span>Vehicle units and tachograph cards shall use a classical RSA public-key cryptographic system to provide the following security mechanisms:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">authentication between vehicle units and cards,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">transport of Triple-DES session keys between vehicle units and tachograph cards,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">digital signature of data downloaded from vehicle units or tachograph cards to external media.</div>
               </div>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_002<span style="word-spacing: NaNpt"> </span>Vehicle units and tachograph cards shall use a Triple DES symmetric cryptographic system to provide a mechanism for data integrity during user data exchange between vehicle units and tachograph cards, and to provide, where applicable, confidentiality of data exchange between vehicle units and tachograph cards.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-765cf608-59c3-470a-ac81-c27c282bc615">2.2.   <span class="boldface">
                  <span class="boldface">Cryptographic algorithms</span>
               </span>
            </p>
<p class="title-gr-seq-level-5" id="id-e3a7167d-05b5-4106-bdfa-d748ff80ff88">2.2.1   <span class="boldface">
                  <span class="italics">RSA algorithm</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_003<span style="word-spacing: NaNpt"> </span>The RSA algorithm is fully defined by the following relations:</p>
            </div>
<p class="norm">X.SK[<span class="italics">m</span>] = <span class="italics">s</span> = <span class="italics">m<span class="superscript">d</span>
               </span> mod <span class="italics">n</span>
            </p>
<p class="norm">X.PK[<span class="italics">s</span>] = <span class="italics">m</span> = <span class="italics">s<span class="superscript">e</span>
               </span> mod <span class="italics">n</span>
            </p>
<p class="list">A more comprehensive description of the RSA function can be found in reference [PKCS1]. Public exponent, e, for RSA calculations is an integer between 3 and n-1 satisfying gcd(e, lcm(p-1, q-1))=1.</p>
<p class="title-gr-seq-level-5" id="id-4262f9ef-ae57-4a3d-83de-d8d742a3cf82">2.2.2   <span class="boldface">
                  <span class="italics">Hash algorithm</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_004<span style="word-spacing: NaNpt"> </span>The digital signature mechanisms shall use the SHA-1 hash algorithm as defined in reference [SHA-1].</p>
            </div>
<p class="title-gr-seq-level-5" id="id-525e263e-c073-4649-8ab7-8ae5f6c64955">2.2.3   <span class="boldface">
                  <span class="italics">Data Encryption Algorithm</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_005<span style="word-spacing: NaNpt"> </span>DES based algorithms shall be used in Cipher Block Chaining mode of operation.</p>
            </div>
<p class="title-gr-seq-level-3" id="id-d1968d65-dd79-417f-81c7-b93f434891ab">3.   <span class="boldface">KEYS AND CERTIFICATES</span>
            </p>
<p class="title-gr-seq-level-4" id="id-66880c5c-54c9-4d66-9e22-8635b9e21df9">3.1.   <span class="boldface">
                  <span class="boldface">Keys generation and distribution</span>
               </span>
            </p>
<p class="title-gr-seq-level-5" id="id-03a3187d-bcca-4f00-bc71-d3b8c846d7e3">3.1.1   <span class="boldface">
                  <span class="italics">RSA Keys generation and distribution</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_006<span style="word-spacing: NaNpt"> </span>RSA keys shall be generated through three functional hierarchical levels:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">European level,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Member State level,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Equipment level.</div>
               </div>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_007<span style="word-spacing: NaNpt"> </span>At European level, a single European key pair (EUR.SK and EUR.PK) shall be generated. The European private key shall be used to certify the Member States public keys. Records of all certified keys shall be kept. These tasks shall be handled by a European Certification Authority, under the authority and responsibility of the European Commission.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_008<span style="word-spacing: NaNpt"> </span>At Member State level, a Member State key pair (MS.SK and MS.PK) shall be generated. Member States public keys shall be certified by the European Certification Authority. The Member State private key shall be used to certify public keys to be inserted in equipment (vehicle unit or tachograph card). Records of all certified public keys shall be kept with the identification of the equipment to which it is intended. These tasks shall be handled by a Member State Certification Authority. A Member State may regularly change its key pair.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_009<span style="word-spacing: NaNpt"> </span>At equipment level, one single key pair (EQT.SK and EQT.PK) shall be generated and inserted in each equipment. Equipment public keys shall be certified by a Member State Certification Authority. These tasks may be handled by equipment manufacturers, equipment personalisers or Member State authorities. This key pair is used for authentication, digital signature and encipherement services</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_010<span style="word-spacing: NaNpt"> </span>Private keys confidentiality shall be maintained during generation, transport (if any) and storage.</p>
            </div>
<p class="list">The following picture summarises the data flow of this process:</p>
<p class="list">
               
            </p>
<p class="title-gr-seq-level-5" id="id-caee77e2-7ba3-4f10-bfef-0b77fc81ccc6">3.1.2   <span class="boldface">
                  <span class="italics">RSA Test keys</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_011<span style="word-spacing: NaNpt"> </span>For the purpose of equipment testing (including interoperability tests) the European Certification Authority shall generate a different single European test key pair and at least two Member State test key pairs, the public keys of which shall be certified with the European private test key. Manufacturers shall insert, in equipment undergoing type approval tests, test keys certified by one of these Member State test keys.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-489b040e-9b26-4a6a-b988-203429415602">3.1.3   <span class="boldface">
                  <span class="italics">Motion sensor keys</span>
               </span>
            </p>
<p class="norm">The confidentiality of the three Triple DES keys described below shall be appropriately maintained during generation, transport (if any) and storage.</p>
<p class="norm">In order to support tachograph components compliant with ISO 16844, the European Certification Authority and the Member State Certification Authorities shall, in addition, ensure the following:</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="normal">CSM_036</p>
               <span style="word-spacing: NaNpt"> </span>
               <p class="normal">The European Certification authority shall generate KmVU and KmWC, two independent and unique Triple DES keys, and generate Km as: </p>
               <div class="box">Km = Km<span class="subscript">VU</span> XOR Km<span class="subscript">WC</span>
               </div>
               <p class="normal">. The European Certification Authority shall forward these keys, under appropriately secured procedures, to Member States Certification Authorities at their request.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_037<span style="word-spacing: NaNpt"> </span>Member States Certification Authorities shall:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">use Km to encrypt motion sensor data requested by motion sensor manufacturers (data to be encrypted with Km is defined in ISO 16844-3),</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">forward Km<span class="subscript">VU</span> to vehicle unit manufacturers, under appropriately secured procedures, for insertion in vehicle units,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">ensure that Km<span class="subscript">WC</span> will be inserted in all workshop cards ( in  elementary file) during card personalisation.</div>
               </div>
            </div>
<p class="title-gr-seq-level-5" id="id-3167c2d7-6704-47e2-a5a4-4d8db09b3c4d">3.1.4   <span class="boldface">
                  <span class="italics">T-DES session keys generation and distribution</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_012<span style="word-spacing: NaNpt"> </span>Vehicle units and tachograph cards shall, as a part of the mutual authentication process, generate and exchange necessary data to elaborate a common Triple DES session key. This exchange of data shall be protected for confidentiality through an RSA crypt-mechanism.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_013<span style="word-spacing: NaNpt"> </span>This key shall be used for all subsequent cryptographic operations using secure messaging. Its validity shall expire at the end of the session (withdrawal of the card or reset of the card) and/or after 240 use (one use of the key = one command using secure messaging sent to the card and associated response).</p>
            </div>
<p class="title-gr-seq-level-4" id="id-bf88f798-22d7-42e6-981b-b7c5c3ca21e2">3.2.   <span class="boldface">
                  <span class="boldface">Keys</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_014<span style="word-spacing: NaNpt"> </span>RSA keys shall have (whatever the level) the following lengths: modulus <span class="italics">n</span>1 024  bits, public exponent <span class="italics">e</span> 64 bits maximum, private exponent <span class="italics">d</span>1 024  bits.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_015<span style="word-spacing: NaNpt"> </span>Triple DES keys shall have the form (K<span class="subscript">a</span>, K<span class="subscript">b</span>, K<span class="subscript">a</span>) where K<span class="subscript">a</span> and K<span class="subscript">b</span> are independent 64 bits long keys. No parity error detecting bits shall be set.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-2fe05dd6-2e11-403a-b435-8e514bf04ea0">3.3.   <span class="boldface">
                  <span class="boldface">Certificates</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_016<span style="word-spacing: NaNpt"> </span>RSA Public key certificates shall be ‘non self-descriptive’‘Card Verifiable’ certificates (Ref.: ISO/IEC 7816-8)</p>
            </div>
<p class="title-gr-seq-level-5" id="id-733521eb-08fe-46c6-a29c-961e4a39822d">3.3.1   <span class="boldface">
                  <span class="italics">Certificates content</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_017<span style="word-spacing: NaNpt"> </span>RSA Public key certificates are built with the following data in the following order:</p>
            </div>
<p>
               <br/>
            </p>
<div class="centered">
               <p>
                  <br/>
               </p>
               <table width="240" border="1" cellpadding="2" cellspacing="0">
                  <colgroup><col width="3%"/>
                  <col width="13%"/>
                  <col width="3%"/>
                  <col width="81%"/>
                  </colgroup><tbody>
                     <tr>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Data</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Format</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Bytes</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Obs</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">CPI</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">INTEGER</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">1</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Certificate Profile Identifier (‘01’ for this version)</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">CAR</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">OCTET STRING</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">8</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Certification Authority Reference</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">CHA</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">OCTET STRING</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">7</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Certificate Holder Authorisation</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">EOV</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">TimeReal</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">4</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Certificate end of validity. Optional, ‘FF’ padded if not used.</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">CHR</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">OCTET STRING</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">8</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Certificate Holder Reference</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-left">
                              <span class="italics">n</span>
                           </p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">OCTET STRING</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">128</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Public key (modulus)</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-left">
                              <span class="italics">e</span>
                           </p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">OCTET STRING</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">8</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Public Key (public exponent)</p>
                        </td>
                     </tr>
                     <tr>
                        <td colspan="2" valign="top">
                           <p class="normal"> </p>
                           <div>
                        </div></td>
                        <td valign="top">
                           <p class="tbl-right">
                              <span class="boldface">164</span>
                           </p>
                        </td>
                        <td valign="top">
                           <p class="normal"> </p>
                           <div>
                        </div></td>
                     </tr>
                  </tbody>
               </table>
            </div>
<p class="title-gr-seq-level-5" id="id-7ec1ea81-cfc4-48e7-8094-a033b24772c8">
               <span class="italics">Notes:</span>
            </p>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">1.<span style="word-spacing: 15pt"> </span>The ‘Certificate Profile Identifier’ (CPI) delineates the exact structure of an authentication certificate. It can be used as an equipment internal identifier of a relevant headerlist which describes the concatenation of Data Elements within the certificate.</p>
            </div>
<p class="list">The headerlist associated with this certificate content is as follows:</p>
<p>
               <br/>
            </p>
<div class="centered">
               <p>
                  <br/>
               </p>
               <table width="480" border="1" cellpadding="2" cellspacing="0">
                  <colgroup><col width="6%"/>
                  <col width="6%"/>
                  <col width="6%"/>
                  <col width="5%"/>
                  <col width="5%"/>
                  <col width="5%"/>
                  <col width="6%"/>
                  <col width="5%"/>
                  <col width="6%"/>
                  <col width="5%"/>
                  <col width="6%"/>
                  <col width="5%"/>
                  <col width="8%"/>
                  <col width="7%"/>
                  <col width="5%"/>
                  <col width="6%"/>
                  <col width="5%"/>
                  <col width="6%"/>
                  </colgroup><tbody>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">‘4D’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘16’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘5F 29’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘01’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘42’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘08’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘5F 4B’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘07’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘5F 24’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘04’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘5F 20’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘08’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘7F 49’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘05’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘81’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘81 80’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘82’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘08’</p>
                        </td>
                     </tr>
                     <tr>
                        <td rowspan="3" valign="top">
                           <p class="tbl-norm">Extended Headerlist Tag</p>
                        </td>
                        <td rowspan="3" valign="top">
                           <p class="tbl-norm">Length of header list</p>
                        </td>
                        <td rowspan="2" valign="top">
                           <p class="tbl-norm">CPI Tag</p>
                        </td>
                        <td rowspan="3" valign="top">
                           <p class="tbl-norm">CPI Length</p>
                        </td>
                        <td rowspan="3" valign="top">
                           <p class="tbl-norm">CAR Tag</p>
                        </td>
                        <td rowspan="3" valign="top">
                           <p class="tbl-norm">CAR Length</p>
                        </td>
                        <td rowspan="3" valign="top">
                           <p class="tbl-norm">CHA Tag</p>
                        </td>
                        <td rowspan="3" valign="top">
                           <p class="tbl-norm">CHA Length</p>
                        </td>
                        <td rowspan="3" valign="top">
                           <p class="tbl-norm">EOV Tag</p>
                        </td>
                        <td rowspan="3" valign="top">
                           <p class="tbl-norm">EOV Length</p>
                        </td>
                        <td rowspan="3" valign="top">
                           <p class="tbl-norm">CHR Tag</p>
                        </td>
                        <td rowspan="3" valign="top">
                           <p class="tbl-norm">CHR Length</p>
                        </td>
                        <td rowspan="3" valign="top">
                           <p class="tbl-norm">Public Key Tag (Constructed)</p>
                        </td>
                        <td rowspan="3" valign="top">
                           <p class="tbl-norm">Length of subsequent DOs</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">modulus Tag</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">modulus length</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">public exponent Tag</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">public exponent length</p>
                        </td>
                     </tr>
                     <tr>
                        <td colspan="4" valign="top">
                           <p class="normal"> </p>
                           <div>
                        </div></td>
                     </tr>
                     <tr>
                        <td colspan="16" valign="top">
                           <p class="normal"> </p>
                           <div>
                        </div></td>
                     </tr>
                  </tbody>
               </table>
            </div>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">2.<span style="word-spacing: 15pt"> </span>The ‘Certification Authority Reference’ (CAR) has the purpose of identifying the certificate issuing CA, in such a way that the Data Element can be used at the same time as an Authority Key Identifier to reference the Public Key of the Certification Authority (for coding, see Key Identifier below).</p>
            </div>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">3.<span style="word-spacing: 15pt"> </span>The ‘Certificate Holder Authorisation’ (CHA) is used to identify the rights of the certificate holder. It consists of the Tachograph Application ID and of the type of equipment to which the certificate is intended (according to  data element, ‘00’ for a Member State).</p>
            </div>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">4.<span style="word-spacing: 15pt"> </span>The ‘Certificate Holder Reference’ (CHR) has the purpose of identifying uniquely the certificate holder, in such a way that the Data Element can be used at the same time as a Subject Key Identifier to reference the Public Key of the certificate holder.</p>
            </div>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">5.<span style="word-spacing: 15pt"> </span>Key Identifiers uniquely identify certificate holder or certification authorities. They are coded as follows:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>5.1 </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">Equipment (VU or Card):</p>
                  <p>
                     <br/>
                  </p>
                  <div class="centered">
                     <p>
                        <br/>
                     </p>
                     <table width="240" border="1" cellpadding="2" cellspacing="0">
                        <colgroup><col width="7%"/>
                        <col width="28%"/>
                        <col width="19%"/>
                        <col width="25%"/>
                        <col width="20%"/>
                        </colgroup><tbody>
                           <tr>
                              <td style="font-weight: bold" valign="top">
                                 <p class="tbl-norm">Data</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Equipment serial number</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Date</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Type</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Manufacturer</p>
                              </td>
                           </tr>
                           <tr>
                              <td style="font-weight: bold" valign="top">
                                 <p class="tbl-norm">Length</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">4 Bytes</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">2 Bytes</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">1 Byte</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">1 Byte</p>
                              </td>
                           </tr>
                           <tr>
                              <td style="font-weight: bold" valign="top">
                                 <p class="tbl-norm">Value</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Integer</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">mm yy BCD coding</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Manufacturer specific</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Manufacturer code</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <p class="list">In the case of a VU, the manufacturer, when requesting certificates, may or may not know the identification of the equipment in which the keys will be inserted.</p>
                  <p class="list">In the first case, the manufacturer will send the equipment identification with the public key to its Member State authority for certification. The certificate will then contain the equipment identification, and the manufacturer must ensure that keys and certificate are inserted in the intended equipment. The Key identifier has the form shown above.</p>
                  <p class="list">In the later case, the manufacturer must uniquely identify each certificate request and send this identification with the public key to its Member State authority for certification. The certificate will contain the request identification. The manufacturer must feed back its Member State authority with the assignment of key to equipment (i.e. certificate request identification, equipment identification) after key installation in the equipment. The key identifier has the following form:</p>
                  <p>
                     <br/>
                  </p>
                  <div class="centered">
                     <p>
                        <br/>
                     </p>
                     <table width="240" border="1" cellpadding="2" cellspacing="0">
                        <colgroup><col width="7%"/>
                        <col width="37%"/>
                        <col width="18%"/>
                        <col width="20%"/>
                        <col width="19%"/>
                        </colgroup><tbody>
                           <tr>
                              <td style="font-weight: bold" valign="top">
                                 <p class="tbl-norm">Data</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Certificate request serial number</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Date</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Type</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Manufacturer</p>
                              </td>
                           </tr>
                           <tr>
                              <td style="font-weight: bold" valign="top">
                                 <p class="tbl-norm">Length</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">4 Bytes</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">2 Bytes</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">1 Byte</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">1 Byte</p>
                              </td>
                           </tr>
                           <tr>
                              <td style="font-weight: bold" valign="top">
                                 <p class="tbl-norm">Value</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Integer</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">mm yy BCD coding</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">‘FF’</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Manufacturer code</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>5.2 </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">Certification Authority:</p>
                  <p>
                     <br/>
                  </p>
                  <div class="centered">
                     <p>
                        <br/>
                     </p>
                     <table width="320" border="1" cellpadding="2" cellspacing="0">
                        <colgroup><col width="3%"/>
                        <col width="36%"/>
                        <col width="8%"/>
                        <col width="44%"/>
                        <col width="8%"/>
                        </colgroup><tbody>
                           <tr>
                              <td style="font-weight: bold" valign="top">
                                 <p class="tbl-norm">Data</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Authority Identification</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Key serial number</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Additional info</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Identifier</p>
                              </td>
                           </tr>
                           <tr>
                              <td style="font-weight: bold" valign="top">
                                 <p class="tbl-norm">Length</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">4 Bytes</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">1 Byte</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">2 Bytes</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">1 Byte</p>
                              </td>
                           </tr>
                           <tr>
                              <td style="font-weight: bold" valign="top">
                                 <p class="tbl-norm">Value</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">1 Byte nation numerical code</p>
                                 <p class="tbl-norm">3 Bytes nation alphanumerical code</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Integer</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">additional coding</p>
                                 <p class="tbl-norm">(CA specific)</p>
                                 <p class="tbl-norm">‘FF FF’ if not used</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">‘01’</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <p class="list">The key serial number is used to distinguish the different keys of a Member State, in the case the key is changed.</p>
               </div>
            </div>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">6.<span style="word-spacing: 15pt"> </span>Certificate verifiers shall implicitly know that the public key certified is an RSA key relevant to authentication, digital signature verification and encipherement for confidentiality services (the certificate contains no Object Identifier to specify it).</p>
            </div>
<p class="title-gr-seq-level-5" id="id-61290744-578e-4b9e-8c1a-966ef0dc6ef7">3.3.2   <span class="boldface">
                  <span class="italics">Certificates issued</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_018<span style="word-spacing: NaNpt"> </span>The certificate issued is a digital signature with partial recovery of the certificate content in accordance with ISO/IEC 9796-2 (except for its annex A4), with the ‘Certification Authority Reference’ appended.</p>
            </div>
<div class="box">X.C = X.CA.SK[&amp;#x2018;6A&amp;#x2019; || C<span class="subscript">r</span> || <span class="italics">Hash</span>(Cc) || &amp;#x2018;BC&amp;#x2019;] || C<span class="subscript">n</span> || X.CAR</div>
<p>
               <br/>
            </p>
<div class="centered">
               <p>
                  <br/>
               </p>
               <table width="240" border="1" cellpadding="2" cellspacing="0">
                  <colgroup><col width="62%"/>
                  <col width="18%"/>
                  <col width="4%"/>
                  <col width="16%"/>
                  </colgroup><tbody>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">With certificate content = Cc =</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">C<span class="subscript">r</span>
                           </p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">||</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">C<span class="subscript">n</span>
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="normal"> </p>
                           <div>
                        </div></td>
                        <td valign="top">
                           <p class="tbl-norm">106 bytes</p>
                        </td>
                        <td valign="top">
                           <p class="normal"> </p>
                           <div>
                        </div></td>
                        <td valign="top">
                           <p class="tbl-norm">58 bytes</p>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </div>
<p class="title-gr-seq-level-5" id="id-395521fa-d840-4c4a-83d5-a172fa359447">
               <span class="italics">Notes:</span>
            </p>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">1.<span style="word-spacing: 15pt"> </span>This certificate is 194 bytes long.</p>
            </div>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">2.<span style="word-spacing: 15pt"> </span>CAR, being hidden by the signature, is also appended to the signature, such that the Public Key of the Certification Authority may be selected for the verification of the certificate.</p>
            </div>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">3.<span style="word-spacing: 15pt"> </span>The certificate verifier shall implicitly know the algorithm used by the Certification Authority to sign the certificate.</p>
            </div>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">4.<span style="word-spacing: 15pt"> </span>The headerlist associated with this issued certificate is as follows:</p>
            </div>
<p>
               <br/>
            </p>
<div class="centered">
               <p>
                  <br/>
               </p>
               <table width="240" border="1" cellpadding="2" cellspacing="0">
                  <colgroup><col width="18%"/>
                  <col width="14%"/>
                  <col width="12%"/>
                  <col width="12%"/>
                  <col width="12%"/>
                  <col width="10%"/>
                  <col width="10%"/>
                  <col width="10%"/>
                  </colgroup><tbody>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">‘7F 21’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘09’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘5F 37’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘81 80’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘5F 38’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘3A’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘42’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘08’</p>
                        </td>
                     </tr>
                     <tr>
                        <td rowspan="2" valign="top">
                           <p class="tbl-norm">CV Certificate Tag (Constructed)</p>
                        </td>
                        <td rowspan="2" valign="top">
                           <p class="tbl-norm">Length of subsequent DOs</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Signature Tag</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Signature Length</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Remainder Tag</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Remainder Length</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">CAR Tag</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">CAR Length</p>
                        </td>
                     </tr>
                     <tr>
                        <td colspan="6" valign="top">
                           <p class="normal"> </p>
                           <div>
                        </div></td>
                     </tr>
                  </tbody>
               </table>
            </div>
<p class="title-gr-seq-level-5" id="id-a3150330-ae87-4c88-ab34-94ee0328c634">3.3.3   <span class="boldface">
                  <span class="italics">Certificate verification and unwrapping</span>
               </span>
            </p>
<p class="norm">Certificate verification and unwrapping consists in verifying the signature in accordance with ISO/IEC 9796-2, retrieving the certificate content and the public key contained: X.PK = X.CA.PK <span class="subscript">o</span> X.C, and verifying the validity of the certificate.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_019<span style="word-spacing: NaNpt"> </span>It involves the following steps:</p>
            </div>
<div class="list">Verify signature and retrieve content:</div>
<div class="list">
               <p>
                  <br/>
               </p>
               <div class="centered">
                  <p>
                     <br/>
                  </p>
                  <table width="240" border="1" cellpadding="2" cellspacing="0">
                     <colgroup><col width="57%"/>
                     <col width="6%"/>
                     <col width="12%"/>
                     <col width="3%"/>
                     <col width="10%"/>
                     <col width="3%"/>
                     <col width="9%"/>
                     </colgroup><tbody>
                        <tr>
                           <td valign="top">
                              <p class="tbl-norm">—  from X.C retrieve Sign, C<span class="subscript">n</span>&#39; and CAR&#39;:</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">X.C =</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">Sign</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">||</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">C<span class="subscript">n</span>&#39;</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">||</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">CAR&#39;</p>
                           </td>
                        </tr>
                        <tr>
                           <td valign="top">
                              <p class="normal"> </p>
                              <div>
                           </div></td>
                           <td valign="top">
                              <p class="normal"> </p>
                              <div>
                           </div></td>
                           <td valign="top">
                              <p class="tbl-norm">128 Bytes</p>
                           </td>
                           <td valign="top">
                              <p class="normal"> </p>
                              <div>
                           </div></td>
                           <td valign="top">
                              <p class="tbl-norm">58 Bytes</p>
                           </td>
                           <td valign="top">
                              <p class="normal"> </p>
                              <div>
                           </div></td>
                           <td valign="top">
                              <p class="tbl-norm">8 Bytes</p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
<div class="list">
               <div class="grid-container grid-list">
                  <div class="list grid-list-column-1">
                     <span>— </span>
                  </div>
                  <div class="grid-list-column-2">
                     <div class="list">from CAR&#39; select appropriate Certification Authority Public Key (if not done before through other means)</div>
                  </div>
               </div>
               <div class="grid-container grid-list">
                  <div class="list grid-list-column-1">
                     <span>— </span>
                  </div>
                  <div class="grid-list-column-2">
                     <div class="list">open Sign with CA Public Key: Sr&#39;= X.CA.PK [Sign],</div>
                  </div>
               </div>
               <div class="grid-container grid-list">
                  <div class="list grid-list-column-1">
                     <span>— </span>
                  </div>
                  <div class="grid-list-column-2">
                     <div class="list">check Sr&#39; starts with ‘6A’ and ends with ‘BC’
                                                   </div>
                  </div>
               </div>
            </div>
<div class="list">
               <p>
                  <br/>
               </p>
               <div class="centered">
                  <p>
                     <br/>
                  </p>
                  <table width="240" border="1" cellpadding="2" cellspacing="0">
                     <colgroup><col width="39%"/>
                     <col width="19%"/>
                     <col width="2%"/>
                     <col width="9%"/>
                     <col width="2%"/>
                     <col width="8%"/>
                     <col width="2%"/>
                     <col width="19%"/>
                     </colgroup><tbody>
                        <tr>
                           <td valign="top">
                              <p class="tbl-norm">—  compute C<span class="subscript">r</span>&#39; and H&#39; from: Sr&#39; =</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">‘6A’</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">||</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">C<span class="subscript">r</span>&#39;</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">||</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">H&#39;</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">||</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">‘BC’</p>
                           </td>
                        </tr>
                        <tr>
                           <td valign="top">
                              <p class="normal"> </p>
                              <div>
                           </div></td>
                           <td valign="top">
                              <p class="normal"> </p>
                              <div>
                           </div></td>
                           <td valign="top">
                              <p class="normal"> </p>
                              <div>
                           </div></td>
                           <td valign="top">
                              <p class="tbl-norm">106 Bytes</p>
                           </td>
                           <td valign="top">
                              <p class="normal"> </p>
                              <div>
                           </div></td>
                           <td valign="top">
                              <p class="tbl-norm">20 Bytes</p>
                           </td>
                           <td valign="top">
                              <p class="normal"> </p>
                              <div>
                           </div></td>
                           <td valign="top">
                              <p class="normal"> </p>
                              <div>
                           </div></td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
<div class="list">
               <div class="grid-container grid-list">
                  <div class="list grid-list-column-1">
                     <span>— </span>
                  </div>
                  <div class="grid-list-column-2">
                     <div class="list">Recover certificate content C&#39; = C<span class="subscript">r</span>&#39; || C<span class="subscript">n</span>&#39;,</div>
                  </div>
               </div>
               <div class="grid-container grid-list">
                  <div class="list grid-list-column-1">
                     <span>— </span>
                  </div>
                  <div class="grid-list-column-2">
                     <div class="list">check <span class="italics">Hash</span>(C&#39;) = H&#39;</div>
                  </div>
               </div>
            </div>
<div class="list">If the checks are OK the certificate is a genuine one, its content is C&#39;.</div>
<div class="list">Verify validity. From C&#39;:</div>
<div class="list">
               <div class="grid-container grid-list">
                  <div class="list grid-list-column-1">
                     <span>— </span>
                  </div>
                  <div class="grid-list-column-2">
                     <div class="list">if applicable, check End of validity date,</div>
                  </div>
               </div>
            </div>
<div class="list">Retrieve and store public key, Key Identifier, Certificate Holder Authorisation and Certificate End of Validity from C&#39;:</div>
<div class="list">
               <div class="grid-container grid-list">
                  <div class="list grid-list-column-1">
                     <span>— </span>
                  </div>
                  <div class="grid-list-column-2">
                     <div class="list">X.PK = <span class="italics">n</span> || <span class="italics">e</span>
                     </div>
                  </div>
               </div>
               <div class="grid-container grid-list">
                  <div class="list grid-list-column-1">
                     <span>— </span>
                  </div>
                  <div class="grid-list-column-2">
                     <div class="list">X.KID = CHR</div>
                  </div>
               </div>
               <div class="grid-container grid-list">
                  <div class="list grid-list-column-1">
                     <span>— </span>
                  </div>
                  <div class="grid-list-column-2">
                     <div class="list">X.CHA = CHA</div>
                  </div>
               </div>
               <div class="grid-container grid-list">
                  <div class="list grid-list-column-1">
                     <span>— </span>
                  </div>
                  <div class="grid-list-column-2">
                     <div class="list">X.EOV = EOV</div>
                  </div>
               </div>
            </div>
<p class="title-gr-seq-level-3" id="id-3123a2e3-de6f-4b48-afe6-cc4bbbac697e">4.   <span class="boldface">MUTUAL AUTHENTICATION MECHANISM</span>
            </p>
<p class="norm">Mutual authentication between cards and VUs is based on the following principle:</p>
<p class="norm">Each party shall demonstrate to the other that it owns a valid key pair, the public key of which has been certified by a Member State certification authority, itself being certified by the European certification authority.</p>
<p class="norm">Demonstration is made by signing with the private key a random number sent by the other party, who must recover the random number sent when verifying this signature.</p>
<p class="norm">The mechanism is triggered at card insertion by the VU. It starts with the exchange of certificates and unwrapping of public keys, and ends with the setting of a session key.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_020<span style="word-spacing: NaNpt"> </span>The following protocol shall be used (arrows indicate commands and data exchanged (see Appendix 2)):</p>
            </div>
<p class="list">
               
            </p>
<p class="list">
               
            </p>
<p class="title-gr-seq-level-3" id="id-e8c78e01-1001-4a93-b116-fc98a1cdf48a">5.   <span class="boldface">VU-CARDS DATA TRANSFER CONFIDENTIALITY, INTEGRITY AND AUTHENTICATION MECHANISMS</span>
            </p>
<p class="title-gr-seq-level-4" id="id-fed443e7-7e37-4c5e-835e-2c387ae6541c">5.1.   <span class="boldface">
                  <span class="boldface">Secure Messaging</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_021<span style="word-spacing: NaNpt"> </span>VU-Cards data transfers integrity shall be protected through Secure Messaging in accordance with references [ISO/IEC 7816-4] and [ISO/IEC 7816-8].</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_022<span style="word-spacing: NaNpt"> </span>When data need to be protected during transfer, a Cryptographic Checksum Data Object shall be appended to the Data Objects sent within the command or the response. The Cryptographic Checksum shall be verified by the receiver.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_023<span style="word-spacing: NaNpt"> </span>The cryptographic checksum of data sent within a command shall integrate the command header, and all data objects sent (=&gt;CLA = ‘0C’, and all data objects shall be encapsulated with tags in which b1=1).</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_024<span style="word-spacing: NaNpt"> </span>The response status-information bytes shall be protected by a cryptographic checksum when the response contains no data field.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_025<span style="word-spacing: NaNpt"> </span>Cryptographic checksums shall be 4 Bytes long.</p>
            </div>
<p class="list">The structure of commands and responses when using secure messaging is therefore the following:</p>
<div class="list">The DOs used are a partial set of the Secure Messaging DOs described in ISO/IEC 7816-4:</div>
<div class="list">
               <p>
                  <br/>
               </p>
               <div class="centered">
                  <p>
                     <br/>
                  </p>
                  <table width="240" border="1" cellpadding="2" cellspacing="0">
                     <colgroup><col width="19%"/>
                     <col width="8%"/>
                     <col width="73%"/>
                     </colgroup><tbody>
                        <tr>
                           <td style="font-weight: bold" valign="top">
                              <p class="tbl-norm">Tag</p>
                           </td>
                           <td style="font-weight: bold" valign="top">
                              <p class="tbl-norm">Mnemonic</p>
                           </td>
                           <td style="font-weight: bold" valign="top">
                              <p class="tbl-norm">Meaning</p>
                           </td>
                        </tr>
                        <tr>
                           <td valign="top">
                              <p class="tbl-right">
                                 <span class="boldface">‘81’</span>
                              </p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">T<span class="subscript">PV</span>
                              </p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">Plain Value not BER-TLV coded data (to be protected by CC)</p>
                           </td>
                        </tr>
                        <tr>
                           <td valign="top">
                              <p class="tbl-norm">‘97’</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-left">
                                 <span class="boldface">T<span class="subscript">LE</span>
                                 </span>
                              </p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">Value of Le in the unsecured command (to be protected by CC)</p>
                           </td>
                        </tr>
                        <tr>
                           <td valign="top">
                              <p class="tbl-norm">‘99’</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">T<span class="subscript">SW</span>
                              </p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">Status-Info (to be protected by CC)</p>
                           </td>
                        </tr>
                        <tr>
                           <td valign="top">
                              <p class="tbl-norm">‘8E’</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">T<span class="subscript">CC</span>
                              </p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">Cryptographic Checksum</p>
                           </td>
                        </tr>
                        <tr>
                           <td valign="top">
                              <p class="tbl-norm">‘87’</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">T<span class="subscript">PI CG</span>
                              </p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">Padding Indicator Byte || Cryptogram (Plain Value not coded in BER-TLV)</p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
<div class="list">Given an unsecured command response pair:</div>
<div class="list">
               <p>
                  <br/>
               </p>
               <div class="centered">
                  <p>
                     <br/>
                  </p>
                  <table width="240" border="1" cellpadding="2" cellspacing="0">
                     <colgroup><col width="7%"/>
                     <col width="7%"/>
                     <col width="5%"/>
                     <col width="5%"/>
                     <col width="24%"/>
                     <col width="29%"/>
                     <col width="24%"/>
                     </colgroup><tbody>
                        <tr>
                           <td colspan="4" style="font-weight: bold" valign="top">
                              <p class="tbl-norm">Command header</p>
                           </td>
                           <td colspan="3" style="font-weight: bold" valign="top">
                              <p class="tbl-norm">Command body</p>
                           </td>
                        </tr>
                        <tr>
                           <td valign="top">
                              <p class="tbl-norm">CLA</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">INS</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">P1</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">P2</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">[L<span class="subscript">c</span> field]</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">[Data field]</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">[L<span class="subscript">e</span> field]</p>
                           </td>
                        </tr>
                        <tr>
                           <td colspan="4" valign="top">
                              <p class="tbl-norm">four bytes</p>
                           </td>
                           <td colspan="3" valign="top">
                              <p class="tbl-norm">L bytes, denoted as B<span class="subscript">1</span> to B<span class="subscript">L</span>
                              </p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
<div class="list">
               <p>
                  <br/>
               </p>
               <div class="centered">
                  <p>
                     <br/>
                  </p>
                  <table width="240" border="1" cellpadding="2" cellspacing="0">
                     <colgroup><col width="68%"/>
                     <col width="16%"/>
                     <col width="16%"/>
                     </colgroup><tbody>
                        <tr>
                           <td style="font-weight: bold" valign="top">
                              <p class="tbl-norm">Response body</p>
                           </td>
                           <td colspan="2" style="font-weight: bold" valign="top">
                              <p class="tbl-norm">Response trailer</p>
                           </td>
                        </tr>
                        <tr>
                           <td valign="top">
                              <p class="tbl-norm">[Data field]</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">SW1</p>
                           </td>
                           <td valign="top">
                              <p class="tbl-norm">SW2</p>
                           </td>
                        </tr>
                        <tr>
                           <td valign="top">
                              <p class="tbl-norm">L<span class="subscript">r</span> data bytes</p>
                           </td>
                           <td colspan="2" valign="top">
                              <p class="tbl-norm">two bytes</p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
<div class="list">The corresponding secured command response pair is:</div>
<div class="list">
               <div class="list">Secured command:</div>
               <div class="list">
                  <p>
                     <br/>
                  </p>
                  <div class="centered">
                     <p>
                        <br/>
                     </p>
                     <table width="240" border="1" cellpadding="2" cellspacing="0">
                        <colgroup><col width="11%"/>
                        <col width="14%"/>
                        <col width="11%"/>
                        <col width="2%"/>
                        <col width="6%"/>
                        <col width="11%"/>
                        <col width="11%"/>
                        <col width="1%"/>
                        <col width="11%"/>
                        <col width="11%"/>
                        <col width="1%"/>
                        <col width="11%"/>
                        <col width=""/>
                        <col width=""/>
                        <col width=""/>
                        </colgroup><tbody>
                           <tr>
                              <td colspan="4" style="font-weight: bold" valign="top">
                                 <p class="tbl-norm">Command header (CH)</p>
                              </td>
                              <td colspan="11" style="font-weight: bold" valign="top">
                                 <p class="tbl-norm">Command body</p>
                              </td>
                           </tr>
                           <tr>
                              <td valign="top">
                                 <p class="tbl-norm">CLA</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">INS</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">P1</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">P2</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">[New L<span class="subscript">c</span> field]</p>
                              </td>
                              <td colspan="9" valign="top">
                                 <p class="tbl-norm">[New Data field]</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">[New L<span class="subscript">e</span> field]</p>
                              </td>
                           </tr>
                           <tr>
                              <td colspan="4" rowspan="2" valign="top">
                                 <p class="tbl-norm">‘OC’</p>
                              </td>
                              <td rowspan="2" valign="top">
                                 <p class="tbl-norm">Length of New Data field</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">T<span class="subscript">PV</span>
                                 </p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">L<span class="subscript">PV</span>
                                 </p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">PV</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">T<span class="subscript">LE</span>
                                 </p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">L<span class="subscript">LE</span>
                                 </p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">L<span class="subscript">e</span>
                                 </p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">T<span class="subscript">CC</span>
                                 </p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">L<span class="subscript">CC</span>
                                 </p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">CC</p>
                              </td>
                              <td rowspan="2" valign="top">
                                 <p class="tbl-norm">‘00’</p>
                              </td>
                           </tr>
                           <tr>
                              <td valign="top">
                                 <p class="tbl-norm">‘81’</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">L<span class="subscript">c</span>
                                 </p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">Data field</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">‘97’</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">‘01’</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">L<span class="subscript">e</span>
                                 </p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">‘8E’</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">‘04’</p>
                              </td>
                              <td valign="top">
                                 <p class="tbl-norm">CC</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div>
               <div class="list">Data to be integrated in checksum = CH || PB || T<span class="subscript">PV</span> || L<span class="subscript">PV</span> || PV || T<span class="subscript">LE</span> || L<span class="subscript">LE</span> || L<span class="subscript">e</span> || PB</div>
               <div class="list">PB = Padding Bytes (80 .. 00) in accordance with ISO-IEC 7816-4 and ISO 9797 method 2.</div>
               <div class="list">DOs PV and LE are present only when there is some corresponding data in the unsecured command.</div>
               <div class="list">Secured response:</div>
               <div class="list">
                  <div class="grid-container grid-list">
                     <div class="list grid-list-column-1">
                        <span>1. </span>
                     </div>
                     <div class="grid-list-column-2">
                        <p class="norm">Case where response data field is not empty and needs not to be protected for confidentiality:</p>
                        <p>
                           <br/>
                        </p>
                        <div class="centered">
                           <p>
                              <br/>
                           </p>
                           <table width="240" border="1" cellpadding="2" cellspacing="0">
                              <colgroup><col width="23%"/>
                              <col width="4%"/>
                              <col width="13%"/>
                              <col width="23%"/>
                              <col width="23%"/>
                              <col width="3%"/>
                              <col width="14%"/>
                              </colgroup><tbody>
                                 <tr>
                                    <td colspan="6" style="font-weight: bold" valign="top">
                                       <p class="tbl-norm">Response body</p>
                                    </td>
                                    <td style="font-weight: bold" valign="top">
                                       <p class="tbl-norm">Response trailer</p>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td colspan="6" valign="top">
                                       <p class="tbl-norm">[New Data field]</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">new SW1 SW2</p>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td valign="top">
                                       <p class="tbl-norm">T<span class="subscript">PV</span>
                                       </p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">L<span class="subscript">PV</span>
                                       </p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">PV</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">T<span class="subscript">CC</span>
                                       </p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">L<span class="subscript">CC</span>
                                       </p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">CC</p>
                                    </td>
                                    <td rowspan="2" valign="top">
                                       <p class="normal"> </p>
                                       <div>
                                    </div></td>
                                 </tr>
                                 <tr>
                                    <td valign="top">
                                       <p class="tbl-norm">‘81’</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">L<span class="subscript">r</span>
                                       </p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">Data field</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">‘8E’</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">‘04’</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">CC</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <p class="list">Data to be integrated in checksum = T<span class="subscript">PV</span> || L<span class="subscript">PV</span> || PV || PB</p>
                     </div>
                  </div>
                  <div class="grid-container grid-list">
                     <div class="list grid-list-column-1">
                        <span>2. </span>
                     </div>
                     <div class="grid-list-column-2">
                        <p class="norm">Case where response data field is not empty and needs to be protected for confidentiality:</p>
                        <p>
                           <br/>
                        </p>
                        <div class="centered">
                           <p>
                              <br/>
                           </p>
                           <table width="240" border="1" cellpadding="2" cellspacing="0">
                              <colgroup><col width="22%"/>
                              <col width="7%"/>
                              <col width="10%"/>
                              <col width="22%"/>
                              <col width="22%"/>
                              <col width="2%"/>
                              <col width="14%"/>
                              </colgroup><tbody>
                                 <tr>
                                    <td colspan="6" style="font-weight: bold" valign="top">
                                       <p class="tbl-norm">Response body</p>
                                    </td>
                                    <td style="font-weight: bold" valign="top">
                                       <p class="tbl-norm">Response trailer</p>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td colspan="6" valign="top">
                                       <p class="tbl-norm">[New Data field]</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">new SW1 SW2</p>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td valign="top">
                                       <p class="tbl-norm">T<span class="subscript">PI CG</span>
                                       </p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">L<span class="subscript">PI CG</span>
                                       </p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">PI CG</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">T<span class="subscript">CC</span>
                                       </p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">L<span class="subscript">CC</span>
                                       </p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">CC</p>
                                    </td>
                                    <td rowspan="2" valign="top">
                                       <p class="normal"> </p>
                                       <div>
                                    </div></td>
                                 </tr>
                                 <tr>
                                    <td valign="top">
                                       <p class="tbl-norm">‘87’</p>
                                    </td>
                                    <td valign="top">
                                       <p class="normal"> </p>
                                       <div>
                                    </div></td>
                                    <td valign="top">
                                       <p class="tbl-norm">PI || CG</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">‘8E’</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">‘04’</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">CC</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <p class="list">Data to be carried by CG: non BER-TLV coded data and padding bytes.</p>
                        <p class="list">Data to be integrated in checksum = T<span class="subscript">PI CG</span> || L<span class="subscript">PI CG</span> || PI CG || PB</p>
                     </div>
                  </div>
                  <div class="grid-container grid-list">
                     <div class="list grid-list-column-1">
                        <span>3. </span>
                     </div>
                     <div class="grid-list-column-2">
                        <p class="norm">Case where response data field is empty:</p>
                        <p>
                           <br/>
                        </p>
                        <div class="centered">
                           <p>
                              <br/>
                           </p>
                           <table width="240" border="1" cellpadding="2" cellspacing="0">
                              <colgroup><col width="19%"/>
                              <col width="19%"/>
                              <col width="11%"/>
                              <col width="19%"/>
                              <col width="19%"/>
                              <col width="2%"/>
                              <col width="11%"/>
                              </colgroup><tbody>
                                 <tr>
                                    <td colspan="6" style="font-weight: bold" valign="top">
                                       <p class="tbl-norm">Response body</p>
                                    </td>
                                    <td style="font-weight: bold" valign="top">
                                       <p class="tbl-norm">Response trailer</p>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td colspan="6" valign="top">
                                       <p class="tbl-norm">[New Data field]</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">new SW1 SW2</p>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td valign="top">
                                       <p class="tbl-norm">T<span class="subscript">SW</span>
                                       </p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">L<span class="subscript">SW</span>
                                       </p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">SW</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">T<span class="subscript">CC</span>
                                       </p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">L<span class="subscript">CC</span>
                                       </p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">CC</p>
                                    </td>
                                    <td rowspan="2" valign="top">
                                       <p class="normal"> </p>
                                       <div>
                                    </div></td>
                                 </tr>
                                 <tr>
                                    <td valign="top">
                                       <p class="tbl-norm">‘99’</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">‘02’</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">New SW1 SW2</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">‘8E’</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">‘04’</p>
                                    </td>
                                    <td valign="top">
                                       <p class="tbl-norm">CC</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <p class="list">Data to be integrated in checksum = T<span class="subscript">SW</span> || L<span class="subscript">SW</span> || SW || PB</p>
                     </div>
                  </div>
               </div>
            </div>
<p class="title-gr-seq-level-4" id="id-727492d6-1294-4f3f-bdb0-40fde12260cc">5.2.   <span class="boldface">
                  <span class="boldface">Treatment of Secure Messaging errors</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_026<span style="word-spacing: NaNpt"> </span>When the tachograph card recognises an SM error while interpreting a command, then the status bytes must be returned without SM. In accordance with ISO/IEC 7816-4, the following status bytes are defined to indicate SM errors:</p>
            </div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">‘66 88’</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">Verification of Cryptographic Checksum failed,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">‘69 87’</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">Expected SM Data Objects missing,</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">‘69 88’</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">SM Data Objects incorrect.</p>
                  </td>
               </tr>
            </tbody></table>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_027<span style="word-spacing: NaNpt"> </span>When the tachograph card returns status bytes without SM DOs or with an erroneous SM DO, the session must be aborted by the VU.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-aa477c9d-764a-44c0-8e34-02d6df792c40">5.3.   <span class="boldface">
                  <span class="boldface">Algorithm to compute Cryptographic Checksums</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_028<span style="word-spacing: NaNpt"> </span>Cryptographic checksums are built using a retail MACs in accordance with ANSI X9.19 with DES:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Initial stage: The initial check block y0 is E(Ka, SSC).</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Sequential stage: The check blocks y1, .., yn are calculated using Ka.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Final stage: The cryptographic checksum is calculated from the last check block yn as follows: E(Ka, D(Kb, yn)).</div>
               </div>
            </div>
<p class="list">where E() means encryption with DES, and D() means decryption with DES.</p>
<p class="list">The four most significant bytes of the cryptographic checksum are transferred</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_029<span style="word-spacing: NaNpt"> </span>The Send Sequence Counter (SSC) shall be initiated during key agreement procedure to:</p>
            </div>
<p class="list">Initial SSC: Rnd3 (4 least significant bytes) || Rnd1 (4 least significant bytes).</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_030<span style="word-spacing: NaNpt"> </span>The Send Sequence Counter shall be increased by 1 each time before a MAC is calculated (i.e. the SSC for the first command is Initial SSC + 1, the SSC for the first response is Initial SSC + 2).</p>
            </div>
<p class="list">The following figure shows the calculation of the retail MAC:</p>
<p class="list">
               
            </p>
<p class="title-gr-seq-level-4" id="id-eb0f8278-c9d2-4b0c-ba02-b7bd3425841f">5.4.   <span class="boldface">
                  <span class="boldface">Algorithm to compute cryptograms for confidentiality DOs</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_031<span style="word-spacing: NaNpt"> </span>Cryptograms are computed using TDEA in TCBC mode of operation in accordance with references [TDES] and [TDES-OP] and with the Null vector as Initial Value block.</p>
            </div>
<p class="list">The following figure shows the application of keys in TDES:</p>
<p class="list">
               
            </p>
<p class="title-gr-seq-level-3" id="id-9e8f8e82-0e5b-4ee2-bafc-fe8702eb98fa">6.   <span class="boldface">DATA DOWNLOAD DIGITAL SIGNATURE MECHANISMS</span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_032<span style="word-spacing: NaNpt"> </span>The Intelligent Dedicated Equipment (IDE) stores data received from an equipment (VU or card) during one download session within one physical data file. This file must contain the certificates MS<span class="subscript">i</span>.C and EQT.C. The file contains digital signatures of data blocks as specified in Appendix 7 Data Downloading Protocols.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_033<span style="word-spacing: NaNpt"> </span>Digital signatures of downloaded data shall use a digital signature scheme with appendix such, that downloaded data may be read without any decipherment if desired.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-4ee0b89f-6f11-4e4f-8eca-bb1829a99017">6.1.   <span class="boldface">
                  <span class="boldface">Signature generation</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_034<span style="word-spacing: NaNpt"> </span>Data signature generation by the equipment shall follow the signature scheme with appendix defined in reference [PKCS1] with the SHA-1 hash function:</p>
            </div>
<div class="list">Signature = EQT.SK[‘00’ || ‘01’ || <span class="italics">PS</span> || ‘00’ || DER(SHA-1(Data))]</div>
<div class="list">
               <span class="italics">PS</span> = Padding string of octets with value ‘FF’ such that length is 128.</div>
<div class="list">DER(SHA-1(<span class="italics">M</span>)) is the encoding of the algorithm ID for the hash function and the hash value into an ASN.1 value of type DigestInfo (distinguished encoding rules):</div>
<div class="list">
                                          ‘30’||‘21’||‘30’||‘09’||‘06’||‘05’||‘2B’||‘0E’||‘03’||‘02’||‘1A’||‘05’||‘00’||‘04’||‘14’||Hash Value.</div>
<p class="title-gr-seq-level-4" id="id-aaa2b5c7-9a76-444a-99b4-bcef1901b8d1">6.2.   <span class="boldface">
                  <span class="boldface">Signature verification</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_035<span style="word-spacing: NaNpt"> </span>Data signature verification on downloaded data shall follow the signature scheme with appendix defined in reference [PKCS1] with the SHA-1 hash function.</p>
            </div>
<p class="list">The European public key EUR.PK needs to be known independently (and trusted) by the verifier.</p>
<p class="list">The following table illustrates the protocol an IDE carrying a Control card can follow to verify the integrity of data downloaded and stored on the ESM (External Storage media). The control card is used to perform the decipherement of digital signatures. This function may in this case not be implemented in the IDE.</p>
<p class="list">The equipment that has downloaded and signed the data to be analysed is denoted EQT.</p>
<p class="list">
               
            </p>
<p class="title-gr-seq-level-2" id="id-e86fe5a7-a8c5-431c-bd35-72d3820aa3cc">PART B</p>
<p class="title-gr-seq-level-2" id="id-1a01428c-7997-44b1-8ce5-b5e97b1b31b4">
               <span class="boldface">SECOND-GENERATION TACHOGRAPH SYSTEM</span>
            </p>
<p class="title-gr-seq-level-3" id="id-08eaa3bd-2e19-44fe-9569-4db728a34fcf">7.   <span class="boldface">INTRODUCTION</span>
            </p>
<p class="title-gr-seq-level-4" id="id-d2be1ec2-2332-4af5-9921-d1166c8b3fde">7.1.   <span class="boldface">
                  <span class="boldface">References</span>
               </span>
            </p>
<p class="norm">The following references are used in this part of this Appendix.</p>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">AES</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">National Institute of Standards and Technology (NIST), FIPS PUB 197: Advanced Encryption Standard (AES), November 26, 2001</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">DSS</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">National Institute of Standards and Technology (NIST), FIPS PUB 186-4: Digital Signature Standard (DSS), July 2013</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ISO 7816-4</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">ISO/IEC 7816-4, Identification cards — Integrated circuit cards — Part 4: Organization, security and commands for interchange. Third edition 2013-04-15</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ISO 7816-8</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">ISO/IEC 7816-8, Identification cards — Integrated circuit cards — Part 8: Commands for security operations. Second edition 2004-06-01</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ISO 8825-1</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">ISO/IEC 8825-1, Information technology — ASN.1 encoding rules: Specification of Basic Encoding Rules (BER), Canonical Encoding Rules (CER) and Distinguished Encoding Rules (DER). Fourth edition, 2008-12-15</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ISO 9797-1</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">ISO/IEC 9797-1, Information technology — Security techniques — Message Authentication Codes (MACs) — Part 1: Mechanisms using a block cipher. Second edition, 2011-03-01</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ISO 10116</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">ISO/IEC 10116, Information technology — Security techniques — Modes of operation of an <span class="italics">n</span>-bit block cipher. Third edition, 2006-02-01</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ISO 16844-3</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">ISO/IEC 16844-3, Road vehicles — Tachograph systems — Part 3: Motion sensor interface. First edition 2004, including Technical Corrigendum 1 2006</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">RFC 5480</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Elliptic Curve Cryptography Subject Public Key Information, March 2009</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">RFC 5639</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Elliptic Curve Cryptography (ECC) — Brainpool Standard Curves and Curve Generation, 2010</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">RFC 5869</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">HMAC-based Extract-and-Expand Key Derivation Function (HKDF), May 2010</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">SHS</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">National Institute of Standards and Technology (NIST), FIPS PUB 180-4: Secure Hash Standard, March 2012</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">SP 800-38B</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">National Institute of Standards and Technology (NIST), Special Publication 800-38B: Recommendation for Block Cipher Modes of Operation: The CMAC Mode for Authentication, 2005</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">TR-03111</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">BSI Technical Guideline TR-03111, Elliptic Curve Cryptography, version 2.00, 2012-06-28</p>
                  </td>
               </tr>
            </tbody></table>
<p class="title-gr-seq-level-4" id="id-e795b92d-024a-4295-8bb2-8b66dce1f91a">7.2.   <span class="boldface">
                  <span class="boldface">Notations and Abbreviations</span>
               </span>
            </p>
<p class="norm">The following notations and abbreviated terms are used in this Appendix:</p>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">AES</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Advanced Encryption Standard</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CA</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Certificate Authority</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CAR</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Certificate Authority Reference</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CBC</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Cipher Block Chaining (mode of operation)</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CH</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Command Header</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CHA</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Certificate Holder Authorisation</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CHR</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Certificate Holder Reference</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">CV</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Constant Vector</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">DER</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Distinguished Encoding Rules</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">DO</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Data Object</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">DSRC</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Dedicated Short Range Communication</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ECC</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Elliptic Curve Cryptography</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ECDSA</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Elliptic Curve Digital Signature Algorithm</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">ECDH</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Elliptic Curve Diffie-Hellman (key agreement algorithm)</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">EGF</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">External GNSS Facility</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">EQT</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Equipment</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">IDE</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Intelligent Dedicated Equipment</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">K<span class="subscript">M</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Motion Sensor Master Key, allowing the pairing of a Vehicle Unit to a Motion Sensor</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">K<span class="subscript">M-VU</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Key inserted in vehicle units, allowing a VU to derive the Motion Sensor Master Key if a workshop card is inserted into the VU</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">K<span class="subscript">M-WC</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Key inserted in workshop cards, allowing a VU to derive the Motion Sensor Master Key if a workshop card is inserted into the VU</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">MAC</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Message Authentication Code</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">MoS</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Motion Sensor</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">MSB</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Most Significant Bit</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">PKI</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Public Key Infrastructure</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">RCF</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Remote Communication Facility</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">SSC</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Send Sequence Counter</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">SM</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Secure Messaging</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">TDES</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Triple Data Encryption Standard</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">TLV</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Tag Length Value</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">VU</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">Vehicle Unit</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.C</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">the public key certificate of user X</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.CA</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">the certificate authority that issued the certificate of user X</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.CAR</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">the certificate authority reference mentioned in the certificate of user X</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.CHR</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">the certificate holder reference mentioned in the certificate of user X</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.PK</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">public key of user X</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.SK</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">private key of user X</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.PK<span class="subscript">eph</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">ephemeral public key of user X</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">X.SK<span class="subscript">eph</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">ephemeral private key of user X</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">‘xx’</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">a hexadecimal value</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">||</p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">concatenation operator</p>
                  </td>
               </tr>
            </tbody></table>
<p class="title-gr-seq-level-4" id="id-decda097-5555-4aab-989c-8fe4f58ff53c">7.3.   <span class="boldface">
                  <span class="boldface">Definitions</span>
               </span>
            </p>
<p class="norm">The definitions of terms used in this Appendix are included in section I of Annex 1C.</p>
<p class="title-gr-seq-level-3" id="id-0b9f7934-c8cc-4b0a-a50f-c3072ec6ac22">8.   <span class="boldface">CRYPTOGRAPHIC SYSTEMS AND ALGORITHMS</span>
            </p>
<p class="title-gr-seq-level-4" id="id-d42a237a-f3f5-43d0-8e43-44717a4d019f">8.1.   <span class="boldface">
                  <span class="boldface">Cryptographic Systems</span>
               </span>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_38<span style="word-spacing: NaNpt"> </span>Vehicle units and tachograph cards shall use an elliptic curve-based public-key cryptographic system to provide the following security services:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">mutual authentication between a vehicle unit and a card,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">agreement of AES session keys between a vehicle unit and a card,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">ensuring the authenticity, integrity and non-repudiation of data downloaded from vehicle units or tachograph cards to external media.</div>
               </div>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_39<span style="word-spacing: NaNpt"> </span>Vehicle units and external GNSS facilities shall use an elliptic curve-based public-key cryptographic system to provide the following security services:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">coupling of a vehicle unit and an external GNSS facility,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">mutual authentication between a vehicle unit and an external GNSS facility,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">agreement of an AES session key between a vehicle unit and an external GNSS facility.</div>
               </div>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_40<span style="word-spacing: NaNpt"> </span>Vehicle units and tachograph cards shall use an AES-based symmetric cryptographic system to provide the following security services:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">ensuring authenticity and integrity of data exchanged between a vehicle unit and a tachograph card,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">where applicable, ensuring confidentiality of data exchanged between a vehicle unit and a tachograph card.</div>
               </div>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_41<span style="word-spacing: NaNpt"> </span>Vehicle units and external GNSS facilities shall use an AES-based symmetric cryptographic system to provide the following security services:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">ensuring authenticity and integrity of data exchanged between a vehicle unit and an external GNSS facility.</div>
               </div>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_42<span style="word-spacing: NaNpt"> </span>Vehicle units and motion sensors shall use an AES-based symmetric cryptographic system to provide the following security services:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">pairing of a vehicle unit and a motion sensor,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">mutual authentication between a vehicle unit and a motion sensor,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">ensuring confidentiality of data exchanged between a vehicle unit and a motion sensor.</div>
               </div>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_43<span style="word-spacing: NaNpt"> </span>Vehicle units and control cards shall use an AES-based symmetric cryptographic system to provide the following security services on the remote communication interface:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">ensuring confidentiality, authenticity and integrity of data transmitted from a vehicle unit to a control card.</div>
               </div>
            </div>
<p class="title-gr-seq-level-4" id="id-880ac010-a023-4827-a1bb-a00a0bb39ed6">
               <span class="italics">Notes:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>Properly speaking, data is transmitted from a vehicle unit to a remote interrogator under the control of a control officer, using a remote communication facility that may be internal or external to the VU, see Appendix 14. However, the remote interrogator sends the received data to a control card for decryption and validation of authenticity. From a security point of view, the remote communication facility and the remote interrogator are fully transparent.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>A workshop card offers the same security services for the DSRC interface as a control card does. This allows a workshop to validate the proper functioning of the remote communication interface of a VU, including security. Please refer to section 9.2.2 for more information.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-0cdc9075-825d-4bfc-aeaf-0302eddaac56">8.2.   <span class="boldface">
                  <span class="boldface">Cryptographic Algorithms</span>
               </span>
            </p>
<p class="title-gr-seq-level-5" id="id-e5abb2a9-1493-458c-b777-91be21ff35f5">8.2.1   <span class="boldface">
                  <span class="italics">Symmetric Algorithms</span>
               </span>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_44<span style="word-spacing: NaNpt"> </span>Vehicle units, tachograph cards, motion sensors and external GNSS facilities shall support the AES algorithm as defined in [AES], with key lengths of 128, 192 and 256 bits.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-a0b4e691-f7e9-4a23-a8b6-17de744f2d5c">8.2.2   <span class="boldface">
                  <span class="italics">Asymmetric Algorithms and Standardized Domain Parameters</span>
               </span>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_45<span style="word-spacing: NaNpt"> </span>Vehicle units, tachograph cards and external GNSS facilities shall support elliptic curve cryptography with a key size of 256, 384 and 512/521 bits.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_46<span style="word-spacing: NaNpt"> </span>Vehicle units, tachograph cards and external GNSS facilities shall support the ECDSA signing algorithm, as specified in [DSS].</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_47<span style="word-spacing: NaNpt"> </span>Vehicle units, tachograph cards and external GNSS facilities shall support the ECKA-EG key agreement algorithm, as specified in [TR 03111].</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_48<span style="word-spacing: NaNpt"> </span>Vehicle units, tachograph cards and external GNSS facilities shall support all standardized domain parameters specified in Table 1 below for elliptic curve cryptography.</p>
            </div>
<p>
               <br/>
            </p>
<div class="centered">
               <p>
                  <br/>
               </p>
               <p class="title-table" id="id-f2fe108f-7f84-403e-8af1-a9d2cc3d700d">
                  <span class="italics">Table 1</span>
               </p>
               <p class="title-table" id="id-3d5805d3-f965-4093-b3e5-c34c9fd001e9">
                  <span class="boldface">Standardized domain parameters</span>
               </p>
               <table width="320" border="1" cellpadding="2" cellspacing="0">
                  <colgroup><col width="6%"/>
                  <col width="4%"/>
                  <col width="7%"/>
                  <col width="83%"/>
                  </colgroup><tbody>
                     <tr>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Name</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Size (bits)</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Reference</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Object identifier</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">NIST P-256</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">256</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">[DSS], [RFC 5480]</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">BrainpoolP256r1</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">256</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">[RFC 5639]</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">NIST P-384</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">384</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">[DSS], [RFC 5480]</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">BrainpoolP384r1</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">384</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">[RFC 5639]</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">BrainpoolP512r1</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">512</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">[RFC 5639]</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">NIST P-521</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">521</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">[DSS], [RFC 5480]</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </div>
<p class="norm">
               <span class="italics">Note:</span> the object identifiers mentioned in the last column of Table 1 are specified in [RFC 5639] for the Brainpool curves and in [RFC 5480] for the NIST curves.</p>
<p class="norm">
               
            </p>
<p class="title-gr-seq-level-5" id="id-1115650e-020c-41dc-91d5-08a0414af571">8.2.3   <span class="boldface">
                  <span class="italics">Hashing algorithms</span>
               </span>
            </p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_49<span style="word-spacing: NaNpt"> </span>Vehicle units, tachograph cards and external GNSS facilities shall support the SHA-256, SHA-384 and SHA-512 algorithms specified in [SHS].</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<p class="title-gr-seq-level-5" id="id-20ea198d-a59f-4f41-a3bf-070709475b7f">8.2.4   <span class="boldface">
                  <span class="italics">Cipher Suites</span>
               </span>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_50<span style="word-spacing: NaNpt"> </span>In case a symmetric algorithm, an asymmetric algorithm and/or a hashing algorithm are used together to form a security protocol, their respective key lengths and hash sizes shall be of (roughly) equal strength. Table 2 shows the allowed cipher suites:</p>
            </div>
<p>
               <br/>
            </p>
<div class="centered">
               <p>
                  <br/>
               </p>
               <p class="title-table" id="id-7ddec6d7-4bd8-498a-a43b-eb8424811805">
                  <span class="italics">Table 2</span>
               </p>
               <p class="title-table" id="id-4530023d-b54b-413b-8ebf-cdd743dd9b82">
                  <span class="boldface">Allowed cipher suites</span>
               </p>
               <table width="240" border="1" cellpadding="2" cellspacing="0">
                  <colgroup><col width="17%"/>
                  <col width="21%"/>
                  <col width="23%"/>
                  <col width="19%"/>
                  <col width="20%"/>
                  </colgroup><tbody>
                     <tr>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Cipher suite Id</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">ECC key size (bits)</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">AES key length (bits)</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Hashing algorithm</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">MAC length (bytes)</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">CS#1</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">256</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">128</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">SHA-256</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">8</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">CS#2</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">384</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">192</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">SHA-384</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">12</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">CS#3</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">512/521</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">256</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">SHA-512</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </div>
<p class="norm">
               <span class="italics">Note:</span> ECC keys sizes of 512 bits and 521 bits are considered to be equal in strength for all purposes within this Appendix.</p>
<p class="title-gr-seq-level-3" id="id-0ce64379-80fe-42cb-9188-521b196ae9d4">9.   <span class="boldface">KEYS AND CERTIFICATES</span>
            </p>
<p class="title-gr-seq-level-4" id="id-6a9e948d-062a-4398-9d0e-55e741f1fae1">9.1.   <span class="boldface">
                  <span class="boldface">Asymmetric Key Pairs and Public Key Certificates</span>
               </span>
            </p>
<p class="title-gr-seq-level-5" id="id-5e44799b-0f9a-49ef-beeb-fc75109d8f82">9.1.1   <span class="boldface">
                  <span class="italics">General</span>
               </span>
            </p>
<p class="norm">
               <span class="italics">Note:</span> the keys described in this section are used for mutual authentication and secure messaging between vehicle units and tachograph cards and between vehicle units and external GNSS facilities. These processes are described in detail in chapters 10 and 11 of this Appendix.</p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_51<span style="word-spacing: NaNpt"> </span>Within the European Smart Tachograph system, ECC key pairs and corresponding certificates shall be generated and managed through three functional hierarchical levels:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">European level,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Member State level,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Equipment level.</div>
               </div>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_52<span style="word-spacing: NaNpt"> </span>Within the entire European Smart Tachograph system, public and private keys and certificates shall be generated, managed and communicated using standardized and secure methods.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-e0ad8adf-660d-4ee3-a0b4-6b420b27f286">9.1.2   <span class="boldface">
                  <span class="italics">European Level</span>
               </span>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_53<span style="word-spacing: NaNpt"> </span>At European level, a single unique ECC key pair designated as EUR shall be generated. It shall consist of a private key (EUR.SK) and a public key (EUR.PK). This key pair shall form the root key pair of the entire European Smart Tachograph PKI. This task shall be handled by a European Root Certificate Authority (ERCA), under the authority and responsibility of the European Commission.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_54<span style="word-spacing: NaNpt"> </span>The ERCA shall use the European private key to sign a (self-signed) root certificate of the European public key, and shall communicate this European root certificate to all Member States.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_55<span style="word-spacing: NaNpt"> </span>The ERCA shall use the European private key to sign the certificates of the Member States public keys upon request. The ERCA shall keep records of all signed Member State public key certificates.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_56<span style="word-spacing: NaNpt"> </span>As shown in Figure 1 in section 9.1.7, the ERCA shall generate a new European root key pair every 17 years. Whenever the ERCA generates a new European root key pair, it shall create a new self-signed root certificate for the new European public key. The validity period of a European root certificate shall be 34 years plus 3 months.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> The introduction of a new root key pair also implies that ERCA will generate a new motion sensor master key and a new DSRC master key, see sections 9.2.1.2 and 9.2.2.2.</p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_57<span style="word-spacing: NaNpt"> </span>Before generating a new European root key pair, the ERCA shall conduct an analysis of the cryptographic strength that is needed for the new key pair, given it should stay secure for the next 34 years. If found necessary, the ERCA shall switch to a cipher suite that is stronger than the current one, as specified in CSM_50.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_58<span style="word-spacing: NaNpt"> </span>Whenever it generates a new European root key pair, the ERCA shall create a link certificate for the new European public key and sign it with the previous European private key. The validity period of the link certificate shall be 17 years plus 3 months. This is shown in Figure 1 in section 9.1.7 as well.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<p class="norm">
               <span class="italics">Note:</span> Since a link certificate contains the ERCA generation <span class="italics">X</span> public key and is signed with the ERCA generation <span class="italics">X-1</span> private key, a link certificate offers equipment issued under generation <span class="italics">X-1</span> a method to trust equipment issued under generation <span class="italics">X</span>.</p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_59<span style="word-spacing: NaNpt"> </span>The ERCA shall not use the private key of a root key pair for any purpose after the moment a new root key certificate becomes valid.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_60<span style="word-spacing: NaNpt"> </span>At any moment in time, the ERCA shall dispose of the following cryptographic keys and certificates:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The current EUR key pair and corresponding certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">All previous EUR certificates to be used for the verification of MSCA certificates that are still valid</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Link certificates for all generations of EUR certificates except the first one</div>
               </div>
            </div>
<p class="title-gr-seq-level-5" id="id-1f5ed61e-dff9-4d21-a9b9-bafce28e7d75">9.1.3   <span class="boldface">
                  <span class="italics">Member State Level</span>
               </span>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_61<span style="word-spacing: NaNpt"> </span>At Member State level, all Member States required to sign tachograph card certificates shall generate one or more unique ECC key pairs designated as MSCA_Card. All Member States required to sign certificates for vehicle units or external GNSS facilities shall additionally generate one or more unique ECC key pairs designated as MSCA_VU-EGF.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_62<span style="word-spacing: NaNpt"> </span>The task of generating Member State key pairs shall be handled by a Member State Certificate Authority (MSCA). Whenever a MSCA generates a Member State key pair, it shall send the public key to the ERCA in order to obtain a corresponding Member State certificate signed by the ERCA.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_63<span style="word-spacing: NaNpt"> </span>An MSCA shall choose the strength of a Member State key pair equal to the strength of the European root key pair used to sign the corresponding Member State certificate.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_64<span style="word-spacing: NaNpt"> </span>An MSCA_VU-EGF key pair, if present, shall consist of private key MSCA_VU-EGF.SK and public key MSCA_VU-EGF.PK. An MSCA shall use the MSCA_VU-EGF.SK private key exclusively to sign the public key certificates of vehicle units and external GNSS facilities.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_65<span style="word-spacing: NaNpt"> </span>An MSCA_Card key pair shall consist of private key MSCA_Card.SK and public key MSCA_Card.PK. An MSCA shall use the MSCA_Card.SK private key exclusively to sign the public key certificates of tachograph cards.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_66<span style="word-spacing: NaNpt"> </span>An MSCA shall keep records of all signed VU certificates, external GNSS facility certificates and card certificates, together with the identification of the equipment for which each certificate is intended.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_67<span style="word-spacing: NaNpt"> </span>The validity period of an MSCA_VU-EGF certificate shall be 17 years plus 3 months. The validity period of an MSCA_Card certificate shall be 7 years plus 1 month.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_68<span style="word-spacing: NaNpt"> </span>As shown in Figure 1 in section 9.1.7, the private key of a MSCA_VU-EGF key pair and the private key of a MSCA_Card key pair shall have a key usage period of two years.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_69<span style="word-spacing: NaNpt"> </span>An MSCA shall not use the private key of an MSCA_VU-EGF key pair for any purpose after the moment its usage period has ended. Neither shall an MSCA use the private key of an MSCA_Card key pair for any purpose after the moment its usage period has ended.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_70<span style="word-spacing: NaNpt"> </span>At any moment in time, an MSCA shall dispose of the following cryptographic keys and certificates:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The current MSCA_Card key pair and corresponding certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">All previous MSCA_Card certificates to be used for the verification of the certificates of tachograph cards that are still valid</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The current EUR certificate necessary for the verification of the current MSCA certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">All previous EUR certificates necessary for the verification of all MSCA certificates that are still valid</div>
               </div>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_71<span style="word-spacing: NaNpt"> </span>If an MSCA is required to sign certificates for vehicle units or external GNSS facilities, it shall additionally dispose of the following keys and certificates:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The current MSCA_VU-EGF key pair and corresponding certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">All previous MSCA_VU-EGF public keys to be used for the verification of the certificates of VUs or external GNSS facilities that are still valid</div>
               </div>
            </div>
<p class="title-gr-seq-level-5" id="id-4dda81f6-b429-4d40-a98f-d40d86d7f9bc">9.1.4   <span class="boldface">
                  <span class="italics">Equipment Level: Vehicle Units</span>
               </span>
            </p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_72<span style="word-spacing: NaNpt"> </span>Two unique ECC key pairs shall be generated for each vehicle unit, designated as VU_MA and VU_Sign. This task is handled by VU manufacturers. Whenever a VU key pair is generated, the party generating the key shall send the public key to its MSCA, in order to obtain a corresponding VU certificate signed by the MSCA. The private key shall be used only by the vehicle unit.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_73<span style="word-spacing: NaNpt"> </span>The VU_MA and VU_Sign certificates of a given vehicle unit shall have the same Certificate Effective Date.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_74<span style="word-spacing: NaNpt"> </span>A VU manufacturer shall choose the strength of a VU key pair equal to the strength of the MSCA key pair used to sign the corresponding VU certificate.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_75<span style="word-spacing: NaNpt"> </span>A vehicle unit shall use its VU_MA key pair, consisting of private key VU_MA.SK and public key VU_MA.PK, exclusively to perform VU Authentication towards tachograph cards and external GNSS facilities, as specified in sections 10.3 and 11.4 of this Appendix.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_76<span style="word-spacing: NaNpt"> </span>A vehicle unit shall be capable of generating ephemeral ECC key pairs and shall use an ephemeral key pair exclusively to perform session key agreement with a tachograph card or external GNSS facility, as specified in sections 10.4 and 11.4 of this Appendix.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_77<span style="word-spacing: NaNpt"> </span>A vehicle unit shall use the private key VU_Sign.SK of its VU_Sign key pair exclusively to sign downloaded data files, as specified in chapter 14 of this Appendix. The corresponding public key VU_Sign.PK shall be used exclusively to verify signatures created by the vehicle unit.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_78<span style="word-spacing: NaNpt"> </span>As shown in Figure 1 in section 9.1.7, the validity period of a VU_MA certificate shall be 15 years and 3 months. The validity period of a VU_Sign certificate shall also be 15 years and 3 months.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-d460b260-0702-4125-9a6c-4d0122e3394e">
               <span class="italics">Notes:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The extended validity period of a VU_Sign certificate allows a Vehicle Unit to create valid signatures over downloaded data during the first three months after it has expired, as required in Regulation (EU) No 581/2010.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The extended validity period of a VU_MA certificate is needed to allow the VU to authenticate to a control card or a company card during the first three months after it has expired, such that is it possible to perform a data download.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_79<span style="word-spacing: NaNpt"> </span>A vehicle unit shall not use the private key of a VU key pair for any purpose after the corresponding certificate has expired.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_80<span style="word-spacing: NaNpt"> </span>The VU key pairs (except ephemeral keys pairs) and corresponding certificates of a given vehicle unit shall not be replaced or renewed in the field once the vehicle unit has been put in operation.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-b386fcf5-c0c7-4f7b-99eb-7cc677027f56">
               <span class="italics">Notes:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>Ephemeral key pairs are not included in this requirement, as a new ephemeral key pair is generated by a VU each time Chip Authentication and session key agreement is performed, see section 10.4. Note that ephemeral key pairs do not have corresponding certificates.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>This requirement does not forbid the possibility of replacing static VU key pairs during a refurbishment or repair in a secure environment controlled by the VU manufacturer.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_81<span style="word-spacing: NaNpt"> </span>When put in operation, vehicle units shall contain the following cryptographic keys and certificates:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The VU_MA private key and corresponding certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The VU_Sign private key and corresponding certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The MSCA_VU-EGF certificate containing the MSCA_VU-EGF.PK public key to be used for verification of the VU_MA certificate and VU_Sign certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The EUR certificate containing the EUR.PK public key to be used for verification of the MSCA_VU-EGF certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The EUR certificate whose validity period directly precedes the validity period of the EUR certificate to be used to verify the MSCA_VU-EGF certificate, if existing</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The link certificate linking these two EUR certificates, if existing</div>
               </div>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_82<span style="word-spacing: NaNpt"> </span>In addition to the cryptographic keys and certificates listed in CSM_81, vehicle units shall also contain the keys and certificates specified in Part A of this Appendix, allowing a vehicle unit to interact with first-generation tachograph cards.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-af11f060-3bb9-481e-ae82-431844027d28">9.1.5   <span class="boldface">
                  <span class="italics">Equipment Level: Tachograph Cards</span>
               </span>
            </p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_83<span style="word-spacing: NaNpt"> </span>One unique ECC key pair, designated as Card_MA, shall be generated for each tachograph card. A second unique ECC key pair, designated as Card_Sign, shall additionally be generated for each driver card and each workshop card. This task may be handled by card manufacturers or card personalisers. Whenever a card key pair is generated, the party generating the key shall send the public key to its MSCA, in order to obtain a corresponding card certificate signed by the MSCA. The private key shall be used only by the tachograph card.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_84<span style="word-spacing: NaNpt"> </span>The Card_MA and Card_Sign certificates of a given driver card or workshop card shall have the same Certificate Effective Date.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_85<span style="word-spacing: NaNpt"> </span>A card manufacturer or card personaliser shall choose the strength of a card key pair equal to the strength of the MSCA key pair used to sign the corresponding card certificate.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_86<span style="word-spacing: NaNpt"> </span>A tachograph card shall use its Card_MA key pair, consisting of private key Card_MA.SK and public key Card_MA.PK, exclusively to perform mutual authentication and session key agreement towards vehicle units, as specified in sections 10.3 and 10.4 of this Appendix.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_87<span style="word-spacing: NaNpt"> </span>A driver card or workshop card shall use the private key Card_Sign.SK of its Card_Sign key pair exclusively to sign downloaded data files, as specified in chapter 14 of this Appendix. The corresponding public key Card_Sign.PK shall be used exclusively to verify signatures created by the card.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_88<span style="word-spacing: NaNpt"> </span>The validity period of a Card_MA certificate shall be as follows:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">For driver cards: 5 years</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">For company cards: 5 years</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">For control cards: 2 years</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">For workshop cards: 1 year</div>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_89<span style="word-spacing: NaNpt"> </span>The validity period of a Card_Sign certificate shall be as follows:</p>
            </div>
<p>
               <br/>
            </p>
<div class="centered">
               <p>
                  <br/>
               </p>
               <table width="240" border="1" cellpadding="2" cellspacing="0">
                  <colgroup><col width="58%"/>
                  <col width="42%"/>
                  </colgroup><tbody>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">—  For driver cards:</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">5 years and 1 month</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">—  For workshop cards:</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">1 year and 1 month</p>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </div>
<p class="norm">
               <span class="italics">Note:</span> the extended validity period of a Card_Sign certificate allows a driver card to create valid signatures over downloaded data during the first month after it has expired. This is necessary in view of Regulation (EU) No 581/2010, which requires that a data download from a driver card must be possible up to 28 days after the last data has been recorded.</p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_90<span style="word-spacing: NaNpt"> </span>The key pairs and corresponding certificates of a given tachograph card shall not be replaced or renewed once the card has been issued.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_91<span style="word-spacing: NaNpt"> </span>When issued, tachograph cards shall contain the following cryptographic keys and certificates:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The Card_MA private key and corresponding certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">For driver cards and workshop cards additionally: the Card_Sign private key and corresponding certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The MSCA_Card certificate containing the MSCA_Card.PK public key to be used for verification of the Card_MA certificate and Card_Sign certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The EUR certificate containing the EUR.PK public key to be used for verification of the MSCA_Card certificate.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The EUR certificate whose validity period directly precedes the validity period of the EUR certificate to be used to verify the MSCA_Card certificate, if existing.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The link certificate linking these two EUR certificates, if existing.</div>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: INSERTED">▼M1</a>
            </p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Additionally, for control cards, company cards and workshop cards only, and only if such cards are issued during the first three months of the validity period of a new EUR certificate: the EUR certificate that is two generations older, if existing.</div>
               </div>
            </div>
<p class="norm">
               <span class="italics">Note to last bullet:</span> For example, in the first three months of the ERCA(3) certificate (see Figure 1), the mentioned cards shall contain the ERCA(1) certificate. This is needed to ensure that these cards can be used to perform data downloads from ERCA(1) VUs whose normal 15-year life period plus the 3-months data downloading period expires during these months; see the last bullet of requirement 13) in Annex IC.</p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_92<span style="word-spacing: NaNpt"> </span>In addition to the cryptographic keys and certificates listed in CSM_91, tachograph cards shall also contain the keys and certificates specified in Part A of this Appendix, allowing these cards to interact with first-generation VUs.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-cdba777f-6407-46f4-af3a-63cf32bced92">9.1.6   <span class="boldface">
                  <span class="italics">Equipment Level: External GNSS Facilities</span>
               </span>
            </p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_93<span style="word-spacing: NaNpt"> </span>One unique ECC key pair shall be generated for each external GNSS facility, designated as EGF_MA. This task is handled by external GNSS facility manufacturers. Whenever an EGF_MA key pair is generated, the party generating th e key shall send the public key to its MSCA in order to obtain a corresponding EGF_MA certificate signed by the MSCA. The private key shall be used only by the external GNSS facility.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_94<span style="word-spacing: NaNpt"> </span>An EGF manufacturer shall choose the strength of an EGF_MA key pair equal to the strength of the MSCA key pair used to sign the corresponding EGF_MA certificate.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_95<span style="word-spacing: NaNpt"> </span>An external GNSS facility shall use its EGF_MA key pair, consisting of private key EGF_MA.SK and public key EGF_MA.PK, exclusively to perform mutual authentication and session key agreement towards vehicle units, as specified in section 11.4 of this Appendix.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_96<span style="word-spacing: NaNpt"> </span>The validity period of an EGF_MA certificate shall be 15 years.</p>
            </div>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_97<span style="word-spacing: NaNpt"> </span>An external GNSS facility shall not use the private key of its EGF_MA key pair for coupling to a vehicle unit after the corresponding certificate has expired.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> as explained in section 11.3.3, an EGF may potentially use its private key for mutual authentication towards the VU it is already coupled to, even after the corresponding certificate has expired.</p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_98<span style="word-spacing: NaNpt"> </span>The EGF_MA key pair and corresponding certificate of a given external GNSS facility shall not be replaced or renewed in the field once the EGF has been put in operation.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> This requirement does not forbid the possibility of replacing EGF key pairs during a refurbishment or repair in a secure environment controlled by the EGF manufacturer.</p>
<div style="margin-left: 48pt; text-indent: -48pt">
               <p class="norm">CSM_99<span style="word-spacing: NaNpt"> </span>When put in operation, an external GNSS facility shall contain the following cryptographic keys and certificates:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The EGF_MA private key and corresponding certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The MSCA_VU-EGF certificate containing the MSCA_VU-EGF.PK public key to be used for verification of the EGF_MA certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The EUR certificate containing the EUR.PK public key to be used for verification of the MSCA_VU-EGF certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The EUR certificate whose validity period directly precedes the validity period of the EUR certificate to be used to verify the MSCA_VU-EGF certificate, if existing</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The link certificate linking these two EUR certificates, if existing</div>
               </div>
            </div>
<p class="title-gr-seq-level-5" id="id-f9707d1d-5f7e-40db-b18e-8f045152ee8c">9.1.7   <span class="boldface">
                  <span class="italics">Overview: Certificate Replacement</span>
               </span>
            </p>
<p class="norm">Figure 1 below shows how different generations of ERCA root certificates, ERCA link certificates, MSCA certificates and equipment (VU and card) certificates are issued and used over time:</p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<p class="title-gr-seq-level-6" id="id-38f14f34-224a-48fd-ab19-8870dee380e3">
               <span class="italics">Figure 1</span>
            </p>
<p class="title-gr-seq-level-6" id="id-7f6b0c28-f510-44b4-8d09-7c1dd205d8d5">
               <span class="boldface">Issuance and usage of different generations of ERCA root certificates, ERCA link certificates, MSCA certificates and equipment certificates</span>
            </p>
<p class="norm">
               
            </p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<p class="title-gr-seq-level-6" id="id-e623d5d1-1d20-4d13-b6ab-d451c8047e98">
               <span class="italics">Notes to Figure 1:</span>
            </p>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">1.<span style="word-spacing: 15pt"> </span>Different generations of the root certificate are indicated by a number in brackets. E.g. ERCA (1) is the first generation of ERCA root certificate; ERCA (2) is the second generation, etc.</p>
            </div>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">2.<span style="word-spacing: 15pt"> </span>Other certificates are indicated by two numbers in brackets, the first one indicating the root certificate generation under which they are issued, the second one the generation of the certificate itself. E.g. MSCA_Card (1-1) is the first MSCA_Card certificate issued under ERCA (1); MSCA_Card (2-1) is the first MSCA_Card certificate issued under ERCA (2); MSCA_Card (2-last) is the last MSCA_Card certificate issued under ERCA (2); Card_MA(2-1) is the first Card certificate for mutual authentication that is issued under ERCA (2), etc.</p>
            </div>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">3.<span style="word-spacing: 15pt"> </span>The MSCA_Card (2-1) and MSCA_Card (1-last) certificates are issued at almost but not exactly the same date. MSCA_Card (2-1) is the first MSCA_Card certificate issued under ERCA (2) and will be issued slightly later than MSCA_Card (1-last), the last MSCA_Card certificate under ERCA (1).</p>
            </div>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">4.<span style="word-spacing: 15pt"> </span>As shown in the figure, the first VU and Card certificates issued under ERCA (2) will appear almost two years before the last VU and Card certificates issued under ERCA (1) will appear. This is because of the fact that VU and Card certificates are issued under an MSCA certificate, not directly under the ERCA certificate. The MSCA (2-1) certificate will be issued directly after ERCA (2) becomes valid, but the MSCA (1-last) certificate will be issued only slightly before that time, at the last moment the ERCA (1) certificate is still valid. Therefore, these two MSCA certificates will have almost the same validity period, despite the fact that they are of different generations.</p>
            </div>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">5.<span style="word-spacing: 15pt"> </span>The validity period shown for cards is the one for driver cards (5 years).</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 24pt; text-indent: -24pt">
               <p class="norm">6.<span style="word-spacing: 15pt"> </span>To save space, the difference in validity period between the Card_MA and Card_Sign certificates is shown only for the first generation.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<p class="title-gr-seq-level-4" id="id-f6635649-a000-4133-a243-5707b85455e9">9.2.   <span class="boldface">
                  <span class="boldface">Symmetric Keys</span>
               </span>
            </p>
<p class="title-gr-seq-level-5" id="id-b65f61e4-e109-4b3f-b5ad-022866b344a9">9.2.1   <span class="boldface">
                  <span class="italics">Keys for Securing VU — Motion Sensor Communication</span>
               </span>
            </p>
<p class="title-gr-seq-level-6" id="id-b6e72044-198f-4e31-8eb0-253357f64c44">9.2.1.1   <span class="boldface">
                  <span class="italics">General</span>
               </span>
            </p>
<p class="norm">
               <span class="italics">Note:</span> readers of this section are supposed to be familiar with the contents of [ISO 16844-3] describing the interface between a vehicle unit and a motion sensor. The pairing process between a VU and a motion sensor is described in detail in chapter 12 of this Appendix.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_100<span style="word-spacing: NaNpt"> </span>A number of symmetric keys is needed for pairing vehicle units and motion sensors, for mutual authentication between vehicle units and motion sensors and for encrypting communication between vehicle units and motion sensors, as shown in Table 3. All of these keys shall be AES keys, with a key length equal to the length of the motion sensor master key, which shall be linked to the length of the (foreseen) European root key pair as described in CSM_50.</p>
            </div>
<p>
               <br/>
            </p>
<div class="centered">
               <p>
                  <br/>
               </p>
               <p class="title-table" id="id-2e84f01a-324b-41ab-b280-4770a8ad07b3">
                  <span class="italics">Table 3</span>
               </p>
               <p class="title-table" id="id-defea9f2-191c-4ba8-9e30-235da6c82c74">
                  <span class="boldface">Keys for securing vehicle unit — motion sensor communication</span>
               </p>
               <table width="240" border="1" cellpadding="2" cellspacing="0">
                  <colgroup><col width="9%"/>
                  <col width="2%"/>
                  <col width="22%"/>
                  <col width="32%"/>
                  <col width="35%"/>
                  </colgroup><tbody>
                     <tr>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Key</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Symbol</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Generated by</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Generation method</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Stored by</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Motion Sensor Master Key — VU part</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">K<span class="subscript">M-VU</span>
                           </p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">ERCA</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Random</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">ERCA, MSCAs involved in issuing VUs certificates, VU manufacturers, vehicle units</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Motion Sensor Master Key — Workshop part</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">K<span class="subscript">M-WC</span>
                           </p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">ERCA</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Random</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">ERCA, MSCAs, card manufacturers, workshop cards</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Motion Sensor Master Key</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">K<span class="subscript">M</span>
                           </p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Not independently generated</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Calculated as K<span class="subscript">M</span> = K<span class="subscript">M-VU</span> XOR K<span class="subscript">M-WC</span>
                           </p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">ERCA, MSCAs involved in issuing motion sensors keys (optionally) <a href="#E0018">(<span class="superscript">*1</span>)</a>
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Identification Key</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">K<span class="subscript">ID</span>
                           </p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Not independently generated</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Calculated as K<span class="subscript">ID =</span> K<span class="subscript">M</span> XOR CV, where CV is specified in CSM_106</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">ERCA, MSCAs involved in issuing motion sensors keys (optionally) <a href="#E0018">(<span class="superscript">*1</span>)</a>
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Pairing Key</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">K<span class="subscript">P</span>
                           </p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Motion sensor manufacturer</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Random</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">One motion sensor</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Session Key</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">K<span class="subscript">S</span>
                           </p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">VU (during pairing of VU and motion sensor)</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Random</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">One VU and one motion sensor</p>
                        </td>
                     </tr>
                     <tr>
                        <td colspan="5">
                           <div class="tbl-norm">
                              <a id="E0018">(<span class="superscript">*1</span>)   </a>
                              <p class="inline-element">Storage of K<span class="subscript">M</span> and K<span class="subscript">ID</span> is optional, as these keys can be derived from K<span class="subscript">M-VU</span>, K<span class="subscript">M-WC</span> and CV.</p>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_101<span style="word-spacing: NaNpt"> </span>The European Root Certificate Authority shall generate K<span class="subscript">M-VU</span> and K<span class="subscript">M-WC</span>, two random and unique AES keys from which the motion sensor master key K<span class="subscript">M</span> can be calculated as K<span class="subscript">M-VU</span> XOR K<span class="subscript">M-WC</span>. The ERCA shall communicate K<span class="subscript">M,</span> K<span class="subscript">M-VU</span> and K<span class="subscript">M-WC</span> to Member State Certificate Authorities upon their request.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_102<span style="word-spacing: NaNpt"> </span>The ERCA shall assign to each motion sensor master key K<span class="subscript">M</span> a unique version number, which shall also be applicable for the constituting keys K<span class="subscript">M-VU</span> and K<span class="subscript">M-WC</span> and for the related identification key K<span class="subscript">ID.</span> The ERCA shall inform the MSCAs about the version number when sending K<span class="subscript">M-VU</span> and K<span class="subscript">M-WC</span> to them.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> The version number is used to distinguish different generations of these keys, as explained in detail in section 9.2.1.2.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_103<span style="word-spacing: NaNpt"> </span>A Member State Certificate Authority shall forward K<span class="subscript">M-VU,</span> together with its version number, to vehicle unit manufacturers upon their request. The VU manufacturers shall insert K<span class="subscript">M-VU</span> and its version number in all manufactured VUs.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_104<span style="word-spacing: NaNpt"> </span>A Member State Certificate Authority shall ensure that K<span class="subscript">M-WC</span>, together with its version number, is inserted in every workshop card issued under its responsibility.</p>
            </div>
<p class="title-gr-seq-level-6" id="id-d11752cd-7655-450e-8d64-ca3e31841904">
               <span class="italics">Notes:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>See the description of data type  in Appendix 2.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>as explained in section 9.2.1.2, in fact multiple generations of K<span class="subscript">M-WC</span> may have to be inserted in a single workshop card.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_105<span style="word-spacing: NaNpt"> </span>In addition to the AES key specified in CSM_104, a MSCA shall ensure that the TDES key Km<span class="subscript">WC,</span> specified in requirement CSM_037 in Part A of this Appendix, is inserted in every workshop card issued under its responsibility.</p>
            </div>
<p class="title-gr-seq-level-6" id="id-d1d4eef1-9f1f-4836-8e15-d0caef892563">
               <span class="italics">Notes:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>This allows a second-generation workshop card to be used for coupling a first-generation VU.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>A second-generation workshop card will contain two different applications, one complying with Part B of this Appendix and one complying with Part A. The latter will contain the TDES key Km<span class="subscript">WC</span>.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_106<span style="word-spacing: NaNpt"> </span>An MSCA involved in issuing motion sensors shall derive the identification key from the motion sensor master key by XORing it with a constant vector CV. The value of CV shall be as follows:</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">For 128-bit motion sensor master keys: CV = ‘B6 44 2C 45 0E F8 D3 62 0B 7A 8A 97 91 E4 5D 83’
                                             </div>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">For 192-bit motion sensor master keys: CV = ‘72 AD EA FA 00 BB F4 EE F4 99 15 70 5B 7E EE BB 1C 54 ED 46 8B 0E F8 25’
                                             </div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">For 256-bit motion sensor master keys: CV = ‘1D 74 DB F0 34 C7 37 2F 65 55 DE D5 DC D1 9A C3 23 D6 A6 25 64 CD BE 2D 42 0D 85 D2 32 63 AD 60’
                                             </div>
               </div>
            </div>
<p class="norm">
               <span class="italics">Note:</span> the constant vectors have been generated as follows:</p>
<div class="list">Pi_10 = first 10 bytes of the decimal portion of the mathematical constant π = ‘24 3F 6A 88 85 A3 08 D3 13 19’
                                                   </div>
<div class="list">CV_128-bits = first 16 bytes of SHA-256(Pi_10)</div>
<div class="list">CV_192-bits = first 24 bytes of SHA-384(Pi_10)</div>
<div class="list">CV_256-bits = first 32 bytes of SHA-512(Pi_10)</div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_107<span style="word-spacing: NaNpt"> </span>
                  <span>
                     <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">
                        <span class="boldface">►M1</span>
                     </a>
                  </span> Each Motion sensor manufacturer shall generate a random and unique pairing key K<span class="subscript">P</span> for every motion sensor, and shall send each pairing key to its Member State Certificate Authority. The MSCA shall encrypt each pairing key separately with the motion sensor master key K<span class="subscript">M</span> and shall return the encrypted key to the motion sensor manufacturer. For each encrypted key, the MSCA shall notify the motion sensor manufacturer of the version number of the associated K<span class="subscript">M</span>.<span class="boldface"> ◄ </span>
               </p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> as explained in section 9.2.1.2, in fact a motion sensor manufacturer may have to generate multiple unique pairing keys for a single motion sensor.</p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_108<span style="word-spacing: NaNpt"> </span>Each motion sensor manufacturer shall generate a unique serial number for every motion sensor, and shall send all serial numbers to its Member State Certificate Authority. The MSCA shall encrypt each serial number separately with the identification key K<span class="subscript">ID</span> and shall return the encrypted serial number to the motion sensor manufacturer. For each encrypted serial number, the MSCA shall notify the motion sensor manufacturer of the version number of the associated K<span class="subscript">ID</span>.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_109<span style="word-spacing: NaNpt"> </span>For requirements CSM_107 and CSM_108, the MSCA shall use the AES algorithm in the Cipher Block Chaining mode of operation, as defined in [ISO 10116], with an interleave parameter <span class="italics">m</span> = 1 and an initialization vector SV = ‘00’ {16}, i.e. sixteen bytes with binary value 0. When necessary, the MSCA shall use padding method 2 defined in [ISO 9797-1].</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_110<span style="word-spacing: NaNpt"> </span>The motion sensor manufacturer shall store the encrypted pairing key and the encrypted serial number in the intended motion sensor, together with the corresponding plain text values and the version number of K<span class="subscript">M</span> and K<span class="subscript">ID</span> used for encrypting.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> as explained in section 9.2.1.2, in fact a motion sensor manufacturer may have to insert multiple encrypted pairing keys and multiple encrypted serial numbers in a single motion sensor.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_111<span style="word-spacing: NaNpt"> </span>In addition to the AES-based cryptographic material specified in CSM_110, a motion sensor manufacturer may also store in each motion sensor the TDES-based cryptographic material specified in requirement CSM_037 in Part A of this Appendix.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> doing so will allow a second-generation motion sensor to be coupled to a first-generation VU.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_112<span style="word-spacing: NaNpt"> </span>The length of the session key K<span class="subscript">S</span> generated by a VU during the pairing to a motion sensor shall be linked to the length of its K<span class="subscript">M-VU,</span> as described in CSM_50.</p>
            </div>
<p class="title-gr-seq-level-6" id="id-36767594-9aad-4533-9769-5fcebbe7f573">9.2.1.2   <span class="boldface">
                  <span class="italics">Motion Sensor Master Key Replacement in Second-Generation Equipment</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_113<span style="word-spacing: NaNpt"> </span>Each motion sensor master key and all related keys (see Table 3) is associated to a particular generation of the ERCA root key pair. These keys shall therefore be replaced every 17 years. The validity period of each motion sensor master key generation shall begin one year before the associated ERCA root key pair becomes valid and shall end when the associated ERCA root key pair expires. This is depicted in Figure 2.</p>
            </div>
<p class="list"> 
               <span class="italics">Figure 2</span> 
               <br/> 
               <span class="boldface">Issuance and usage of different generations of the motion sensor master key in vehicle units, motions sensors and workshop cards</span> 
               
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_114<span style="word-spacing: NaNpt"> </span>At least one year before generating a new European root key pair, as described in CSM_56, the ERCA shall generate a new motion sensor master key K<span class="subscript">M</span> by generating a new K<span class="subscript">M-VU</span> and K<span class="subscript">M-WC</span>. The length of the motion sensor master key shall be linked to the foreseen strength of the new European root key pair, according to CSM_50. The ERCA shall communicate the new K<span class="subscript">M</span>, K<span class="subscript">M-VU</span> and K<span class="subscript">M-WC</span> to the MSCAs upon their request, together with their version number.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_115<span style="word-spacing: NaNpt"> </span>An MSCA shall ensure that all valid generations of K<span class="subscript">M-WC</span> are stored in every workshop card issued under its authority, together with their version numbers, as shown in Figure 2.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> this implies that in the last year of the validity period of an ERCA certificate, workshop cards will be issued with three different generations of K<span class="subscript">M-WC</span>, as shown in Figure 2.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_116<span style="word-spacing: NaNpt"> </span>In relation to the process described in CSM_107 and CSM_108 above: An MSCA shall encrypt each pairing key K<span class="subscript">P</span> it receives from a motion sensor manufacturer separately with each valid generation of the motion sensor master key K<span class="subscript">M</span>. An MSCA shall also encrypt each serial number it receives from a motion sensor manufacturer separately with each valid generation of the identification key K<span class="subscript">ID</span>. A motion sensor manufacturer shall store all encryptions of the pairing key and all encryptions of the serial number in the intended motion sensor, together with the corresponding plain text values and the version number(s) of K<span class="subscript">M</span> and K<span class="subscript">ID</span> used for encrypting.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> This implies that in the last year of the validity period of an ERCA certificate, motion sensors will be issued with encrypted data based on three different generations of K<span class="subscript">M,</span> as shown in Figure 2.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_117<span style="word-spacing: NaNpt"> </span>In relation to the process described in CSM_107 above: Since the length of the pairing key K<span class="subscript">P</span> shall be linked to the length of K<span class="subscript">M</span> (see CSM_100), a motion sensor manufacturer may have to generate up to three different pairing keys (of different lengths) for one motion sensor, in case subsequent generations of K<span class="subscript">M</span> have different lengths. In such a case, the manufacturer shall send each pairing key to the MSCA. The MSCA shall ensure that each pairing key is encrypted with the correct generation of the motion sensor master key, i.e. the one having the same length.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> In case the motion sensor manufacturer chooses to generate a TDES-based pairing key for a second-generation motion sensor (see CSM_111), the manufacturer shall indicate to the MSCA that the TDES-based motion sensor master key must be used for encrypting this pairing key. This is because the length of a TDES key may be equal to that of an AES key, so the MSCA cannot judge from the key length alone.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_118<span style="word-spacing: NaNpt"> </span>Vehicle unit manufacturers shall insert only one generation of K<span class="subscript">M-VU</span> in each vehicle unit, together with its version number. This K<span class="subscript">M-VU</span> generation shall be linked to the ERCA certificate upon which the VU&#39;s certificates are based.</p>
            </div>
<p class="title-gr-seq-level-6" id="id-7343e628-86da-48c2-93b8-bd19875e3118">
               <span class="italics">Notes:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>A vehicle unit based on the generation <span class="italics">X</span> ERCA certificate shall only contain the generation <span class="italics">X</span> K<span class="subscript">M-VU,</span> even if it is issued after the start of the validity period of the generation <span class="italics">X+1</span> ERCA certificate. This is shown in Figure 2.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>A VU of generation <span class="italics">X</span> cannot be paired to a motion sensor of generation <span class="italics">X-1</span>.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>Since workshop cards have a validity period of one year, the result of CSM_113 — CSM_118 is that all workshop cards will contain the new K<span class="subscript">M-WC</span> at the moment the first VU containing the new K<span class="subscript">M-VU</span> is issued. Therefore, such a VU will always be able to calculate the new K<span class="subscript">M.</span> Moreover, by that time most new motion sensors will contain encrypted data based on the new K<span class="subscript">M</span> as well.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-610a1180-443a-4caa-b5df-fa6625d61f57">9.2.2   <span class="boldface">
                  <span class="italics">Keys for Securing DSRC Communication</span>
               </span>
            </p>
<p class="title-gr-seq-level-6" id="id-83b6b4b9-7f52-47cb-8e1a-e16f3f96af3d">9.2.2.1   <span class="boldface">
                  <span class="italics">General</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_119<span style="word-spacing: NaNpt"> </span>The authenticity and confidentiality of data communicated from a vehicle unit to a control authority over a DSRC remote communication channel shall be ensured by means of a set of VU-specific AES keys derived from a single DSRC master key, KM<span class="subscript">DSRC</span>.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_120<span style="word-spacing: NaNpt"> </span>The DSRC master key KM<span class="subscript">DSRC</span> shall be an AES key that is securely generated, stored and distributed by the ERCA. The key length may be 128, 192 or 256 bits and shall be linked to the length of the European root key pair, as described in CSM_50.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_121<span style="word-spacing: NaNpt"> </span>The ERCA shall communicate the DSRC master key to Member State Certificate Authorities upon their request in a secure manner, to allow them to derive VU-specific DSRC keys and to ensure that the DSRC master key is inserted in all control cards and workshop cards issued under their responsibility.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_122<span style="word-spacing: NaNpt"> </span>The ERCA shall assign to each DSRC master key a unique version number. The ERCA shall inform the MSCAs about the version number when sending the DSRC master key to them.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> The version number is used to distinguish different generations of the DSRC master key, as explained in detail in section 9.2.2.2.</p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_123<span style="word-spacing: NaNpt"> </span>For every vehicle unit, the vehicle unit manufacturer shall create a unique VU serial number and shall send this number to its Member State Certificate Authority in a request to obtain a set of two VU-specific DSRC keys. The VU serial number shall have data type  .</p>
            </div>
<p class="title-gr-seq-level-6" id="id-d4e0884f-9057-47e6-960e-32c1a45f4174">
               <span class="italics">Note:</span>
            </p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">This VU serial number shall be identical to the vuSerialNumber element of VuIdentification, see Appendix 1 and to the Certificate Holder Reference in the VU’s certificates.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The VU serial number may not be known at the moment a vehicle unit manufacturer requests the VU-specific DSRC keys. In this case, the VU manufacturer shall send instead the unique certificate request ID it used when requesting the VU’s certificates; see CSM_153. This certificate request ID shall therefore be equal to the Certificate Holder Reference in the VU’s certificates.</div>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_124<span style="word-spacing: NaNpt"> </span>Upon receiving a request for VU-specific DSRC keys, the MSCA shall derive two AES keys for the vehicle unit, called K_VU<span class="subscript">DSRC</span>_ENC and K_VU<span class="subscript">DSRC</span>_MAC. These VU-specific keys shall have the same length as the DSRC master key. The MSCA shall use the key derivation function defined in [RFC 5869]. The hash function that is necessary to instantiate the HMAC-Hash function shall be linked to the length of the DSRC master key, as described in CSM_50. The key derivation function in [RFC 5869] shall be used as follows:</p>
            </div>
<div class="list">Step 1 (Extract):</div>
<div class="list">
               <div class="grid-container grid-list">
                  <div class="list grid-list-column-1">
                     <span>— </span>
                  </div>
                  <div class="grid-list-column-2">
                     <div class="list">
                        <span class="italics">PRK</span> = HMAC-Hash (<span class="italics">salt, IKM</span>) where <span class="italics">salt</span> is an empty string ‘
                                                         ’ and <span class="italics">IKM</span> is KM<span class="subscript">DSRC</span>.</div>
                  </div>
               </div>
            </div>
<div class="list">Step 2 (Expand):</div>
<div class="list">
               <div class="grid-container grid-list">
                  <div class="list grid-list-column-1">
                     <span>— </span>
                  </div>
                  <div class="grid-list-column-2">
                     <div class="list">
                        <span class="italics">OKM</span> = <span class="italics">T(1)</span>, where</div>
                     <div class="list">
                        <span class="italics">T(1)</span> = HMAC-Hash (<span class="italics">PRK</span>, <span class="italics">T(0)</span> || <span class="italics">info</span> || ‘01’) with</div>
                     <div class="list">
                        <div class="grid-container grid-list">
                           <div class="list grid-list-column-1">
                              <span>— </span>
                           </div>
                           <div class="grid-list-column-2">
                              <div class="list">
                                 <span class="italics">T(0)</span> = an empty string (‘
                                                                  ’)</div>
                           </div>
                        </div>
                        <div class="grid-container grid-list">
                           <div class="list grid-list-column-1">
                              <span>— </span>
                           </div>
                           <div class="grid-list-column-2">
                              <div class="list">
                                 <span>
                                    <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">
                                       <span class="boldface">►M1</span>
                                    </a>
                                 </span> 
                                                                  <span class="italics">info</span> = VU serial number or certificate request ID, as specified in CSM_123<span class="boldface"> ◄ </span>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="grid-container grid-list">
                  <div class="list grid-list-column-1">
                     <span>— </span>
                  </div>
                  <div class="grid-list-column-2">
                     <div class="list">K_VU<span class="subscript">DSRC</span>_ENC = first <span class="italics">L</span> octets of <span class="italics">OKM</span> and</div>
                     <div class="list">K_VU<span class="subscript">DSRC</span>_MAC = last <span class="italics">L</span> octets of <span class="italics">OKM</span>
                     </div>
                     <div class="list">where <span class="italics">L</span> is the required length of K_VU<span class="subscript">DSRC</span>_ENC and K_VU<span class="subscript">DSRC</span>_MAC in octets.</div>
                  </div>
               </div>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_125<span style="word-spacing: NaNpt"> </span>The MSCA shall distribute K_VU<span class="subscript">DSRC</span>_ENC and K_VU<span class="subscript">DSRC</span>_MAC to the VU manufacturer in a secure manner for insertion in the intended vehicle unit.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_126<span style="word-spacing: NaNpt"> </span>When issued, a vehicle unit shall have stored K_VU<span class="subscript">DSRC</span>_ENC and K_VU<span class="subscript">DSRC</span>_MAC in its secure memory, in order to be able to ensure the integrity, authenticity and confidentiality of data sent over the remote communication channel. A vehicle unit shall also store the version number of the DSRC master key used to derive these VU-specific keys.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_127<span style="word-spacing: NaNpt"> </span>When issued, control cards and workshop cards shall have stored KM<span class="subscript">DSRC</span> in their secure memory, in order to be able to verify the integrity and authenticity of data sent by a VU over the remote communication channel and to decrypt this data. Control cards and workshop cards shall also store the version number of the DSRC master key.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> as explained in section 9.2.2.2, in fact multiple generations of KM<span class="subscript">DSRC</span> may have to be inserted in a single workshop card or control card.</p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_128<span style="word-spacing: NaNpt"> </span>The MSCA shall keep records of all VU-specific DSRC keys it generated, their version number and the VU serial number or certificate request ID used in deriving them.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<p class="title-gr-seq-level-6" id="id-2cbaff6c-e271-4a7e-8f70-9778ab61b0b8">9.2.2.2   <span class="boldface">
                  <span class="italics">DSRC Master Key Replacement</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_129<span style="word-spacing: NaNpt"> </span>Each DSRC master key is associated to a particular generation of the ERCA root key pair. The ERCA shall therefore replace the DSRC master key every 17 years. The validity period of each DSRC master key generation shall begin two years before the associated ERCA root key pair becomes valid and shall end when the associated ERCA root key pair expires. This is depicted in Figure 3.</p>
            </div>
<p class="list"> 
               <span class="italics">Figure 3</span> 
               <br/> 
               <span class="boldface">Issuance and usage of different generations of the DSRC master key in vehicle units, workshop cards and control cards</span> 
               
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_130<span style="word-spacing: NaNpt"> </span>At least two years before generating a new European root key pair, as described in CSM_56, the ERCA shall generate a new DSRC master key. The length of the DSRC key shall be linked to the foreseen strength of the new European root key pair, according to CSM_50. The ERCA shall communicate the new DSRC master key to the MSCAs upon their request, together with its version number.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_131<span style="word-spacing: NaNpt"> </span>An MSCA shall ensure that all valid generations of KM<span class="subscript">DSRC</span> are stored in every control card issued under its authority, together with their version numbers, as shown in Figure 3.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> this implies that in the last two years of the validity period of an ERCA certificate, control cards will be issued with three different generations of KM<span class="subscript">DSRC</span>, as shown in Figure 3.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_132<span style="word-spacing: NaNpt"> </span>An MSCA shall ensure that all generations of KM<span class="subscript">DSRC</span> that have been valid for at least a year and are still valid, are stored in every workshop card issued under its authority, together with their version numbers, as shown in Figure 3.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> this implies that in the last year of the validity period of an ERCA certificate, workshop cards will be issued with three different generations of KM<span class="subscript">DSRC</span>, as shown in Figure 3.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_133<span style="word-spacing: NaNpt"> </span>Vehicle unit manufacturers shall insert only one set of VU-specific DSRC keys into each vehicle unit, together with its version number. This set of keys shall be derived from the KM<span class="subscript">DSRC</span> generation linked to the ERCA certificate upon which the VU&#39;s certificates are based.</p>
            </div>
<p class="title-gr-seq-level-6" id="id-e84e79a0-acd0-4265-a7ba-67b060ce2473">
               <span class="italics">Notes:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>This implies that a vehicle unit based on the generation <span class="italics">X</span> ERCA certificate shall only contain the generation <span class="italics">X</span> K_VU<span class="subscript">DSRC</span>_ENC and K_VU<span class="subscript">DSRC</span>_MAC<span class="subscript">,</span> even if the VU is issued after the start of the validity period of the generation <span class="italics">X+1</span> ERCA certificate. This is shown in Figure 3.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>Since workshop cards have a validity period of one year and control cards of two years, the result of CSM_131 — CSM_133 is that all workshop cards and control cards will contain the new DSRC master key at the moment the first VU containing VU-specific keys based on that master key will be issued.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-7caf87a1-1ae9-47ca-9db6-f52210662c78">9.3.   <span class="boldface">
                  <span class="boldface">Certificates</span>
               </span>
            </p>
<p class="title-gr-seq-level-5" id="id-d94e9e9b-6bcc-4554-a62c-1bbe06e7f01c">9.3.1   <span class="boldface">
                  <span class="italics">General</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_134<span style="word-spacing: NaNpt"> </span>All certificates in the European Smart Tachograph system shall be self-descriptive, card-verifiable (CV) certificates according to [ISO 7816-4] and [ISO 7816-8].</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_135<span style="word-spacing: NaNpt"> </span>
                  <span>
                     <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">
                        <span class="boldface">►M1</span>
                     </a>
                  </span> The Distinguished Encoding Rules (DER) according to [ISO 8825-1] shall be used to encode the data objects within certificates. Table 4 shows the full certificate encoding, including all tag and length bytes.<span class="boldface"> ◄ </span>
               </p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> this encoding results in a Tag-Length-Value (TLV) structure as follows:</p>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Tag</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">The tag is encoded in one or two octets and indicates the content.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Length</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">The length is encoded as an unsigned integer in one, two, or three octets, resulting in a maximum length of 65 535  octets. The minimum number of octets shall be used.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Value</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">The value is encoded in zero or more octets</p>
                  </td>
               </tr>
            </tbody></table>
<p class="title-gr-seq-level-5" id="id-f99b155c-afa4-41b5-a8c4-5caff49edece">9.3.2   <span class="boldface">
                  <span class="italics">Certificate Content</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_136<span style="word-spacing: NaNpt"> </span>All certificates shall have the structure shown in the certificate profile in Table 4.</p>
            </div>
<p>
               <br/>
            </p>
<div class="centered">
               <p>
                  <br/>
               </p>
               <p class="title-table" id="id-9880f983-6a97-4c16-a970-c47a23f9f644">
                  <span class="italics">Table 4</span>
               </p>
               <p class="title-table" id="id-a1699ef1-3345-4f45-b388-16e85144387d">
                  <span class="boldface">Certificate Profile version 1</span>
               </p>
               <table width="480" border="1" cellpadding="2" cellspacing="0">
                  <colgroup><col width="9%"/>
                  <col width="1%"/>
                  <col width="7%"/>
                  <col width="6%"/>
                  <col width="78%"/>
                  </colgroup><tbody>
                     <tr>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Field</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Field ID</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Tag</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Length (bytes)</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="hd-column">ASN.1 data type</p>
                           <p class="hd-column">(see Appendix 1)</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">ECC Certificate</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">C</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘7F 21’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">var</p>
                        </td>
                        <td valign="top">
                           <p class="normal"> </p>
                           <div>
                        </div></td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">ECC Certificate Body</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">B</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘7F 4E’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">var</p>
                        </td>
                        <td valign="top">
                           <p class="normal"> </p>
                           <div>
                        </div></td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Certificate Profile Identifier</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">CPI</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘5F 29’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘01’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Certificate Authority Reference</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">CAR</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘42’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘08’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Certificate Holder Authorisation</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">CHA</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘5F 4C’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘07’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                              
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Public Key</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">PK</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘7F 49’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">var</p>
                        </td>
                        <td valign="top">
                           <p class="normal"> </p>
                           <div>
                        </div></td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Domain Parameters</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">DP</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘06’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">var</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Public Point</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">PP</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘86’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">var</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Certificate Holder Reference</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">CHR</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘5F 20’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘08’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Certificate Effective Date</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">CEfD</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘5F 25’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘04’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Certificate Expiration Date</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">CExD</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘5F 24’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘04’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">ECC Certificate Signature</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">S</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘5F 37’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">var</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-centered">
                              
                           </p>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </div>
<p class="norm">
               <span class="italics">Note:</span> the Field ID will be used in later sections of this Appendix to indicate individual fields of a certificate, e.g. X.CAR is the Certificate Authority Reference mentioned in the certificate of user X.</p>
<p class="title-gr-seq-level-6" id="id-b6b61fdb-5aa3-430d-8228-eb02e1ba2670">9.3.2.1   <span class="boldface">Certificate Profile Identifier</span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_137<span style="word-spacing: NaNpt"> </span>Certificates shall use a Certificate Profile Identifier to indicate the certificate profile used. Version 1, as specified in Table 4, shall be identified by a value of ‘00’.</p>
            </div>
<p class="title-gr-seq-level-6" id="id-5ad89a65-9e47-4f2b-ada6-e5626c1c9490">9.3.2.2   <span class="boldface">Certificate Authority Reference</span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_138<span style="word-spacing: NaNpt"> </span>The Certificate Authority Reference shall be used to identify the public key to be used to verify the certificate signature. The Certificate Authority Reference shall therefore be equal to the Certificate Holder Reference in the certificate of the corresponding certificate authority.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_139<span style="word-spacing: NaNpt"> </span>An ERCA root certificate shall be self-signed, i.e., the Certificate Authority Reference and the Certificate Holder Reference in the certificate shall be equal.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_140<span style="word-spacing: NaNpt"> </span>For an ERCA link certificate, the Certificate Holder Reference shall be equal to the CHR of the new ERCA root certificate. The Certificate Authority Reference for a link certificate shall be equal to the CHR of the previous ERCA root certificate.</p>
            </div>
<p class="title-gr-seq-level-6" id="id-3a9afd18-6765-4e1b-872d-782ede57c9d8">9.3.2.3   <span class="boldface">Certificate Holder Authorisation</span>
            </p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_141<span style="word-spacing: NaNpt"> </span>The Certificate Holder Authorisation shall be used to identify the type of certificate. It consists of the six most significant bytes of the Tachograph Application ID, concatenated with the equipment type, which indicates the type of equipment for which the certificate is intended. In the case of a VU certificate, a driver card certificate or a workshop card certificate, the equipment type is also used to differentiate between a certificate for Mutual Authentication and a certificate for creating digital signatures (see section 9.1 and Appendix 1, data type EquipmentType).</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<p class="title-gr-seq-level-6" id="id-a1fc5236-cd38-464c-9fc1-c87038fcd400">9.3.2.4   <span class="boldface">Public Key</span>
            </p>
<p class="norm">The Public Key nests two data elements: the standardized domain parameters to be used with the public key in the certificate and the value of the public point.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_142<span style="word-spacing: NaNpt"> </span>The data element Domain Parameters shall contain one of the object identifiers specified in Table 1 to reference a set of standardized domain parameters.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_143<span style="word-spacing: NaNpt"> </span>The data element Public Point shall contain the public point. Elliptic curve public points shall be converted to octet strings as specified in [TR-03111]. The uncompressed encoding format shall be used. When recovering an elliptic curve point from its encoded format, the validations described in [TR-03111] shall always be carried out.</p>
            </div>
<p class="title-gr-seq-level-6" id="id-145225e3-451e-47ce-99e9-a6f24a5acc55">9.3.2.5   <span class="boldface">Certificate Holder Reference</span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_144<span style="word-spacing: NaNpt"> </span>The Certificate Holder Reference is an identifier for the public key provided in the certificate. It shall be used to reference this public key in other certificates.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_145<span style="word-spacing: NaNpt"> </span>For card certificates and external GNSS facility certificates, the Certificate Holder Reference shall have the  data type specified in Appendix 1.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_146<span style="word-spacing: NaNpt"> </span>For vehicle units, the manufacturer, when requesting a certificate, may or may not know the manufacturer-specific serial number of the VU for which that certificate and the associated private key is intended. In the first case, the Certificate Holder Reference shall have the  data type specified in Appendix 1. In the latter case, the Certificate Holder Reference shall have the  data type specified in Appendix 1.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: INSERTED">▼M1</a>
            </p>
<p class="norm">
               <span class="italics">Note:</span> For a card certificate, the value of the CHR shall be equal to the value of the cardExtendedSerialNumber in EF_ICC; see Appendix 2. For an EGF certificate, the value of the CHR shall be equal to the value of the sensorGNSSSerialNumber in EF_ICC; see Appendix 14. For a VU certificate, the value of the CHR shall be equal to the vuSerialNumber element of VuIdentification, see Appendix 1, unless the manufacturer does not know the manufacturer-specific serial number at the time the certificate is requested.</p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_147<span style="word-spacing: NaNpt"> </span>For ERCA and MSCA certificates, the Certificate Holder Reference shall have the  data type specified in Appendix 1.</p>
            </div>
<p class="title-gr-seq-level-6" id="id-e552428b-439e-49f9-b0a2-66d140ad7f70">9.3.2.6   <span class="boldface">Certificate Effective Date</span>
            </p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_148<span style="word-spacing: NaNpt"> </span>The Certificate Effective Date shall indicate the starting date and time of the validity period of the certificate.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<p class="title-gr-seq-level-6" id="id-032b45df-f18d-4cf6-8a9e-6e44698ed976">9.3.2.7   <span class="boldface">Certificate Expiration Date</span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_149<span style="word-spacing: NaNpt"> </span>The Certificate Expiration Date shall indicate the end date and time of the validity period of the certificate.</p>
            </div>
<p class="title-gr-seq-level-6" id="id-7eff41b2-a351-410e-b8e1-cc0807cb88cf">9.3.2.8   <span class="boldface">Certificate Signature</span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_150<span style="word-spacing: NaNpt"> </span>The signature on the certificate shall be created over the encoded certificate body, including the certificate body tag and length. The signature algorithm shall be ECDSA, as specified in [DSS], using the hashing algorithm linked to the key size of the signing authority, as specified in CSM_50. The signature format shall be plain, as specified in [TR-03111].</p>
            </div>
<p class="title-gr-seq-level-5" id="id-541d406d-c477-4ccf-bed0-a282d250ede9">9.3.3   <span class="boldface">
                  <span class="italics">Requesting Certificates</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_151<span style="word-spacing: NaNpt"> </span>
                  <span>
                     <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">
                        <span class="boldface">►M1</span>
                     </a>
                  </span> When requesting a certificate, an MSCA shall send the following data to the ERCA:<span class="boldface"> ◄ </span>
               </p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The Certificate Profile Identifier of the requested certificate</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The Certificate Authority Reference expected to be used for signing the certificate.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The Public Key to be signed</div>
               </div>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_152<span style="word-spacing: NaNpt"> </span>In addition to the data in CSM_151, an MSCA shall send the following data in a certificate request to the ERCA, allowing the ERCA to create the Certificate Holder Reference of the new MSCA certificate:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The numerical nation code of the Certification Authority (data type  defined in Appendix 1)</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The alphanumerical nation code of the Certification Authority (data type  defined in Appendix 1)</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The 1-byte serial number to distinguish the different keys of the Certification Authority in the case keys are changed</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The two-byte field containing Certification Authority specific additional info</div>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_153<span style="word-spacing: NaNpt"> </span>An equipment manufacturer shall send the following data in a certificate request to an MSCA, allowing the MSCA to create the Certificate Holder Reference of the new equipment certificate:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">If known (see CSM_154), a serial number for the equipment, unique for the manufacturer, the equipment&#39;s type and the month of manufacturing. Otherwise, a unique certificate request identifier.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The month and the year of equipment manufacturing or of the certificate request.</div>
               </div>
            </div>
<p class="list">The manufacturer shall ensure that this data is correct and that the certificate returned by the MSCA is inserted in the intended equipment.</p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_154<span style="word-spacing: NaNpt"> </span>In the case of a VU, the manufacturer, when requesting a certificate, may or may not know the manufacturer-specific serial number of the VU for which that certificate and the associated private key is intended. If known, the VU manufacturer shall send the serial number to the MSCA. If not known, the manufacturer shall uniquely identify each certificate request and send this certificate request serial number to the MSCA. The resulting certificate will then contain the certificate request serial number. After inserting the certificate in a specific VU, the manufacturer shall communicate the connection between the certificate request serial number and the VU identification to the MSCA.</p>
            </div>
<p class="title-gr-seq-level-3" id="id-36649fed-c158-4151-957c-665c8c14d6ea">10.   <span class="boldface">VU- CARD MUTUAL AUTHENTICATION AND SECURE MESSAGING</span>
            </p>
<p class="title-gr-seq-level-4" id="id-79ed2930-bc6c-4714-8b75-66655102c921">10.1.   <span class="boldface">
                  <span class="boldface">General</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_155<span style="word-spacing: NaNpt"> </span>On a high level, secure communication between a vehicle unit and a tachograph card shall be based on the following steps:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">First, each party shall demonstrate to the other that it owns a valid public key certificate, signed by a Member State Certificate Authority. In turn, the MSCA public key certificate must be signed by the European root certificate authority. This step is called certificate chain verification and is specified in detail in section 10.2</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Second, the vehicle unit shall demonstrate to the card that it is in possession of the private key corresponding to the public key in the presented certificate. It does so by signing a random number sent by the card. The card verifies the signature over the random number. If this verification is successful, the VU is authenticated. This step is called VU Authentication and is specified in detail in section 10.3.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Third, both parties independently calculate two AES session keys using an asymmetric key agreement algorithm. Using one of these session keys, the card creates a message authentication code (MAC) over some data sent by the VU. The VU verifies the MAC. If this verification is successful, the card is authenticated. This step is called Card Authentication and is specified in detail in section 10.4.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Fourth, the VU and the card shall use the agreed session keys to ensure the confidentiality, integrity and authenticity of all exchanged messages. This is called Secure Messaging and is specified in detail in section 10.5.</div>
               </div>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_156<span style="word-spacing: NaNpt"> </span>The mechanism described in CSM_155 shall be triggered by the vehicle unit whenever a card is inserted into one of its card slots.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-baa0b04c-057f-42a3-ba6b-6fc74838a382">10.2.   <span class="boldface">
                  <span class="boldface">Mutual Certificate Chain Verification</span>
               </span>
            </p>
<p class="title-gr-seq-level-5" id="id-9e3f1d07-d64c-4543-94f5-172a16d6a143">10.2.1   <span class="boldface">
                  <span class="italics">Card Certificate Chain Verification by VU</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_157<span style="word-spacing: NaNpt"> </span>
                  <span>
                     <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">
                        <span class="boldface">►M1</span>
                     </a>
                  </span> Vehicle units shall use the protocol depicted in Figure 4 for verifying a tachograph card’s certificate chain. For every certificate it reads from the card, the VU shall verify that the Certificate Holder Authorisation (CHA) field is correct:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The CHA field of the Card certificate shall indicate a card certificate for mutual authentication (see Appendix 1, data type EquipmentType).</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The CHA of the Card.CA certificate shall indicate an MSCA.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The CHA of the Card.Link certificate shall indicate the ERCA.<span class="boldface"> ◄ </span>
                  </div>
               </div>
            </div>
<p class="title-gr-seq-level-5" id="id-fd4c71c9-d5c6-4c4d-ac8d-1dcca449acdd">
               <span class="italics">Notes to Figure 4:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The Card certificates and public keys mentioned in the figure are those for mutual authentication. Section 9.1.5 denotes these as Card_MA.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The Card.CA certificates and public keys mentioned in the figure are those for signing card certificates and it is indicated in the CAR of the Card certificate. Section 9.1.3 denotes these as MSCA_Card.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The Card.CA.EUR certificate mentioned in the figure is the European root certificate that is indicated in the CAR of the Card.CA certificate.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The Card.Link certificate mentioned in the figure is the card&#39;s link certificate, if present. As specified in section 9.1.2, this is a link certificate for a new European root key pair created by the ERCA and signed by the previous European private key.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The Card.Link.EUR certificate is the European root certificate that is indicated in the CAR of the Card.Link certificate.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_158<span style="word-spacing: NaNpt"> </span>As depicted in Figure 4, verification of the card&#39;s certificate chain shall begin upon card insertion. The vehicle unit shall read the card holder reference () from EF ICC. The VU shall check if it knows the card, i.e., if it has successfully verified the card&#39;s certificate chain in the past and stored it for future reference. If it does, and the card certificate is still valid, the process continues with the verification of the VU certificate chain. Otherwise, the VU shall successively read from the card the MSCA_Card certificate to be used for verifying the card certificate, the Card.CA. EUR certificate to be used for verifying the MSCA_Card certificate, and possibly the link certificate, until it finds a certificate it knows or it can verify. If such a certificate is found, the VU shall use that certificate to verify the underlying card certificates it has read from the card. If successful, the process continues with the verification of the VU certificate chain. If not successful, the VU shall ignore the card.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> There are three ways in which the VU may know the Card.CA.EUR certificate:</p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">the Card.CA.EUR certificate is the same certificate as the VU&#39;s own EUR certificate;</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">the Card.CA.EUR certificate precedes the VU&#39;s own EUR certificate and the VU contained this certificate already at issuance (see CSM_81);</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">the Card.CA.EUR certificate succeeds the VU&#39;s own EUR certificate and the VU received a link certificate in the past from another tachograph card, verified it and stored it for future reference.</div>
               </div>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_159<span style="word-spacing: NaNpt"> </span>As indicated in Figure 4, once the VU has verified the authenticity and validity of a previously unknown certificate, it may store this certificate for future reference, such that it does not need to verify that certificate&#39;s authenticity again if it is presented to the VU again. Instead of storing the entire certificate, a VU may choose to store only the contents of the Certificate Body, as specified in section 9.3.2. <span>
                     <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: INSERTED">
                        <span class="boldface">►M1</span>
                     </a>
                  </span> Whereas storing of all other types of certificate is optional, it is mandatory for a VU to store a new link certificate presented by a card.<span class="boldface"> ◄ </span>
               </p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_160<span style="word-spacing: NaNpt"> </span>The VU shall verify the temporal validity of any certificate read from the card or stored in its memory, and shall reject expired certificates. For verifying the temporal validity of a certificate presented by the card a VU shall use its internal clock.</p>
            </div>
<p class="title-gr-seq-level-6" id="id-55ff5947-8873-4b9f-a459-4b97ee347e3f">
               <span class="italics">Figure 4</span>
            </p>
<p class="title-gr-seq-level-6" id="id-9013337d-c000-463f-a88b-d6c76811cb92">
               <span class="boldface">Protocol for Card Certificate Chain Verification by VU</span>
            </p>
<p class="title-gr-seq-level-5" id="id-11149aca-e116-4d14-aa52-8fbf20d7dc06">10.2.2   <span class="boldface">
                  <span class="italics">VU Certificate Chain Verification by Card</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_161<span style="word-spacing: NaNpt"> </span>
                  <span>
                     <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">
                        <span class="boldface">►M1</span>
                     </a>
                  </span> Tachograph cards shall use the protocol depicted in Figure 5 for verifying a VU&#39;s certificate chain. For every certificate presented by the VU, the card shall verify that the Certificate Holder Authorisation (CHA) field is correct:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The CHA of the VU.Link certificate shall indicate the ERCA.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The CHA of the VU.CA certificate shall indicate an MSCA.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The CHA field of the VU certificate shall indicate a VU certificate for mutual authentication (see Appendix 1, data type EquipmentType).<span class="boldface"> ◄ </span>
                  </div>
               </div>
            </div>
<p class="title-gr-seq-level-6" id="id-98873ddc-9718-4ef7-b986-f4afc6e1c351">
               <span class="italics">Figure 5</span>
            </p>
<p class="title-gr-seq-level-6" id="id-101db851-810a-4ab6-a585-1d9863839068">
               <span class="boldface">Protocol for VU Certificate Chain Verification by Card</span>
            </p>
<p class="title-gr-seq-level-6" id="id-7935c90b-8f9b-4e9b-8c1e-8cba6d829115">
               <span class="italics">Notes to Figure 5:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The VU certificates and public keys mentioned in the figure are those for mutual authentication. Section 9.1.4 denotes these as VU_MA.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The VU.CA certificates and public keys mentioned in the figure are those for signing VU and external GNSS facility certificates. Section 9.1.3 denotes these as MSCA_VU-EGF.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The VU.CA.EUR certificate mentioned in the figure is the European root certificate that is indicated in the CAR of the VU.CA certificate.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The VU.Link certificate mentioned in the figure is the VU&#39;s link certificate, if present. As specified in section 9.1.2, this is a link certificate for a new European root key pair created by the ERCA and signed by the previous European private key.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The VU.Link.EUR certificate is the European root certificate that is indicated in the CAR of the VU.Link certificate.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_162<span style="word-spacing: NaNpt"> </span>As depicted in Figure 5, verification of the certificate chain of the vehicle unit shall begin with the vehicle unit attempting to set its own public key for use in the tachograph card. If this succeeds, it means that the card successfully verified the VU&#39;s certificate chain in the past, and has stored the VU certificate for future reference. In this case, the VU certificate is set for use and the process continues with VU Authentication. If the card does not know the VU certificate, the VU shall successively present the VU.CA certificate to be used for verifying its VU certificate, the VU.CA.EUR certificate to be used for verifying the VU.CA certificate, and possibly the link certificate, in order to find a certificate known or verifiable by the card. If such a certificate is found, the card shall use that certificate to verify the underlying VU certificates presented to it. If successful, the VU shall finally set its public key for use in the tachograph card. If not successful, the VU shall ignore the card.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-9c3dc538-f80c-49bd-a292-b0b65f930516">
               <span class="italics">Note: There are three ways in which the card may know the VU.CA.EUR certificate:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>the VU.CA.EUR certificate is the same certificate as the card&#39;s own EUR certificate;</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>the VU.CA.EUR certificate precedes the card&#39;s own EUR certificate and the card contained this certificate already at issuance (see CSM_91);</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>the VU.CA.EUR certificate succeeds the card&#39;s own EUR certificate and the card received a link certificate in the past from another vehicle unit, verified it and stored it for future reference.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_163<span style="word-spacing: NaNpt"> </span>The VU shall use the MSE: Set AT command to set its public key for use in the tachograph card. As specified in Appendix 2, this command contains an indication of the cryptographic mechanism that will be used with the key that is set. This mechanism shall be ‘VU Authentication using the ECDSA algorithm, in combination with the hashing algorithm linked to the key size of the VU&#39;s VU_MA key pair, as specified in CSM_50’.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_164<span style="word-spacing: NaNpt"> </span>The MSE: Set AT command also contains an indication of the ephemeral key pair which the VU will use during session key agreement (see section 10.4). Therefore, before sending the MSE: Set AT command, the VU shall generate an ephemeral ECC key pair. For generating the ephemeral key pair, the VU shall use the standardized domain parameters indicated in the card certificate. The ephemeral key pair is denoted as (VU.SK<span class="subscript">eph</span>, VU.PK<span class="subscript">eph</span>, Card.DP). The VU shall take the x-coordinate of the ECDH ephemeral public point as the key identification; this is called the compressed representation of the public key and denoted as Comp(VU.PK<span class="subscript">eph</span>).</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_165<span style="word-spacing: NaNpt"> </span>If the MSE: Set AT command is successful, the card shall set the indicated VU.PK for subsequent use during Vehicle Authentication, and shall temporarily store Comp(VU.PKeph). In case two or more successful MSE: Set AT commands are sent before session key agreement is performed, the card shall store only the last Comp(VU.PKeph) received. The card shall reset Comp(VU.PKeph) after a successful GENERAL AUTHENTICATE command.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_166<span style="word-spacing: NaNpt"> </span>The card shall verify the temporal validity of any certificate presented by the VU or referenced by the VU while stored in the card&#39;s memory, and shall reject expired certificates.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_167<span style="word-spacing: NaNpt"> </span>For verifying the temporal validity of a certificate presented by the VU, each tachograph card shall internally store some data representing the current time. This data shall not be directly updatable by a VU. At issuance, the current time of a card shall be set equal to the Effective Date of the card&#39;s Card_MA certificate. A card shall update its current time if the Effective Date of an authentic ‘valid source of time’ certificate presented by a VU is more recent than the card&#39;s current time. In that case, the card shall set its current time to the Effective Date of that certificate. The card shall accept only the following certificates as a valid source of time:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Second-generation ERCA link certificates</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Second-generation MSCA certificates</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Second-generation VU certificates issued by the same country as the card&#39;s own card certificate(s).</div>
               </div>
            </div>
<p class="norm">
               <span class="italics">Note:</span> the last requirement implies that a card shall be able to recognize the CAR of the VU certificate, i.e. the MSCA_VU-EGF certificate. This will not be the same as the CAR of its own certificate, which is the MSCA_Card certificate.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_168<span style="word-spacing: NaNpt"> </span>As indicated in Figure 5, once the card has verified the authenticity and validity of a previously unknown certificate, it may store this certificate for future reference, such that it does not need to verify that certificate&#39;s authenticity again if it is presented to the card again. Instead xof storing the entire certificate, a card may choose to store only the contents of the Certificate Body, as specified in section 9.3.2.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-84f2d04c-3dd2-40ae-a1e5-2a355e5b31d1">10.3.   <span class="boldface">
                  <span class="boldface">VU Authentication</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_169<span style="word-spacing: NaNpt"> </span>Vehicle units and cards shall use the VU Authentication protocol depicted in Figure 6 to authenticate the VU towards the card. VU Authentication enables the tachograph card to explicitly verify that the VU is authentic. To do so, the VU shall use its private key to sign a challenge generated by the card.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_170<span style="word-spacing: NaNpt"> </span>
                  <span>
                     <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">
                        <span class="boldface">►M1</span>
                     </a>
                  </span> Next to the card challenge, the VU shall include in the signature the certificate holder reference taken from the card certificate.<span class="boldface"> ◄ </span>
               </p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> This ensures that the card to which the VU authenticates itself is the same card whose certificate chain the VU has verified previously.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_171<span style="word-spacing: NaNpt"> </span>The VU shall also include in the signature the identifier of the ephemeral public key Comp(VU.PK<span class="subscript">eph</span>) which the VU will use to set up Secure Messaging during the Chip Authentication process specified in section 10.4.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> This ensures that the VU with which a card communicates during a Secure Messaging session is the same VU that was authenticated by the card.</p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<p class="title-gr-seq-level-5" id="id-1cd77787-8e2e-401a-9a1c-fb7c2548286d">
               <span class="italics">Figure 6</span>
            </p>
<p class="title-gr-seq-level-5" id="id-795ab61a-c1fe-4f9b-ad1e-161a3f339755">
               <span class="boldface">VU Authentication protocol</span>
            </p>
<p class="norm">
               
            </p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_172<span style="word-spacing: NaNpt"> </span>If multiple GET CHALLENGE commands are sent by the VU during VU Authentication, the card shall return a new 8-byte random challenge each time, but shall store only the last challenge.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_173<span style="word-spacing: NaNpt"> </span>The signing algorithm used by the VU for VU Authentication shall be ECDSA as specified in [DSS], using the hashing algorithm linked to the key size of the VU&#39;s VU_MA key pair, as specified in CSM_50. The signature format shall be plain, as specified in [TR-03111]. The VU shall send the resulting signature to the card.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_174<span style="word-spacing: NaNpt"> </span>Upon receiving the VU’s signature in an EXTERNAL AUTHENTICATE command, the card shall</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Calculate the authentication token by concatenating Card.CHR, the card challenge rcard and the identifier of the VU ephemeral public key Comp(VU.PKeph),</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Verify the VU’s signature using the ECDSA algorithm, using the hashing algorithm linked to the key size of the VU’s VU_MA key pair as specified in CSM_50, in combination with VU.PK and the calculated authentication token.</div>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<p class="title-gr-seq-level-4" id="id-c5e7aa1f-c7a8-4c3e-84a0-6f60adc13cdd">10.4.   <span class="boldface">
                  <span class="boldface">Chip Authentication and Session Key Agreement</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_175<span style="word-spacing: NaNpt"> </span>Vehicle units and cards shall use the Chip Authentication protocol depicted in <span class="boldface">Figure 7</span> to authenticate the card towards the VU. Chip Authentication enables the vehicle unit to explicitly verify that the card is authentic.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-46be36e7-006d-44fe-8fa0-a13df01159b6">
               <span class="italics">Figure 7</span>
            </p>
<p class="title-gr-seq-level-5" id="id-0a53a49e-5acb-4a34-a865-3d82ad8ff0d9">
               <span class="boldface">Chip Authentication and session key agreement</span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_176<span style="word-spacing: NaNpt"> </span>The VU and the card shall take the following steps:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>1. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The vehicle unit initiates the Chip Authentication process by sending the MSE: Set AT command indicating ‘Chip Authentication using the ECDH algorithm resulting in an AES session key length linked to the key size of the card&#39;s Card_MA key pair, as specified in CSM_50’. The VU shall determine the key size of the card&#39;s key pair from the card certificate.</p>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>2. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The VU sends the public point VU.PK<span class="subscript">eph</span> of its ephemeral key pair to the card. The public point shall be converted to an octet string as specified in [TR-03111]. The uncompressed encoding format shall be used. As explained in CSM_164, the VU generated this ephemeral key pair prior to the verification of the VU certificate chain. The VU sent the identifier of the ephemeral public key Comp(VU.PK<span class="subscript">eph</span>) to the card, and the card stored it.</p>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>3. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The card computes Comp(VU.PK<span class="subscript">eph</span>) from VU.PK<span class="subscript">eph</span> and compares this to the stored value of Comp(VU.PK<span class="subscript">eph</span>).</p>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>4. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">Using the ECDH algorithm in combination with the card&#39;s static private key and the VU&#39;s ephemeral public key, the card computes a secret K.</p>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>5. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The card chooses a random 8-byte nonce N<span class="subscript">PICC</span> and uses it to derive two AES session keys K<span class="subscript">MAC</span> and K<span class="subscript">ENC</span> from K. See CSM_179.</p>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>6. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">Using K<span class="subscript">MAC</span>, the card computes an authentication token over the VU ephemeral public point: T<span class="subscript">PICC</span> = CMAC(K<span class="subscript">MAC</span>, VU.PK<span class="subscript">eph</span>). The public point shall be in the format used by the VU (see bullet 2 above). The card sends N<span class="subscript">PICC</span> and T<span class="subscript">PICC</span> to the vehicle unit.</p>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>7. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">Using the ECDH algorithm in combination with the card&#39;s static public key and the VU&#39;s ephemeral private key, the VU computes the same secret K as the card did in step 4.</p>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>8. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The VU derives session keys K<span class="subscript">MAC</span> and K<span class="subscript">ENC</span> from K and N<span class="subscript">PICC</span>; see CSM_179.</p>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>9. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The VU verifies the authentication token T<span class="subscript">PICC</span>.</p>
               </div>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_177<span style="word-spacing: NaNpt"> </span>In step 3 above, the card shall compute Comp(VU.PKeph) as the x-coordinate of the public point in VU.PKeph.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_178<span style="word-spacing: NaNpt"> </span>In steps 4 and 7 above, the card and the vehicle unit shall use the ECKA-EG algorithm as defined in [TR-03111].</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_179<span style="word-spacing: NaNpt"> </span>In steps 5 and 8 above, the card and the vehicle unit shall use the key derivation function for AES session keys defined in [TR-03111], with the following precisions and changes:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The value of the counter shall be ‘00 00 00 01’ for K<span class="subscript">ENC</span> and ‘00 00 00 02’ for K<span class="subscript">MAC.</span>
                  </div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The optional nonce <span class="italics">r</span> shall be used and shall be equal to N<span class="subscript">PICC.</span>
                  </div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">For deriving 128-bits AES keys, the hashing algorithm to be used shall be SHA-256.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">For deriving 192-bits AES keys, the hashing algorithm to be used shall be SHA-384.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">For deriving 256-bits AES keys, the hashing algorithm to be used shall be SHA-512.</div>
               </div>
            </div>
<p class="list">The length of the session keys (i.e. the length at which the hash is truncated) shall be linked to the size of the Card_MA key pair, as specified in CSM_50.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_180<span style="word-spacing: NaNpt"> </span>In steps 6 and 9 above, the card and the vehicle unit shall use the AES algorithm in CMAC mode, as specified in [SP 800-38B]. The length of T<span class="subscript">PICC</span> shall be linked to the length of the AES session keys, as specified in CSM_50.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-19681d5a-ca45-4a93-9c99-3d13cfcf53be">10.5.   <span class="boldface">
                  <span class="boldface">Secure Messaging</span>
               </span>
            </p>
<p class="title-gr-seq-level-5" id="id-5855151f-b38f-416a-9f46-3913eea64c02">10.5.1   <span class="boldface">
                  <span class="italics">General</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_181<span style="word-spacing: NaNpt"> </span>All commands and responses exchanged between a vehicle unit and a tachograph card after successful Chip Authentication took place and until the end of the session shall be protected by Secure Messaging.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_182<span style="word-spacing: NaNpt"> </span>Except when reading from a file with access condition SM-R-ENC-MAC-G2 (see Appendix 2, section 4), Secure Messaging shall be used in authentication-only mode. In this mode, a cryptographic checksum (a.k.a. MAC) is added to all commands and responses to ensure message authenticity and integrity.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_183<span style="word-spacing: NaNpt"> </span>When reading data from a file with access condition SM-R-ENC-MAC-G2, Secure Messaging shall be used in encrypt-then-authenticate mode, i.e. the response data is encrypted first to ensure message confidentiality, and afterwards a MAC over the formatted encrypted data is calculated to ensure authenticity and integrity.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_184<span style="word-spacing: NaNpt"> </span>Secure Messaging shall use AES as defined in [AES] with the session keys K<span class="subscript">MAC</span> and K<span class="subscript">ENC</span> that were agreed during Chip Authentication.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_185<span style="word-spacing: NaNpt"> </span>An unsigned integer shall be used as the Send Sequence Counter (SSC) to prevent replay attacks. The size of the SSC shall be equal to the AES block size, i.e. 128 bits. The SSC shall be in MSB-first format. The Send Sequence Counter shall be initialized to zero (i.e. ‘00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00’) when Secure Messaging is started. The SSC shall be increased every time before a command or response APDU is generated, i.e. since the starting value of the SSC in a SM session is 0, in the first command the value of the SSC will be 1. The value of SSC for the first response will be 2.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_186<span style="word-spacing: NaNpt"> </span>For message encryption, K<span class="subscript">ENC</span> shall be used with AES in the Cipher Block Chaining (CBC) mode of operation, as defined in [ISO 10116], with an interleave parameter <span class="italics">m</span> = 1 and an initialization vector SV = E(K<span class="subscript">ENC</span>, SSC), i.e. the current value of the Send Sequence Counter encrypted with K<span class="subscript">ENC</span>.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_187<span style="word-spacing: NaNpt"> </span>For message authentication, K<span class="subscript">MAC</span> shall be used with AES in CMAC mode as specified in [SP 800-38B]. The length of the MAC shall be linked to the length of the AES session keys, as specified in CSM_50. The Send Sequence Counter shall be included in the MAC by prepending it before the datagram to be authenticated.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-03bf84c2-c5d7-4e55-816d-185ae9fded43">10.5.2   <span class="boldface">
                  <span class="italics">Secure Message Structure</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_188<span style="word-spacing: NaNpt"> </span>Secure Messaging shall make use only of the Secure Messaging data objects (see [ISO 7816-4]) listed in Table 5. In any message, these data objects shall be used in the order specified in this table.</p>
            </div>
<p>
               <br/>
            </p>
<div class="centered">
               <p>
                  <br/>
               </p>
               <p class="title-table" id="id-d327b72d-d937-4605-9cea-8eef5498d941">
                  <span class="italics">Table 5</span>
               </p>
               <p class="title-table" id="id-7329f322-3f8c-4da4-a066-afb8128e98c3">
                  <span class="boldface">Secure Messaging Data Objects</span>
               </p>
               <table width="240" border="1" cellpadding="2" cellspacing="0">
                  <colgroup><col width="71%"/>
                  <col width="15%"/>
                  <col width="7%"/>
                  <col width="8%"/>
                  </colgroup><tbody>
                     <tr>
                        <td rowspan="2" valign="top" style="font-weight: bold">
                           <p class="tbl-norm">Data Object Name</p>
                        </td>
                        <td rowspan="2" valign="top" style="font-weight: bold">
                           <p class="tbl-norm">Tag</p>
                        </td>
                        <td colspan="2" style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Presence (M)andatory, (C)onditional or (F)orbidden in</p>
                        </td>
                     </tr>
                     <tr>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Commands</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">Responses</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Plain value not encoded in BER-TLV</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘81’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">C</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">C</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Plain value encoded in BER-TLV, but not including SM DOs</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘B3’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">C</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">C</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Padding-content indicator followed by cryptogram, plain value not encoded in BER-TLV</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘87’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">C</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">C</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Protected Le</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘97’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">C</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">F</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Processing Status</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘99’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">F</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">M</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">Cryptographic Checksum</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">‘8E’</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">M</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">M</p>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </div>
<p class="norm">
               <span class="italics">Note:</span> As specified in Appendix 2, tachograph cards may support the READ BINARY and UPDATE BINARY command with an odd INS byte (‘B1’ resp. ‘D7’). These command variants are required to read and update files with more than 32 768  bytes or more. In case such a variant is used, a data object with tag ‘B3’ shall be used instead of an object with tag ‘81’. See Appendix 2 for more information.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_189<span style="word-spacing: NaNpt"> </span>All SM data objects shall be encoded in DER TLV as specified in [ISO 8825-1]. This encoding results in a Tag-Length-Value (TLV) structure as follows:</p>
            </div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Tag</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">The tag is encoded in one or two octets and indicates the content.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Length</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">The length is encoded as an unsigned integer in one, two, or three octets, resulting in a maximum length of 65 535  octets. The minimum number of octets shall be used.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Value</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">The value is encoded in zero or more octets</p>
                  </td>
               </tr>
            </tbody></table>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_190<span style="word-spacing: NaNpt"> </span>APDUs protected by Secure Messaging shall be created as follows:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The command header shall be included in the MAC calculation, therefore value ‘0C’shall be used for the class byte CLA.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">As specified in Appendix 2, all INS bytes shall be even, with the possible exception of odd INS bytes for the READ BINARY and UPDATE BINARY commands.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The actual value of Lc will be modified to Lc&#39; after application of secure messaging.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The Data field shall consist of SM data objects.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">In the protected command APDU the new Le byte shall be set to ‘00’. If required, a data object ‘97’ shall be included in the Data field in order to convey the original value of Le.</div>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_191<span style="word-spacing: NaNpt"> </span>Any data object to be encrypted shall be padded according to [ISO 7816-4] using padding-content indicator ‘01’. For the calculation of the MAC, data objects in the APDU shall be padded according to [ISO 7816-4].</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> Padding for Secure Messaging is always performed by the secure messaging layer, not by the CMAC or CBC algorithms.</p>
<p class="title-gr-seq-level-6" id="id-e3fcd8db-c6af-4114-91ac-cd1aafcdc7eb">
               <span class="italics">Summary and Examples</span>
            </p>
<p class="norm">A command APDU with applied Secure Messaging will have the following structure, depending on the case of the respective unsecured command (DO is data object):</p>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Case 1</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">CLA INS P1 P2 || Lc&#39; || DO ‘8E’ || Le</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Case 2</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">CLA INS P1 P2 || Lc&#39; || DO ‘97’ || DO‘8E’ || Le</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Case 3 (even INS byte)</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">CLA INS P1 P2 || Lc&#39; || DO ‘81’ || DO‘8E’ || Le</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Case 3 (odd INS byte)</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">CLA INS P1 P2 || Lc&#39; || DO ‘B3’ || DO‘8E’ || Le</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Case 4 (even INS byte)</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">CLA INS P1 P2 || Lc&#39; || DO ‘81’ || DO‘97’ || DO‘8E’ || Le</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Case 4 (odd INS byte)</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">CLA INS P1 P2 || Lc&#39; || DO ‘B3’ || DO‘97’ || DO‘8E’ || Le</p>
                  </td>
               </tr>
            </tbody></table>
<p class="norm">where Le = ‘00’ or ‘00 00’ depending on whether short length fields or extended length fields are used; see [ISO 7816-4].</p>
<p class="norm">A response APDU with applied Secure Messaging will have the following structure, depending on the case of the respective unsecured response:</p>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Case 1 or 3</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">DO ‘99’ || DO ‘8E’ || SW1SW2</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Case 2 or 4 (even INS byte) without encryption</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">DO ‘81’ || DO ‘99’ || DO ‘8E’ || SW1SW2</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Case 2 or 4 (even INS byte) with encryption</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">DO ‘87’ || DO ‘99’ || DO ‘8E’ || SW1SW2</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="5%"/>
               <col width="85%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="norm">Case 2 or 4 (odd INS byte) without encryption</p>
                  </td>
                  <td valign="top">
                     <p class="norm">:</p>
                  </td>
                  <td valign="top">
                     <p class="norm">DO ‘B3’ || DO ‘99’ || DO ‘8E’ || SW1SW2</p>
                  </td>
               </tr>
            </tbody></table>
<p class="norm">
               <span class="italics">Note:</span> Case 2 or 4 (odd INS byte) with encryption is never used in the communication between a VU and a card.</p>
<p class="norm">Below are three example APDU transformations for commands with even INS code. Figure 8 shows an authenticated Case 4 command APDU, Figure 9 shows an authenticated Case 1/Case 3 response APDU, and Figure 10 shows an encrypted and authenticated Case 2/Case 4 response APDU.</p>
<p class="title-gr-seq-level-7" id="id-5c630b1a-82fd-45fe-aee6-e40caa881812">
               <span class="italics">Figure 8</span>
            </p>
<p class="title-gr-seq-level-7" id="id-48e03b4d-a078-47f5-aec1-844572509196">
               <span class="boldface">Transformation of an authenticated Case 4 Command APDU</span>
            </p>
<p class="title-gr-seq-level-7" id="id-db7498ab-f5b0-4b46-b07b-d6cd00820fbf">
               <span class="italics">Figure 9</span>
            </p>
<p class="title-gr-seq-level-7" id="id-112e3a01-5b66-4dd0-8b9c-565a33db2886">
               <span class="boldface">Transformation of an authenticated Case 1 / Case 3 Response APDU</span>
            </p>
<p class="title-gr-seq-level-7" id="id-b09221c0-c2de-4c48-89f6-27bf62c0e1f2">
               <span class="italics">Figure 10</span>
            </p>
<p class="title-gr-seq-level-7" id="id-f55b121a-37dc-4bd5-9a5b-981b78b1400d">
               <span class="boldface">Transformation of an encrypted and authenticated Case 2/Case 4 Response APDU</span>
            </p>
<p class="norm">
               
            </p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<p class="title-gr-seq-level-5" id="id-7f50d9fc-3d72-499e-bfd2-0f0815372464">10.5.3   <span class="boldface">
                  <span class="italics">Secure Messaging Session Abortion</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_192<span style="word-spacing: NaNpt"> </span>A vehicle unit shall abort an ongoing Secure Messaging session if and only if one of the following conditions occur:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">it receives a plain response APDU,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">it detects a Secure Messaging error in a response APDU:</div>
                  <div class="list">
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">An expected Secure Messaging data object is missing, the order of data objects is incorrect, or an unknown data object is included.</div>
                        </div>
                     </div>
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">A Secure Messaging data object is incorrect, e.g. the MAC value is incorrect, the TLV structure is incorrect or the padding indicator in tag ‘87’ is not equal to ‘01’.</div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">the card sends a status byte indicating it detected an SM error (see CSM_194),</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">the limit for the number of commands and associated responses within the current session is reached. For a given VU, this limit shall be defined by its manufacturer, taking into account the security requirements of the hardware used, with a maximum value of 240 SM commands and associated responses per session.</div>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_193<span style="word-spacing: NaNpt"> </span>A tachograph card shall abort an ongoing Secure Messaging session if and only if one of the following conditions occur:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">it receives a plain command APDU,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">it detects a Secure Messaging error in a command APDU:</div>
                  <div class="list">
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">An expected Secure Messaging data object is missing, the order of data objects is incorrect, or an unknown data object is included.</div>
                        </div>
                     </div>
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">A Secure Messaging data object is incorrect, e.g. the MAC value is incorrect or the TLV structure is incorrect.</div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">it is depowered or reset,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">the VU starts the VU Authentication process,</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">the limit for the number of commands and associated responses within the current session is reached. For a given card, this limit shall be defined by its manufacturer, taking into account the security requirements of the hardware used, with a maximum value of 240 SM commands and associated responses per session.</div>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_194<span style="word-spacing: NaNpt"> </span>Regarding SM error handling by a tachograph card:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">If in a command APDU some expected Secure Messaging data objects are missing, the order of data objects is incorrect or unknown data objects are included, a tachograph card shall respond with status bytes ‘69 87’.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">If a Secure Messaging data object in a command APDU is incorrect, a tachograph card shall respond with status bytes ‘69 88’.</div>
               </div>
            </div>
<p class="list">In such a case, the status bytes shall be returned without using SM.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_195<span style="word-spacing: NaNpt"> </span>If a Secure Messaging session between a VU and a tachograph card is aborted, the VU and the tachograph card shall</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">securely destroy the stored session keys</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">immediately establish a new Secure Messaging session, as described in sections 10.2 — 10.5.</div>
               </div>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_196<span style="word-spacing: NaNpt"> </span>If for any reason the VU decides to restart mutual authentication towards an inserted card, the process shall restart with verification of the card certificate chain, as described in section 10.2, and shall continue as described in sections 10.2 — 10.5.</p>
            </div>
<p class="title-gr-seq-level-3" id="id-049bddce-587e-4903-ae74-97c68d31fcc6">11.   <span class="boldface">VU — EXTERNAL GNSS FACILITY COUPLING, MUTUAL AUTHENTICATION AND SECURE MESSAGING</span>
            </p>
<p class="title-gr-seq-level-4" id="id-dd60d445-ed9e-4fc1-b6f2-6beabb95a1c1">11.1.   <span class="boldface">
                  <span class="boldface">General</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_197<span style="word-spacing: NaNpt"> </span>The GNSS facility used by a VU to determine its position may be internal, (i.e. built into the VU casing and not detachable), or it may be an external module. In the first case, there is no need to standardize the internal communication between the GNSS facility and the VU, and the requirements in this chapter do not apply. In the latter case, communication between the VU and the external GNSS facility shall be standardized and protected as described in this chapter.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_198<span style="word-spacing: NaNpt"> </span>Secure communication between a vehicle unit and an external GNSS facility shall take place in the same way as secure communication between a vehicle unit and a tachograph card, with the external GNSS facility (EGF) taking the role of the card. All requirements mentioned in chapter 10 for tachograph cards shall be satisfied by an EGF, taking into account the deviations, clarifications and additions mentioned in this chapter. In particular, mutual certificate chain verification, VU Authentication and Chip Authentication shall be performed as described in sections 11.3 and 11.4.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_199<span style="word-spacing: NaNpt"> </span>Communication between a vehicle unit and an EGF differs from communication between a vehicle unit and a card in the fact that a vehicle unit and an EGF must be coupled once in a workshop before the VU and the EGF can exchange GNSS-based data during normal operation. The coupling process is described in section 11.2.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_200<span style="word-spacing: NaNpt"> </span>For communication between a vehicle unit and an EGF, APDU commands and responses based on [ISO 7816-4] and [ISO 7816-8] shall be used. The exact structure of these APDUs is defined in Appendix 2 of this Annex.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-5faba3fd-7ceb-4d68-a3aa-1633041cff97">11.2.   <span class="boldface">
                  <span class="boldface">VU and External GNSS Facility Coupling</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_201<span style="word-spacing: NaNpt"> </span>A vehicle unit and an EGF in a vehicle shall be coupled by a workshop. Only a coupled vehicle unit and EGF shall be able to communicate during normal operation.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_202<span style="word-spacing: NaNpt"> </span>Coupling of a vehicle unit and an EGF shall only be possible if the vehicle unit is in calibration mode. The coupling shall be initiated by the vehicle unit.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_203<span style="word-spacing: NaNpt"> </span>A workshop may re-couple a vehicle unit to another EGF or to the same EGF at any time. During re-coupling, the VU shall securely destroy the existing EGF_MA certificate in its memory and shall store the EGF_MA certificate of the EGF to which it is being coupled.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_204<span style="word-spacing: NaNpt"> </span>A workshop may re-couple an external GNSS facility to another VU or to the same VU at any time. During re-coupling, the EGF shall securely destroy the existing VU_MA certificate in its memory and shall store the VU_MA certificate of the VU to which it is being coupled.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-030dc373-fbce-457b-814b-dcb52432d3b2">11.3.   <span class="boldface">
                  <span class="boldface">Mutual Certificate Chain Verification</span>
               </span>
            </p>
<p class="title-gr-seq-level-5" id="id-9bab5b01-1ffc-46ea-9618-c09e6aff4b10">11.3.1   <span class="boldface">
                  <span class="italics">General</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_205<span style="word-spacing: NaNpt"> </span>Mutual certificate chain verification between a VU and an EGF shall take place only during the coupling of the VU and the EGF by a workshop. During normal operation of a coupled VU and EGF, no certificates shall be verified. Instead, the VU and EGF shall trust the certificates they stored during the coupling, after checking the temporal validity of these certificates. The VU and the EGF shall not trust any other certificates for protecting the VU — EGF communication during normal operation.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-b0c7035b-a612-4d95-8e92-c8e0e535afe1">11.3.2   <span class="boldface">
                  <span class="italics">During VU — EGF Coupling</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_206<span style="word-spacing: NaNpt"> </span>During the coupling to an EGF, a vehicle unit shall use the protocol depicted in Figure 4 (section 10.2.1) for verifying the external GNSS facility&#39;s certificate chain.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-1618c40c-aea9-42b6-af2a-588f2cdbe37f">
               <span class="italics">Notes to Figure 4 within this context:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>Communication control is out of the scope of this Appendix. However, an EGF is not a smart card and hence the VU will probably not send a Reset to initiate the communication and will not receive an ATR.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The Card certificates and public keys mentioned in the figure shall be interpreted as the EGF&#39;s certificates and public keys for mutual authentication. Section 9.1.6 denotes these as EGF_MA.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The Card.CA certificates and public keys mentioned in the figure shall be interpreted as the MSCA&#39;s certificates and public keys for signing EGF certificates. Section 9.1.3 denotes these as MSCA_VU-EGF.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The Card.CA.EUR certificate mentioned in the figure shall be interpreted as the European root certificate that is indicated in the CAR of the MSCA_VU-EGF certificate.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The Card.Link certificate mentioned in the figure shall be interpreted as the EGF&#39;s link certificate, if present. As specified in section 9.1.2, this is a link certificate for a new European root key pair created by the ERCA and signed by the previous European private key.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The Card.Link.EUR certificate is the European root certificate that is indicated in the CAR of the Card.Link certificate.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>Instead of the , the VU shall read the  from EF ICC.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>Instead of selecting the Tachograph AID, the VU shall select the EGF AID.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>‘Ignore Card’ shall be interpreted as ‘Ignore EGF’.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_207<span style="word-spacing: NaNpt"> </span>Once it has verified the EGF_MA certificate, the vehicle unit shall store this certificate for use during normal operation; see section 11.3.3.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_208<span style="word-spacing: NaNpt"> </span>
                  <span>
                     <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">
                        <span class="boldface">►M1</span>
                     </a>
                  </span> During the coupling to a VU, an external GNSS facility shall use the protocol depicted in Figure 5 (section 10.2.2) for verifying the VU&#39;s certificate chain.<span class="boldface"> ◄ </span>
               </p>
            </div>
<p class="title-gr-seq-level-5" id="id-dff03d47-f193-4e82-a8ed-120b3eea9c55">
               <span class="italics">Notes to Figure 5 within this context:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The VU shall generate a fresh ephemeral key pair using the domain parameters in the EGF certificate.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The VU certificates and public keys mentioned in the figure are those for mutual authentication. Section 9.1.4 denotes these as VU_MA.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The VU.CA certificates and public keys mentioned in the figure are those for signing VU and external GNSS facility certificates. Section 9.1.3 denotes these as MSCA_VU-EGF.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The VU.CA.EUR certificate mentioned in the figure is the European root certificate that is indicated in the CAR of the VU.CA certificate.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The VU.Link certificate mentioned in the figure is the VU&#39;s link certificate, if present. As specified in section 9.1.2, this is a link certificate for a new European root key pair created by the ERCA and signed by the previous European private key.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The VU.Link.EUR certificate is the European root certificate that is indicated in the CAR of the VU.Link certificate.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_209<span style="word-spacing: NaNpt"> </span>In deviation from requirement CSM_167, an EGF shall use the GNSS time to verify the temporal validity of any certificate presented.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_210<span style="word-spacing: NaNpt"> </span>Once it has verified the VU_MA certificate, the external GNSS facility shall store this certificate for use during normal operation; see section 11.3.3.</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<p class="title-gr-seq-level-5" id="id-87acc07d-f66e-4e46-a6da-7c0d97aee79d">11.3.3   <span class="boldface">
                  <span class="italics">During Normal Operation</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_211<span style="word-spacing: NaNpt"> </span>
                  <span>
                     <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">
                        <span class="boldface">►M1</span>
                     </a>
                  </span> During normal operation, a vehicle unit and an EGF shall use the protocol depicted in Figure 11 for verifying the temporal validity of the stored EGF_MA certificate and for setting the VU_MA public key for subsequent VU Authentication. No further mutual verification of the certificate chains shall take place during normal operation.<span class="boldface"> ◄ </span>
               </p>
            </div>
<p class="norm">Note that Figure 11 in essence consists of the first steps shown in Figure 4 and Figure 5. Again, note that since an EGF is not a smart card, the VU will probably not send a Reset to initiate the communication and will not receive an ATR. In any case this is out of the scope of this Appendix.</p>
<p class="title-gr-seq-level-6" id="id-0a9c8b7d-5dc1-4d24-b613-df0bbfdc8d35">
               <span class="italics">Figure 11</span>
            </p>
<p class="title-gr-seq-level-6" id="id-7deb4731-02c5-421e-8710-3cdd4078e350">
               <span class="boldface">Mutual verification of certificate temporal validity during normal VU — EGF operation</span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_212<span style="word-spacing: NaNpt"> </span>As shown in Figure 11, the vehicle unit shall log an error if the EGF_MA certificate is no longer valid. However, mutual authentication, key agreement and subsequent communication via secure messaging shall proceed normally.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-e7fdd54c-6ad3-49cd-a2e6-5dd8cf8db109">11.4.   <span class="boldface">
                  <span class="boldface">VU Authentication, Chip Authentication and Session Key Agreement</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_213<span style="word-spacing: NaNpt"> </span>VU Authentication, Chip Authentication and session key agreement between a VU and an EGF shall take place during coupling and whenever a Secure Messaging session is re-established during normal operation. The VU and the EGF shall carry out the processes described in sections 10.3 and 10.4. All requirements in these sections shall apply.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-c7eb80cc-9c3e-4297-b5ea-459a2bb8123c">11.5.   <span class="boldface">
                  <span class="boldface">Secure Messaging</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_214<span style="word-spacing: NaNpt"> </span>All commands and responses exchanged between a vehicle unit and an external GNSS facility after successful Chip Authentication took place and until the end of the session shall be protected by Secure Messaging.in authentication-only mode. All requirements in section 10.5 shall apply.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_215<span style="word-spacing: NaNpt"> </span>If a Secure Messaging session between a VU and an EGF is aborted, the VU shall immediately establish a new Secure Messaging session, as described in section 11.3.3 and 11.4.</p>
            </div>
<p class="title-gr-seq-level-3" id="id-6c4994e3-8ba1-4e9b-b5ac-901cca3a9870">12.   <span class="boldface">VU — MOTION SENSOR PAIRING AND COMMUNICATION</span>
            </p>
<p class="title-gr-seq-level-4" id="id-744cb6c5-fe6b-4259-865a-ba556ae22a26">12.1.   <span class="boldface">
                  <span class="boldface">General</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_216<span style="word-spacing: NaNpt"> </span>A vehicle unit and a motion sensor shall communicate using the interface protocol specified in [ISO 16844-3] during pairing and in normal operation, with the changes described in this chapter and in section 9.2.1.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> readers of this chapter are supposed to be familiar with the contents of [ISO 16844-3].</p>
<p class="title-gr-seq-level-4" id="id-0b948989-b6ff-4d99-8d4d-728ecf2d0183">12.2.   <span class="boldface">
                  <span class="boldface">VU — Motion Sensor Pairing Using Different Key Generations</span>
               </span>
            </p>
<p class="norm">As explained in section 9.2.1, the motion sensor master key and all associated keys are regularly replaced. This leads to the presence of up to three motion sensor-related AES keys K<span class="subscript">M-WC</span> (of consecutive key generations) in workshop cards. Similarly, in motion sensors up to three different AES-based encryptions of data (based on consecutive generations of the motion sensor master key K<span class="subscript">M</span>) may be present. A vehicle unit contains only one motion sensor-related key K<span class="subscript">M-VU.</span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_217<span style="word-spacing: NaNpt"> </span>A second-generation VU and a second-generation motion sensor shall be paired as follows (compare Table 6 in [ISO 16844-3]):</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>1. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">A second-generation workshop card is inserted into the VU and the VU is connected to the motion sensor.</p>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>2. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The VU reads all available K<span class="subscript">M-WC</span> keys from the workshop card, inspects their key version numbers and chooses the one matching the version number of the VU&#39;s K<span class="subscript">M-VU</span> key. If the matching K<span class="subscript">M-WC</span> key is not present on the workshop card, the VU aborts the pairing process and shows an appropriate error message to the workshop card holder.</p>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>3. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The VU calculates the motion sensor master key K<span class="subscript">M</span> from K<span class="subscript">M-VU</span> and K<span class="subscript">M-WC,</span> and the identification key K<span class="subscript">ID</span> from K<span class="subscript">M</span>, as specified in section 9.2.1.</p>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>4. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The VU sends the instruction to initiate the pairing process towards the motion sensor, as described in [ISO 16844-3], and encrypts the serial number it receives from the motion sensor with the identification key K<span class="subscript">ID.</span> The VU sends the encrypted serial number back to the motion sensor.</p>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>5. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The motion sensor matches the encrypted serial number consecutively with each of the encryptions of the serial number it holds internally. If it finds a match, the VU is authenticated. The motion sensor notes the generation of K<span class="subscript">ID</span> used by the VU and returns the matching encrypted version of its pairing key; i.e. the encryption that was created using the same generation of K<span class="subscript">M</span>.</p>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>6. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The VU decrypts the pairing key using K<span class="subscript">M</span>, generates a session key K<span class="subscript">S,</span> encrypts it with the pairing key and sends the result to the motion sensor. The motion sensor decrypts K<span class="subscript">S</span>.</p>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>7. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The VU assembles the pairing information as defined in [ISO 16844-3], encrypts the information with the pairing key, and sends the result to the motion sensor. The motion sensor decrypts the pairing information.</p>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>8. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The motion sensor encrypts the received pairing information with the received K<span class="subscript">S</span> and returns this to the VU. The VU verifies that the pairing information is the same information which the VU sent to the motion sensor in the previous step. If it is, this proves that the motion sensor used the same K<span class="subscript">S</span> as the VU and hence in step 5 sent its pairing key encrypted with the correct generation of K<span class="subscript">M</span>. Hence, the motion sensor is authenticated.</p>
               </div>
            </div>
<p class="norm">Note that steps 2 and 5 are different from the standard process in [ISO 16844-3]; the other steps are standard.</p>
<p class="list">
               <span class="italics">Example:</span> Suppose a pairing takes place in the first year of the validity of the ERCA (3) certificate; see Figure 2 in section 9.2.1.2. Moreover</p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Suppose the motion sensor was issued in the last year of the validity of the ERCA (1) certificate. It will therefore contain the following keys and data:</div>
                  <div class="list">
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">N<span class="subscript">s</span>[1]: its serial number encrypted with generation 1 of K<span class="subscript">ID</span>,</div>
                        </div>
                     </div>
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">N<span class="subscript">s</span>[2]: its serial number encrypted with generation 2 of K<span class="subscript">ID</span>,</div>
                        </div>
                     </div>
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">N<span class="subscript">s</span>[3]: its serial number encrypted with generation 3 of K<span class="subscript">ID</span>,</div>
                        </div>
                     </div>
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">K<span class="subscript">P</span>[1]: its generation-1 pairing key (<a href="#E0019" id="src.E0019">
                                 <span class="superscript">12</span>
                              </a>), encrypted with generation 1 of K<span class="subscript">M</span>,</div>
                        </div>
                     </div>
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">K<span class="subscript">P</span>[2]: its generation-2 pairing key, encrypted with generation 2 of K<span class="subscript">M</span>,</div>
                        </div>
                     </div>
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">K<span class="subscript">P</span>[3]: its generation-3 pairing key, encrypted with generation 3 of K<span class="subscript">M</span>,</div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Suppose that the workshop card was issued in the first year of the validity of the ERCA (3) certificate. It will therefore contain the generation 2 and generation 3 of the K<span class="subscript">M-WC</span> key.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Suppose the VU is a generation-2 VU, containing the generation 2 of K<span class="subscript">M-VU.</span>
                  </div>
               </div>
            </div>
<p class="list">In this case, the following will happen in steps 2 — 5:</p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Step 2: The VU reads generation 2 and generation 3 of K<span class="subscript">M-WC</span> from the workshop card and inspects their version numbers.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Step 3: The VU combines the generation-2 K<span class="subscript">M-WC</span> with its K<span class="subscript">M-VU</span> to compute K<span class="subscript">M</span> and K<span class="subscript">ID.</span>
                  </div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Step 4: The VU encrypts the serial number it receives from the motion sensor with K<span class="subscript">ID.</span>
                  </div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Step 5: The motion sensor compares the received data with N<span class="subscript">s</span>[1] and doesn&#39;t find a match. Next, it compares the data with N<span class="subscript">s</span>[2] and finds a match. It concludes that the VU is a generation-2 VU, and therefore sends back K<span class="subscript">P</span>[2].</div>
               </div>
            </div>
<p class="title-gr-seq-level-4" id="id-c37227b5-0ce3-480e-9ad2-9a8d2acbc188">12.3.   <span class="boldface">
                  <span class="boldface">VU — Motion Sensor Pairing and Communication using AES</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_218<span style="word-spacing: NaNpt"> </span>As specified in Table 3 in section 9.2.1, all keys involved in the pairing of a (second-generation) vehicle unit and a motion sensor and in subsequent communication shall be AES keys, rather than double-length TDES keys as specified in [ISO 16844-3]. These AES keys may have a length of 128, 192 or 256 bits. Since the AES block size is 16 bytes, the length of an encrypted message must be a multiple of 16 bytes, compared to 8 bytes for TDES. Moreover, some of these messages will be used to transport AES keys, the length of which may be 128, 192 or 256 bits. Therefore, the number of data bytes per instruction in Table 5 of [ISO 16844-3] shall be changed as shown in Table 6:</p>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<p>
               <br/>
            </p>
<div class="centered">
               <p>
                  <br/>
               </p>
               <p class="title-table" id="id-6fbebb3f-0244-46d6-a018-e8636884dd70">
                  <span class="italics">Table 6</span>
               </p>
               <p class="title-table" id="id-0bf29365-54f5-4c0b-ae77-afe35b73508b">
                  <span class="boldface">Number of plaintext and encrypted data bytes per instruction defined in [ISO 16844-3]</span>
               </p>
               <table width="240" border="1" cellpadding="2" cellspacing="0">
                  <colgroup><col width="14%"/>
                  <col width="9%"/>
                  <col width="45%"/>
                  <col width="3%"/>
                  <col width="3%"/>
                  <col width="9%"/>
                  <col width="9%"/>
                  <col width="9%"/>
                  </colgroup><tbody>
                     <tr>
                        <td rowspan="2" valign="top" style="font-weight: bold">
                           <p class="tbl-norm">Instruction</p>
                        </td>
                        <td rowspan="2" valign="top" style="font-weight: bold">
                           <p class="tbl-norm">Request / reply</p>
                        </td>
                        <td rowspan="2" valign="top" style="font-weight: bold">
                           <p class="tbl-norm">Description of data</p>
                        </td>
                        <td rowspan="2" valign="top" style="font-weight: bold">
                           <p class="hd-column"># of plaintext data bytes according to</p>
                           <p class="hd-column">[ISO 16844-3]</p>
                        </td>
                        <td rowspan="2" valign="top" style="font-weight: bold">
                           <p class="tbl-norm"># of plaintext data bytes using AES keys</p>
                        </td>
                        <td colspan="3" style="font-weight: bold" valign="top">
                           <p class="tbl-norm"># of encrypted data bytes when using AES keys of bitlength</p>
                        </td>
                     </tr>
                     <tr>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">128</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">192</p>
                        </td>
                        <td style="font-weight: bold" valign="top">
                           <p class="tbl-norm">256</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">10</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">request</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Authentication data + file number</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">8</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">8</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">11</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">reply</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Authentication data + file contents</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16 or 32, depend on file</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16 or32, depend on file</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">32 / 48</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">32 / 48</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">32 / 48</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">41</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">request</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">MoS serial number</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">8</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">8</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">41</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">reply</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Pairing key</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16 / 24 / 32</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">32</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">32</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">42</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">request</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Session key</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16 / 24 / 32</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">32</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">32</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">43</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">request</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Pairing information</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">24</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">24</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">32</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">32</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">32</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">50</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">reply</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Pairing information</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">24</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">24</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">32</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">32</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">32</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">70</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">request</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">Authentication data</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">8</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">8</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                     </tr>
                     <tr>
                        <td valign="top">
                           <p class="tbl-norm">80</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">reply</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">MoS counter value + auth. data</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">8</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">8</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                        <td valign="top">
                           <p class="tbl-norm">16</p>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_219<span style="word-spacing: NaNpt"> </span>The pairing information that is sent in instructions 43 (VU request) and 50 (MoS reply) shall be assembled as specified in section 7.6.10 of [ISO 16844-3], except that the AES algorithm shall be used instead of the TDES algorithm in the pairing data encryption scheme, thus resulting in two AES encryptions, and adopting the padding specified in CSM_220 to fit with the AES block size. The key K&#39;<span class="subscript">p</span> used for this encryption shall be generated as follows:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">In case the pairing key K<span class="subscript">P</span> is 16 bytes long: K&#39;<span class="subscript">p</span> = K<span class="subscript">P</span> XOR (N<span class="subscript">s</span>||N<span class="subscript">s</span>)</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">In case the pairing key K<span class="subscript">P</span> is 24 bytes long: K&#39;<span class="subscript">p</span> = K<span class="subscript">P</span> XOR (N<span class="subscript">s</span>||N<span class="subscript">s</span>||N<span class="subscript">s</span>)</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">In case the pairing key K<span class="subscript">P</span> is 32 bytes long: K&#39;<span class="subscript">p</span> = K<span class="subscript">P</span> XOR (N<span class="subscript">s</span>||N<span class="subscript">s</span>||N<span class="subscript">s</span>||N<span class="subscript">s</span>)</div>
               </div>
            </div>
<p class="list">where N<span class="subscript">s</span> is the 8-byte serial number of the motion sensor.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_220<span style="word-spacing: NaNpt"> </span>In case the plaintext data length (using AES keys) is not a multiple of 16 bytes, padding method 2 defined in [ISO 9797-1] shall be used.</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> in [ISO 16844-3], the number of plaintext data bytes is always a multiple of 8, such that padding is not necessary when using TDES. The definition of data and messages in [ISO 16844-3] is not changed by this part of this Appendix, thus necessitating the application of padding.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_221<span style="word-spacing: NaNpt"> </span>For instruction 11 and in case more than one block of data must be encrypted, the Cipher Block Chaining mode of operation shall be used as defined in [ISO 10116], with an interleave parameter <span class="italics">m</span> = 1. The IV to be used shall be</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">For instruction 11: the 8-byte authentication block specified in section 7.6.3.3 of [ISO 16844-3], padded using padding method 2 defined in [ISO 9797-1]; see also section 7.6.5 and 7.6.6 of [ISO 16844-3].</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">For all other instructions in which more than 16 bytes are transferred, as specified in Table 6: ‘00’ {16}, i.e. sixteen bytes with binary value 0.</div>
               </div>
            </div>
<p class="norm">
               <span class="italics">Note:</span> As shown in section 7.6.5 and 7.6.6 of [ISO 16844-3], when the MoS encrypts data files for inclusion in instruction 11, the authentication block is both</p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Used as the initialization vector for the CBC-mode encryption of the data files</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Encrypted and included as the first block in the data that is sent to the VU.</div>
               </div>
            </div>
<p class="title-gr-seq-level-4" id="id-a9819889-3782-418b-a8b8-d2516d59a342">12.4.   <span class="boldface">
                  <span class="boldface">VU — Motion Sensor Pairing For Different Equipment Generations</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_222<span style="word-spacing: NaNpt"> </span>As explained in section 9.2.1, a second-generation motion sensor may contain the TDES-based encryption of the pairing data (as defined in Part A of this Appendix), which allows the motion sensor to be paired to a first-generation VU. If this is the case, a first-generation VU and a second-generation motion sensor shall be paired as described in Part A of this Appendix and in [ISO 16844-3]. For the pairing process either a first-generation or a second-generation workshop card may be used.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-4cf3fb36-0306-43ae-acd3-133697164806">
               <span class="italics">Notes:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>It is not possible to pair a second-generation VU to a first-generation motion sensor.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>It is not possible to use a first-generation workshop card for coupling a second-generation VU to a motion sensor.</p>
            </div>
<p class="title-gr-seq-level-3" id="id-8cd6bd4a-ce9e-4eb4-97ca-1598e75ffae6">13.   <span class="boldface">SECURITY FOR REMOTE COMMUNICATION OVER DSRC</span>
            </p>
<p class="title-gr-seq-level-4" id="id-ef73d3d2-39e7-4ab9-b9e5-45ad1fe1dc7d">13.1.   <span class="boldface">
                  <span class="boldface">General</span>
               </span>
            </p>
<p class="norm">As specified in Appendix 14, a VU regularly generates Remote Tachograph Monitoring (RTM) data and sends this data to the (internal or external) Remote Communication Facility (RCF). The remote communication facility is responsible for sending this data over the DSRC interface described in Appendix 14 to the remote interrogator. Appendix 1 specifies that the RTM data is the concatenation of:</p>
<p class="norm">
               <span class="boldface">Encrypted tachograph payload</span>the encryption of the plaintext tachograph payload</p>
<p class="norm">
               <span class="boldface">DSRC security data</span>described below</p>
<p class="norm">The plaintext tachograph payload data format is specified in Appendix 1 and further described in Appendix 14. This section describes the structure of the DSRC security data; the formal specification is in Appendix 1.</p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_223<span style="word-spacing: NaNpt"> </span>The plaintext  data communicated by a VU to a Remote Communication Facility (if the RCF is external to the VU) or from the VU to a remote interrogator over the DSRC interface (if the RCF is internal in the VU) shall be protected in encrypt-then-authenticate mode, i.e. the tachograph payload data is encrypted first to ensure message confidentiality, and afterwards a MAC is calculated to ensure data authenticity and integrity.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_224<span style="word-spacing: NaNpt"> </span>The DSRC security data shall consist of the concatenation of the following data elements in the following order; see also Figure 12:</p>
            </div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">
                        <span class="boldface">Current date time</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">the current date and time of the VU (data type )</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">
                        <span class="boldface">Counter</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">a 3-byte counter, see CSM_225</p>
                  </td>
               </tr>
            </tbody></table>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">
                        <span class="boldface">VU serial number</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">the VU’s serial number or certificate request ID (data type VuSerialNumber or CertificateRequestID) – see CSM_123</p>
                  </td>
               </tr>
            </tbody></table>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">
                        <span class="boldface">DSRC master key version number</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">the 1-byte version number of the DSRC master key from which the VU-specific DSRC keys were derived, see section 9.2.2.</p>
                  </td>
               </tr>
            </tbody></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
               <colgroup><col width="10%"/>
               <col width="90%"/>
               </colgroup><tbody><tr>
                  <td valign="top">
                     <p class="dlist-term">
                        <span class="boldface">MAC</span>
                     </p>
                  </td>
                  <td valign="top">
                     <p class="dlist-definition">the MAC calculated over all previous bytes in the RTM data.</p>
                  </td>
               </tr>
            </tbody></table>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_225<span style="word-spacing: NaNpt"> </span>The 3-byte counter in the DSRC security data shall be in MSB-first format. The first time a VU calculates a set of RTM data after it is taken into production, it shall set the value of the counter to 0. The VU shall increase the value of the counter data by 1, each time before it calculates a next set of RTM data.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-0bb6dbac-6849-4a95-892a-4f479e962a5e">13.2.   <span class="boldface">
                  <span class="boldface">Tachograph Payload Encryption and MAC Generation</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_226<span style="word-spacing: NaNpt"> </span>Given a plaintext data element with data type  as described in Appendix 14, a VU shall encrypt this data as shown in Figure 12: the VU&#39;s DSRC key for encryption K_VU<span class="subscript">DSRC</span>_ENC (see section 9.2.2) shall be used with AES in the Cipher Block Chaining (CBC) mode of operation, as defined in [ISO 10116], with an interleave parameter <span class="italics">m</span> = 1. The initialization vector shall be equal to <span class="italics">IV</span> = <span class="italics">current date time</span> || ‘<span class="italics">00 00 00 00 00 00 00 00 00</span>’ || <span class="italics">counter</span>, where <span class="italics">current date time</span> and <span class="italics">counter</span> are specified in CSM_224. The data to be encrypted shall be padded using method 2 defined in [ISO 9797-1].</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_227<span style="word-spacing: NaNpt"> </span>A VU shall calculate the MAC in the DSRC security data as shown in Figure 12: the MAC shall be calculated over all preceding bytes in the RTM data, up to and including the DSRC master key version number, and including the tags and lengths of the data objects. The VU shall use its DSRC key for authenticity K_VU<span class="subscript">DSRC</span>_MAC (see section 9.2.2) with the AES algorithm in CMAC mode as specified in [SP 800-38B]. The length of the MAC shall be linked to the length of the VU-specific DSRC keys, as specified in CSM_50.</p>
            </div>
<p class="title-gr-seq-level-5" id="id-bf796946-45ad-4dfc-b7b4-e9d0a6ff613e">
               <span class="italics">Figure 12</span>
            </p>
<p class="title-gr-seq-level-5" id="id-85a5234f-0e41-40de-a955-d0d3a84b2da3">
               <span class="boldface">Tachograph payload encryption and MAC generation</span>
            </p>
<p class="title-gr-seq-level-4" id="id-aac70e62-28ca-44f0-b36b-ee846b8a2b20">13.3.   <span class="boldface">
                  <span class="boldface">Verification and Decryption of Tachograph Payload</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_228<span style="word-spacing: NaNpt"> </span>When a remote interrogator receives RTM data from a VU, it shall send the entire RTM data to a control card in the data field of a PROCESS DSRC MESSAGE command, as described in Appendix 2. Then:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>1. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The control card shall inspect the DSRC master key version number in the DSRC security data. If the control card does not know the indicated DSRC master key, it shall return an error specified in Appendix 2 and abort the process.</p>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>2. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The control card shall use the indicated DSRC master key in combination with the VU serial number or the certificate request ID in the DSRC security data to derive the VU-specific DSRC keys K_VU<span class="subscript">DSRC</span>_ENC and K_VU<span class="subscript">DSRC</span>_MAC, as specified in CSM_124.</p>
               </div>
            </div>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>3. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The control card shall use K_VU<span class="subscript">DSRC</span>_MAC to verify the MAC in the DSRC security data, as specified in CSM_227. If the MAC is incorrect, the control card shall return an error specified in Appendix 2 and abort the process.</p>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>4. </span>
               </div>
               <div class="grid-list-column-2">
                  <p class="norm">The control card shall use K_VU<span class="subscript">DSRC</span>_ENC to decrypt the encrypted tachograph payload, as specified in CSM_226. The control card shall remove the padding and shall return the decrypted tachograph payload data to the remote interrogator.</p>
               </div>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_229<span style="word-spacing: NaNpt"> </span>In order to prevent replay attacks, the remote interrogator shall verify the freshness of the RTM data by verifying that the <span class="italics">current date time</span> in the DSRC security data does not deviate too much from the current time of the remote interrogator.</p>
            </div>
<p class="title-gr-seq-level-4" id="id-b1900b2f-e72a-4a1e-be1e-7c6fa1f5ea2e">
               <span class="italics">Notes:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>This requires the remote interrogator to have an accurate and reliable source of time.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>Since Appendix 14 requires a VU to calculate a new set of RTM data every 60 seconds, and the clock of the VU is allowed to deviate 1 minute from the real time, a lower limit for the freshness of the RTM data is 2 minutes. The actual freshness to be required also depends on the accuracy of the clock of the remote interrogator.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_230<span style="word-spacing: NaNpt"> </span>When a workshop verifies the correct functioning of the DSRC functionality of a VU, it shall send the entire RTM data received from the VU to a workshop card in the data field of a PROCESS DSRC MESSAGE command, as described in Appendix 2. The workshop card shall perform all checks and actions specified in CSM_228.</p>
            </div>
<p class="title-gr-seq-level-3" id="id-89b091f4-72f8-47d2-abbc-e062b09e0010">14.   <span class="boldface">SIGNING DATA DOWNLOADS AND VERIFYING SIGNATURES</span>
            </p>
<p class="title-gr-seq-level-4" id="id-0dcef92b-015b-4b42-aae4-26e56a045423">14.1.   <span class="boldface">
                  <span class="boldface">General</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_231<span style="word-spacing: NaNpt"> </span>The Intelligent Dedicated Equipment (IDE) shall store data received from a VU or a card during one download session within one physical data file. Data may be stored on an ESM (external storage medium). This file contains digital signatures over data blocks, as specified in Appendix 7. This file shall also contain the following certificates (refer to section 9.1):</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">In case of a VU download:</div>
                  <div class="list">
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">The VU_Sign certificate</div>
                        </div>
                     </div>
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">The MSCA_VU-EGF certificate containing the public key to be used for verification of the VU_Sign certificate</div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">In case of a Card download:</div>
                  <div class="list">
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">The Card_Sign certificate</div>
                        </div>
                     </div>
                     <div class="grid-container grid-list">
                        <div class="list grid-list-column-1">
                           <span>— </span>
                        </div>
                        <div class="grid-list-column-2">
                           <div class="list">The MSCA_Card certificate containing the public key to be used for verification of the Card_Sign certificate</div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_232<span style="word-spacing: NaNpt"> </span>The IDE shall also dispose of.</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">In case it uses a control card to verify the signature, as shown in Figure 13: The link certificate linking the latest EUR certificate to the EUR certificate whose validity period directly precedes it, if existing.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">In case it verifies the signature itself: all valid European root certificates.</div>
               </div>
            </div>
<p class="norm">
               <span class="italics">Note:</span> the method the IDE uses to retrieve these certificates is not specified in this Appendix.</p>
<p class="title-gr-seq-level-4" id="id-9e67e979-d924-4480-b5af-08574e66b4d8">14.2.   <span class="boldface">
                  <span class="boldface">Signature generation</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_233<span style="word-spacing: NaNpt"> </span>The signing algorithm to create digital signatures over downloaded data shall be ECDSA as specified in [DSS], using the hashing algorithm linked to the key size of the VU or the card, as specified in CSM_50. The signature format shall be plain, as specified in [TR-03111].</p>
            </div>
<p class="title-gr-seq-level-4" id="id-e06fe635-4072-4741-b125-705bea64b320">14.3.   <span class="boldface">
                  <span class="boldface">Signature verification</span>
               </span>
            </p>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_234<span style="word-spacing: NaNpt"> </span>
                  <span>
                     <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">
                        <span class="boldface">►M1</span>
                     </a>
                  </span> An IDE may perform verification of a signature over downloaded data itself or it may use a control card for this purpose. In case it uses a control card, signature verification shall take place as shown in Figure 13. For verifying the temporal validity of a certificate presented by the IDE, the control card shall use its internal current time, as specified in CSM_167. The control card shall update its current time if the Effective Date of an authentic ‘valid source of time’ certificate is more recent than the card’s current time. The card shall accept only the following certificates as a valid source of time:</p>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Second-generation ERCA link certificates</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Second-generation MSCA certificates</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">Second-generation VU_Sign or Card_Sign certificates issued by the same country as the control card’s own card certificate.</div>
               </div>
            </div>
<p class="list">In case it performs signature verification itself, the IDE shall verify the authenticity and validity of all certificates in the certificate chain in the data file, and it shall verify the signature over the data following the signature scheme defined in [DSS]. In both cases, for every certificate read from the data file, it is necessary to verify that the Certificate Holder Authorisation (CHA) field is correct:</p>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The CHA field of the EQT certificate shall indicate a VU or Card (as applicable) certificate for signing (see Appendix 1, data type EquipmentType).</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The CHA of the EQT.CA certificate shall indicate an MSCA.</div>
               </div>
            </div>
<div class="grid-container grid-list">
               <div class="list grid-list-column-1">
                  <span>— </span>
               </div>
               <div class="grid-list-column-2">
                  <div class="list">The CHA of the EQT.Link certificate shall indicate the ERCA.<span class="boldface"> ◄ </span>
                  </div>
               </div>
            </div>
<p class="title-gr-seq-level-4" id="id-3d66cdbb-f763-47e1-92ab-4e4febabadfb">
               <span class="italics">Notes to Figure 13:</span>
            </p>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The equipment that signed the data to be analysed is denoted EQT.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The EQT certificates and public keys mentioned in the figure are those for signing, i.e. VU_Sign or Card_Sign.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The EQT.CA certificates and public keys mentioned in the figure are those for signing VU or Card certificates, as applicable.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The EQT.CA.EUR certificate mentioned in the figure is the European root certificate that is indicated in the CAR of the EQT.CA certificate.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The EQT.Link certificate mentioned in the figure is the EQT&#39;s link certificate, if present. As specified in section 9.1.2, this is a link certificate for a new European root key pair created by the ERCA and signed with the previous European private key.</p>
            </div>
<div style="margin-left: 18pt; text-indent: -18pt">
               <p class="norm">—<span style="word-spacing: 8pt"> </span>The EQT.Link.EUR certificate is the European root certificate that is indicated in the CAR of the EQT.Link certificate.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_235<span style="word-spacing: NaNpt"> </span>For calculating the hash M sent to the control card in the PSO:Hash command, the IDE shall use the hashing algorithm linked to the key size of the VU or the card from which the data is downloaded, as specified in CSM_50.</p>
            </div>
<div style="margin-left: 54pt; text-indent: -54pt">
               <p class="norm">CSM_236<span style="word-spacing: NaNpt"> </span>For verifying the EQT&#39;s signature, the control card shall follow the signature scheme defined in [DSS].</p>
            </div>
<p class="norm">
               <span class="italics">Note:</span> This document does not specify any action to undertake if a signature over a downloaded data file cannot be verified or if the verification is unsuccessful.</p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32018R0502" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32018R0502: REPLACED">▼M1</a>
            </p>
<p class="title-gr-seq-level-5" id="id-436a5b36-c3d6-437b-9acb-c60fddcfa584">
               <span class="italics">Figure 13</span>
            </p>
<p class="title-gr-seq-level-5" id="id-e0341a7d-b86e-45ff-9e08-9fdd37867473">
               <span class="boldface">Protocol for verification of the signature over a downloaded data file</span>
            </p>
<p class="norm">
               
            </p>
<p class="modref">
               <a href="http://publications.europa.eu/resource/celex/32016R0799" onclick="window.open(this.href,&#39;_blank&#39;); return false;" title="32016R0799">▼B</a>
            </p>
</body>
</html>