<!DOCTYPE html>
<html><head>

      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
      <title>Consolidated TEXT: 32016R0799 — EN — 21.08.2023</title>
      
   
</head>
<body>
<h1>Appendix 7: DATA DOWNLOADING PROTOCOLS</h1>

<nav><h2>Table of Contents</h2><ol><li><a href="#introduction">INTRODUCTION</a></li><li><a href="#scope">Scope</a></li><li><a href="#acronyms-and-notations">Acronyms and notations</a></li><li><a href="#vu-data-downloading">V.U. DATA DOWNLOADING</a></li><li><a href="#download-procedure">Download procedure</a></li><li><a href="#data-download-protocol">Data download protocol</a></li><li><a href="#message-structure">Message structure</a></li><li><a href="#message-types">Message types</a></li><li><a href="#start-communication-request-sid-81">Start Communication Request (SID 81)</a></li><li><a href="#positive-response-start-communication-sid-c1">Positive Response Start Communication (SID C1)</a></li><li><a href="#start-diagnostic-session-request-sid-10">Start Diagnostic Session Request (SID 10)</a></li><li><a href="#positive-response-start-diagnostic-sid-50">Positive Response Start Diagnostic (SID 50)</a></li><li><a href="#link-control-service-sid-87">Link Control Service (SID 87)</a></li><li><a href="#link-control-positive-response-sid-c7">Link Control Positive Response (SID C7)</a></li><li><a href="#request-upload-sid-35">Request Upload (SID 35)</a></li><li><a href="#positive-response-request-upload-sid-75">Positive Response Request Upload (SID 75)</a></li><li><a href="#transfer-data-request-sid-36">Transfer Data Request (SID 36)</a></li><li><a href="#positive-response-transfer-data-sid-76">Positive Response Transfer Data (SID 76)</a></li><li><a href="#request-transfer-exit-sid-37">Request Transfer Exit (SID 37)</a></li><li><a href="#positive-response-request-transfer-exit-sid-77">Positive Response Request Transfer Exit (SID 77)</a></li><li><a href="#stop-communication-request-sid-82">Stop Communication Request (SID 82)</a></li><li><a href="#positive-response-stop-communication-sid-c2">Positive Response Stop Communication (SID C2)</a></li><li><a href="#acknowledge-sub-message-sid-83">Acknowledge Sub Message (SID 83)</a></li><li><a href="#negative-response-sid-7f">Negative Response (SID 7F)</a></li><li><a href="#message-flow">Message flow</a></li><li><a href="#timing">Timing</a></li><li><a href="#error-handling">Error handling</a></li><li><a href="#start-communication-phase">Start Communication phase</a></li><li><a href="#communication-phase">Communication phase</a></li><li><a href="#response-message-content">Response Message content</a></li><li><a href="#positive-response-transfer-data-download-interface">Positive Response Transfer Data Download Interface Version</a></li><li><a href="#positive-response-transfer-data-overview">Positive Response Transfer Data Overview</a></li><li><a href="#positive-response-transfer-data-activities">Positive Response Transfer Data Activities</a></li><li><a href="#positive-response-transfer-data-events-and-faults">Positive Response Transfer Data Events and Faults</a></li><li><a href="#positive-response-transfer-data-detailed-speed">Positive Response Transfer Data Detailed Speed</a></li><li><a href="#positive-response-transfer-data-technical-data">Positive Response Transfer Data Technical Data</a></li><li><a href="#esm-file-storage">ESM File storage</a></li><li><a href="#tachograph-cards-downloading-protocol">TACHOGRAPH CARDS DOWNLOADING PROTOCOL</a></li><li><a href="#scope">Scope</a></li><li><a href="#definitions">Definitions</a></li><li><a href="#card-downloading">Card Downloading</a></li><li><a href="#initialisation-sequence">Initialisation sequence</a></li><li><a href="#sequence-for-un-signed-data-files">Sequence for un-signed data files</a></li><li><a href="#sequence-for-signed-data-files">Sequence for Signed data files</a></li><li><a href="#sequence-for-resetting-the-calibration-counter">Sequence for resetting the calibration counter.</a></li><li><a href="#data-storage-format">Data storage format</a></li><li><a href="#introduction">Introduction</a></li><li><a href="#file-format">File format</a></li><li><a href="#downloading-a-tachograph-card-via-a-vehicle-unit">DOWNLOADING A TACHOGRAPH CARD VIA A VEHICLE UNIT.</a></li></ol></nav>
<p>1.   <strong>INTRODUCTION</strong>
            </p>
<p>This appendix specifies the procedures to follow in order to perform the different types of data download to an External Storage Medium, together with the protocols that must be implemented to assure the correct data transfer and the full compatibility of the downloaded data format to allow any controller to inspect these data and be able to control their authenticity and their integrity before analysing them.</p>
<p>▼M1</p>
<p>1.1.   <strong>Scope</strong>
            </p>
<p>Data may be downloaded to an ESM:</p>
<dl><dt>—</dt><dd>from a Vehicle Unit by an Intelligent Dedicated Equipment (IDE) connected to the VU,</dd><dt>—</dt><dd>from a tachograph card by an IDE fitted with a card interface device (IFD),</dd><dt>—</dt><dd>from a tachograph card via a vehicle unit by an IDE connected to the VU.</dd></dl>


<p>To give the possibility to verify the authenticity and integrity of downloaded data stored on an ESM, data is downloaded with a signature appended in accordance with Appendix 11 Common Security Mechanisms. The source equipment (VU or card) identification and its security certificates (Member state and equipment) are also downloaded. The verifier of the data must possess independently a trusted European public key.</p>
<p>Data downloaded from a VU are signed using Appendix 11 Common Security Mechanisms Part B (Second-generation tachograph system), except when drivers&#39; control is performed by a non EU control authority, using a first generation control card, in which case data are signed using Appendix 11 Common Security Mechanisms Part A (First-generation tachograph system), as requested by Appendix 15 Migration, requirement MIG_015.</p>
<p>This Appendix specifies therefore two types of data downloads from the VU:</p>
<dl><dt>—</dt><dd>Generation 2 type of VU data download, providing the generation 2 data structure, signed using Appendix 11 Common Security Mechanisms Part B,</dd><dt>—</dt><dd>Generation 1 type of VU data download, providing the generation 1 data structure, signed using Appendix 11 Common Security Mechanisms Part A.</dd></dl>

<p>Similarly, there are two types of data downloads from second generation driver cards inserted in a VU, as specified in paragraphs 3 and 4 of this Appendix.</p>
<p>▼B</p>
<p>1.2.   <strong>Acronyms and notations</strong>
            </p>
<p>The following acronyms are used in this appendix:</p>
<table>
               <tbody><tr>
                  <td>AID</td>
                  <td>Application Identifier</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>ATR</td>
                  <td>Answer To Reset</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>CS</td>
                  <td>Checksum byte</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>DF</td>
                  <td>Dedicated File</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>DS_</td>
                  <td>Diagnostic Session</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>EF</td>
                  <td>Elementary File</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>ESM</td>
                  <td>External Storage Medium</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>FID</td>
                  <td>File Identifier (File ID)</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>FMT</td>
                  <td>Format Byte (first byte of message header)</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>ICC</td>
                  <td>Integrated Circuit Card</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>IDE</td>
                  <td>Intelligent Dedicated Equipment: The equipment used to perform data downloading to the ESM (e.g. Personal Computer)</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>IFD</td>
                  <td>Interface Device</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>KWP</td>
                  <td>Keyword Protocol 2000</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>LEN</td>
                  <td>Length Byte (last byte of message header)</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>PPS</td>
                  <td>Protocol Parameter Selection</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>PSO</td>
                  <td>Perform Security Operation</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SID</td>
                  <td>Service Identifier</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SRC</td>
                  <td>Source byte</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>TGT</td>
                  <td>Target Byte</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>TLV</td>
                  <td>Tag Length Value</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>TREP</td>
                  <td>Transfer Response Parameter</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>TRTP</td>
                  <td>Transfer Request Parameter</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>VU</td>
                  <td>Vehicle Unit</td>
               </tr>
            </tbody></table>
<p>2.   <strong>V.U. DATA DOWNLOADING</strong>
            </p>
<p>2.1.   <strong>Download procedure</strong>
            </p>
<p>In order to carry on a VU data download, the operator must perform the following operations:</p>
<dl><dt>—</dt><dd>Insert his tachograph card inside a card slot of the VU ( *1 );</dd><dt>—</dt><dd>Connect the IDE to the VU download connector;</dd><dt>—</dt><dd>Establish the connection between the IDE and the VU;</dd><dt>—</dt><dd>Select on the IDE the data to download and send the request to the VU;</dd><dt>—</dt><dd>Close the download session.</dd></dl>




<p>2.2.   <strong>Data download protocol</strong>
            </p>
<p>The protocol is structured on a master-slave basis, with the IDE playing the master role and the VU playing the slave role.</p>
<p>The message structure, types and flow are principally based on the Keyword Protocol 2000 (KWP) (ISO 14230-2 Road vehicles — Diagnostic systems — Keyword protocol 2000 — Part2: Data link layer).</p>
<p>The application layer is principally based on the current draft to date of ISO 14229-1 (Road vehicles — Diagnostic systems — Part 1: Diagnostic services, version 6 of 22 February 2001).</p>
<p>2.2.1   <strong>Message structure</strong>
            </p>
<p>DDP_002 All the messages exchanged between the IDE and the VU are formatted with a structure consisting of three parts:</p>
<dl><dt>—</dt><dd>Header composed by a Format byte (FMT), a Target byte (TGT), a Source byte (SRC) and possibly a Length byte (LEN),</dd><dt>—</dt><dd>Data field composed by a Service Identifier byte (SID) and a variable number of data bytes, which can include an optional diagnostic session byte (DS_) or an optional transfer parameter byte (TRTP or TREP).</dd><dt>—</dt><dd>Checksum composed by a Checksum byte (CS).</dd></dl>


<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Header</td>
                        <td>Data field</td>
                        <td>Checksum</td>
                     </tr>
                     <tr>
                        <td>FMT</td>
                        <td>TGT</td>
                        <td>SRC</td>
                        <td>LEN</td>
                        <td>SID</td>
                        <td>DATA</td>
                        <td>…</td>
                        <td>…</td>
                        <td>…</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>4 bytes</td>
                        <td>Max 255 bytes</td>
                        <td>1 byte</td>
                     </tr>
                  </tbody>
               </table>
<p>The TGT and SRC byte represent the physical address of the recipient and originator of the message. Values are F0 Hex for the IDE and EE Hex for the VU.</p>
<p>The LEN byte is the length of the Data field part.</p>
<p>The Checksum byte is the 8 bit sum series modulo 256 of all the bytes of the message excluding the CS itself.</p>
<p>FMT, SID, DS_, TRTP and TREP bytes are defined later in this document.</p>
<p>DDP_003 In the case where the data to be carried by the message is longer than the space available in the data field part, the message is actually sent in several sub messages. Each sub message bears a header, the same SID, TREP and a 2-byte sub message counter indicating the sub message number within the total message. To enable error checking and abort the IDE acknowledges every sub message. The IDE can accept the sub message, ask for it to be re-transmitted, request the VU to start again or abort the transmission.</p>
<p>DDP_004 If the last sub message contains exactly 255 bytes in the data field, a final sub message with an empty (except SID TREP and sub message counter) data field must be appended to show the end of the message.</p>
<p>
               <em>Example:</em>
            </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Header</td>
                        <td>SID</td>
                        <td>TREP</td>
                        <td>Message</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>4 Bytes</td>
                        <td>Longer than 255 Bytes</td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>Will be transmitted as:</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Header</td>
                        <td>SID</td>
                        <td>TREP</td>
                        <td>00</td>
                        <td>01</td>
                        <td>Sub message 1</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>4 Bytes</td>
                        <td>255 Bytes</td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Header</td>
                        <td>SID</td>
                        <td>TREP</td>
                        <td>00</td>
                        <td>02</td>
                        <td>Sub message 2</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>4 Bytes</td>
                        <td>255 Bytes</td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>…</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Header</td>
                        <td>SID</td>
                        <td>TREP</td>
                        <td>xx</td>
                        <td>yy</td>
                        <td>Sub message n</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>4 Bytes</td>
                        <td>Less than 255 Bytes</td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>or as:</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Header</td>
                        <td>SID</td>
                        <td>TREP</td>
                        <td>00</td>
                        <td>01</td>
                        <td>Sub message 1</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>4 Bytes</td>
                        <td>255 Bytes</td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Header</td>
                        <td>SID</td>
                        <td>TREP</td>
                        <td>00</td>
                        <td>02</td>
                        <td>Sub message 2</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>4 Bytes</td>
                        <td>255 Bytes</td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>…</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Header</td>
                        <td>SID</td>
                        <td>TREP</td>
                        <td>xx</td>
                        <td>yy</td>
                        <td>Sub message n</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>4 Bytes</td>
                        <td>255 Bytes</td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Header</td>
                        <td>SID</td>
                        <td>TREP</td>
                        <td>xx</td>
                        <td>yy + 1</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>4 Bytes</td>
                        <td>4 bytes</td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>2.2.2   <strong>Message types</strong>
            </p>
<p>The communication protocol for data download between the VU and the IDE requires the exchange of 8 different message types.</p>
<p>The following table summarises these messages.</p>
<p>▼M3</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Message Structure</td>
                        <td>Max 4 Bytes</td>
                        <td>Max 255 Bytes</td>
                        <td>1 Byte</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>Header</td>
                        <td>Data</td>
                        <td>CheckSum</td>
                     </tr>
                     <tr>
                        <td>IDE -&gt;</td>
                        <td>&lt;- VU</td>
                        <td>FMT</td>
                        <td>TGT</td>
                        <td>SRC</td>
                        <td>LEN</td>
                        <td>SID</td>
                        <td>DS_ / TRTP</td>
                        <td>DATA</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Start Communication Request</td>
                        <td>81</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td></td>
                        <td>81</td>
                        <td></td>
                        <td></td>
                        <td>E0</td>
                     </tr>
                     <tr>
                        <td>Positive Response Start Communication</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>03</td>
                        <td>C1</td>
                        <td></td>
                        <td>EA, 8F</td>
                        <td>9B</td>
                     </tr>
                     <tr>
                        <td>Start Diagnostic Session Request</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>02</td>
                        <td>10</td>
                        <td>81</td>
                        <td></td>
                        <td>F1</td>
                     </tr>
                     <tr>
                        <td>Positive Response Start Diagnostic</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>02</td>
                        <td>50</td>
                        <td>81</td>
                        <td></td>
                        <td>31</td>
                     </tr>
                     <tr>
                        <td>Link Control Service</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>Verify Baud Rate (stage 1)</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>9 600 Bd</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>04</td>
                        <td>87</td>
                        <td>01</td>
                        <td>01,01</td>
                        <td>EC</td>
                     </tr>
                     <tr>
                        <td>19 200 Bd</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>04</td>
                        <td>87</td>
                        <td>01</td>
                        <td>01,02</td>
                        <td>ED</td>
                     </tr>
                     <tr>
                        <td>38 400 Bd</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>04</td>
                        <td>87</td>
                        <td>01</td>
                        <td>01,03</td>
                        <td>EE</td>
                     </tr>
                     <tr>
                        <td>57 600 Bd</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>04</td>
                        <td>87</td>
                        <td>01</td>
                        <td>01,04</td>
                        <td>EF</td>
                     </tr>
                     <tr>
                        <td>115 200 Bd</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>04</td>
                        <td>87</td>
                        <td>01</td>
                        <td>01,05</td>
                        <td>F0</td>
                     </tr>
                     <tr>
                        <td>Positive Response Verify Baud Rate</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>02</td>
                        <td>C7</td>
                        <td>01</td>
                        <td></td>
                        <td>28</td>
                     </tr>
                     <tr>
                        <td>Transition Baud Rate (stage 2)</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>03</td>
                        <td>87</td>
                        <td>02</td>
                        <td>03</td>
                        <td>ED</td>
                     </tr>
                     <tr>
                        <td>Request Upload</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>0A</td>
                        <td>35</td>
                        <td></td>
                        <td>00,00,00,00,00,FF,FF, FF,FF</td>
                        <td>99</td>
                     </tr>
                     <tr>
                        <td>Positive Response Request Upload</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>03</td>
                        <td>75</td>
                        <td></td>
                        <td>00,FF</td>
                        <td>D5</td>
                     </tr>
                     <tr>
                        <td>Transfer Data Request</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>Download interface version</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>02</td>
                        <td>36</td>
                        <td>00</td>
                        <td></td>
                        <td>96</td>
                     </tr>
                     <tr>
                        <td>Overview</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>02</td>
                        <td>36</td>
                        <td>01, 21 or 31</td>
                        <td></td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Activities</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>06</td>
                        <td>36</td>
                        <td>02, 22 or 32</td>
                        <td>Date</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Events &amp; Faults</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>02</td>
                        <td>36</td>
                        <td>03, 23 or 33</td>
                        <td>Date</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Detailed Speed</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>02</td>
                        <td>36</td>
                        <td>04 or 24</td>
                        <td>Date</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Technical Data</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>02</td>
                        <td>36</td>
                        <td>05, 25 or 35</td>
                        <td>Date</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Card download</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>02 or 03</td>
                        <td>36</td>
                        <td>06</td>
                        <td>Slot</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Positive Response Transfer Data</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>Len</td>
                        <td>76</td>
                        <td>TREP</td>
                        <td>Data</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Request Transfer Exit</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>01</td>
                        <td>37</td>
                        <td></td>
                        <td></td>
                        <td>96</td>
                     </tr>
                     <tr>
                        <td>Positive Response Request Transfer Exit</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>01</td>
                        <td>77</td>
                        <td></td>
                        <td></td>
                        <td>D6</td>
                     </tr>
                     <tr>
                        <td>Stop Communication Request</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>01</td>
                        <td>82</td>
                        <td></td>
                        <td></td>
                        <td>E1</td>
                     </tr>
                     <tr>
                        <td>Positive Response Stop Communication</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>01</td>
                        <td>C2</td>
                        <td></td>
                        <td></td>
                        <td>21</td>
                     </tr>
                     <tr>
                        <td>Acknowledge sub message</td>
                        <td>80</td>
                        <td>EE</td>
                        <td>F0</td>
                        <td>Len</td>
                        <td>83</td>
                        <td></td>
                        <td>Data</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Negative responses</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>General reject</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>03</td>
                        <td>7F</td>
                        <td>Sid Req</td>
                        <td>10</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Service not supported</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>03</td>
                        <td>7F</td>
                        <td>Sid Req</td>
                        <td>11</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Sub function not supported</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>03</td>
                        <td>7F</td>
                        <td>Sid Req</td>
                        <td>12</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Incorrect Message Length</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>03</td>
                        <td>7F</td>
                        <td>Sid Req</td>
                        <td>13</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Conditions not correct or Request sequence error</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>03</td>
                        <td>7F</td>
                        <td>Sid Req</td>
                        <td>22</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Request out of range</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>03</td>
                        <td>7F</td>
                        <td>Sid Req</td>
                        <td>31</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Upload not accepted</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>03</td>
                        <td>7F</td>
                        <td>Sid Req</td>
                        <td>50</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Response pending</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>03</td>
                        <td>7F</td>
                        <td>Sid Req</td>
                        <td>78</td>
                        <td>CS</td>
                     </tr>
                     <tr>
                        <td>Data not available</td>
                        <td>80</td>
                        <td>F0</td>
                        <td>EE</td>
                        <td>03</td>
                        <td>7F</td>
                        <td>Sid Req</td>
                        <td>FA</td>
                        <td>CS</td>
                     </tr>
                  </tbody>
               </table>
<p>
               <em>Notes:</em>
            </p>
<dl><dt>—</dt><dd>Sid Req = the Sid of the corresponding request.</dd><dt>—</dt><dd>TREP = the TRTP of the corresponding request.</dd><dt>—</dt><dd>Dark cells denote that nothing is transmitted.</dd><dt>—</dt><dd>The term upload (as seen from the IDE) is used for compatibility with ISO 14229. It means the same as download (as seen from the VU).</dd><dt>—</dt><dd>Potential 2-byte sub message counters are not shown in this table.</dd><dt>—</dt><dd>Slot is the slot number, either ‘1’ (card on driver slot) or ‘2’ (card on co-driver slot).</dd><dt>—</dt><dd>In case the slot is not specified, the VU shall select slot 1 if a card is inserted in this slot and it shall select slot 2 only in case it is specifically selected by the user.</dd><dt>—</dt><dd>TRTP 24 is used for Generation 2, for version 1 and version 2 type of VU data download requests.</dd><dt>—</dt><dd>TRTP 00, 31, 32, 33 and 35 are used for Generation 2 version 2 type of VU data download requests.</dd><dt>—</dt><dd>TRTP 21, 22, 23, and 25 are used for Generation 2 version 1 type of VU data download requests.</dd><dt>—</dt><dd>TRTP 01 to 05 are used for Generation 1 type of VU data download requests. They can optionally be accepted by Generation 2 type of VU, but only in the frame of drivers&#39; control performed by a non-EU control authority, using a first generation control card.</dd><dt>—</dt><dd>TRTP 11 to 1F are reserved for manufacturer specific download requests.</dd></dl>











<p>▼B</p>
<p>2.2.2.1   <strong>Start Communication Request (SID 81)</strong>
            </p>
<p>DDP_005 This message is issued by the IDE to establish the communication link with the VU. Initial communications are always performed at 9 600 baud (until baud rate is eventually changed using the appropriate Link control services).</p>
<p>2.2.2.2   <strong>Positive Response Start Communication (SID C1)</strong>
            </p>
<p>DDP_006 This message is issued by the VU to answer positively to a start communication request. It includes the 2 key bytes ‘EA’‘8F’ indicating that the unit supports protocol with header including target source and length information.</p>
<p>2.2.2.3   <strong>Start Diagnostic Session Request (SID 10)</strong>
            </p>
<p>DDP_007 The Start Diagnostic Session request message is issued by the IDE in order to request a new diagnostic session with the VU. The sub function ‘default session’ (81 Hex) indicates a standard diagnostic session is to be opened.</p>
<p>2.2.2.4   <strong>Positive Response Start Diagnostic (SID 50)</strong>
            </p>
<p>DDP_008 The Positive Response Start Diagnostic message is sent by the VU to answer positively to Diagnostic Session Request.</p>
<p>2.2.2.5   <strong>Link Control Service (SID 87)</strong>
            </p>
<p>DDP_052 The Link Control Service is used by the IDE to initiate a change in baud rate. This takes place in two steps. In step one the IDE proposes the baud rate change, indicating the new rate. On receipt of a positive message from the VU the IDE sends out confirmation of the baud rate change to the VU (step two). The IDE then changes to the new baud rate. After receipt of the confirmation the VU changes to the new baud rate</p>
<p>2.2.2.6   <strong>Link Control Positive Response (SID C7)</strong>
            </p>
<p>DDP_053 The Link Control Positive Response is issued by the VU to answer positively to Link Control Service request (step one). Note that no response is given to the confirmation request (step two).</p>
<p>2.2.2.7   <strong>Request Upload (SID 35)</strong>
            </p>
<p>DDP_009 The Request Upload message is issued by the IDE to specify to the VU that a download operation is requested. To meet the requirements of ISO14229 data is included covering address, the size and format details for the data requested. As these are not known to the IDE prior to a download, the memory address is set to 0, format is unencrypted and uncompressed and the memory size is set to the maximum.</p>
<p>2.2.2.8   <strong>Positive Response Request Upload (SID 75)</strong>
            </p>
<p>DDP_010 The Positive Response Request Upload message is sent by the VU to indicate to the IDE that the VU is ready to download data. To meet the requirements of ISO 14229 data is included in this positive response message, indicating to the IDE that further Positive Response Transfer Data messages will include 00FF hex bytes maximum.</p>
<p>2.2.2.9   <strong>Transfer Data Request (SID 36)</strong>
            </p>
<p>▼M1</p>
<p>DDP_011 The Transfer Data Request is sent by the IDE to specify to the VU the type of data that are to be downloaded. A one byte Transfer Request Parameter (TRTP) indicates the type of transfer.</p>
<p>▼M3</p>
<p>There are seven types of data transfer. For VU data download, two different TRTP values can be used for each transfer type:</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data transfer type</td>
                        <td>
                           <p>TRTP value for generation 1 type of</p>
                           <p>VU data download</p>
                        </td>
                        <td>
                           <p>TRTP value for generation 2, version 1 type of</p>
                           <p>VU data download</p>
                        </td>
                        <td>
                           <p>TRTP value for generation 2, version 2 type of</p>
                           <p>VU data download</p>
                        </td>
                     </tr>
                     <tr>
                        <td>Download interface version</td>
                        <td>Not used</td>
                        <td>Not used</td>
                        <td>00</td>
                     </tr>
                     <tr>
                        <td>Overview</td>
                        <td>01</td>
                        <td>21</td>
                        <td>31</td>
                     </tr>
                     <tr>
                        <td>Activities of a specified date</td>
                        <td>02</td>
                        <td>22</td>
                        <td>32</td>
                     </tr>
                     <tr>
                        <td>Events and faults</td>
                        <td>03</td>
                        <td>23</td>
                        <td>33</td>
                     </tr>
                     <tr>
                        <td>Detailed speed</td>
                        <td>04</td>
                        <td>24</td>
                        <td>24</td>
                     </tr>
                     <tr>
                        <td>Technical data</td>
                        <td>05</td>
                        <td>25</td>
                        <td>35</td>
                     </tr>
                  </tbody>
               </table>
<p>▼M1</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data transfer type</td>
                        <td>TRTP value</td>
                     </tr>
                     <tr>
                        <td>Card download</td>
                        <td>06</td>
                     </tr>
                  </tbody>
               </table>
<p>▼M3</p>
<p>DDP_054 It is mandatory for the IDE to request the overview data transfer (TRTP 01, 21 or 31) during a download session as this only will ensure that the VU certificates are recorded within the downloaded file (and allow for verification of digital signature).</p>
<p>In the third case (TRTP 02, 22 or 32) the Transfer Data Request message includes the indication of the calendar day (TimeReal format) to be downloaded.</p>
<p>▼B</p>
<p>2.2.2.10   <strong>Positive Response Transfer Data (SID 76)</strong>
            </p>
<p>DDP_012 The Positive Response Transfer Data is sent by the VU in response to the Transfer Data Request. The message contains the requested data, with a Transfer Response Parameter (TREP) corresponding to the TRTP of the request.</p>
<p>▼M3</p>
<p>DDP_055 In the first case (TREP 01, 21 or 31), the VU will send data helping the IDE operator to choose the data he wants to download further. The information contained within this message is:</p>
<p>▼M1</p>
<dl><dt>—</dt><dd>Security certificates,</dd><dt>—</dt><dd>Vehicle identification,</dd><dt>—</dt><dd>VU current date and time,</dd><dt>—</dt><dd>Min and Max downloadable date (VU data),</dd><dt>—</dt><dd>Indication of cards presence in the VU,</dd><dt>—</dt><dd>Previous download to a company,</dd><dt>—</dt><dd>Company locks,</dd><dt>—</dt><dd>Previous controls.</dd></dl>







<p>▼B</p>
<p>2.2.2.11   <strong>Request Transfer Exit (SID 37)</strong>
            </p>
<p>DDP_013 The Request Transfer Exit message is sent by the IDE to inform the VU that the download session is terminated.</p>
<p>2.2.2.12   <strong>Positive Response Request Transfer Exit (SID 77)</strong>
            </p>
<p>DDP_014 The Positive Response Request Transfer Exit message is sent by the VU to acknowledge the Request Transfer Exit.</p>
<p>2.2.2.13   <strong>Stop Communication Request (SID 82)</strong>
            </p>
<p>DDP_015 The Stop Communication Request message is sent by the IDE to disconnect the communication link with the VU.</p>
<p>2.2.2.14   <strong>Positive Response Stop Communication (SID C2)</strong>
            </p>
<p>DDP_016 The Positive Response Stop Communication message is sent by the VU to acknowledge the Stop Communication Request.</p>
<p>2.2.2.15   <strong>Acknowledge Sub Message (SID 83)</strong>
            </p>
<p>DDP_017 The Acknowledge Sub Message is sent by the IDE to confirm receipt of each part of a message that is being transmitted as several sub messages. The data field contains the SID received from the VU and a 2-byte code as follows:</p>
<dl><dt>—</dt><dd>MsgC+1 Acknowledges correct receipt of sub message number MsgC. Request from the IDE to the VU to send next sub message</dd><dt>—</dt><dd>MsgC indicates a problem with the receipt of sub message number MsgC. Request from the IDE to the VU to send the sub message again.</dd><dt>—</dt><dd>FFFF requests termination of the message. This can be used by the IDE to end the transmission of the VU message for any reason.</dd></dl>


<p>The last sub message of a message (LEN byte &lt; 255) may be acknowledged using any of these codes or not acknowledged.</p>
<p>The VU responses that will consist of several sub messages are:</p>
<dl><dt>—</dt><dd>Positive Response Transfer Data (SID 76)</dd></dl>
<p>2.2.2.16   <strong>Negative Response (SID 7F)</strong>
            </p>
<p>DDP_018 The Negative Response message is sent by the VU in response to the above request messages when the VU cannot satisfy the request. The data fields of the message contains the SID of the response (7F), the SID of the request, and a code specifying the reason of the negative response. The following codes are available:</p>
<dl><dt>—</dt><dd>10 general reject The action cannot be performed for a reason not covered below.</dd><dt>—</dt><dd>11 service not supported The SID of the request is not understood.</dd><dt>—</dt><dd>12 sub function not supported The DS_ or TRTP of the request is not understood, or there are no further sub messages to be transmitted.</dd><dt>—</dt><dd>13 incorrect message length The length of the received message is wrong.</dd><dt>—</dt><dd>22 conditions not correct or request sequence error The required service is not active or the sequence of request messages is not correct.</dd><dt>—</dt><dd>31 Request out of range The request parameter record (data field) is not valid.</dd><dt>—</dt><dd>50 upload not accepted The request cannot be performed (VU in a non appropriate mode of operation or internal fault of the VU).</dd><dt>—</dt><dd>78 response pending The action requested cannot be completed in time and the VU is not ready to accept another request.</dd></dl>







<p>▼M1</p>
<dl><dt>—</dt><dd>FA data not available The data object of a data transfer request are not available in the VU (e.g. no card is inserted, generation 1 type of VU data download requested outside the frame of a driver’s control by a non EU control authority…).</dd></dl>
<p>▼B</p>
<p>2.2.3   <strong>Message flow</strong>
            </p>
<p>A typical message flow during a normal data download procedure is the following:</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>IDE</td>
                        <td></td>
                        <td>VU</td>
                     </tr>
                     <tr>
                        <td>Start Communication Request</td>
                        <td>⇨</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Positive Response</td>
                     </tr>
                     <tr>
                        <td>Start Diagnostic Service Request</td>
                        <td>⇨</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Positive Response</td>
                     </tr>
                     <tr>
                        <td>Request Upload</td>
                        <td>⇨</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Positive Response</td>
                     </tr>
                     <tr>
                        <td>Transfer Data Request Overview</td>
                        <td>⇨</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Positive Response</td>
                     </tr>
                     <tr>
                        <td>Transfer Data Request #2</td>
                        <td>⇨</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Positive Response #1</td>
                     </tr>
                     <tr>
                        <td>Acknowledge Sub Message #1</td>
                        <td>⇨</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Positive Response #2</td>
                     </tr>
                     <tr>
                        <td>Acknowledge Sub Message #2</td>
                        <td>⇨</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Positive Response #m</td>
                     </tr>
                     <tr>
                        <td>Acknowledge Sub Message #m</td>
                        <td>⇨</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Positive Response (Data Field &lt; 255 Bytes)</td>
                     </tr>
                     <tr>
                        <td>Acknowledge Sub Message (optional)</td>
                        <td>⇨</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>…</td>
                     </tr>
                     <tr>
                        <td>Transfer Data Request #n</td>
                        <td>⇨</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Positive Response</td>
                     </tr>
                     <tr>
                        <td>Request Transfer Exit</td>
                        <td>⇨</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Positive Response</td>
                     </tr>
                     <tr>
                        <td>Stop Communication Request</td>
                        <td>⇨</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Positive Response</td>
                     </tr>
                  </tbody>
               </table>
<p>2.2.4   <strong>Timing</strong>
            </p>
<p>DDP_019 During normal operation the timing parameters shown in the following figure are relevant:</p>
<p>
               <em>Figure 1</em>
            </p>
<p>
               <strong>Message flow, timing</strong>
            </p>
<p>Where:</p>
<table>
               <tbody><tr>
                  <td>P1</td>
                  <td>=</td>
                  <td>Inter byte time for VU response.</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>P2</td>
                  <td>=</td>
                  <td>Time between end of IDE request and start of VU response, or between end of IDE acknowledge and start of next VU response.</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>P3</td>
                  <td>=</td>
                  <td>Time between end of VU response and start of new IDE request, or between end of VU response and start of IDE acknowledge, or between end of IDE request and start of new IDE request if VU fails to respond.</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>P4</td>
                  <td>=</td>
                  <td>Inter byte time for IDE request.</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>P5</td>
                  <td>=</td>
                  <td>Extended value of P3 for card downloading.</td>
               </tr>
            </tbody></table>
<p>The allowed values for the timing parameters are showed in the following table (KWP extended timing parameters set, used in case of physical addressing for faster communication).</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Timing Parameter</td>
                        <td>
                           <p>Lower limit</p>
                           <p>Value (ms)</p>
                        </td>
                        <td>
                           <p>Upper limit</p>
                           <p>Value (ms)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>0</td>
                        <td>20</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>20</td>
                        <td>1 000  (*1)</td>
                     </tr>
                     <tr>
                        <td>P3</td>
                        <td>10</td>
                        <td>5 000</td>
                     </tr>
                     <tr>
                        <td>P4</td>
                        <td>5</td>
                        <td>20</td>
                     </tr>
                     <tr>
                        <td>P5</td>
                        <td>10</td>
                        <td>20 minutes</td>
                     </tr>
                     <tr>
                        <td>
                           <div>
                              <a id="E0014">(<sup>*1</sup>)   </a>
                              <p>If the VU responds with a Negative Response containing a code meaning ‘request correctly received, response pending’, this value is extended to the same upper limit value of P3.</p>
                           </div>
                        </td>
                     </tr>
                  </tbody>
               </table>
<p>2.2.5   <strong>Error handling</strong>
            </p>
<p>If an error occurs during the message exchange, the message flow scheme is modified depending on which equipment has detected the error and on the message generating the error.</p>
<p>In figure 2 and figure 3 the error handling procedures for the VU and the IDE are respectively shown.</p>
<p>2.2.5.1   <strong>Start Communication phase</strong>
            </p>
<p>DDP_020 If the IDE detects an error during the Start Communication phase, either by timing or by the bit stream, then it will wait for a period P3 min before issuing again the request.</p>
<p>DDP_021 If the VU detects an error in the sequence coming from the IDE, it shall send no response and wait for another Start Communication Request message within a period P3 max.</p>
<p>2.2.5.2   <strong>Communication phase</strong>
            </p>
<p>Two different error handling areas can be defined:</p>
<dl><dt>1.  DDP_022  DDP_023  DDP_024</dt><dd>
                  <p>
                     <strong>The VU detects an IDE transmission error.</strong>
                  </p>
                  <div>
                     <div>DDP_022</div>
                     <p>For every received message the VU shall detect timing errors, byte format errors (e.g. start and stop bit violations) and frame errors (wrong number of bytes received, wrong checksum byte).</p>
                  </div>
                  <div>
                     <div>DDP_023</div>
                     <p>If the VU detects one of the above errors, then it sends no response and ignores the message received.</p>
                  </div>
                  <div>
                     <div>DDP_024</div>
                     <p>The VU may detect other errors in the format or content of the received message (e.g. message not supported) even if the message satisfies the length and checksum requirements; in such a case, the VU shall respond to the IDE with a Negative Response message specifying the nature of the error.</p>
                  </div>
                  <p> 
                     ▼M3 
                      
                     <em>Figure 2</em> 
                      
                     <strong>VU error handling</strong> 
                     
                      
                     ▼B 
                  </p>
               </dd><dt>2.  DDP_025  DDP_026  DDP_027  DDP_028</dt><dd>
                  <p>
                     <strong>The IDE detects a VU transmission error.</strong>
                  </p>
                  <div>
                     <div>DDP_025</div>
                     <p>For every received message the IDE shall detect timing errors, byte format errors (e.g. start and stop bit violations) and frame errors (wrong number of bytes received, wrong checksum byte).</p>
                  </div>
                  <div>
                     <div>DDP_026</div>
                     <p>The IDE shall detect sequence errors, e.g. incorrect sub message counter increments in successive received messages.</p>
                  </div>
                  <div>
                     <div>DDP_027</div>
                     <p>If the IDE detects an error or there was no response from the VU within a P2 max period, the request message will be sent again for a maximum of three transmissions in total. For the purposes of this error detection a sub message acknowledge will be considered as a request to the VU.</p>
                  </div>
                  <div>
                     <div>DDP_028</div>
                     <p>The IDE shall wait at least for a period of P3 min before beginning each transmission; the wait period shall be measured from the last calculated occurrence of a stop bit after the error was detected.</p>
                  </div>
                  <p> 
                     <em>Figure 3</em> 
                      
                     <strong>IDE error handling</strong> 
                     
                  </p>
               </dd></dl>

<p>2.2.6   <strong>Response Message content</strong>
            </p>
<p>This paragraph specifies the content of the data fields of the various positive response messages.</p>
<p>Data elements are defined in Appendix 1 data dictionary.</p>
<p>Remark: For generation 2 downloads, each top-level data element is represented by a record array, even if it contains only one record. A record array starts with a header; this header contains the record type, the record size and the number of records. Record arrays are named by ‘…RecordArray’ (with header) in the following tables.</p>
<p>▼M3</p>
<p>2.2.6.1   <strong>Positive Response Transfer Data Download Interface Version</strong>
            </p>
<p>DDP_028a The data field of the ‘Positive Response Transfer Data Download Interface Version’ message shall provide the following data in the following order under the SID 76 Hex, the TREP 00 Hex:</p>
<p>Data structure generation 2, version 2 (TREP 00 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>DownloadInterfaceVersion</td>
                        <td></td>
                        <td>
                           <p>Generation and version of the VU: 02,02 Hex for Generation 2, version 2.</p>
                           <p>Not supported by Generation 1 and Generation 2, version 1 VU, which shall respond negatively (Sub function not supported, see DDP_018)</p>
                        </td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>2.2.6.2   <strong>Positive Response Transfer Data Overview</strong>
            </p>
<p>DDP_029 The data field of the ‘Positive Response Transfer Data Overview’ message shall provide the following data in the following order under the SID 76 Hex, the TREP 01, 21 or 31 Hex and appropriate sub message splitting and counting:</p>
<p>Data structure generation 1 (TREP 01 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>MemberStateCertificate</td>
                        <td></td>
                        <td>VU Security certificates</td>
                     </tr>
                     <tr>
                        <td>VUCertificate</td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>VehicleIdentificationNumber</td>
                        <td></td>
                        <td>Vehicle identification</td>
                     </tr>
                     <tr>
                        <td>VehicleRegistrationIdentification</td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>CurrentDateTime</td>
                        <td></td>
                        <td>VU current date and time</td>
                     </tr>
                     <tr>
                        <td>VuDownloadablePeriod</td>
                        <td></td>
                        <td>Downloadable period</td>
                     </tr>
                     <tr>
                        <td>CardSlotsStatus</td>
                        <td></td>
                        <td>Type of cards inserted in the VU</td>
                     </tr>
                     <tr>
                        <td>VuDownloadActivityData</td>
                        <td></td>
                        <td>Previous VU download</td>
                     </tr>
                     <tr>
                        <td>VuCompanyLocksData</td>
                        <td></td>
                        <td>All company locks stored. If the section is empty, only noOfLocks = 0 is sent.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>VuControlActivityData</td>
                        <td></td>
                        <td>All control records stored in the VU. If the section is empty, only noOfControls = 0 is sent</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>Signature</td>
                        <td></td>
                        <td>RSA signature of all data (except certificates) starting from VehicleIdentificationNumber down to last byte of last VuControlActivityData.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>Data structure generation 2, version 1 (TREP 21 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>MemberStateCertificateRecordArray</td>
                        <td></td>
                        <td>Member state certificate</td>
                     </tr>
                     <tr>
                        <td>VUCertificateRecordArray</td>
                        <td></td>
                        <td>VU certificate</td>
                     </tr>
                     <tr>
                        <td>VehicleIdentificationNumberRecordArray</td>
                        <td></td>
                        <td>Vehicle identification</td>
                     </tr>
                     <tr>
                        <td>VehicleRegistrationIdentificationRecordArray</td>
                        <td></td>
                        <td>Vehicle registration number</td>
                     </tr>
                     <tr>
                        <td>CurrentDateTimeRecordArray</td>
                        <td></td>
                        <td>VU current date and time</td>
                     </tr>
                     <tr>
                        <td>VuDownloadablePeriodRecordArray</td>
                        <td></td>
                        <td>Downloadable period</td>
                     </tr>
                     <tr>
                        <td>CardSlotsStatusRecordArray</td>
                        <td></td>
                        <td>Type of cards inserted in the VU</td>
                     </tr>
                     <tr>
                        <td>VuDownloadActivityDataRecordArray</td>
                        <td></td>
                        <td>Previous VU download</td>
                     </tr>
                     <tr>
                        <td>VuCompanyLocksRecordArray</td>
                        <td></td>
                        <td>All company locks stored. If the section is empty, an array header with noOfRecords = 0 is sent</td>
                     </tr>
                     <tr>
                        <td>VuControlActivityRecordArray</td>
                        <td></td>
                        <td>All control records stored in the VU. If the section is empty, an array header with noOfRecords = 0 is sent</td>
                     </tr>
                     <tr>
                        <td>SignatureRecordArray</td>
                        <td></td>
                        <td>ECC signature of all preceding data except the certificates.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>Data structure generation 2, version 2 (TREP 31 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>MemberStateCertificateRecordArray</td>
                        <td></td>
                        <td>Member state certificate</td>
                     </tr>
                     <tr>
                        <td>VUCertificateRecordArray</td>
                        <td></td>
                        <td>VU certificate</td>
                     </tr>
                     <tr>
                        <td>VehicleIdentificationNumberRecordArray</td>
                        <td></td>
                        <td>Vehicle identification</td>
                     </tr>
                     <tr>
                        <td>VehicleRegistrationNumberRecordArray</td>
                        <td></td>
                        <td>Vehicle registration number</td>
                     </tr>
                     <tr>
                        <td>CurrentDateTimeRecordArray</td>
                        <td></td>
                        <td>VU current date and time</td>
                     </tr>
                     <tr>
                        <td>VuDownloadablePeriodRecordArray</td>
                        <td></td>
                        <td>Downloadable period</td>
                     </tr>
                     <tr>
                        <td>CardSlotsStatusRecordArray</td>
                        <td></td>
                        <td>Type of cards inserted in the VU</td>
                     </tr>
                     <tr>
                        <td>VuDownloadActivityDataRecordArray</td>
                        <td></td>
                        <td>Previous VU download</td>
                     </tr>
                     <tr>
                        <td>VuCompanyLocksRecordArray</td>
                        <td></td>
                        <td>All company locks stored. If the section is empty, an array header with noOfRecords = 0 is sent</td>
                     </tr>
                     <tr>
                        <td>VuControlActivityRecordArray</td>
                        <td></td>
                        <td>All control records stored in the VU. If the section is empty, an array header with noOfRecords = 0 is sent</td>
                     </tr>
                     <tr>
                        <td>SignatureRecordArray</td>
                        <td></td>
                        <td>ECC signature of all preceding data except the certificates.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>2.2.6.3   <strong>Positive Response Transfer Data Activities</strong>
            </p>
<p>DDP_030 The data field of the ‘Positive Response Transfer Data Activities’ message shall provide the following data in the following order under the SID 76 Hex, the TREP 02, 22 or 32 Hex and appropriate sub message splitting and counting:</p>
<p>Data structure generation 1 (TREP 02 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>TimeReal</td>
                        <td></td>
                        <td>Date of day downloaded</td>
                     </tr>
                     <tr>
                        <td>OdometerValueMidnight</td>
                        <td></td>
                        <td>Odometer at end of downloaded day</td>
                     </tr>
                     <tr>
                        <td>VuCardIWData</td>
                        <td></td>
                        <td>
                           <p>Cards insertion withdrawal cycles data.</p>
                           <p>— If this section contains no available data, only noOfVuCardIWRecords = 0 is sent.</p>
                           <p>— When a VuCardIWRecord lies across 00:00 (card insertion on previous day) or across 24:00 (card withdrawal the following day) it shall appear in full within the two days involved.</p>
                        </td>
                     </tr>
                     <tr>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                     </tr>
                     <tr>
                        <td>VuActivityDailyData</td>
                        <td></td>
                        <td>Slots status at 00:00 and activity changes recorded for the day downloaded.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>VuPlaceDailyWorkPeriodData</td>
                        <td></td>
                        <td>Places related data recorded for the day downloaded. If the section is empty, only noOfPlaceRecords = 0 is sent.</td>
                     </tr>
                     <tr>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                     </tr>
                     <tr>
                        <td>VuSpecificConditionData</td>
                        <td></td>
                        <td>Specific conditions data recorded for the day downloaded. If the section is empty, only noOfSpecificConditionRecords=0 is sent</td>
                     </tr>
                     <tr>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                     </tr>
                     <tr>
                        <td>Signature</td>
                        <td></td>
                        <td>RSA signature of all data starting from TimeReal down to last byte of last specific condition record.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>Data structure generation 2, version 1 (TREP 22 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>DateOfDayDownloadedRecordArray</td>
                        <td></td>
                        <td>Date of day downloaded</td>
                     </tr>
                     <tr>
                        <td>OdometerValueMidnightRecordArray</td>
                        <td></td>
                        <td>Odometer at end of downloaded day</td>
                     </tr>
                     <tr>
                        <td>VuCardIWRecordArray</td>
                        <td></td>
                        <td>
                           <p>Cards insertion withdrawal cycles data.</p>
                           <p>— If this section contains no available data, an array header with noOfRecords = 0 is sent.</p>
                           <p>— When a VuCardIWRecord lies across 00:00 (card insertion on previous day) or across 24:00 (card withdrawal the following day) it shall appear in full within the two days involved.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>VuActivityDailyRecordArray</td>
                        <td></td>
                        <td>Slots status at 00:00 and activity changes recorded for the day downloaded.</td>
                     </tr>
                     <tr>
                        <td>VuPlaceDailyWorkPeriodRecordArray</td>
                        <td></td>
                        <td>Places related data recorded for the day downloaded. If the section is empty, an array header with noOfRecords = 0 is sent.</td>
                     </tr>
                     <tr>
                        <td>VuGNSSADRecordArray</td>
                        <td></td>
                        <td>GNSS positions of the vehicle if the accumulated driving time of the vehicle reaches a multiple of three hours. If the section is empty, an array header with noOfRecords = 0 is sent.</td>
                     </tr>
                     <tr>
                        <td>VuSpecificConditionRecordArray</td>
                        <td></td>
                        <td>Specific conditions data recorded for the day downloaded. If the section is empty, an array header with noOfRecords =0 is sent</td>
                     </tr>
                     <tr>
                        <td>SignatureRecordArray</td>
                        <td></td>
                        <td>ECC signature of all preceding data.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>Data structure generation 2, version 2 (TREP 32 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>DateOfDayDownloadedRecordArray</td>
                        <td></td>
                        <td>Date of day downloaded</td>
                     </tr>
                     <tr>
                        <td>OdometerValueMidnightRecordArray</td>
                        <td></td>
                        <td>Odometer at end of downloaded day</td>
                     </tr>
                     <tr>
                        <td>VuCardIWRecordArray</td>
                        <td></td>
                        <td>
                           <p>Cards insertion withdrawal cycles data.</p>
                           <p>— If this section contains no available data, an array header with noOfRecords = 0 is sent.</p>
                           <p>— When a VuCardIWRecord lies across 00:00 (card insertion on previous day) or across 24:00 (card withdrawal the following day) it shall appear in full within the two days involved.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>VuActivityDailyRecordArray</td>
                        <td></td>
                        <td>Slots status at 00:00 and activity changes recorded for the day downloaded.</td>
                     </tr>
                     <tr>
                        <td>VuPlaceDailyWorkPeriodRecordArray</td>
                        <td></td>
                        <td>Places related data recorded for the day downloaded. If the section is empty, an array header with noOfRecords = 0 is sent.</td>
                     </tr>
                     <tr>
                        <td>VuGNSSADRecordArray</td>
                        <td></td>
                        <td>GNSS positions of the vehicle if the accumulated driving time of the vehicle reaches a multiple of three hours. If the section is empty, an array header with noOfRecords = 0 is sent.</td>
                     </tr>
                     <tr>
                        <td>VuSpecificConditionRecordArray</td>
                        <td></td>
                        <td>Specific conditions data recorded for the day downloaded. If the section is empty, an array header with noOfRecords =0 is sent</td>
                     </tr>
                     <tr>
                        <td>VuBorderCrossingRecordArray</td>
                        <td></td>
                        <td>Border crossings for the day downloaded. If the section is empty, an array header with noOfRecords = 0 is sent.</td>
                     </tr>
                     <tr>
                        <td>VuLoadUnloadRecordArray</td>
                        <td></td>
                        <td>Load/unload operations for the day downloaded. If the section is empty, an array header with noOfRecords = 0 is sent.</td>
                     </tr>
                     <tr>
                        <td>SignatureRecordArray</td>
                        <td></td>
                        <td>ECC signature of all preceding data.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>2.2.6.4   <strong>Positive Response Transfer Data Events and Faults</strong>
            </p>
<p>DDP_031 The data field of the ‘Positive Response Transfer Data Events and Faults’ message shall provide the following data in the following order under the SID 76 Hex, the TREP 03, 23 or 33 Hex and appropriate sub message splitting and counting:</p>
<p>Data structure generation 1, (TREP 03 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>VuFaultData</td>
                        <td></td>
                        <td>
                           <p>All faults stored or on-going in the VU.</p>
                           <p>If the section is empty, only noOfVuFaults = 0 is sent.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>VuEventData</td>
                        <td></td>
                        <td>
                           <p>All events (except over speeding) stored or on-going in the VU.</p>
                           <p>If the section is empty, only noOfVuEvents = 0 is sent.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>VuOverSpeedingControlData</td>
                        <td></td>
                        <td>Data related to last over speeding control (default value if no data).</td>
                     </tr>
                     <tr>
                        <td>VuOverSpeedingEventData</td>
                        <td></td>
                        <td>
                           <p>All over speeding events stored in the VU.</p>
                           <p>If the section is empty, only noOfVuOverSpeedingEvents = 0 is sent.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>VuTimeAdjustmentData</td>
                        <td></td>
                        <td>
                           <p>All time adjustment events stored in the VU (outside the frame of a full calibration).</p>
                           <p>If the section is empty, only noOfVuTimeAdjRecords = 0 is sent.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>Signature</td>
                        <td></td>
                        <td>RSA signature of all data starting from noOfVuFaults down to last byte of last time adjustment record</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>Data structure generation 2, version 1 (TREP 23 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>VuFaultRecordArray</td>
                        <td></td>
                        <td>
                           <p>All faults stored or on-going in the VU.</p>
                           <p>If the section is empty, an array header with noOfRecords = 0 is sent.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>VuEventRecordArray</td>
                        <td></td>
                        <td>
                           <p>All events (except over speeding) stored or on-going in the VU.</p>
                           <p>If the section is empty, an array header with noOfRecords = 0 is sent.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>VuOverSpeedingControlDataRecordArray</td>
                        <td></td>
                        <td>Data related to last over speeding control (default value if no data).</td>
                     </tr>
                     <tr>
                        <td>VuOverSpeedingEventRecordArray</td>
                        <td></td>
                        <td>
                           <p>All over speeding events stored in the VU.</p>
                           <p>If the section is empty, an array header with noOfRecords = 0 is sent.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>VuTimeAdjustmentRecordArray</td>
                        <td></td>
                        <td>
                           <p>All time adjustment events stored in the VU (outside the frame of a full calibration).</p>
                           <p>If the section is empty, an array header with noOfRecords = 0 is sent.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>SignatureRecordArray</td>
                        <td></td>
                        <td>ECC signature of all preceding data.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>Data structure generation 2, version 2 (TREP 33 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>VuFaultRecordArray</td>
                        <td></td>
                        <td>
                           <p>All faults stored or on-going in the VU.</p>
                           <p>If the section is empty, an array header with noOfRecords = 0 is sent.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>VuEventRecordArray</td>
                        <td></td>
                        <td>
                           <p>All events (except over speeding) stored or on-going in the VU.</p>
                           <p>If the section is empty, an array header with noOfRecords = 0 is sent.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>VuOverSpeedingControlDataRecordArray</td>
                        <td></td>
                        <td>Data related to last over speeding control (default value if no data).</td>
                     </tr>
                     <tr>
                        <td>VuOverSpeedingEventRecordArray</td>
                        <td></td>
                        <td>
                           <p>All over speeding events stored in the VU.</p>
                           <p>If the section is empty, an array header with noOfRecords = 0 is sent.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>VuTimeAdjustmentRecordArray</td>
                        <td></td>
                        <td>
                           <p>All time adjustment events stored in the VU (outside the frame of a full calibration).</p>
                           <p>If the section is empty, an array header with noOfRecords = 0 is sent.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>SignatureRecordArray</td>
                        <td></td>
                        <td>ECC signature of all preceding data.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>2.2.6.5   <strong>Positive Response Transfer Data Detailed Speed</strong>
            </p>
<p>DDP_032 The data field of the ‘Positive Response Transfer Data Detailed Speed’ message shall provide the following data in the following order under the SID 76 Hex, the TREP 04 or 24 Hex and appropriate sub message splitting and counting:</p>
<p>Data structure generation 1 (TREP 04 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>VuDetailedSpeedData</td>
                        <td></td>
                        <td>
                           <p>All detailed speed stored in the VU (one speed block per minute during which the vehicle has been moving)</p>
                           <p>60 speed values per minute (one per second).</p>
                        </td>
                     </tr>
                     <tr>
                        <td>Signature</td>
                        <td></td>
                        <td>RSA signature of all data starting from noOfSpeedBlocks down to last byte of last speed block.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>Data structure generation 2 (TREP 24 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>VuDetailedSpeedBlockRecordArray</td>
                        <td></td>
                        <td>
                           <p>All detailed speed stored in the VU (one speed block per minute during which the vehicle has been moving)</p>
                           <p>60 speed values per minute (one per second).</p>
                        </td>
                     </tr>
                     <tr>
                        <td>SignatureRecordArray</td>
                        <td></td>
                        <td>ECC signature of all preceding data.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>▼M3</p>
<p>2.2.6.6   <strong>Positive Response Transfer Data Technical Data</strong>
            </p>
<table>
               <tbody><tr>
                  <td>DDP_033</td>
                  <td>The data field of the ‘Positive Response Transfer Data Technical Data’ message shall provide the following data in the following order under the SID 76 Hex, the TREP 05, 25 or 35 Hex and appropriate sub message splitting and counting:</td>
               </tr>
            </tbody></table>
<p>Data structure generation 1 (TREP 05 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>VuIdentification</td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>SensorPaired</td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>VuCalibrationData</td>
                        <td></td>
                        <td>All calibration records stored in the VU.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>Signature</td>
                        <td></td>
                        <td>RSA signature of all data starting from vuManufacturerName down to last byte of last VuCalibrationRecord.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>Data structure generation 2, version 1 (TREP 25 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>VuIdentificationRecordArray</td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>VuSensorPairedRecordArray</td>
                        <td></td>
                        <td>All MS pairings stored in the VU</td>
                     </tr>
                     <tr>
                        <td>VuSensorExternalGNSSCoupledRecordArray</td>
                        <td></td>
                        <td>All external GNSS facility couplings stored in the VU</td>
                     </tr>
                     <tr>
                        <td>VuCalibrationRecordArray</td>
                        <td></td>
                        <td>All calibration records stored in the VU.</td>
                     </tr>
                     <tr>
                        <td>VuCardRecordArray</td>
                        <td></td>
                        <td>All card insertion data stored in the VU.</td>
                     </tr>
                     <tr>
                        <td>VuITSConsentRecordArray</td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>VuPowerSupplyInterruptionRecordArray</td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>SignatureRecordArray</td>
                        <td></td>
                        <td>ECC signature of all preceding data.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>Data structure generation 2, version 2 (TREP 35 Hex)</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Data element</td>
                        <td></td>
                        <td>Comment</td>
                     </tr>
                     <tr>
                        <td>VuIdentificationRecordArray</td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>VuSensorPairedRecordArray</td>
                        <td></td>
                        <td>All MS pairings stored in the VU</td>
                     </tr>
                     <tr>
                        <td>VuSensorExternalGNSSCoupledRecordArray</td>
                        <td></td>
                        <td>All external GNSS facility couplings stored in the VU</td>
                     </tr>
                     <tr>
                        <td>VuCalibrationRecordArray</td>
                        <td></td>
                        <td>All calibration records stored in the VU.</td>
                     </tr>
                     <tr>
                        <td>VuCardRecordArray</td>
                        <td></td>
                        <td>All card insertion data stored in the VU.</td>
                     </tr>
                     <tr>
                        <td>VuITSConsentRecordArray</td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>VuPowerSupplyInterruptionRecordArray</td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>SignatureRecordArray</td>
                        <td></td>
                        <td>ECC signature of all preceding data.</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>
<p>2.3.   <strong>ESM File storage</strong>
            </p>
<p>DDP_034 When a download session has included a VU data transfer, the IDE shall store within one single physical file all data received from the VU during the download session within Positive Response Transfer Data messages. Data stored excludes message headers, sub-message counters, empty sub-messages and checksums but include the SID and TREP (of the first sub-message only if several sub-messages).</p>
<p>3.   <strong>TACHOGRAPH CARDS DOWNLOADING PROTOCOL</strong>
            </p>
<p>3.1.   <strong>Scope</strong>
            </p>
<p>This paragraph describes the direct card data downloading of a tachograph card to an IDE. The IDE is not part of the secure environment; therefore no authentication between the card and the IDE is performed.</p>
<p>3.2.   <strong>Definitions</strong>
            </p>
<table>
               <tbody><tr>
                  <td>Download session</td>
                  <td>:</td>
                  <td>Each time a download of the ICC data is performed. The session covers the complete procedure from the reset of the ICC by an IFD until the deactivation of the ICC (withdraw of the card or next reset).</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>Signed Data File</td>
                  <td>:</td>
                  <td>A file from the ICC. The file is transferred to the IFD in plain text. On the ICC the file is hashed and signed and the signature is transferred to the IFD.</td>
               </tr>
            </tbody></table>
<p>3.3.   <strong>Card Downloading</strong>
            </p>
<p>▼M3</p>
<p>DDP_035 The download of a tachograph card includes the following steps:</p>
<dl><dt>—</dt><dd>Download the common information of the card in the EFs ICC and IC. This information is optional and is not secured with a digital signature.</dd><dt>—  —  —  —  —  —</dt><dd>
                  <div>For first and second generation tachograph cards</div>
                  <div>
                     <div>
                        <div>—</div>
                        <div>
                           <div>Download EFs within Tachograph DF:</div>
                           <div>
                              <div>
                                 <div>—</div>
                                 <div>
                                    <div>Download the EFs Card_Certificate and CA_Certificate. This information is not secured with a digital signature.</div>
                                    <div>It is mandatory to download these files for each download session.</div>
                                 </div>
                              </div>
                              <div>
                                 <div>—</div>
                                 <div>
                                    <div>Download the other application data EFs (within Tachograph DF) except EF Card_Download. This information is secured with a digital signature, using Appendix 11 Common Security Mechanisms Part A.</div>
                                 </div>
                              </div>
                              <div>
                                 <div>—</div>
                                 <div>
                                    <div>It is mandatory to download at least the EFs Application_Identification and Identification for each download session.</div>
                                 </div>
                              </div>
                              <div>
                                 <div>—</div>
                                 <div>
                                    <div>When downloading a driver card it is also mandatory to download the following EFs:</div>
                                    <div>
                                       <div>Events_Data,</div>
                                       <div>Faults_Data,</div>
                                       <div>Driver_Activity_Data,</div>
                                       <div>Vehicles_Used,</div>
                                       <div>Places,</div>
                                       <div>Control_Activity_Data,</div>
                                       <div>Specific_Conditions.</div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </dd><dt>—  —  —  —  —  —  —  —  —  —</dt><dd>
                  <div>For second generation tachograph cards only:</div>
                  <div>
                     <div>
                        <div>—</div>
                        <div>
                           <div>Except when a download of a driver card inserted in a VU is performed during drivers&#39; control by a non EU control authority, using a first generation control card, download EFs within Tachograph_G2 DF:</div>
                           <div>
                              <div>
                                 <div>—</div>
                                 <div>
                                    <div>Download the EFs CardSignCertificate, CA_Certificate and Link_Certificate. This information is not secured with a digital signature.</div>
                                 </div>
                              </div>
                              <div>
                                 <div>—</div>
                                 <div>
                                    <div>It is mandatory to download these files for each download session.</div>
                                 </div>
                              </div>
                              <div>
                                 <div>—</div>
                                 <div>
                                    <div>Download the other application data EFs (within Tachograph_G2 DF) except EF Card_Download. This information is secured with a digital signature, using Appendix 11 Common Security Mechanisms Part B.</div>
                                 </div>
                              </div>
                              <div>
                                 <div>—</div>
                                 <div>
                                    <div>It is mandatory to download at least the EFs Application_Identification, Application_Identification_V2 (if present) and Identification for each download session.</div>
                                 </div>
                              </div>
                              <div>
                                 <div>—</div>
                                 <div>
                                    <div>When downloading a driver card it is also mandatory to download the following EFs:</div>
                                    <div>
                                       <div>Events_Data,</div>
                                       <div>Faults_Data,</div>
                                       <div>Driver_Activity_Data,</div>
                                       <div>Vehicles_Used,</div>
                                       <div>Places,</div>
                                       <div>Control_Activity_Data,</div>
                                       <div>Specific_Conditions,</div>
                                       <div>VehicleUnits_Used,</div>
                                       <div>GNSS_Places,</div>
                                       <div>Places_Authentication, if present,</div>
                                       <div>GNSS_Places_Authentication, if present,</div>
                                       <div>Border_Crossings, if present,</div>
                                       <div>Load_Unload_Operations, if present,</div>
                                       <div>Load_Type_Entries, if present.</div>
                                    </div>
                                 </div>
                              </div>
                              <div>
                                 <div>—</div>
                                 <div>
                                    <div>When downloading a driver card, update the LastCardDownload date in EF Card_Download, in the Tachograph and, if applicable, Tachograph_G2 DFs.</div>
                                 </div>
                              </div>
                              <div>
                                 <div>—</div>
                                 <div>
                                    <div>When downloading a workshop card, reset the calibration counter in EF Card_Download in the Tachograph and, if applicable, Tachograph_G2 DFs.</div>
                                 </div>
                              </div>
                              <div>
                                 <div>—</div>
                                 <div>
                                    <div>When downloading a workshop card the EF Sensor_Installation_Data in the Tachograph and, if applicable, Tachograph_G2 DFs shall not be downloaded.</div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </dd></dl>


<p>▼B</p>
<p>3.3.1   <strong>Initialisation sequence</strong>
            </p>
<p>DDP_036 The IDE shall initiate the sequence as follows:</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Card</td>
                        <td>Direction</td>
                        <td>IDE/IFD</td>
                        <td>Meaning/Remarks</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Hardware reset</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>ATR</td>
                        <td>⇨</td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>It is optional to use PPS to switch to a higher baud rate as long as the ICC supports it.</p>
<p>3.3.2   <strong>Sequence for un-signed data files</strong>
            </p>
<p>DDP_037 
                  
                     
                        ►M1
                     
                   The sequence to download EFs ICC, IC, Card_Certificate (or CardSignCertificate for DF Tachograph_G2), CA_Certificate and Link_Certificate (for DF Tachograph_G2 only) is as follows:<strong>◄</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Card</td>
                        <td>Direction</td>
                        <td>IDE/IFD</td>
                        <td>Meaning/Remarks</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Select File</td>
                        <td>Select by File identifiers</td>
                     </tr>
                     <tr>
                        <td>OK</td>
                        <td>⇨</td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Read Binary</td>
                        <td>If the file contains more data than the buffer size of the reader or the card the command has to be repeated until the complete file is read.</td>
                     </tr>
                     <tr>
                        <td>
                           <p>
                              <strong>File Data</strong>
                           </p>
                           <p>
                              <strong>OK</strong>
                           </p>
                        </td>
                        <td>⇨</td>
                        <td>Store data to ESM</td>
                        <td>according to 3.4 Data storage format</td>
                     </tr>
                  </tbody>
               </table>
<p>
               <em>Note 1:</em> Before selecting the Card_Certificate (or CardSignCertificate) EF, the Tachograph Application must be selected (selection by AID).</p>
<p>
               <em>Note 2:</em> Selecting and reading a file may also be performed in one step using a Read Binary command with a short EF identifier.</p>
<p>3.3.3   <strong>Sequence for Signed data files</strong>
            </p>
<p>DDP_038 The following sequence shall be used for each of the following files that has to be downloaded with their signature:</p>
<p>▼M1</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Card</td>
                        <td>Dir</td>
                        <td>IDE / IFD</td>
                        <td>Meaning / Remarks</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>Select File</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>OK</td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>Perform Hash of File</td>
                        <td>—  Calculates the hash value over the data content of the selected file using the prescribed hash algorithm in accordance with Appendix 11, part A or B. This command is not an ISO-Command.</td>
                     </tr>
                     <tr>
                        <td>Calculate Hash of File and store Hash value temporarily</td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>OK</td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>Read Binary</td>
                        <td>If the file contains more data than the buffer of the reader or the card can hold, the command has to be repeated until the complete file is read.</td>
                     </tr>
                     <tr>
                        <td>
                           <p>
                              <strong>File Data</strong>
                           </p>
                           <p>
                              <strong>OK</strong>
                           </p>
                        </td>
                        <td></td>
                        <td>Store received data to ESM</td>
                        <td>according to 3.4 Data storage format</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>PSO: Compute Digital Signature</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>Perform Security Operation ‘Compute Digital Signature’ using the temporarily stored Hash value</td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>
                           <p>
                              <strong>Signature</strong>
                           </p>
                           <p>
                              <strong>OK</strong>
                           </p>
                        </td>
                        <td></td>
                        <td>Append data to the previous stored data on the ESM</td>
                        <td>according to 3.4 Data storage format</td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>
<p>
               <em>Note:</em> Selecting and reading a file may also be performed in one step using a Read Binary command with a short EF identifier. In this case the EF may be selected and read before the command Perform Hash of File is applied.</p>
<p>3.3.4   <strong>Sequence for resetting the calibration counter.</strong>
            </p>
<p>DDP_039 The sequence to reset the counter in the EF in a workshop card is the following:</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Card</td>
                        <td>Dir</td>
                        <td>IDE/IFD</td>
                        <td>Meaning/Remarks</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>Select File EF Card_Download</td>
                        <td>Select by File identifiers</td>
                     </tr>
                     <tr>
                        <td>OK</td>
                        <td>⇨</td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td>⇦</td>
                        <td>
                           <p>
                              <strong>Update Binary</strong>
                           </p>
                           <p>NoOfCalibrationsSinceDownload = ‘00 00’</p>
                        </td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>resets card download number</td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>OK</td>
                        <td>⇨</td>
                        <td></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
<p>
               <em>Note:</em> Selecting and updating a file may also be performed in one step using an Update Binary command with a short EF identifier.</p>
<p>3.4.   <strong>Data storage format</strong>
            </p>
<p>3.4.1   <strong>Introduction</strong>
            </p>
<p>DDP_040 The downloaded data has to be stored according to the following conditions:</p>
<dl><dt>—</dt><dd>The data shall be stored transparent. This means that the order of the bytes as well as the order of the bits inside the byte that are transferred from the card has to be preserved during storage.</dd><dt>—</dt><dd>All files of the card downloaded within a download session are stored in one file on the ESM.</dd></dl>

<p>3.4.2   <strong>File format</strong>
            </p>
<p>DDP_041 The file format is a concatenation of several TLV objects.</p>
<p>DDP_042 The tag for an EF shall be the FID plus the appendix ‘00’.</p>
<p>DDP_043 The tag of an EF&#39;s signature shall be the FID of the file plus the appendix ‘01’.</p>
<p>DDP_044 The length is a two byte value. The value defines the number of bytes in the value field. The value ‘FF FF’ in the length field is reserved for future use.</p>
<p>DDP_045 When a file is not downloaded nothing related to the file shall be stored (no tag and no zero length).</p>
<p>▼M1</p>
<p>DDP_046 A signature shall be stored as the next TLV object directly after the TLV object that contains the data of the file.</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Definition</td>
                        <td>Meaning</td>
                        <td>Length</td>
                     </tr>
                     <tr>
                        <td>FID (2 Bytes) || ‘00’</td>
                        <td>Tag for EF (FID) in the or for common information of the card</td>
                        <td>3 Bytes</td>
                     </tr>
                     <tr>
                        <td>FID (2 Bytes) || ‘01’</td>
                        <td>Tag for Signature of EF (FID) in the DF</td>
                        <td>3 Bytes</td>
                     </tr>
                     <tr>
                        <td>FID (2 Bytes) || ‘02’</td>
                        <td>Tag for EF (FID) in the DF</td>
                        <td>3 Bytes</td>
                     </tr>
                     <tr>
                        <td>FID (2 Bytes) || ‘03’</td>
                        <td>Tag for Signature of EF (FID) in the DF</td>
                        <td>3 Bytes</td>
                     </tr>
                     <tr>
                        <td>xx xx</td>
                        <td>Length of Value field</td>
                        <td>2 Bytes</td>
                     </tr>
                  </tbody>
               </table>
<p>Example of data in a download file on an ESM:</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Tag</td>
                        <td>Length</td>
                        <td>Value</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>—  Data of EF ICC</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>—  Data of EF Card_Certificate</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>—  …</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>Data of EF (in the DF)</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>Signature of EF (in the DF)</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>Data of EF in the DF</td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>Signature of EF in the DF</td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>
<p>4.   <strong>DOWNLOADING A TACHOGRAPH CARD VIA A VEHICLE UNIT.</strong>
            </p>
<p>DDP_047 The VU must allow for downloading the content of a driver card inserted to a connected IDE.</p>
<p>DDP_048 The IDE shall send a ‘Transfer Data Request Card Download’ message to the VU to initiate this mode (see 2.2.2.9).</p>
<p>▼M1</p>
<p>DDP_049 First generation driver cards: Data shall be downloaded using the first generation data download protocol, and downloaded data shall have the same format as data downloaded from a first generation vehicle unit.</p>
<p>Second generation driver cards: the VU shall then download the whole card, file by file, in accordance with the card downloading protocol defined in paragraph 3, and forward all data received from the card to the IDE within the appropriate TLV file format (see 3.4.2) and encapsulated within a ‘Positive Response Transfer Data’ message.</p>
<p>▼B</p>
<p>DDP_050 The IDE shall retrieve card data from the ‘Positive Response Transfer Data’ message (stripping all headers, SIDs, TREPs, sub message counters, and checksums) and store them within one single physical file as described in paragraph 2.3.</p>
<p>DDP_051 The VU shall then, as applicable, update the or the file of the driver card.</p>

</body></html>