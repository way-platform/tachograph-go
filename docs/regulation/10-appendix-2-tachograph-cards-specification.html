<!DOCTYPE html>
<html><head>

      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
      <title>Consolidated TEXT: 32016R0799 — EN — 21.08.2023</title>
      
   
</head>
<body>
<h1>Appendix 2: TACHOGRAPH CARDS SPECIFICATION</h1>

<nav><h2>Table of Contents</h2><ol><li><a href="#introduction">INTRODUCTION</a></li><li><a href="#abbreviations">Abbreviations</a></li><li><a href="#references">References</a></li><li><a href="#electrical-and-physical-characteristics">ELECTRICAL AND PHYSICAL CHARACTERISTICS</a></li><li><a href="#supply-voltage-and-current-consumption">Supply Voltage and Current Consumption</a></li><li><a href="#programming-voltage-vpp">Programming Voltage Vpp</a></li><li><a href="#clock-generation-and-frequency">Clock generation and Frequency</a></li><li><a href="#io-contact">I/O Contact</a></li><li><a href="#states-of-the-card">States of the Card</a></li><li><a href="#hardware-and-communication">HARDWARE AND COMMUNICATION</a></li><li><a href="#introduction">Introduction</a></li><li><a href="#transmission-protocol">Transmission Protocol</a></li><li><a href="#protocols">Protocols</a></li><li><a href="#atr">ATR</a></li><li><a href="#pts">PTS</a></li><li><a href="#access-rules">Access Rules</a></li><li><a href="#commands-and-error-codes-overview">Commands and error codes overview</a></li><li><a href="#command-descriptions">Command descriptions</a></li><li><a href="#select">SELECT</a></li><li><a href="#read-binary">READ BINARY</a></li><li><a href="#update-binary">UPDATE BINARY</a></li><li><a href="#get-challenge">GET CHALLENGE</a></li><li><a href="#verify">VERIFY</a></li><li><a href="#get-response">GET RESPONSE</a></li><li><a href="#pso-verify-certificate">PSO: VERIFY CERTIFICATE</a></li><li><a href="#internal-authenticate">INTERNAL AUTHENTICATE</a></li><li><a href="#external-authenticate">EXTERNAL AUTHENTICATE</a></li><li><a href="#general-authenticate">GENERAL AUTHENTICATE</a></li><li><a href="#manage-security-environment">MANAGE SECURITY ENVIRONMENT</a></li><li><a href="#pso-hash">PSO: HASH</a></li><li><a href="#perform-hash-of-file">PERFORM HASH OF FILE</a></li><li><a href="#pso-compute-digital-signature">PSO: COMPUTE DIGITAL SIGNATURE</a></li><li><a href="#pso-verify-digital-signature">PSO: VERIFY DIGITAL SIGNATURE</a></li><li><a href="#process-dsrc-message">PROCESS DSRC MESSAGE</a></li><li><a href="#tachograph-cards-structure">TACHOGRAPH CARDS STRUCTURE</a></li><li><a href="#master-file-mf">Master File MF</a></li><li><a href="#driver-card-applications">Driver card applications</a></li><li><a href="#driver-card-application-generation-1">Driver card application generation 1</a></li><li><a href="#driver-card-application-generation-2">Driver card application generation 2</a></li><li><a href="#workshop-card-applications">Workshop card applications</a></li><li><a href="#workshop-card-application-generation-1">Workshop card application generation 1</a></li><li><a href="#workshop-card-application-generation-2">Workshop card application generation 2</a></li><li><a href="#control-card-applications">Control card applications</a></li><li><a href="#control-card-application-generation-1">Control Card application generation 1</a></li><li><a href="#control-card-application-generation-2">Control card application generation 2</a></li><li><a href="#company-card-applications">Company card applications</a></li><li><a href="#company-card-application-generation-1">Company card application generation 1</a></li><li><a href="#company-card-application-generation-2">Company card application generation 2</a></li></ol></nav>
<p>1.   <strong>INTRODUCTION</strong>
            </p>
<p>1.1.   <strong>Abbreviations</strong>
            </p>
<p>For the purpose of this appendix, the following abbreviations apply.</p>
<table>
               <tbody><tr>
                  <td>AC</td>
                  <td>Access conditions</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>AES</td>
                  <td>Advanced Encryption Standard</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>AID</td>
                  <td>Application Identifier</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>ALW</td>
                  <td>Always</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>APDU</td>
                  <td>Application Protocol Data Unit (structure of a command)</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>ATR</td>
                  <td>Answer To Reset</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>AUT</td>
                  <td>Authenticated.</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>C6, C7</td>
                  <td>Contacts No 6 and 7 of the card as described in ISO/IEC 7816-2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>cc</td>
                  <td>clock cycles</td>
               </tr>
            </tbody></table>
<p>▼M1</p>
<table>
               <tbody><tr>
                  <td>CHA</td>
                  <td>Certificate Holder Authorisation</td>
               </tr>
            </tbody></table>
<p>▼B</p>
<table>
               <tbody><tr>
                  <td>CHV</td>
                  <td>Card holder Verification Information</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>CLA</td>
                  <td>Class byte of an APDU command</td>
               </tr>
            </tbody></table>
<p>▼M1</p>
<table>
               <tbody><tr>
                  <td>DO</td>
                  <td>Data Object</td>
               </tr>
            </tbody></table>
<p>▼B</p>
<table>
               <tbody><tr>
                  <td>DSRC</td>
                  <td>Dedicated Short Range Communication</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>DF</td>
                  <td>Dedicated File. A DF can contain other files (EF or DF)</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>ECC</td>
                  <td>Elliptic Curve Cryptography</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>EF</td>
                  <td>Elementary File</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>etu</td>
                  <td>elementary time unit</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>G1</td>
                  <td>Generation 1</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>G2</td>
                  <td>Generation 2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>IC</td>
                  <td>Integrated Circuit</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>ICC</td>
                  <td>Integrated Circuit Card</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>ID</td>
                  <td>Identifier</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>IFD</td>
                  <td>Interface Device</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>IFS</td>
                  <td>Information Field Size</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>IFSC</td>
                  <td>Information Field Size for the card</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>IFSD</td>
                  <td>Information Field Size Device (for the Terminal)</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>INS</td>
                  <td>Instruction byte of an APDU command</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>Lc</td>
                  <td>Length of the input data for a APDU command</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>Le</td>
                  <td>Length of the expected data (output data for a command)</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>MF</td>
                  <td>Master File (root DF)</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>NAD</td>
                  <td>Node Address used in T=1 protocol</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>NEV</td>
                  <td>Never</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>P1-P2</td>
                  <td>Parameter bytes</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>PIN</td>
                  <td>Personal Identification Number</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>PRO SM</td>
                  <td>Protected with secure messaging</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>PTS</td>
                  <td>Protocol Transmission Selection</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>RFU</td>
                  <td>Reserved for Future Use</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>RST</td>
                  <td>Reset (of the card)</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SFID</td>
                  <td>Short EF Identifier</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SM</td>
                  <td>Secure Messaging</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SW1-SW2</td>
                  <td>Status bytes</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>TS</td>
                  <td>Initial ATR character</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>VPP</td>
                  <td>Programming Voltage</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>VU</td>
                  <td>Vehicle Unit</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>XXh</td>
                  <td>Value XX in hexadecimal notation</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>‘XXh’</td>
                  <td>Value XX in hexadecimal notation</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>||</td>
                  <td>Concatenation symbol 03||04=0304</td>
               </tr>
            </tbody></table>
<p>1.2.   <strong>References</strong>
            </p>
<p>The following references are used in this Appendix:</p>
<table>
               <tbody><tr>
                  <td>ISO/IEC 7816-2</td>
                  <td>Identification cards — Integrated circuit cards — Part 2: Dimensions and location of the contacts. ISO/IEC 7816-2:2007.</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>ISO/IEC 7816-3</td>
                  <td>Identification cards — Integrated circuit cards — Part 3: Electrical interface and transmission protocols. ISO/IEC 7816-3:2006.</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>ISO/IEC 7816-4</td>
                  <td>Identification cards — Integrated circuit cards — Part 4: Organization, security and commands for interchange. ISO/IEC 7816-4:2013 + Cor 1: 2014.</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>ISO/IEC 7816-6</td>
                  <td>Identification cards — Integrated circuit cards — Part 6: Interindustry data elements for interchange. ISO/IEC 7816-6:2004 + Cor 1: 2006.</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>ISO/IEC 7816-8</td>
                  <td>Identification cards — Integrated circuit cards — Part 8: Commands for security operations. ISO/IEC 7816-8:2004.</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>ISO/IEC 9797-2</td>
                  <td>Information technology — Security techniques — Message Authentication Codes (MACs) — Part 2: Mechanisms using a dedicated hash-function. ISO/IEC 9797-2:2011</td>
               </tr>
            </tbody></table>
<p>2.   <strong>ELECTRICAL AND PHYSICAL CHARACTERISTICS</strong>
            </p>
<p>TCS_01 All electronic signals shall be in accordance with ISO/IEC 7816-3 unless specified otherwise.</p>
<p>TCS_02 The location and dimensions of the card contacts shall comply with the ISO/IEC 7816-2.</p>
<p>2.1.   <strong>Supply Voltage and Current Consumption</strong>
            </p>
<p>TCS_03 The card shall work according to specifications within the consumption limits specified in ISO/IEC 7816-3.</p>
<p>TCS_04 The card shall work with Vcc = 3V (± 0,3V) or with Vcc = 5V (± 0,5V).</p>
<p>Voltage selection shall be performed according to ISO/IEC 7816-3.</p>
<p>2.2.   <strong>Programming Voltage Vpp</strong>
            </p>
<p>TCS_05 The card shall not require a programming voltage at pin C6. It is expected that pin C6 is not connected in an IFD. Contact C6 may be connected to V<span>cc</span> in the card but shall not be connected to ground. This voltage should not be interpreted in any case.</p>
<p>2.3.   <strong>Clock generation and Frequency</strong>
            </p>
<p>TCS_06 The card shall operate within a frequency range of 1 to 5 MHz and may support higher frequencies. Within one card session the clock frequency may vary ± 2 %. The clock frequency is generated by the Vehicle Unit and not the card itself. The duty cycle may vary between 40 and 60 %.</p>
<p>TCS_07 Under conditions contained into the card file EF ICC, the external clock can be stopped. The first byte of the EF ICC file body codes the Clockstop mode conditions:</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Low</td>
                        <td>High</td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>Bit 3</td>
                        <td>Bit 2</td>
                        <td>Bit 1</td>
                     </tr>
                     <tr>
                        <td>0</td>
                        <td>0</td>
                        <td>1</td>
                        <td>Clockstop allowed, no preferred level</td>
                     </tr>
                     <tr>
                        <td>0</td>
                        <td>1</td>
                        <td>1</td>
                        <td>Clockstop allowed, high level preferred</td>
                     </tr>
                     <tr>
                        <td>1</td>
                        <td>0</td>
                        <td>1</td>
                        <td>Clockstop allowed, low level preferred</td>
                     </tr>
                     <tr>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td>Clockstop not allowed</td>
                     </tr>
                     <tr>
                        <td>0</td>
                        <td>1</td>
                        <td>0</td>
                        <td>Clockstop only allowed on high level</td>
                     </tr>
                     <tr>
                        <td>1</td>
                        <td>0</td>
                        <td>0</td>
                        <td>Clockstop only allowed on low level</td>
                     </tr>
                  </tbody>
               </table>
<p>Bits 4 to 8 are not used.</p>
<p>2.4.   <strong>I/O Contact</strong>
            </p>
<p>TCS_08 The I/O contact C7 is used to receive data from and to transmit data to the IFD. During operation only either the card or the IFD shall be in transmit mode. Should both units be in transmit mode no damage shall occur to the card. Unless transmitting, the card shall enter the reception mode.</p>
<p>2.5.   <strong>States of the Card</strong>
            </p>
<p>TCS_09 The card works in two states while the supply voltage is applied:</p>
<p>▼M3</p>
<div>Operation state while executing commands or interfacing with Vehicle Unit,</div>
<p>▼B</p>
<div>Idle state at all other times; in this state all data shall be retained by the card.</div>
<p>3.   <strong>HARDWARE AND COMMUNICATION</strong>
            </p>
<p>3.1.   <strong>Introduction</strong>
            </p>
<p>This paragraph describes the minimum functionality required by Tachograph cards and VUs to ensure correct operation and interoperability.</p>
<p>Tachograph cards are as compliant as possible with the available ISO/IEC applicable norms (especially ISO/IEC 7816). However, commands and protocols are fully described in order to specify some restricted usage or some differences if they exist. The commands specified are fully compliant with the referred norms except where indicated.</p>
<p>3.2.   <strong>Transmission Protocol</strong>
            </p>
<p>TCS_10 The Transmission protocol shall be compliant with ISO/IEC 7816-3 for T = 0 and T = 1. In particular, the VU shall recognise waiting time extensions sent by the card.</p>
<p>3.2.1   <strong>Protocols</strong>
            </p>
<p>TCS_11 The card shall provide both protocol <strong>T=0</strong> and protocol <strong>T=1</strong>. In addition the card may support further contact-oriented protocols.</p>
<p>TCS_12 
                  <strong>T=0</strong> is the default protocol, a <strong>PTS</strong> command is therefore necessary to change the protocol to <strong>T=1</strong>.</p>
<p>TCS_13 Devices shall support <strong>direct convention</strong> in both protocols: the direct convention is hence mandatory for the card.</p>
<p>TCS_14 The <strong>Information Field Size Card</strong> byte shall be presented at the ATR in character TA3. This value shall be at least ‘F0h’ (=240 bytes).</p>
<p>The following restrictions apply to the protocols:</p>
<p>TCS_15 
                  <strong>T=0</strong>
               </p>
<dl><dt>—</dt><dd>The interface device shall support an answer on I/O after the rising edge of the signal on RST from 400 cc.</dd><dt>—</dt><dd>The interface device shall be able to read characters separated with 12 etu.</dd><dt>—</dt><dd>The interface device shall read an erroneous character and its repetition if separated with 13 etu. If an erroneous character is detected, the Error signal on I/O can occur between 1 etu and 2 etu. The device shall support a 1 etu delay.</dd><dt>—</dt><dd>The interface device shall accept a 33 bytes ATR (TS+32)</dd><dt>—</dt><dd>If TC1 is present in the ATR, the Extra Guard Time shall be present for characters sent by the interface device although characters sent by the card can still be separated with 12 etu. This is also true for the ACK character sent by the card after a P3 character emitted by the interface device.</dd><dt>—</dt><dd>The interface device shall take into account a NUL character emitted by the card.</dd><dt>—</dt><dd>The interface device shall accept the complementary mode for ACK.</dd><dt>—</dt><dd>The get-response command cannot be used in chaining mode to get a data which length could exceed 255 bytes.</dd></dl>







<p>TCS_16 
                  <strong>T=1</strong>
               </p>
<dl><dt>—</dt><dd>NAD byte: not used (NAD shall be set to ‘00’).</dd><dt>—</dt><dd>S-block ABORT: not used.</dd><dt>—</dt><dd>S-block VPP state error: not used.</dd></dl>


<p>▼M3 —————</p>
<p>▼B</p>
<dl><dt>—</dt><dd>The Information Field Size Device (IFSD) shall be indicated by the IFD immediately after the ATR: the IFD shall transmit the S-Block IFS request after the ATR and the card shall send back S-Block IFS. The recommended value for IFSD is 254 bytes.</dd><dt>—</dt><dd>The card will not ask for an IFS readjustment.</dd></dl>

<p>3.2.2   <strong>ATR</strong>
            </p>
<p>TCS_17 The device checks ATR bytes, according to ISO/IEC 7816-3. No verification shall be done on ATR Historical Characters.</p>
<p>Example of Basic Biprotocol ATR according to ISO/IEC 7816-3</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Character</td>
                        <td>Value</td>
                        <td>Remarks</td>
                     </tr>
                     <tr>
                        <td>TS</td>
                        <td>‘3Bh’</td>
                        <td>Indicates direct convention.</td>
                     </tr>
                     <tr>
                        <td>T0</td>
                        <td>‘85h’</td>
                        <td>TD1 present; 5 historical bytes are presents.</td>
                     </tr>
                     <tr>
                        <td>TD1</td>
                        <td>‘80h’</td>
                        <td>TD2 present; T=0 to be used</td>
                     </tr>
                     <tr>
                        <td>TD2</td>
                        <td>‘11h’</td>
                        <td>TA3 present; T=1 to be used</td>
                     </tr>
                     <tr>
                        <td>TA3</td>
                        <td>‘XXh’ (at least ‘F0h’)</td>
                        <td>Information Field Size Card ( IFSC)</td>
                     </tr>
                     <tr>
                        <td>TH1 to TH5</td>
                        <td>‘XXh’</td>
                        <td>Historical characters</td>
                     </tr>
                     <tr>
                        <td>TCK</td>
                        <td>‘XXh’</td>
                        <td>Check Character (exclusive OR)</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_18 After the Answer To Reset (ATR), the Master File (MF) is implicitly selected and becomes the Current Directory.</p>
<p>3.2.3   <strong>PTS</strong>
            </p>
<p>TCS_19 The default Protocol is T=0. To set the T=1 protocol, a PTS (also known as PPS) must be sent to the card by the device.</p>
<p>TCS_20 As both T=0 and T=1 protocols are mandatory for the card, the basic PTS for protocol switching is mandatory for the card.</p>
<p>The PTS can be used, as indicated in ISO/IEC 7816-3, to switch to higher baud rates than the default one proposed by the card in the ATR if any (TA(1) byte).</p>
<p>Higher baud rates are optional for the card.</p>
<p>TCS_21 If no other baud rate than the default one are supported (or if the selected baud rate is not supported), the card shall respond to the PTS correctly according to ISO/IEC 7816-3 by omitting the PPS1 byte.</p>
<p>Examples of basic PTS for protocol selection are the following:</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Character</td>
                        <td>Value</td>
                        <td>Remarks</td>
                     </tr>
                     <tr>
                        <td>PPSS</td>
                        <td>‘FFh’</td>
                        <td>The Initiate Character.</td>
                     </tr>
                     <tr>
                        <td>PPS0</td>
                        <td>‘00h’ or ‘01h’</td>
                        <td>PPS1 to PPS3 are not present; ‘00h’ to select T0, ‘01h’ to select T1.</td>
                     </tr>
                     <tr>
                        <td>PK</td>
                        <td>‘XXh’</td>
                        <td>Check Character: <p>‘XXh’ = ‘FFh’ if PPS0 = ‘00h’,</p>
                           <p>‘XXh’ = ‘FEh’ if PPS0 = ‘01h’.</p>
                        </td>
                     </tr>
                  </tbody>
               </table>
<p>3.3.   <strong>Access Rules</strong>
            </p>
<p>TCS_22 An access rule specifies for an access mode, i.e. command, the corresponding security conditions. If these security conditions are fulfilled the corresponding command is processed.</p>
<p>TCS_23 The following security conditions are used for the tachograph card:</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Abbreviation</td>
                        <td>Meaning</td>
                     </tr>
                     <tr>
                        <td>ALW</td>
                        <td>The action is always possible and can be executed without any restriction. Command and response APDU are sent in plain text, i.e. without secure messaging.</td>
                     </tr>
                     <tr>
                        <td>NEV</td>
                        <td>The action is never possible.</td>
                     </tr>
                     <tr>
                        <td>PLAIN-C</td>
                        <td>The command APDU is sent in plain, i.e. without secure messaging.</td>
                     </tr>
                     <tr>
                        <td>PWD</td>
                        <td>The action may only be executed if the workshop card PIN has been successfully verified, i.e. if the card internal security status ‘PIN_Verified’ is set. The command must be sent without secure messaging.</td>
                     </tr>
                     <tr>
                        <td>EXT-AUT-G1</td>
                        <td>The action may only be executed if the External Authenticate command for the generation 1 authentication (see also Appendix 11 Part A) has been successfully performed.</td>
                     </tr>
                     <tr>
                        <td>SM-MAC-G1</td>
                        <td>The APDU (command and response) must be applied with generation 1 secure messaging in authentication-only mode (see Appendix 11 Part A).</td>
                     </tr>
                     <tr>
                        <td>SM-C-MAC-G1</td>
                        <td>The command APDU must be applied with generation 1 secure messaging in authentication only mode (see Appendix 11 Part A).</td>
                     </tr>
                     <tr>
                        <td>SM-R-ENC-G1</td>
                        <td>The response APDU must be applied with generation 1 secure messaging in encryption mode (see Appendix 11 Part A), i.e. no message authentication code is returned.</td>
                     </tr>
                     <tr>
                        <td>SM-R-ENC-MAC-G1</td>
                        <td>The response APDU must be applied with generation 1 secure messaging in encrypt-then-authenticate mode (see Appendix 11 Part A).</td>
                     </tr>
                     <tr>
                        <td>SM-MAC-G2</td>
                        <td>The APDU (command and response) must be applied with generation 2 secure messaging in authentication-only mode (see Appendix 11 Part B).</td>
                     </tr>
                     <tr>
                        <td>SM-C-MAC-G2</td>
                        <td>The command APDU must be applied with generation 2 secure messaging in authentication only mode (see Appendix 11 Part B).</td>
                     </tr>
                     <tr>
                        <td>SM-R-ENC-MAC-G2</td>
                        <td>The response APDU must be applied with generation 2 secure messaging in encrypt-then-authenticate mode (see Appendix 11 Part B).</td>
                     </tr>
                  </tbody>
               </table>
<p>▼M1</p>
<p>TCS_24 These security conditions can be linked in the following ways:</p>
<p>AND : All security conditions must be fulfilled</p>
<p>OR : At least one security condition must be fulfilled</p>
<p>The access rules for the file system, i.e. the SELECT, READ BINARY and UPDATE BINARY command, are specified in chapter 4. The access rules for the remaining commands are specified in the following tables. The term ‘not applicable’ is used if there is no requirement to support the command. In this case the command may or may not be supported, but the access condition is out of scope.</p>
<p>▼B</p>
<p>TCS_25 In the DF Tachograph G1 application the following access rules are used:</p>
<p>▼M1</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Command</td>
                        <td>Driver Card</td>
                        <td>Workshop Card</td>
                        <td>Control Card</td>
                        <td>Company Card</td>
                     </tr>
                     <tr>
                        <td>External Authenticate</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>—  For generation 1 authentication</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>—  For generation 2 authentication</td>
                        <td>ALW</td>
                        <td>PWD</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>Internal Authenticate</td>
                        <td>ALW</td>
                        <td>PWD</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>General Authenticate</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>Get Challenge</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>MSE:SET AT</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>MSE:SET DST</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>Process DSRC Message</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>PSO: Compute Digital Signature</td>
                        <td>
                           <p>ALW OR</p>
                           <p>SM-MAC-G2</p>
                        </td>
                        <td>
                           <p>ALW OR</p>
                           <p>SM-MAC-G2</p>
                        </td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>PSO: Hash</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>ALW</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>PERFORM HASH of FILE</td>
                        <td>
                           <p>ALW OR</p>
                           <p>SM-MAC-G2</p>
                        </td>
                        <td>
                           <p>ALW OR</p>
                           <p>SM-MAC-G2</p>
                        </td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>PSO: Verify Certificate</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>PSO: Verify Digital Signature</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>ALW</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>Verify</td>
                        <td>Not applicable</td>
                        <td>ALW</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>
<p>TCS_26 In the DF Tachograph_G2 application the following access rules are used:</p>
<p>▼M1</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Command</td>
                        <td>Driver Card</td>
                        <td>Workshop Card</td>
                        <td>Control Card</td>
                        <td>Company Card</td>
                     </tr>
                     <tr>
                        <td>External Authenticate</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>—  For generation 1 authentication</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>—  For generation 2 authentication</td>
                        <td>ALW</td>
                        <td>PWD</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>Internal Authenticate</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>General Authenticate</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>Get Challenge</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>MSE:SET AT</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>MSE:SET DST</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>Process DSRC Message</td>
                        <td>Not applicable</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>PSO: Compute Digital Signature</td>
                        <td>
                           <p>ALW OR</p>
                           <p>SM-MAC-G2</p>
                        </td>
                        <td>
                           <p>ALW OR</p>
                           <p>SM-MAC-G2</p>
                        </td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>PSO: Hash</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>ALW</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>PERFORM HASH of FILE</td>
                        <td>
                           <p>ALW OR</p>
                           <p>SM-MAC-G2</p>
                        </td>
                        <td>
                           <p>ALW OR</p>
                           <p>SM-MAC-G2</p>
                        </td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>PSO: Verify Certificate</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>PSO: Verify Digital Signature</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>ALW</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>Verify</td>
                        <td>Not applicable</td>
                        <td>ALW</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>
<p>TCS_27 In the MF the following access rules are used:</p>
<p>▼M1</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Command</td>
                        <td>Driver Card</td>
                        <td>Workshop Card</td>
                        <td>Control Card</td>
                        <td>Company Card</td>
                     </tr>
                     <tr>
                        <td>External Authenticate</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>—  For generation 1 authentication</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>—  For generation 2 authentication</td>
                        <td>ALW</td>
                        <td>PWD</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>Internal Authenticate</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>General Authenticate</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>Get Challenge</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>MSE:SET AT</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>MSE:SET DST</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>Process DSRC Message</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>PSO: Compute Digital Signature</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>PSO: Hash</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>PERFORM HASH of FILE</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>PSO: Verify Certificate</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                        <td>ALW</td>
                     </tr>
                     <tr>
                        <td>PSO: Verify Digital Signature</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                     <tr>
                        <td>Verify</td>
                        <td>Not applicable</td>
                        <td>ALW</td>
                        <td>Not applicable</td>
                        <td>Not applicable</td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>
<p>TCS_28 A tachograph card may or may not accept a command with a higher level of security than the one specified in the security conditions. I.e. if the security condition is ALW (or PLAIN-C) the card may accept a command with secure messaging (encryption and / or authentication mode). If the security condition requires secure messaging with authentication mode, the tachograph card may accept a command with secure messaging of the same generation in authentication and encryption mode.</p>
<p>
               <em>Note:</em> The command descriptions provide more information on the support of the commands for the different tachograph card types and the different DFs.</p>
<p>3.4.   <strong>Commands and error codes overview</strong>
            </p>
<p>Commands and file organisation are deduced from and complies with ISO/IEC 7816-4.</p>
<p>This section describes the following APDU command-response pairs. The command variants which are supported by a generation 1 and 2 application are specified in the corresponding command descriptions.</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Command</td>
                        <td>INS</td>
                     </tr>
                     <tr>
                        <td>SELECT</td>
                        <td>‘A4h’</td>
                     </tr>
                     <tr>
                        <td>READ BINARY</td>
                        <td>‘B0h’, ‘B1h’</td>
                     </tr>
                     <tr>
                        <td>UPDATE BINARY</td>
                        <td>‘D6h’, ‘D7h’</td>
                     </tr>
                     <tr>
                        <td>GET CHALLENGE</td>
                        <td>‘84h’</td>
                     </tr>
                     <tr>
                        <td>VERIFY</td>
                        <td>‘20h’</td>
                     </tr>
                     <tr>
                        <td>GET RESPONSE</td>
                        <td>‘C0h’</td>
                     </tr>
                     <tr>
                        <td>PERFORM SECURITY OPERATION</td>
                        <td>‘2Ah’</td>
                     </tr>
                     <tr>
                        <td>—  VERIFY CERTIFICATE</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>—  COMPUTE DIGITAL SIGNATURE</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>—  VERIFY DIGITAL SIGNATURE</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>—  HASH</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>—  PERFORM HASH OF FILE</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>—  PROCESS DSRC MESSAGE</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INTERNAL AUTHENTICATE</td>
                        <td>‘88h’</td>
                     </tr>
                     <tr>
                        <td>EXTERNAL AUTHENTICATE</td>
                        <td>‘82h’</td>
                     </tr>
                     <tr>
                        <td>MANAGE SECURITY ENVIRONMENT</td>
                        <td>‘22h’</td>
                     </tr>
                     <tr>
                        <td>—  SET DIGITAL SIGNATURE TEMPLATE</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>—  SET AUTHENTICATION TEMPLATE</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>GENERAL AUTHENTICATE</td>
                        <td>‘86h’</td>
                     </tr>
                  </tbody>
               </table>
<p>▼M1</p>
<p>TCS_29 The status words SW1 SW2 are returned in any response message and denote the processing state of the command.</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>SW1</td>
                        <td>SW2</td>
                        <td>Meaning</td>
                     </tr>
                     <tr>
                        <td>90</td>
                        <td>00</td>
                        <td>Normal processing.</td>
                     </tr>
                     <tr>
                        <td>61</td>
                        <td>XX</td>
                        <td>Normal processing. XX = number of response bytes available.</td>
                     </tr>
                     <tr>
                        <td>62</td>
                        <td>81</td>
                        <td>Warning processing. Part of returned data may be corrupted</td>
                     </tr>
                     <tr>
                        <td>63</td>
                        <td>00</td>
                        <td>Authentication failed (Warning)</td>
                     </tr>
                     <tr>
                        <td>63</td>
                        <td>CX</td>
                        <td>Wrong CHV (PIN). Remaining attempts counter provided by ‘X’.</td>
                     </tr>
                     <tr>
                        <td>64</td>
                        <td>00</td>
                        <td>Execution error - State of non-volatile memory unchanged. Integrity error.</td>
                     </tr>
                     <tr>
                        <td>65</td>
                        <td>00</td>
                        <td>Execution error - State of non-volatile memory changed</td>
                     </tr>
                     <tr>
                        <td>65</td>
                        <td>81</td>
                        <td>Execution error - State of non-volatile memory changed – Memory failure</td>
                     </tr>
                     <tr>
                        <td>66</td>
                        <td>88</td>
                        <td>Security error: <p>wrong cryptographic checksum (during Secure Messaging) or</p>
                           <p>wrong certificate (during certificate verification) or</p>
                           <p>wrong cryptogram (during external authentication) or</p>
                           <p>wrong signature (during signature verification)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>67</td>
                        <td>00</td>
                        <td>Wrong length (wrong Lc or Le)</td>
                     </tr>
                     <tr>
                        <td>68</td>
                        <td>83</td>
                        <td>Last command of the chain expected</td>
                     </tr>
                     <tr>
                        <td>69</td>
                        <td>00</td>
                        <td>Forbidden command (no response available in T=0)</td>
                     </tr>
                     <tr>
                        <td>69</td>
                        <td>82</td>
                        <td>Security status not satisfied.</td>
                     </tr>
                     <tr>
                        <td>69</td>
                        <td>83</td>
                        <td>Authentication method blocked.</td>
                     </tr>
                     <tr>
                        <td>69</td>
                        <td>85</td>
                        <td>Conditions of use not satisfied.</td>
                     </tr>
                     <tr>
                        <td>69</td>
                        <td>86</td>
                        <td>Command not allowed (no current EF).</td>
                     </tr>
                     <tr>
                        <td>69</td>
                        <td>87</td>
                        <td>Expected Secure Messaging Data Objects missing</td>
                     </tr>
                     <tr>
                        <td>69</td>
                        <td>88</td>
                        <td>Incorrect Secure Messaging Data Objects</td>
                     </tr>
                     <tr>
                        <td>6A</td>
                        <td>80</td>
                        <td>Incorrect parameters in data field</td>
                     </tr>
                     <tr>
                        <td>6A</td>
                        <td>82</td>
                        <td>File not found.</td>
                     </tr>
                     <tr>
                        <td>6A</td>
                        <td>86</td>
                        <td>Wrong parameters P1-P2.</td>
                     </tr>
                     <tr>
                        <td>6A</td>
                        <td>88</td>
                        <td>Referenced data not found.</td>
                     </tr>
                     <tr>
                        <td>6B</td>
                        <td>00</td>
                        <td>Wrong parameters (offset outside the EF).</td>
                     </tr>
                     <tr>
                        <td>6C</td>
                        <td>XX</td>
                        <td>Wrong length, SW2 indicates the exact length. No data field is returned.</td>
                     </tr>
                     <tr>
                        <td>6D</td>
                        <td>00</td>
                        <td>Instruction code not supported or invalid.</td>
                     </tr>
                     <tr>
                        <td>6E</td>
                        <td>00</td>
                        <td>Class not supported.</td>
                     </tr>
                     <tr>
                        <td>6F</td>
                        <td>00</td>
                        <td>—  Other checking errors</td>
                     </tr>
                  </tbody>
               </table>
<p>Additional status words as defined in ISO/IEC 7816-4 can be returned, if their behaviour is not explicitly mentioned in this appendix.</p>
<p>For example the following status words can be optionally returned:</p>
<p>6881: Logical channel not supported</p>
<p>6882: Secure messaging not supported</p>
<p>▼B</p>
<p>TCS_30 If more than one error condition is fulfilled in one command APDU the card may return any of the appropriate status words.</p>
<p>3.5.   <strong>Command descriptions</strong>
            </p>
<p>The mandatory commands for the Tachograph cards are described in this chapter.</p>
<p>Additional relevant details, related to cryptographic operations involved, are given in Appendix 11 Common security mechanisms for Tachograph Generation 1 and Generation 2.</p>
<p>All commands are described independently of the used protocol (T=0 or T=1). The APDU bytes CLA, INS, P1, P2, Lc and Le are always indicated. If Lc or Le is not needed for the described command, the associated length, value and description are empty.</p>
<p>TCS_31 If both length bytes (Lc and Le) are requested, the described command has to be split in two parts if the IFD is using protocol T=0: the IFD sends the command as described with P3=Lc + data and then sends a GET RESPONSE (see § 3.5.6) command with P3=Le.</p>
<p>TCS_32 If both length bytes are requested, and Le=0 (secure messaging):</p>
<dl><dt>—</dt><dd>When using protocol T=1, the card shall answer to Le=0 by sending all available output data.</dd><dt>—</dt><dd>When using protocol T=0, the IFD shall send the first command with P3=Lc + data, the card shall answer (to this implicit Le=0) by the Status bytes ‘ 61La ’, where La is the number of response bytes available. The IFD shall then generate a GET RESPONSE command with P3 = La to read the data.</dd></dl>

<p>TCS_33 A tachograph card may support extended length fields according to ISO/IEC 7816-4 as an optional feature. A tachograph card that supports extended length fields shall</p>
<dl><dt>—</dt><dd>Indicate the extended length field support in the ATR</dd><dt>—</dt><dd>Provide the supported buffer sizes by means of the extended length information in the EF ATR/INFO see TCS_146.</dd><dt>—</dt><dd>Indicate whether it supports extended length fields for T = 1 and / or T = 0 in the EF Extended Length, see TCS_147.</dd><dt>—</dt><dd>Support extended length fields for the tachograph application generation 1 and 2.</dd></dl>



<p>
               <em>Notes:</em>
            </p>
<p>All commands are specified for short length fields. The usage of extended length APDUs is clear from ISO/IEC 7816-4.</p>
<p>In general the commands are specified for the plain mode, i.e. without secure messaging, as the secure messaging layer is specified in Appendix 11. It is clear from the access rules for a command whether the command shall support secure messaging or not and whether the command shall support generation 1 and / or generation 2 secure messaging. Some command variants are described with secure messaging to illustrate the usage of secure messaging.</p>
<p>TCS_34 The VU shall perform the complete generation 2 VU — card mutual authentication protocol for a session including the certificate verification (if required) either in the DF Tachograph, the DF Tachograph_G2 or the MF.</p>
<p>3.5.1   <strong>SELECT</strong>
            </p>
<p>This command is compliant with ISO/IEC 7816-4, but has a restricted usage compared to the command defined in the norm.</p>
<p>The SELECT command is used:</p>
<dl><dt>—</dt><dd>to select an application DF (selection by name must be used)</dd><dt>—</dt><dd>to select an elementary file corresponding to the submitted file ID</dd></dl>

<p>3.5.1.1   <strong>Selection by name (AID)</strong>
            </p>
<p>This command allows selecting an application DF in the card.</p>
<p>TCS_35 This command can be performed from anywhere in the file structure (after the ATR or at any time).</p>
<p>TCS_36 The selection of an application resets the current security environment. After performing the application selection, no current public key is selected anymore. The EXT-AUT-G1 access condition is also lost. If the command was performed without secure messaging, the former secure messaging session keys are no longer available.</p>
<p>TCS_37 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘A4h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘04h’</td>
                        <td>Selection by name (AID)</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘0Ch’</td>
                        <td>No response expected</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘NNh’</td>
                        <td>
                           <p>Number of bytes sent to the card (length of the AID):</p>
                           <p>‘06h’ for the Tachograph application</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#6-#(5+NN)</td>
                        <td>NN</td>
                        <td>‘XX..XXh’</td>
                        <td>
                           <p>AID: ‘FF 54 41 43 48 4F’ for the Generation 1 tachograph application</p>
                           <p>AID: ‘FF 53 4D 52 44 54’ for the Generation 2 tachograph application</p>
                        </td>
                     </tr>
                  </tbody>
               </table>
<p>No response to the SELECT command is needed (Le absent in T=1, or no response asked in T=0).</p>
<p>TCS_38 
                  <strong>Response Message (no response asked)</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If the application corresponding with the AID is not found, the processing state returned is ‘ 6A82 ’.</dd><dt>—</dt><dd>In T=1, if the byte Le is present, the state returned is ‘ 6700 ’.</dd><dt>—</dt><dd>In T=0, if a response is asked after the SELECT command, the state returned is ‘ 6900 ’.</dd></dl>



<p>▼M1</p>
<dl><dt>—</dt><dd>If the selected application is considered to be corrupted (integrity error is detected within the file attributes), the processing state returned is ‘ 6400 ’ or ‘ 6500 ’.</dd></dl>
<p>▼B</p>
<p>3.5.1.2   <strong>Selection of an Elementary File using its File Identifier</strong>
            </p>
<p>TCS_39 
                  <strong>Command Message</strong>
               </p>
<p>TCS_40 A tachograph card shall support the generation 2 secure messaging as specified in Appendix 11 Part B for this command variant.</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘A4h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘02h’</td>
                        <td>Selection of an EF under the current DF</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘0Ch’</td>
                        <td>No response expected</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘02h’</td>
                        <td>Number of bytes sent to the card</td>
                     </tr>
                     <tr>
                        <td>#6-#7</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>File Identifier</td>
                     </tr>
                  </tbody>
               </table>
<p>No response to the SELECT command is needed (Le absent in T=1, or no response asked in T=0).</p>
<p>TCS_41 
                  <strong>Response Message (no response asked)</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If the file corresponding with the file identifier is not found, the processing state returned is ‘ 6A82 ’.</dd><dt>—</dt><dd>In T=1, if the byte Le is present, the state returned is ‘ 6700 ’.</dd><dt>—</dt><dd>In T=0, if a response is asked after the SELECT command, the state returned is ‘ 6900 ’.</dd></dl>



<p>▼M1</p>
<dl><dt>—</dt><dd>If the selected file is considered to be corrupted (integrity error is detected within the file attributes), the processing state returned is ‘ 6400 ’ or ‘ 6500 ’.</dd></dl>
<p>▼B</p>
<p>3.5.2   <strong>READ BINARY</strong>
            </p>
<p>This command is compliant with ISO/IEC 7816-4, but has a restricted usage compared to the command defined in the norm.</p>
<p>The READ BINARY command is used to read data from a transparent file.</p>
<p>The response of the card consists of returning the data read, optionally encapsulated in a secure messaging structure.</p>
<p>3.5.2.1   <strong>Command with offset in P1-P2</strong>
            </p>
<p>This command enables the IFD to read data from the EF currently selected, without secure messaging.</p>
<p>
               <em>Note:</em> This command without secure messaging can only be used to read a file that supports the ALW security condition for the Read access mode.</p>
<p>TCS_42 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘B0h’</td>
                        <td>Read Binary</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Offset in bytes from the beginning of the file: Most Significant Byte</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Offset in bytes from the beginning of the file: Least Significant Byte</td>
                     </tr>
                     <tr>
                        <td>Le</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Length of data expected. Number of Bytes to be read.</td>
                     </tr>
                  </tbody>
               </table>
<p>
               <em>Note:</em> bit 8 of P1 must be set to 0.</p>
<p>TCS_43 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1-#X</td>
                        <td>X</td>
                        <td>‘XX..XXh’</td>
                        <td>Data read</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If no EF is selected, the processing state returned is ‘ 6986 ’.</dd><dt>—</dt><dd>If the security conditions of the selected file are not satisfied, the command is interrupted with ‘ 6982 ’.</dd><dt>—</dt><dd>If the Offset is not compatible with the size of the EF (Offset &gt; EF size), the processing state returned is ‘ 6B00 ’.</dd><dt>—</dt><dd>If the size of the data to be read is not compatible with the size of the EF (Offset + Le &gt; EF size) the processing state returned is ‘ 6700 ’ or ‘ 6Cxx ’ where ‘xx’ indicates the exact length.</dd></dl>




<p>▼M1</p>
<dl><dt>—</dt><dd>If an integrity error is detected within the file attributes, the card shall consider the file as corrupted and unrecoverable, the processing state returned is ‘ 6400 ’ or ‘ 6500 ’.</dd></dl>
<p>▼B</p>
<dl><dt>—</dt><dd>If an integrity error is detected within the stored data, the card shall return the demanded data, and the processing state returned is ‘ 6281 ’.</dd></dl>
<p>3.5.2.1.1   <strong>Command with secure messaging (examples)</strong>
            </p>
<p>This command enables the IFD to read data from the EF currently selected with secure messaging, in order to verify the integrity of the data received and to protect the confidentiality of the data if the security condition SM-R-ENC-MAC-G1 (generation 1) or SM-R-ENC-MAC-G2 (generation 2) is applied.</p>
<p>TCS_44 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘0Ch’</td>
                        <td>Secure Messaging asked</td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘B0h’</td>
                        <td>Read Binary</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>P1 ( offset in bytes from the beginning of the file): Most Significant Byte</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>P2 ( offset in bytes from the beginning of the file): Least Significant Byte</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Length of input data for secure messaging</td>
                     </tr>
                     <tr>
                        <td>#6</td>
                        <td>1</td>
                        <td>‘97h’</td>
                        <td>TLE: Tag for expected length specification.</td>
                     </tr>
                     <tr>
                        <td>#7</td>
                        <td>1</td>
                        <td>‘01h’</td>
                        <td>LLE: Length of expected length</td>
                     </tr>
                     <tr>
                        <td>#8</td>
                        <td>1</td>
                        <td>‘NNh’</td>
                        <td>Expected length specification (original Le): Number of Bytes to be read</td>
                     </tr>
                     <tr>
                        <td>#9</td>
                        <td>1</td>
                        <td>‘8Eh’</td>
                        <td>TCC: Tag for cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>#10</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>L<span>CC</span>: Length of following cryptographic checksum</p>
                           <p>‘04h’ for Generation 1 secure messaging (see Appendix 11 Part A)</p>
                           <p>‘08h’, ‘0Ch’ or ‘10h’ depending on AES key length for Generation 2 secure messaging (see Appendix 11 Part B)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#11-#(10+L)</td>
                        <td>L</td>
                        <td>‘XX..XXh’</td>
                        <td>Cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>Le</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>As specified in ISO/IEC 7816-4</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_45 
                  <strong>Response Message if SM-R-ENC-MAC-G1 (generation 1) / SM-R-ENC-MAC-G2 (generation 2) is not required and if Secure Messaging input format is correct:</strong>
               </p>
<p>▼M1</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1</td>
                        <td>1</td>
                        <td>‘81h’</td>
                        <td>TPV: Tag for plain value data</td>
                     </tr>
                     <tr>
                        <td>#2</td>
                        <td>L</td>
                        <td>
                           <p>‘NNh’ or</p>
                           <p>‘81 NNh’</p>
                        </td>
                        <td>
                           <p>L<span>PV</span>: length of returned data (=original Le).</p>
                           <p>L is 2 bytes if L<span>PV</span>&gt;127 bytes.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#(2+L) - #(1+L+NN)</td>
                        <td>NN</td>
                        <td>‘XX..XXh’</td>
                        <td>Plain Data value</td>
                     </tr>
                     <tr>
                        <td>#(2+L+NN)</td>
                        <td>1</td>
                        <td>‘99h’</td>
                        <td>Tag for Processing Status (SW1-SW2) – optional for generation 1 secure messaging</td>
                     </tr>
                     <tr>
                        <td>#(3+L+NN)</td>
                        <td>1</td>
                        <td>‘02h’</td>
                        <td>Length of Processing Status – optional for generation 1 secure messaging</td>
                     </tr>
                     <tr>
                        <td>#(4+L+NN) - #(5+L+NN)</td>
                        <td>2</td>
                        <td>‘XX XXh’</td>
                        <td>Processing Status of the unprotected response APDU – optional for generation 1 secure messaging</td>
                     </tr>
                     <tr>
                        <td>#(6+L+NN)</td>
                        <td>1</td>
                        <td>‘8Eh’</td>
                        <td>TCC: Tag for cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>#(7+L+NN)</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>LCC: Length of following cryptographic checksum</p>
                           <p>‘04h’ for Generation 1 secure messaging (see Appendix 11 Part A)</p>
                           <p>‘08h’, ‘0Ch’ or ‘10h’ depending on AES key length for Generation 2 secure messaging (see Appendix 11 Part B)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#(8+L+NN)-#(7+M+L+NN)</td>
                        <td>M</td>
                        <td>‘XX..XXh’</td>
                        <td>Cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>
<p>TCS_46 
                  <strong>Response Message if SM-R-ENC-MAC-G1 (generation 1) / SM-R-ENC-MAC-G2 (generation 2) is required and if Secure Messaging input format is correct:</strong>
               </p>
<p>▼M1</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1</td>
                        <td>1</td>
                        <td>‘87h’</td>
                        <td>TPI CG: Tag for encrypted data (cryptogram)</td>
                     </tr>
                     <tr>
                        <td>#2</td>
                        <td>L</td>
                        <td>
                           <p>‘MMh’ or</p>
                           <p>‘81 MMh’</p>
                        </td>
                        <td>
                           <p>L<span>PI CG</span>: length of returned encrypted data (different of original Le of the command due to padding).</p>
                           <p>L is 2 bytes if LPI CG &gt; 127 bytes.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#(2+L)-#(1+L+MM)</td>
                        <td>MM</td>
                        <td>‘01XX..XXh’</td>
                        <td>Encrypted Data: Padding Indicator and cryptogram</td>
                     </tr>
                     <tr>
                        <td>#(2+L+MM)</td>
                        <td>1</td>
                        <td>‘99h’</td>
                        <td>Tag for Processing Status (SW1-SW2) – optional for generation 1 secure messaging</td>
                     </tr>
                     <tr>
                        <td>#(3+L+MM)</td>
                        <td>1</td>
                        <td>‘02h’</td>
                        <td>Length of Processing Status – optional for generation 1 secure messaging</td>
                     </tr>
                     <tr>
                        <td>#(4+L+MM) - #(5+L+MM)</td>
                        <td>2</td>
                        <td>‘XX XXh’</td>
                        <td>Processing Status of the unprotected response APDU – optional for generation 1 secure messaging</td>
                     </tr>
                     <tr>
                        <td>#(6+L+MM)</td>
                        <td>1</td>
                        <td>‘8Eh’</td>
                        <td>TCC: Tag for cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>#(7+L+MM)</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>LCC: Length of following cryptographic checksum</p>
                           <p>‘04h’ for Generation 1 secure messaging (see Appendix 11 Part A)</p>
                           <p>‘08h’, ‘0Ch’ or ‘10h’ depending on AES key length for Generation 2 secure messaging (see Appendix 11 Part B)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#(8+L+MM)-#(7+N+L+MM)</td>
                        <td>N</td>
                        <td>‘XX..XXh’</td>
                        <td>Cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>
<p>The READ BINARY command may return regular processing states listed in TCS_43 under Tag ‘99h’ as described in TCS_59 using the secure messaging response structure.</p>
<p>Additionally, some errors specifically related to secure messaging can happen. In that case, the processing state is simply returned, with no secure messaging structure involved:</p>
<p>TCS_47 
                  <strong>Response Message if incorrect Secure Messaging input format</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If no current session key is available, the processing state ‘ 6A88 ’ is returned. It happens either if the session key has not already been generated or if the session key validity has expired (in this case the IFD must re-run a mutual authentication process to set a new session key).</dd><dt>—</dt><dd>If some expected data objects (as specified above) are missing in the secure messaging format, the processing state ‘ 6987 ’ is returned: this error happens if an expected tag is missing or if the command body is not properly constructed.</dd><dt>—</dt><dd>If some data objects are incorrect, the processing state returned is ‘ 6988 ’: this error happens if all the required tags are present but some lengths are different from the ones expected.</dd><dt>—</dt><dd>If the verification of the cryptographic checksum fails, the processing state returned is ‘ 6688 ’.</dd></dl>



<p>3.5.2.2   <strong>Command with short EF (Elementary File) identifier</strong>
            </p>
<p>This command variant enables the IFD to select an EF by means of a short EF identifier and read data from this EF.</p>
<p>TCS_48 A tachograph card shall support this command variant for all Elementary Files with a specified short EF identifier. These short EF identifiers are specified in chapter 4.</p>
<p>TCS_49 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘B0h’</td>
                        <td>Read Binary</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>Bit 8 is set to 1</p>
                           <p>Bit 7 and 6 are set to 00</p>
                           <p>Bit 5 — 1 encode the short EF identifier of the corresponding EF</p>
                        </td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Encodes an offset from 0 to 255 bytes in the EF referenced by P1</td>
                     </tr>
                     <tr>
                        <td>Le</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Length of data expected. Number of Bytes to be read.</td>
                     </tr>
                  </tbody>
               </table>
<p>
               <em>Note:</em> The short EF identifiers used for the Generation 2 tachograph application are specified in chapter 4.</p>
<p>If P1 encodes a short EF identifier and the command is successful, the identified EF becomes the currently selected EF (current EF).</p>
<p>TCS_50 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1-#L</td>
                        <td>L</td>
                        <td>‘XX..XXh’</td>
                        <td>Data read</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If the file corresponding with the short EF identifier is not found, the processing state returned is ‘ 6A82 ’.</dd><dt>—</dt><dd>If the security conditions of the selected file are not satisfied, the command is interrupted with ‘ 6982 ’.</dd><dt>—</dt><dd>If the Offset is not compatible with the size of the EF (Offset &gt; EF size), the processing state returned is ‘ 6B00 ’.</dd><dt>—</dt><dd>If the size of the data to be read is not compatible with the size of the EF (Offset + Le &gt; EF size) the processing state returned is ‘ 6700 ’ or ‘ 6Cxx ’ where ‘xx’ indicates the exact length.</dd></dl>




<p>▼M1</p>
<dl><dt>—</dt><dd>If an integrity error is detected within the file attributes, the card shall consider the file as corrupted and unrecoverable, the processing state returned is ‘ 6400 ’ or ‘ 6500 ’.</dd></dl>
<p>▼B</p>
<dl><dt>—</dt><dd>If an integrity error is detected within the stored data, the card shall return the demanded data, and the processing state returned is ‘ 6281 ’.</dd></dl>
<p>3.5.2.3   <strong>Command with odd instruction byte</strong>
            </p>
<p>This command variant enables the IFD to read data from an EF with 32 768 bytes or more.</p>
<p>TCS_51 A tachograph card which supports EFs with 32 768 bytes or more shall support this command variant for these EFs. A tachograph card may or may not support this command variant for other EFs with the exception of the EF Sensor_Installation_Data see TCS_156 and TCS_160.</p>
<p>TCS_52 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘B1h’</td>
                        <td>Read Binary</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>Current EF</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘00h’</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘NNh’</td>
                        <td>Lc Length of offset data object.</td>
                     </tr>
                     <tr>
                        <td>#6-#(5+NN)</td>
                        <td>NN</td>
                        <td>‘XX..XXh’</td>
                        <td>
                           <p>Offset data object:</p>
                           <p>Tag ‘54h’</p>
                           <p>Length ‘01h’ or ‘02h’</p>
                           <p>Value offset</p>
                        </td>
                     </tr>
                     <tr>
                        <td>▼M1</td>
                     </tr>
                     <tr>
                        <td>Le</td>
                        <td>1</td>
                        <td>&#39;XXh&#39;</td>
                        <td>As specified in ISO/IEC 7816-4</td>
                     </tr>
                     <tr>
                        <td>▼B</td>
                     </tr>
                  </tbody>
               </table>
<p>The IFD shall encode the offset data object&#39;s length with a minimum possible number of octets, i.e. using the length byte ‘01h’ the IFD shall encode an offset from 0 to 255 and using the length byte ‘02h’ an offset from ‘256’ up to ‘ 65 535 ’ bytes.</p>
<p>▼M1</p>
<p>In case of T = 0 the card assumes the value Le = ‘00h’ if no secure messaging is applied.</p>
<p>In case of T = 1 the processing state returned is ‘6700’ if Le=‘01h’.</p>
<p>▼B</p>
<p>TCS_53 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1-#L</td>
                        <td>L</td>
                        <td>‘XX..XXh’</td>
                        <td>Data read encapsulated in a discretionary data object with tag ‘53h’.</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If no EF is selected, the processing state returned is ‘ 6986 ’.</dd><dt>—</dt><dd>If the security conditions of the selected file are not satisfied, the command is interrupted with ‘ 6982 ’.</dd><dt>—</dt><dd>If the Offset is not compatible with the size of the EF (Offset &gt; EF size), the processing state returned is ‘ 6B00 ’.</dd><dt>—</dt><dd>If the size of the data to be read is not compatible with the size of the EF (Offset + Le &gt; EF size) the processing state returned is ‘ 6700 ’ or ‘ 6Cxx ’ where ‘xx’ indicates the exact length.</dd></dl>




<p>▼M1</p>
<dl><dt>—</dt><dd>If an integrity error is detected within the file attributes, the card shall consider the file as corrupted and unrecoverable, the processing state returned is ‘ 6400 ’ or ‘ 6500 ’.</dd></dl>
<p>▼B</p>
<dl><dt>—</dt><dd>If an integrity error is detected within the stored data, the card shall return the demanded data, and the processing state returned is ‘ 6281 ’.</dd></dl>
<p>3.5.2.3.1   <strong>Command with secure messaging (example)</strong>
            </p>
<p>The following example illustrates the usage of secure messaging if the security condition SM-MAC-G2 applies.</p>
<p>TCS_54 Command message</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘0Ch’</td>
                        <td>Secure Messaging asked</td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘B1h’</td>
                        <td>Read Binary</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>Current EF</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘00h’</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Length of the secured data field</td>
                     </tr>
                     <tr>
                        <td>#6</td>
                        <td>1</td>
                        <td>‘B3h’</td>
                        <td>Tag for plain value data encoded in BER-TLV</td>
                     </tr>
                     <tr>
                        <td>#7</td>
                        <td>1</td>
                        <td>‘NNh’</td>
                        <td>LPV: length of transmitted data</td>
                     </tr>
                     <tr>
                        <td>#(8)-#(7+NN)</td>
                        <td>NN</td>
                        <td>‘XX..XXh’</td>
                        <td>Plain Data encoded in BER-TLV, i.e. the offset data object with tag ‘54’</td>
                     </tr>
                     <tr>
                        <td>#(8+NN)</td>
                        <td>1</td>
                        <td>‘97h’</td>
                        <td>TLE: Tag for expected length specification.</td>
                     </tr>
                     <tr>
                        <td>#(9+NN)</td>
                        <td>1</td>
                        <td>‘01h’</td>
                        <td>LLE: Length of expected length</td>
                     </tr>
                     <tr>
                        <td>#(10+NN)</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Expected length specification (original Le): Number of bytes to be read</td>
                     </tr>
                     <tr>
                        <td>#(11+NN)</td>
                        <td>1</td>
                        <td>‘8Eh’</td>
                        <td>TCC: Tag for cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>#(12+NN)</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>L<span>CC</span>: Length of following cryptographic checksum</p>
                           <p>‘08h’, ‘0Ch’ or ‘10h’ depending on AES key length for Generation 2 secure messaging (see Appendix 11 Part B)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#(13+NN)-#(12+M+NN)</td>
                        <td>M</td>
                        <td>‘XX..XXh’</td>
                        <td>Cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>Le</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>As specified in ISO/IEC 7816-4</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_55 Response message if the command is successful</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1</td>
                        <td>1</td>
                        <td>‘B3h’</td>
                        <td>Plain Data encoded in BER-TLV</td>
                     </tr>
                     <tr>
                        <td>#2</td>
                        <td>L</td>
                        <td>
                           <p>‘NNh’ or</p>
                           <p>‘81 NNh’</p>
                        </td>
                        <td>
                           <p>L<span>PV</span>: length of returned data (=original Le).</p>
                           <p>L is 2 bytes if L<span>PV</span>&gt;127 bytes.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#(2+L)-#(1+L+NN)</td>
                        <td>NN</td>
                        <td>‘XX..XXh’</td>
                        <td>Plain Data value encoded in BER-TLV, i.e. data read encapsulated in a discretionary data object with tag ‘53h’.</td>
                     </tr>
                     <tr>
                        <td>#(2+L+NN)</td>
                        <td>1</td>
                        <td>‘99h’</td>
                        <td>Processing Status of the unprotected response APDU</td>
                     </tr>
                     <tr>
                        <td>#(3+L+NN)</td>
                        <td>1</td>
                        <td>‘02h’</td>
                        <td>Length of Processing Status</td>
                     </tr>
                     <tr>
                        <td>#(4+L+NN) — #(5+L+NN)</td>
                        <td>2</td>
                        <td>‘XX XXh’</td>
                        <td>Processing Status of the unprotected response APDU</td>
                     </tr>
                     <tr>
                        <td>#(6+L+NN)</td>
                        <td>1</td>
                        <td>‘8Eh’</td>
                        <td>TCC: Tag for cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>#(7+L+NN)</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>L<span>CC</span>: Length of following cryptographic checksum</p>
                           <p>‘08h’, ‘0Ch’ or ‘10h’ depending on AES key length for Generation 2 secure messaging (see Appendix 11 Part B)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#(8+L+NN)-#(7+M+L+NN)</td>
                        <td>M</td>
                        <td>‘XX..XXh’</td>
                        <td>Cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<p>3.5.3   <strong>UPDATE BINARY</strong>
            </p>
<p>This command is compliant with ISO/IEC 7816-4, but has a restricted usage compared to the command defined in the norm.</p>
<p>The UPDATE BINARY command message initiates the update (erase + write) of the bits already present in an EF binary with the bits given in the command APDU.</p>
<p>3.5.3.1   <strong>Command with offset in P1-P2</strong>
            </p>
<p>This command enables the IFD to write data into the EF currently selected, without the card verifying the integrity of data received.</p>
<p>
               <em>Note:</em> This command without secure messaging can only be used to update a file that supports the ALW security condition for the Update access mode.</p>
<p>TCS_56 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘D6h’</td>
                        <td>Update Binary</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Offset in bytes from the beginning of the file: Most Significant Byte</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Offset in bytes from the beginning of the file: Least Significant Byte</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘NNh’</td>
                        <td>Lc Length of data to Update. Number of bytes to be written.</td>
                     </tr>
                     <tr>
                        <td>#6-#(5+NN)</td>
                        <td>NN</td>
                        <td>‘XX..XXh’</td>
                        <td>Data to be written</td>
                     </tr>
                  </tbody>
               </table>
<p>
               <em>Note:</em> bit 8 of P1 must be set to 0.</p>
<p>TCS_57 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If no EF is selected, the processing state returned is ‘ 6986 ’.</dd><dt>—</dt><dd>If the security conditions of the selected file are not satisfied, the command is interrupted with ‘ 6982 ’.</dd><dt>—</dt><dd>If the Offset is not compatible with the size of the EF (Offset &gt; EF size), the processing state returned is ‘ 6B00 ’.</dd><dt>—</dt><dd>If the size of the data to be written is not compatible with the size of the EF (Offset + Lc &gt; EF size) the processing state returned is ‘ 6700 ’.</dd><dt>—</dt><dd>If an integrity error is detected within the file attributes, the card shall consider the file as corrupted and unrecoverable, the processing state returned is ‘ 6400 ’ or ‘ 6500 ’.</dd><dt>—</dt><dd>If writing is unsuccessful, the processing state returned is ‘ 6581 ’.</dd></dl>






<p>3.5.3.1.1   <strong>Command with secure messaging (examples)</strong>
            </p>
<p>This command enables the IFD to write data into the EF currently selected, with the card verifying the integrity of data received. As no confidentiality is required, the data are not encrypted.</p>
<p>TCS_58 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘0Ch’</td>
                        <td>Secure Messaging asked</td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘D6h’</td>
                        <td>Update Binary</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>Offset in bytes from the beginning of the file:</p>
                           <p>Most Significant Byte</p>
                        </td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>Offset in bytes from the beginning of the file:</p>
                           <p>Least Significant Byte</p>
                        </td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Length of the secured data field</td>
                     </tr>
                     <tr>
                        <td>#6</td>
                        <td>1</td>
                        <td>‘81h’</td>
                        <td>TPV: Tag for plain value data</td>
                     </tr>
                     <tr>
                        <td>#7</td>
                        <td>L</td>
                        <td>
                           <p>‘NNh’ or</p>
                           <p>‘81 NNh’</p>
                        </td>
                        <td>
                           <p>L<span>PV</span>: length of transmitted data.</p>
                           <p>L is 2 bytes if L<span>PV</span> &gt; 127 bytes.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#(7+L)-#(6+L+NN)</td>
                        <td>NN</td>
                        <td>‘XX..XXh’</td>
                        <td>Plain Data value (Data to be written)</td>
                     </tr>
                     <tr>
                        <td>#(7+L+NN)</td>
                        <td>1</td>
                        <td>‘8Eh’</td>
                        <td>TCC: Tag for cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>#(8+L+NN)</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>L<span>CC</span>: Length of following cryptographic checksum‘04h’ for Generation 1 secure messaging (see Appendix 11 Part A)</p>
                           <p>‘08h’, ‘0Ch’ or ‘10h’ depending on AES key length for Generation 2 secure messaging (see Appendix 11 Part B)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#(9+L+NN)-#(8+M+L+NN)</td>
                        <td>M</td>
                        <td>‘XX..XXh’</td>
                        <td>Cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>Le</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>As specified in ISO/IEC 7816-4</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_59 
                  <strong>Response message if correct Secure Messaging input format</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1</td>
                        <td>1</td>
                        <td>‘99h’</td>
                        <td>TSW: Tag for Status Words (to be protected by CC)</td>
                     </tr>
                     <tr>
                        <td>#2</td>
                        <td>1</td>
                        <td>‘02h’</td>
                        <td>LSW: length of returned Status Words</td>
                     </tr>
                     <tr>
                        <td>#3-#4</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Processing Status of the unprotected response APDU</td>
                     </tr>
                     <tr>
                        <td>#5</td>
                        <td>1</td>
                        <td>‘8Eh’</td>
                        <td>TCC: Tag for cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>#6</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>L<span>CC</span>: Length of following cryptographic checksum</p>
                           <p>‘04h’ for Generation 1 secure messaging (see Appendix 11 Part A)</p>
                           <p>‘08h’, ‘0Ch’ or ‘10h’ depending on AES key length for Generation 2 secure messaging (see Appendix 11 Part B)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#7-#(6+L)</td>
                        <td>L</td>
                        <td>‘XX..XXh’</td>
                        <td>Cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<p>The ‘regular’ processing states, described for the UPDATE BINARY command with no secure messaging (see §3.5.3.1), can be returned using the response message structure described above.</p>
<p>Additionally, some errors specifically related to secure messaging can happen. In that case, the processing state is simply returned, with no secure messaging structure involved:</p>
<p>TCS_60 
                  <strong>Response Message if error in secure messaging</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If no current session key is available, the processing state ‘ 6A88 ’ is returned.</dd><dt>—</dt><dd>If some expected data objects (as specified above) are missing in the secure messaging format, the processing state ‘ 6987 ’ is returned: this error happens if an expected tag is missing or if the command body is not properly constructed.</dd><dt>—</dt><dd>If some data objects are incorrect, the processing state returned is ‘ 6988 ’: this error happens if all the required tags are present but some lengths are different from the ones expected.</dd><dt>—</dt><dd>If the verification of the cryptographic checksum fails, the processing state returned is ‘ 6688 ’.</dd></dl>



<p>3.5.3.2   <strong>Command with short EF identifier</strong>
            </p>
<p>This command variant enables the IFD to select an EF by means of a short EF identifier and write data from this EF.</p>
<p>TCS_61 A tachograph card shall support this command variant for all Elementary Files with a specified short EF identifier. These short EF identifiers are specified in chapter 4.</p>
<p>TCS_62 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘D6h’</td>
                        <td>Update Binary</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>Bit 8 is set to 1</p>
                           <p>Bit 7 and 6 are set to 00</p>
                           <p>Bit 5 — 1 encode the short EF identifier of the corresponding EF</p>
                        </td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Encodes an offset from 0 to 255 bytes in the EF referenced by P1</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘NNh’</td>
                        <td>Lc Length of data to Update. Number of bytes to be written.</td>
                     </tr>
                     <tr>
                        <td>#6-#(5+NN)</td>
                        <td>NN</td>
                        <td>‘XX..XXh’</td>
                        <td>Data to be written</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_63 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<p>
               <em>Note:</em> The short EF identifiers used for the generation 2 tachograph application are specified in chapter 4.</p>
<p>If P1 encodes a short EF identifier and the command is successful, the identified EF becomes the currently selected EF (current EF).</p>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If the file corresponding with the short EF identifier is not found, the processing state returned is ‘ 6A82 ’.</dd><dt>—</dt><dd>If the security conditions of the selected file are not satisfied, the command is interrupted with ‘ 6982 ’.</dd><dt>—</dt><dd>If the Offset is not compatible with the size of the EF (Offset &gt; EF size), the processing state returned is ‘ 6B00 ’.</dd><dt>—</dt><dd>If the size of the data to be written is not compatible with the size of the EF (Offset + Lc &gt; EF size) the processing state returned is ‘ 6700 ’.</dd></dl>




<p>▼M1</p>
<dl><dt>—</dt><dd>If an integrity error is detected within the file attributes, the card shall consider the file as corrupted and unrecoverable, the processing state returned is ‘ 6400 ’ or ‘ 6500 ’.</dd></dl>
<p>▼B</p>
<dl><dt>—</dt><dd>If writing is unsuccessful, the processing state returned is ‘ 6581 ’.</dd></dl>
<p>3.5.3.3   <strong>Command with odd instruction byte</strong>
            </p>
<p>This command variant enables the IFD to write data to an EF with 32 768 bytes or more.</p>
<p>TCS_64 A tachograph card which supports EFs with 32 768 bytes or more shall support this command variant for these EFs. A tachograph card may or may not support this command variant for other EFs.</p>
<p>TCS_65 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘D7h’</td>
                        <td>Update Binary</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>Current EF</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘00h’</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘NNh’</td>
                        <td>Lc Length of data in the command data field</td>
                     </tr>
                     <tr>
                        <td>#6-#(5+NN)</td>
                        <td>NN</td>
                        <td>‘XX..XXh’</td>
                        <td>Offset data object with tag ‘54h’ || Discretionary data object with tag ‘53h’ that encapsulates the data to be written</td>
                     </tr>
                  </tbody>
               </table>
<p>The IFD shall encode the offset data object&#39;s and the discretionary data object&#39;s length with the minimum possible number of octets, i.e. using the length byte ‘01h’ the IFD shall encode an offset / length from 0 to 255 and using the length byte ‘02h’ an offset / length from ‘256’ up to ‘ 65 535 ’ bytes.</p>
<p>TCS_66 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If no EF is selected, the processing state returned is ‘ 6986 ’.</dd><dt>—</dt><dd>If the security conditions of the selected file are not satisfied, the command is interrupted with ‘ 6982 ’.</dd><dt>—</dt><dd>If the Offset is not compatible with the size of the EF (Offset &gt; EF size), the processing state returned is ‘ 6B00 ’.</dd><dt>—</dt><dd>If the size of the data to be written is not compatible with the size of the EF (Offset + Lc &gt; EF size) the processing state returned is ‘ 6700 ’.</dd><dt>—</dt><dd>If an integrity error is detected within the file attributes, the card shall consider the file as corrupted and unrecoverable, the processing state returned is ‘ 6400 ’ or ‘ 6500 ’.</dd><dt>—</dt><dd>If writing is unsuccessful, the processing state returned is ‘ 6581 ’.</dd></dl>






<p>3.5.3.3.1   <strong>Command with secure messaging (example)</strong>
            </p>
<p>The following example illustrates the usage of secure messaging if the security condition SM-MAC-G2 applies.</p>
<p>TCS_67 Command message</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘0Ch’</td>
                        <td>Secure Messaging asked</td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘D7h’</td>
                        <td>Update Binary</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>Current EF</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘00h’</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Length of the secured data field</td>
                     </tr>
                     <tr>
                        <td>#6</td>
                        <td>1</td>
                        <td>‘B3h’</td>
                        <td>Tag for plain value data encoded in BER-TLV</td>
                     </tr>
                     <tr>
                        <td>#7</td>
                        <td>L</td>
                        <td>
                           <p>‘NNh’ or</p>
                           <p>‘81 NNh’</p>
                        </td>
                        <td>
                           <p>L<span>PV</span>: length of transmitted data.</p>
                           <p>L is 2 bytes if L<span>PV</span> &gt; 127 bytes.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#(7+L)-#(6+L+NN)</td>
                        <td>NN</td>
                        <td>‘XX..XXh’</td>
                        <td>Plain Data encoded in BER-TLV, i.e. offset data object with tag ‘54h’ || Discretionary data object with tag ‘53h’ that encapsulates the data to be written</td>
                     </tr>
                     <tr>
                        <td>#(7+L+NN)</td>
                        <td>1</td>
                        <td>‘8Eh’</td>
                        <td>TCC: Tag for cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>#(8+L+NN)</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>L<span>CC</span>: Length of following cryptographic checksum</p>
                           <p>‘08h’, ‘0Ch’ or ‘10h’ depending on AES key length for Generation 2 secure messaging (see Appendix 11 Part B)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#(9+L+NN)-#(8+M+L+NN)</td>
                        <td>M</td>
                        <td>‘XX..XXh’</td>
                        <td>Cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>Le</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>As specified in ISO/IEC 7816-4</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_68 Response message if the command is successful</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1</td>
                        <td>1</td>
                        <td>‘99h’</td>
                        <td>TSW: Tag for Status Words (to be protected by CC)</td>
                     </tr>
                     <tr>
                        <td>#2</td>
                        <td>1</td>
                        <td>‘02h’</td>
                        <td>LSW: length of returned Status Words</td>
                     </tr>
                     <tr>
                        <td>#3-#4</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Processing Status of the unprotected response APDU</td>
                     </tr>
                     <tr>
                        <td>#5</td>
                        <td>1</td>
                        <td>‘8Eh’</td>
                        <td>TCC: Tag for cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>#6</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>L<span>CC</span>: Length of following cryptographic checksum</p>
                           <p>‘08h’, ‘0Ch’ or ‘10h’ depending on AES key length for Generation 2 secure messaging (see Appendix 11 Part B)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#7-#(6+L)</td>
                        <td>L</td>
                        <td>‘XX..XXh’</td>
                        <td>Cryptographic checksum</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<p>3.5.4   <strong>GET CHALLENGE</strong>
            </p>
<p>This command is compliant with ISO/IEC 7816-4, but has a restricted usage compared to the command defined in the norm.</p>
<p>The GET CHALLENGE command asks the card to issue a challenge in order to use it in a security related procedure in which a cryptogram or some ciphered data are sent to the card.</p>
<p>TCS_69 The Challenge issued by the card is only valid for the next command, which uses a challenge, sent to the card.</p>
<p>TCS_70 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘84h’</td>
                        <td>INS</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>P1</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>P2</td>
                     </tr>
                     <tr>
                        <td>Le</td>
                        <td>1</td>
                        <td>‘08h’</td>
                        <td>Le (Length of Challenge expected).</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_71 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1-#8</td>
                        <td>8</td>
                        <td>‘XX..XXh’</td>
                        <td>Challenge</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If Le is different from ‘08h’, the processing state is ‘ 6700 ’.</dd><dt>—</dt><dd>If parameters P1-P2 are incorrect, the processing state is ‘ 6A86 ’.</dd></dl>


<p>3.5.5   <strong>VERIFY</strong>
            </p>
<p>This command is compliant with ISO/IEC 7816-4, but has a restricted usage compared to the command defined in the norm.</p>
<p>Only the workshop card is required to support this command.</p>
<p>Other types of tachograph cards may or may not implement this command, but for these cards no reference CHV is personalized. Therefore these cards cannot perform this commend successfully. For other types of tachograph cards than workshop cards the behavior, i.e. the error code returned, is out of the scope of this specification, if this command is sent.</p>
<p>The Verify command initiates the comparison in the card of the CHV (PIN) data sent from the command with the reference CHV stored in the card.</p>
<p>▼M1</p>
<p>TCS_72 The PIN entered by the user must be ASCII encoded and right padded with ‘FFh’ bytes up to a length of 8 bytes by the IFD, see also the data type WorkshopCardPIN in Appendix 1.</p>
<p>▼B</p>
<p>TCS_73 The tachograph applications generation 1 and 2 shall use the same reference CHV.</p>
<p>TCS_74 The tachograph card shall check whether the command is encoded correctly. If the command is not encoded correctly the card shall not compare the CHV values, not decrement the remaining CHV attempt counter and not reset the security status ‘PIN_Verified’, but abort the command. A command is encoded correctly, if the CLA, INS, P1, P2, Lc bytes have the specified values, Le is absent, and the command data field has the correct length.</p>
<p>TCS_75 If the command is successful, the remaining CHV attempt counter is reinitialised. The initial value of the remaining CHV attempt counter is 5. If the command is successful the card shall set the internal security status ‘PIN_Verified’. The card shall reset this security status, if the card is reset or if the CHV code transmitted in the command does not match the stored reference CHV.</p>
<p>
               <em>Note:</em> Using the same reference CHV and a global security status prevents that a workshop employee must re-enter the PIN after a selection of another tachograph application DF.</p>
<p>TCS_76 An unsuccessful comparison is recorded in the card, i.e. the remaining CHV attempts counter shall be decremented by one, in order to limit the number of further attempts of the use of the reference CHV.</p>
<p>TCS_77 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘20h’</td>
                        <td>INS</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>P1</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>P2 (the verified CHV is implicitly known)</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘08h’</td>
                        <td>Length of CHV code transmitted</td>
                     </tr>
                     <tr>
                        <td>#6-#13</td>
                        <td>8</td>
                        <td>‘XX..XXh’</td>
                        <td>CHV</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_78 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If the reference CHV is not found, the processing state returned is ‘ 6A88 ’.</dd><dt>—</dt><dd>If the CHV is blocked, (the remaining attempt counter of the CHV is null), the processing state returned is ‘ 6983 ’. Once in that state, the CHV can never be successfully presented anymore.</dd><dt>—</dt><dd>If the comparison is unsuccessful, the remaining attempt Counter is decreased and the status ‘ 63CX ’ is returned (X&gt;0 and X equals the remaining CHV attempts counter.</dd><dt>—</dt><dd>If the reference CHV is considered corrupted, the processing state returned is ‘ 6400 ’ or ‘ 6581 ’.</dd><dt>—</dt><dd>If Lc is different from ‘08h’, the processing state is ‘ 6700 ’.</dd></dl>





<p>3.5.6   <strong>GET RESPONSE</strong>
            </p>
<p>This command is compliant with ISO/IEC 7816-4.</p>
<p>This command (only necessary and available for T=0 Protocol) is used to transmit prepared data from the card to the interface device (case where a command had included both Lc and Le).</p>
<p>The GET RESPONSE command has to be issued immediately after the command preparing the data, otherwise, the data are lost. After the execution of the GET RESPONSE command (except if the error ‘
                              <strong>61xx</strong>
                              ’ or ‘
                              <strong>6Cxx</strong>
                              ’ occur, see below), the previously prepared data are no longer available.</p>
<p>TCS_79 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘C0h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>Le</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Number of bytes expected</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_80 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1-#X</td>
                        <td>X</td>
                        <td>‘XX..XXh’</td>
                        <td>Data</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If no data have been prepared by the card, the processing state returned is ‘ 6900 ’ or ‘ 6F00 ’.</dd><dt>—</dt><dd>If Le exceeds the number of available bytes or if Le is null, the processing state returned is ‘ 6Cxx ’, where xx denotes the exact number of available bytes. In that case, the prepared data are still available for a subsequent GET RESPONSE command.</dd><dt>—</dt><dd>If Le is not null and is smaller than the number of available bytes, the required data are sent normally by the card, and the processing state returned is ‘ 61xx ’, where ‘xx’ indicates a number of extra bytes still available by a subsequent GET RESPONSE command.</dd><dt>—</dt><dd>If the command is not supported (protocol T=1), the card returns ‘ 6D00 ’.</dd></dl>




<p>3.5.7   <strong>PSO: VERIFY CERTIFICATE</strong>
            </p>
<p>This command is compliant with ISO/IEC 7816-8, but has a restricted usage compared to the command defined in the norm.</p>
<p>The VERIFY CERTIFICATE command is used by the card to obtain a Public Key from the outside and to check its validity.</p>
<p>3.5.7.1   <strong>Generation 1 Command — Response pair</strong>
            </p>
<p>TCS_81 This command variant is only supported by a generation 1 tachograph application.</p>
<p>TCS_82 When a VERIFY CERTIFICATE command is successful, the Public Key is stored for a future use in the Security environment. This key shall be explicitly set for the use in security related commands (INTERNAL AUTHENTICATE, EXTERNAL AUTHENTICATE or VERIFY CERTIFICATE) by the MSE command (see § 3.5.11) using its key identifier.</p>
<p>TCS_83 In any case, the VERIFY CERTIFICATE command uses the public key previously selected by the MSE command to open the certificate. This public key must be the one of a Member State or of Europe.</p>
<p>TCS_84 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘2Ah’</td>
                        <td>Perform Security Operation</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>P1</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘AEh’</td>
                        <td>P2: non BER-TLV coded data (concatenation of data elements)</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘C2h’</td>
                        <td>Lc: Length of the certificate, 194 bytes</td>
                     </tr>
                     <tr>
                        <td>#6-#199</td>
                        <td>194</td>
                        <td>‘XX..XXh’</td>
                        <td>Certificate: concatenation of data elements (as described in Appendix 11)</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_85 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If the certificate verification fails, the processing state returned is ‘ 6688 ’. The verification and unwrapping process of the certificate is described in Appendix 11 for G1 and G2.</dd><dt>—</dt><dd>If no Public Key is present in the Security Environment, ‘ 6A88 ’ is returned.</dd><dt>—</dt><dd>If the selected public key (used to unwrap the certificate) is considered corrupted, the processing state returned is ‘ 6400 ’ or ‘ 6581 ’.</dd><dt>—</dt><dd>Generation 1 only: If the selected public key (used to unwrap the certificate) has a CHA.LSB () different from ‘00’ (i.e. is not the one of a Member State or of Europe), the processing state returned is ‘ 6985 ’.</dd></dl>




<p>3.5.7.2   <strong>Generation 2 Command — Response pair</strong>
            </p>
<p>Depending on the curve size ECC certificates may be so long that they cannot be transmitted in a single APDU. In this case command chaining according to ISO/IEC 7816-4 must be applied and the certificate transmitted in two consecutive PSO: Verify Certificate APDUs.</p>
<p>The certificate structure and the domain parameters are defined in Appendix 11.</p>
<p>▼M3</p>
<p>TCS_86 The command can be performed in the MF, DF Tachograph and DF Tachograph_G2, see also TCS_34.</p>
<p>▼B</p>
<p>TCS_87 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘X0h’</td>
                        <td>
                           <p>CLA byte indicating command chaining:</p>
                           <p>‘00h’ the only or last command of the chain</p>
                           <p>‘10h’ not the last command of a chain</p>
                        </td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘2Ah’</td>
                        <td>Perform Security Operation</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘BEh’</td>
                        <td>Verify self-descriptive certificate</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Length of the command data field, see TCS_88 and TCS_89.</td>
                     </tr>
                     <tr>
                        <td>#6-#5+L</td>
                        <td>L</td>
                        <td>‘XX..XXh’</td>
                        <td>
                           <p>DER-TLV encoded data: ECC Certificate Body data object as first data object concatenated with the ECC Certificate Signature data object as second data object or a part of this concatenation. The tag ‘7F21’ and the corresponding length shall not be transmitted.</p>
                           <p>The order of these data objects is fixed.</p>
                        </td>
                     </tr>
                  </tbody>
               </table>
<p>▼M3</p>
<p>TCS_88 For short length APDUs the following provisions apply: the IFD shall use the minimum number of APDUs required to transmit the command payload and transmit the maximum number of bytes in the first command APDU. However any value of ‘Lc’ up to 255 bytes must be supported by the card.</p>
<p>TCS_89 For extended length APDUs the following provisions apply: if the certificate does not fit into a single APDU, the card shall support command chaining. The IFD shall use the minimum number of APDUs required to transmit the command payload and transmit the maximum number of bytes in the first command APDU. If chaining is needed, any value of ‘Lc’ up to the maximum extended length size indicated must be supported by the card.</p>
<p>Note: According to Appendix 11 the card stores the certificate or the relevant contents of the certificate and updates its currentAuthenticatedTime.</p>
<p>The response message structure and status words are as defined in TCS_85.</p>
<p>▼B</p>
<p>TCS_90 In addition to the error codes listed in TCS_85, the card may return the following error codes:</p>
<dl><dt>—</dt><dd>If the selected public key (used to unwrap the certificate) has a CHA.LSB (CertificateHolderAuthorisation.equipmentType) that is not suitable for the certificate verification according to Appendix 11, the processing state returned is ‘ 6985 ’.</dd><dt>—</dt><dd>If the currentAuthenticatedTime of the card is later than the Certificate Expiration Date, the processing state returned is ‘ 6985 ’.</dd><dt>—</dt><dd>If the last command of the chain is expected, the card returns ‘ 6883 ’.</dd><dt>—</dt><dd>If incorrect parameters are sent in the command data field, the card returns ‘ 6A80 ’ (also used in case the data objects are not sent in the specified order).</dd></dl>



<p>3.5.8   <strong>INTERNAL AUTHENTICATE</strong>
            </p>
<p>This command is compliant with ISO/IEC 7816-4.</p>
<p>TCS_91 All tachograph cards shall support this command in the DF Tachograph generation 1. The command may or may not be accessible in the MF and / or the DF Tachograph_G2. If so, the command shall terminate with a suitable error code as the private key of the card (Card.SK) for the generation 1 authentication protocol is only accessible in the DF_Tachograph generation 1.</p>
<p>Using the INTERNAL AUTHENTICATE command, the IFD can authenticate the card. The authentication process is described in Appendix 11. It includes the following statements:</p>
<p>TCS_92 The INTERNAL AUTHENTICATE command uses the card Private Key (implicitly selected) to sign authentication data including K1 (first element for session key agreement) and RND1, and uses the Public Key currently selected (through the last MSE command) to encrypt the signature and form the authentication token (more details in Appendix 11).</p>
<p>TCS_93 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>CLA</td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘88h’</td>
                        <td>INS</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>P1</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>P2</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘10h’</td>
                        <td>Length of data sent to the card</td>
                     </tr>
                     <tr>
                        <td>#6 — #13</td>
                        <td>8</td>
                        <td>‘XX..XXh’</td>
                        <td>Challenge used to authenticate the card</td>
                     </tr>
                     <tr>
                        <td>#14 -#21</td>
                        <td>8</td>
                        <td>‘XX..XXh’</td>
                        <td>VU.CHR (see Appendix 11)</td>
                     </tr>
                     <tr>
                        <td>Le</td>
                        <td>1</td>
                        <td>‘80h’</td>
                        <td>Length of the data expected from the card</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_94 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1-#128</td>
                        <td>128</td>
                        <td>‘XX..XXh’</td>
                        <td>Card authentication token (see Appendix 11)</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If no Public Key is present in the Security Environment, the processing state returned is ‘ 6A88 ’.</dd><dt>—</dt><dd>If no Private Key is present in the Security Environment, the processing state returned is ‘ 6A88 ’.</dd><dt>—</dt><dd>If VU.CHR does not match the current public key identifier, the processing state returned is ‘ 6A88 ’.</dd><dt>—</dt><dd>If the selected private key is considered corrupted, the processing state returned is ‘ 6400 ’ or ‘ 6581 ’.</dd></dl>




<p>▼M1</p>
<p>TCS_95 If the INTERNAL AUTHENTICATE command is successful, the current generation 1 session key, if existing, is erased and no longer available. In order to have a new generation 1 session key available, the EXTERNAL AUTHENTICATE command for the generation 1 authentication mechanism must be successfully performed.</p>
<p>
                  <em>Note:</em>
                   For generation 2 session keys see Appendix 11 CSM_193 and CSM_195. If generation 2 session keys are established and the tachograph card receives the plain INTERNAL AUTHENTICATE command APDU, it aborts the generation 2 secure messaging session and destroys the generation 2 session keys.</p>
<p>▼B</p>
<p>3.5.9   <strong>EXTERNAL AUTHENTICATE</strong>
            </p>
<p>This command is compliant with ISO/IEC 7816-4.</p>
<p>Using the EXTERNAL AUTHENTICATE command, the card can authenticate the IFD. The authentication process is described in Appendix 11 for Tachograph G1 and G2 (VU authentication).</p>
<p>TCS_96 The command variant for the generation 1 mutual authentication mechanism is only supported by a generation 1 tachograph application.</p>
<p>▼M1</p>
<p>TCS_97 The command variant for the second generation VU-card mutual authentication can be performed in the MF, DF Tachograph and DF Tachograph_G2, see also TCS_34. If this generation 2 EXTERNAL AUTHENTICATE command is successful, the current generation 1 session key, if existing, is erased and no longer available.</p>
<p>
                  <em>Note:</em>
                   For generation 2 session keys see Appendix 11 CSM_193 and CSM_195. If generation 2 session keys are established and the tachograph card receives the plain EXTERNAL AUTHENTICATE command APDU, it aborts the generation 2 secure messaging session and destroys the generation 2 session keys.</p>
<p>▼B</p>
<p>TCS_98 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>CLA</td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘82h’</td>
                        <td>INS</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>Keys and algorithms implicitly known</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Lc (Length of the data sent to the card )</td>
                     </tr>
                     <tr>
                        <td>#6-#(5+L)</td>
                        <td>L</td>
                        <td>‘XX..XXh’</td>
                        <td>
                           <p>Generation 1 authentication: Cryptogram (see Appendix 11 Part A)</p>
                           <p>Generation 2 authentication: Signature generated by the IFD (see Appendix 11 Part B)</p>
                        </td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_99 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If the CHA of the currently set public key is not the concatenation of the Tachograph application AID and of a VU equipment Type, the processing state returned is ‘ 6F00 ’.</dd><dt>—</dt><dd>If the command is not immediately preceded with a GET CHALLENGE command, the processing state returned is ‘ 6985 ’.</dd></dl>


<p>The Generation 1 Tachograph application may return the following additional error codes:</p>
<dl><dt>—</dt><dd>If no Public Key is present in the Security Environment, ‘ 6A88 ’ is returned.</dd><dt>—</dt><dd>If no Private Key is present in the Security Environment, the processing state returned is ‘ 6A88 ’.</dd><dt>—</dt><dd>If the verification of the cryptogram is wrong, the processing state returned is ‘ 6688 ’.</dd><dt>—</dt><dd>If the selected private key is considered corrupted, the processing state returned is ‘ 6400 ’ or ‘ 6581 ’.</dd></dl>



<p>The command variant for the Generation 2 authentication may return the following additional error code:</p>
<dl><dt>—</dt><dd>If signature verification failed, the card returns ‘ 6300 ’.</dd></dl>
<p>3.5.10   <strong>GENERAL AUTHENTICATE</strong>
            </p>
<p>This command is used for the generation 2 chip authentication protocol specified in Appendix 11 Part B and is compliant with ISO/IEC 7816-4.</p>
<p>TCS_100 The command can be performed in the MF, DF Tachograph and DF Tachograph_G2, see also TCS_34.</p>
<p>TCS_101 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘86h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>Keys and protocol implicitly known</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘NNh’</td>
                        <td>Lc: length of subsequent data field</td>
                     </tr>
                     <tr>
                        <td>#6-#(5+L)</td>
                        <td>L</td>
                        <td>‘7Ch’ + L7C + ‘80h’ + L80 + ‘XX..XXh’</td>
                        <td>
                           <p>DER-TLV encoded ephemeral public key value (see Appendix 11)</p>
                           <p>The VU shall send the data objects in this order.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>▼M3</td>
                     </tr>
                     <tr>
                        <td>Le</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>As specified in ISO/IEC 7816-4</td>
                     </tr>
                     <tr>
                        <td>▼B</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_102 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1-#L</td>
                        <td>L</td>
                        <td>‘7Ch’ + L7C + ‘81h’ + ‘08h’ + ‘XX..XXh’ + ‘82h’ + L82 + ‘XX..XXh’</td>
                        <td>DER-TLV encoded Dynamic Authentication Data: nonce and authentication token (see Appendix 11)</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>The card returns ‘ 6A80 ’ to indicate incorrect parameters in data field.</dd><dt>—</dt><dd>The card returns ‘ 6982 ’ if the External Authenticate command has not been performed successfully</dd></dl>


<p>The response Dynamic Authentication Data object ‘7Ch’</p>
<dl><dt>—</dt><dd>must be present if the operation is successful, i.e. the Status Words are ‘ 9000 ’,</dd><dt>—</dt><dd>must be absent in case of an execution error or checking error, i.e. if the Status Words are in the range ‘ 6400 ’ — ‘ 6FFF ’, and</dd><dt>—</dt><dd>may be absent in case of a warning, i.e. if the Status Words are in the range ‘ 6200 ’ — ‘ 63FF ’.</dd></dl>


<p>3.5.11   <strong>MANAGE SECURITY ENVIRONMENT</strong>
            </p>
<p>This command is used to set a public key for authentication purpose.</p>
<p>3.5.11.1   <strong>Generation 1 Command — Response pair</strong>
            </p>
<p>This command is compliant with ISO/IEC 7816-4. The use of this command is restricted regarding the related standard.</p>
<p>TCS_103 This command is only supported by a generation 1 tachograph application.</p>
<p>TCS_104 The key referenced in the MSE data field remains the current public key until the next correct MSE command, a DF is selected or the card is reset.</p>
<p>TCS_105 If the key referenced is not (already) present into the card, the security environment remains unchanged.</p>
<p>TCS_106 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>CLA</td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘22h’</td>
                        <td>INS</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘C1h’</td>
                        <td>P1: referenced key valid for all cryptographic operations</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘B6h’</td>
                        <td>P2 (referenced data concerning Digital Signature)</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘0Ah’</td>
                        <td>Lc: length of subsequent data field</td>
                     </tr>
                     <tr>
                        <td>#6</td>
                        <td>1</td>
                        <td>‘83h’</td>
                        <td>Tag for referencing a public key in asymmetric cases</td>
                     </tr>
                     <tr>
                        <td>#7</td>
                        <td>1</td>
                        <td>‘08h’</td>
                        <td>Length of the key reference (key identifier)</td>
                     </tr>
                     <tr>
                        <td>#8-#15</td>
                        <td>8</td>
                        <td>‘XX..XXh’</td>
                        <td>Key identifier as specified in Appendix 11</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_107 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If the referenced key is not present into the card, the processing state returned is ‘ 6A88 ’.</dd><dt>—</dt><dd>If some expected data objects are missing in the secure messaging format, the processing state ‘ 6987 ’ is returned. This can happen if the tag ‘83h’ is missing.</dd><dt>—</dt><dd>If some data objects are incorrect, the processing state returned is ‘ 6988 ’. This can happen if the length of the key identifier is not ‘08h’.</dd><dt>—</dt><dd>If the selected key is considered corrupted, the processing state returned is ‘ 6400 ’ or ‘ 6581 ’.</dd></dl>




<p>3.5.11.2   <strong>Generation 2 Command — Response pairs</strong>
            </p>
<p>For the Generation 2 authentication the tachograph card supports the following MSE: Set command versions which are compliant with ISO/IEC 7816-4. These command versions are not supported for the Generation 1 authentication.</p>
<p>3.5.11.2.1   <strong>MSE:SET AT for Chip Authentication</strong>
            </p>
<p>The following MSE:SET AT command is used to select the parameters for the Chip Authentication that is performed by a subsequent General Authenticate command.</p>
<p>TCS_108 The command can be performed in the MF, DF Tachograph and DF Tachograph_G2, see also TCS_34.</p>
<p>TCS_109 
                  <strong>MSE:SET AT Command Message for Chip Authentication</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘22h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘41h’</td>
                        <td>Set for internal authentication</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘A4h’</td>
                        <td>Authentication</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘NNh’</td>
                        <td>Lc: length of subsequent data field</td>
                     </tr>
                     <tr>
                        <td>#6-#(5+L)</td>
                        <td>L</td>
                        <td>‘80h’ + ‘0Ah’ + ‘XX..XXh’</td>
                        <td>
                           <p>DER-TLV encoded cryptographic mechanism reference: Object Identifier of Chip Authentication (value only, Tag ‘06h’ is omitted).</p>
                           <p>See Appendix 1 for the values of object identifiers; the byte notation shall be used. See Appendix 11 for guidance on how to select one of these object identifiers.</p>
                        </td>
                     </tr>
                  </tbody>
               </table>
<p>3.5.11.2.2   <strong>MSE:SET AT for VU Authentication</strong>
            </p>
<p>The following MSE:SET AT command is used to select the parameters and keys for the VU Authentication that is performed by a subsequent External Authenticate command.</p>
<p>TCS_110 The command can be performed in the MF, DF Tachograph and DF Tachograph_G2, see also TCS_34.</p>
<p>TCS_111 
                  <strong>MSE:SET AT Command Message for VU Authentication</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘22h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘81h’</td>
                        <td>Set for external authentication</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘A4h’</td>
                        <td>Authentication</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘NNh’</td>
                        <td>Lc: length of subsequent data field</td>
                     </tr>
                     <tr>
                        <td>#6-#(5+L)</td>
                        <td>L</td>
                        <td>‘80h’ + ‘0Ah’ + ‘XX..XXh’</td>
                        <td>
                           <p>DER-TLV encoded cryptographic mechanism reference: Object Identifier of VU Authentication (value only, Tag ‘06h’ is omitted).</p>
                           <p>See Appendix 1 for the values of object identifiers; the byte notation shall be used. See Appendix 11 for guidance on how to select one of these object identifiers.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>‘83h’ + ‘08h’ + ‘XX..XXh’</td>
                        <td>DER-TLV encoded reference of the VU public key by the Certificate Holder Reference mentioned in its certificate.</td>
                     </tr>
                     <tr>
                        <td>‘91h’ + L91 + ‘XX..XXh’</td>
                        <td>DER-TLV encoded compressed representation of the ephemeral public key of the VU that will be used during Chip Authentication (see Appendix 11)</td>
                     </tr>
                  </tbody>
               </table>
<p>3.5.11.2.3   <strong>MSE:SET DST</strong>
            </p>
<p>The following MSE:SET DST command is used to set a public key either</p>
<dl><dt>—</dt><dd>for the verification of a signature that is provided in a subsequent PSO: Verify Digital Signature command or</dd><dt>—</dt><dd>for the signature verification of a certificate that is provided in a subsequent PSO: Verify Certificate command</dd></dl>

<p>TCS_112 The command can be performed in the MF, DF Tachograph and DF Tachograph_G2, see also TCS_33.</p>
<p>TCS_113 
                  <strong>MSE:SET DST Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘22h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘81h’</td>
                        <td>Set for verification</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘B6h’</td>
                        <td>Digital Signature</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘NNh’</td>
                        <td>Lc: length of subsequent data field</td>
                     </tr>
                     <tr>
                        <td>#6-#(5+L)</td>
                        <td>L</td>
                        <td>‘83h’ + ‘08h’ + ‘XX...XXh’</td>
                        <td>DER-TLV encoded reference of a public key, i.e. the Certificate Holder Reference in the certificate of the public key (see Appendix 11)</td>
                     </tr>
                  </tbody>
               </table>
<p>For all command versions the response message structure and status words are given by:</p>
<p>TCS_114 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’. The protocol has been selected and initialised.</dd><dt>—</dt><dd>‘ 6A80 ’ indicates incorrect parameters in the command data field.</dd><dt>—</dt><dd>‘ 6A88 ’ indicates that referenced data (i.e. a referenced key) is not available.</dd></dl>


<p>▼M1</p>
<dl><dt>—</dt><dd>If the currentAuthenticatedTime of the card is later than the Expiration Date of the selected public key, the processing state returned is ‘6A88’.</dd></dl>
<p>
                  <em>Note:</em>
                   In the case of a MSE: SET AT for VU Authentication command, the referenced key is a VU_MA public key. The card shall set the VU_MA public key for use, if available in its memory, which matches the Certificate Holder Reference (CHR) given in the command data field (the card can identify VU_MA public keys by means of the certificate&#39;s CHA field). A card shall return ‘6A 88’ to this command in case only the VU_Sign public key or no public key of the Vehicle Unit is available. See the definition of the CHA field in Appendix 11 and of data type equipmentType in Appendix 1.</p>
<p>Similarly, in case an MSE: SET DST command referencing an EQT (i.e. a VU or a card) is sent to a control card, according to CSM_234 the referenced key is always an EQT_Sign key that has to be used for the verification of a digital signature. According to Figure 13 in Appendix 11, the control card will always have stored the relevant EQT_Sign public key. In some cases, the control card may have stored the corresponding EQT_MA public key. The control card shall always set the EQT_Sign public key for use when it receives an MSE: SET DST command.</p>
<p>▼B</p>
<p>3.5.12   <strong>PSO: HASH</strong>
            </p>
<p>This command is used to transfer to the card the result of a hash calculation on some data. This command is used for the verification of digital signatures. The hash value is stored temporarily for the subsequent command PSO: Verify Digital Signature</p>
<p>This command is compliant with ISO/IEC 7816-8. The use of this command is restricted regarding the related standard.</p>
<p>Only the control card is required to support this command in the DF Tachograph and DF Tachograph_G2.</p>
<p>Other types of tachograph cards may or may not implement this command. The command may or may not be accessible in the MF.</p>
<p>The control card application generation 1 supports only SHA-1.</p>
<p>TCS_115 The temporarily stored hash value shall be deleted if a new hash value is computed by means of the PSO: HASH command, if a DF is selected, and if the tachograph card is reset.</p>
<p>TCS_116 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>CLA</td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘2Ah’</td>
                        <td>Perform Security Operation</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘90h’</td>
                        <td>Return Hash code</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘A0h’</td>
                        <td>Tag: data field contains DOs relevant for hashing</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Length Lc of the subsequent data field</td>
                     </tr>
                     <tr>
                        <td>#6</td>
                        <td>1</td>
                        <td>‘90h’</td>
                        <td>Tag for the hash code</td>
                     </tr>
                     <tr>
                        <td>#7</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>
                           <p>Length L of the hash code:</p>
                           <p>‘14h’ in Generation 1 application (see Appendix 11 Part A)</p>
                           <p>‘20h’, ‘30h’ or ‘40h’ in Generation 2 application (see Appendix 11 Part B)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#8-#(7+L)</td>
                        <td>L</td>
                        <td>‘XX..XXh’</td>
                        <td>Hash code</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_117 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If some expected data objects (as specified above) are missing, the processing state ‘ 6987 ’ is returned. This can happen if one of the tag ‘90h’ is missing.</dd><dt>—</dt><dd>If some data objects are incorrect, the processing state returned is ‘ 6988 ’. This error happens if the required tag is present but with a length different from ‘14h’ for SHA-1, ‘20h’ for SHA-256, ‘30h’ for SHA-384, ‘40h’ for SHA-512 (Generation 2 application).</dd></dl>


<p>3.5.13   <strong>PERFORM HASH of FILE</strong>
            </p>
<p>This command is not compliant with ISO/IEC 7816-8. Thus the CLA byte of this command indicates that there is a proprietary use of the PERFORM SECURITY OPERATION / HASH.</p>
<p>Only the driver card and the workshop card are required to support this command in the DF Tachograph and DF Tachograph_G2.</p>
<p>Other types of tachograph cards may or may not implement this command. If a company or control card implements this command, the command shall be implemented as specified in this chapter.</p>
<p>The command may or may not be accessible in the MF. If so, the command shall be implemented as specified in this chapter, i.e. shall not allow the calculation of a hash value, but terminate with a suitable error code.</p>
<p>TCS_118 The PERFORM HASH of FILE command is used to hash the data area of the currently selected transparent EF.</p>
<p>TCS_119 A tachograph card shall support this command only for the EFs that are listed in chapter 4 under the DF_Tachograph and DF_Tachograph_G2 with the following exception. A tachograph card shall not support the command for the EF Sensor_Installation_Data of DF Tachograph_G2..</p>
<p>TCS_120 The result of the hash operation is stored temporarily in the card. It can then be used to get a digital signature of the file, using the PSO: COMPUTE DIGITAL SIGNATURE command.</p>
<p>▼M1</p>
<p>TCS_121 The temporarily stored hash of file value shall be deleted if a new hash of file value is computed by means of the PERFORM HASH of FILE command, if a DF is selected, and if the tachograph card is reset.</p>
<p>▼B</p>
<p>TCS_122 The Tachograph Generation 1 application shall support SHA-1.</p>
<p>▼M1</p>
<p>TCS_123 The Tachograph Generation 2 application shall support the SHA-2 algorithm (SHA-256, SHA-384 or SHA-512), specified by the cipher suite in Appendix 11 Part B for the card signature key Card_Sign.</p>
<p>▼B</p>
<p>TCS_124 
                  <strong>Command Message</strong>
               </p>
<p>▼M1</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘80h’</td>
                        <td>CLA</td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘2Ah’</td>
                        <td>Perform Security Operation</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘90h’</td>
                        <td>Tag: Hash</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>
                           <p>Algorithm implicitly known</p>
                           <p>For the Tachograph Generation 1 application: SHA-1</p>
                           <p>For the Tachograph Generation 2 application: SHA-2 algorithm (SHA-256, SHA-384 or SHA-512) defined by the cipher suite in Appendix 11 Part B for the card signature key Card_Sign</p>
                        </td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>
<p>TCS_125 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If the current EF does not allow this command (EF Sensor_Installation_Data in DF Tachograph_G2), the processing state ‘ 6985 ’ is returned.</dd><dt>—</dt><dd>If the selected EF is considered corrupted (file attributes or stored data integrity errors), the processing state returned is ‘ 6400 ’ or ‘ 6581 ’.</dd><dt>—</dt><dd>If the selected file is not a transparent file or if there is no current EF, the processing state returned is ‘ 6986 ’.</dd></dl>



<p>3.5.14   <strong>PSO: COMPUTE DIGITAL SIGNATURE</strong>
            </p>
<p>▼M1</p>
<p>This command is used to compute the digital signature of previously computed hash code (see PERFORM HASH of FILE, §3.5.13).</p>
<p>Only the driver card and the workshop card are required to support this command in the DF Tachograph and DF Tachograph_G2.</p>
<p>Other types of tachograph cards may or may not implement this command. In case of the Generation 2 tachograph application, only the driver card and the workshop card have a generation 2 signature key, other cards are not able to successfully perform the command and terminate with a suitable error code.</p>
<p>The command may or may not be accessible in the MF. If the command is not accessible in the MF, it shall terminate with a suitable error code.</p>
<p>This command is compliant with ISO/IEC 7816-8. The use of this command is restricted regarding the related standard.</p>
<p>▼B</p>
<p>TCS_126 This command shall not compute a digital signature of previously computed hash code with the PSO: HASH command.</p>
<p>TCS_127 The card private key is used to compute the digital signature and is implicitly known by the card.</p>
<p>TCS_128 The Generation 1 tachograph application performs a digital signature using a padding method compliant with PKCS1 (see Appendix 11 for details).</p>
<p>TCS_129 The Generation 2 tachograph application computes an elliptic curve based digital signature (see Appendix 11 for details).</p>
<p>TCS_130 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>CLA</td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘2Ah’</td>
                        <td>Perform Security Operation</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘9Eh’</td>
                        <td>Digital signature to be returned</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘9Ah’</td>
                        <td>Tag: data field contains data to be signed. As no data field is included, the data are supposed to be already present in the card (hash of file)</td>
                     </tr>
                     <tr>
                        <td>Le</td>
                        <td>1</td>
                        <td>‘NNh’</td>
                        <td>Length of the expected signature</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_131 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1-#L</td>
                        <td>L</td>
                        <td>‘XX..XXh’</td>
                        <td>Signature of the previously computed hash</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If the implicitly selected private key is considered as corrupted, the processing state returned is ‘ 6400 ’ or ‘ 6581 ’.</dd><dt>—</dt><dd>If the hash which was computed in a previous Perform Hash of File command is not available, the processing state returned is ‘ 6985 ’.</dd></dl>


<p>3.5.15   <strong>PSO: VERIFY DIGITAL SIGNATURE</strong>
            </p>
<p>This command is used to verify the digital signature, provided as an input, whose hash is known to the card. The signature algorithm is implicitly known by the card.</p>
<p>This command is compliant with ISO/IEC 7816-8. The use of this command is restricted regarding the related standard.</p>
<p>Only the control card is required to support this command in the DF Tachograph and DF Tachograph_G2.</p>
<p>Other types of tachograph cards may or may not implement this command. The command may or may not be accessible in the MF.</p>
<p>TCS_132 The VERIFY DIGITAL SIGNATURE command always uses the public key selected by the previous Manage Security Environment MSE: Set DST command and the previous hash code entered by a PSO: HASH command.</p>
<p>TCS_133 
                  <strong>Command Message</strong>
               </p>
<p>▼M1</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>CLA</td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘2Ah’</td>
                        <td>Perform Security Operation</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘A8h’</td>
                        <td>Tag: data field contains DOs relevant for verification</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘XXh’</td>
                        <td>Length Lc of the subsequent data field</td>
                     </tr>
                     <tr>
                        <td>#6</td>
                        <td>1</td>
                        <td>‘9Eh’</td>
                        <td>Tag for Digital Signature</td>
                     </tr>
                     <tr>
                        <td>
                           <p>#7 or</p>
                           <p>#7-#8</p>
                        </td>
                        <td>L</td>
                        <td>
                           <p>‘NNh’ or</p>
                           <p>‘81 NNh’</p>
                        </td>
                        <td>
                           <p>Length of digital signature (L is 2 bytes if the digital signature is longer than 127 bytes):</p>
                           <p>128 bytes coded in accordance with Appendix 11 Part A for Tachograph Generation 1 application.</p>
                           <p>Depending on the selected curve for Tachograph Generation 2 application (see Appendix 11 Part B).</p>
                        </td>
                     </tr>
                     <tr>
                        <td>#(7+L)-#(6+L+NN)</td>
                        <td>NN</td>
                        <td>‘XX..XXh’</td>
                        <td>Digital signature content</td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>
<p>TCS_134 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>If the verification of the signature fails, the processing state returned is ‘ 6688 ’. The verification process is described in Appendix 11.</dd><dt>—</dt><dd>If no public key is selected, the processing state returned is ‘ 6A88 ’.</dd><dt>—</dt><dd>If some expected data objects (as specified above) are missing, the processing state ‘ 6987 ’ is returned. This can happen if one of the required tag is missing.</dd><dt>—</dt><dd>If no hash code is available to process the command (as a result of a previous PSO: Hash command), the processing state returned is ‘ 6985 ’.</dd><dt>—</dt><dd>If some data objects are incorrect, the processing state returned is ‘ 6988 ’. This can happen if one of the required data objects length is incorrect.</dd><dt>—</dt><dd>If the selected public key is considered corrupted, the processing state returned is ‘ 6400 ’ or ‘ 6581 ’.</dd></dl>






<p>▼M1</p>
<dl><dt>—</dt><dd>If the selected public key (used to verify the digital signature) has a CHA.LSB (CertificateHolderAuthorisation.equipmentType) that is not suitable for the digital signature verification according to Appendix 11, the processing state returned is ‘ 6985 ’.</dd></dl>
<p>▼B</p>
<p>3.5.16   <strong>PROCESS DSRC MESSAGE</strong>
            </p>
<p>This command is used to verify the integrity and authenticity of the DSRC message and to decipher the data communicated from a VU to a control authority or a workshop over the DSRC link. The card derives the encryption key and the MAC key used to secure the DSRC message as described in Appendix 11 Part B chapter 13.</p>
<p>Only the control card and the workshop card are required to support this command in the DF Tachograph_G2.</p>
<p>Other types of tachograph cards may or may not implement this command, but shall not have a DSRC master key. Therefore these cards cannot perform the command successfully, but terminate with a suitable error code.</p>
<p>The command may or may not be accessible in the MF and / or the DF Tachograph. If so, the command shall terminate with a suitable error code.</p>
<p>TCS_135 The DSRC master key is accessible only in the DF Tachograph_G2, i.e. the control and workshop card shall support a successful execution of the command only in the DF Tachograph_G2.</p>
<p>TCS_136 The command shall only decrypt the DSRC data and verify the cryptographic checksum, but not interpret the input data.</p>
<p>TCS_137 The order of the data objects in the command data field is fixed by this specification.</p>
<p>TCS_138 
                  <strong>Command Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>CLA</td>
                        <td>1</td>
                        <td>‘80h’</td>
                        <td>Proprietary CLA</td>
                     </tr>
                     <tr>
                        <td>INS</td>
                        <td>1</td>
                        <td>‘2Ah’</td>
                        <td>Perform Security Operation</td>
                     </tr>
                     <tr>
                        <td>P1</td>
                        <td>1</td>
                        <td>‘80h’</td>
                        <td>Response data: plain value</td>
                     </tr>
                     <tr>
                        <td>P2</td>
                        <td>1</td>
                        <td>‘B0h’</td>
                        <td>Command data: plain value encoded in BER-TLV and including SM DOs</td>
                     </tr>
                     <tr>
                        <td>Lc</td>
                        <td>1</td>
                        <td>‘NNh’</td>
                        <td>Length Lc of the subsequent data field</td>
                     </tr>
                     <tr>
                        <td>#6-#(5+L)</td>
                        <td>L</td>
                        <td>‘87h’ + L87 + ‘XX..XXh’</td>
                        <td>
                           <p>DER-TLV encoded padding-content indicator byte followed by encrypted tachograph payload. For the padding-content indicator byte the value ‘00h’ (‘no further indication’ according to ISO/IEC 7816-4:2013 Table 52) shall be used. For the encryption mechanism see Appendix 11, Part B chapter 13.</p>
                           <p>Allowed values for the length L<span>87</span> are the multiples of the AES block length plus 1 for the padding-content indicator byte, i.e. from 17 bytes up to and including 193 bytes.</p>
                           <p>
                              <em>Note:</em> See ISO/IEC 7816-4:2013 Table 49 for the SM data object with tag ‘87h’.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>‘81h’ + ‘10h’</td>
                        <td>
                           <p>DER-TLV encoded Control Reference Template for Confidentiality nesting the concatenation of the following data elements (see Appendix 1 DSRCSecurityData and Appendix 11 Part B chapter 13):</p>
                           <p>— 4 byte time stamp</p>
                           <p>— 3 byte counter</p>
                           <p>— 8 byte VU serial number</p>
                           <p>— 1 byte DSRC master key version</p>
                           <p>
                              <em>Note:</em> See ISO/IEC 7816-4:2013 Table 49 for the SM data object with tag ‘81h’.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>‘8Eh’ + L8E + ‘XX..XXh’</td>
                        <td>
                           <p>DER-TLV encoded MAC over the DSRC message. For the MAC algorithm and calculation see Appendix 11, Part B chapter 13.</p>
                           <p>
                              <em>Note:</em> See ISO/IEC 7816-4:2013 Table 49 for the SM data object with tag ‘8Eh’.</p>
                        </td>
                     </tr>
                     <tr>
                        <td>▼M3</td>
                     </tr>
                     <tr>
                        <td>Le</td>
                        <td>1</td>
                        <td>‘00h’</td>
                        <td>As specified in ISO/IEC 7816-4</td>
                     </tr>
                     <tr>
                        <td>▼B</td>
                     </tr>
                  </tbody>
               </table>
<p>TCS_139 
                  <strong>Response Message</strong>
               </p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td>Byte</td>
                        <td>Length</td>
                        <td>Value</td>
                        <td>Description</td>
                     </tr>
                     <tr>
                        <td>#1-#L</td>
                        <td>L</td>
                        <td>‘XX..XXh’</td>
                        <td>Absent (in case of an error) or deciphered data (padding removed)</td>
                     </tr>
                     <tr>
                        <td>SW</td>
                        <td>2</td>
                        <td>‘XXXXh’</td>
                        <td>Status Words (SW1,SW2)</td>
                     </tr>
                  </tbody>
               </table>
<dl><dt>—</dt><dd>If the command is successful, the card returns ‘ 9000 ’.</dd><dt>—</dt><dd>‘ 6A80 ’ indicates incorrect parameters in the command data field (also used in case the data objects are not sent in the specified order).</dd><dt>—</dt><dd>‘ 6A88 ’ indicates that referenced data is not available, i.e. the referenced DSRC master key is not available.</dd><dt>—</dt><dd>‘ 6900 ’ indicates that the verification of the cryptographic checksum or the decryption of the data failed.</dd></dl>



<p>▼M1</p>
<dl><dt>—</dt><dd>‘ 6985 ’ indicates that the 4-byte time stamp provided in the command data field is earlier than cardValidityBegin or later than cardExpiryDate.</dd></dl>
<p>▼B</p>
<p>4.   <strong>TACHOGRAPH CARDS STRUCTURE</strong>
            </p>
<p>This paragraph specifies the file structures of the Tachograph cards for storage of accessible data.</p>
<p>It does not specify card manufacturer dependent internal structures, such as e.g. file headers, nor storage and handling of data elements needed for internal use only such as ,, or.</p>
<p>TCS_140 A generation 2 tachograph card shall host the Master File MF and a generation 1 and a generation 2 tachograph application of the same type (e.g. driver card applications).</p>
<p>TCS_141 A tachograph card shall support at least the minimum number of records specified for the corresponding applications and shall not support more records than the maximum number of records specified for the corresponding applications.</p>
<p>▼M3</p>
<p>The maximum and minimum numbers of records are specified in this chapter for the different applications. In version 2 of generation 2 driver and workshop cards, the generation 1 application shall support the maximum number of records specified in TCS_150 and TCS_158.</p>
<p>▼B</p>
<p>For the security conditions used in the access rules throughout this chapter please refer to chapter 3.3. In general the access mode ‘read’ denotes the READ BINARY command with even and if supported odd INS byte with the exception of the EF Sensor_Installation_Data on the workshop card, see TCS_156 and TCS_160. The access mode ‘update’ denotes the Update Binary command with even and if supported odd INS byte and the access mode ‘select’ the SELECT command.</p>
<p>4.1.   <strong>Master File MF</strong>
            </p>
<p>TCS_142 After its personalisation, the master file MF shall have the following permanent file structure and file access rules:</p>
<p>
               <em>Note:</em> The short EF identifier SFID is given as decimal number, e.g. the value 30 corresponds to 11110 in binary.</p>

<p>The following abbreviation for the security condition is used in this table:</p>
<table>
               <tbody><tr>
                  <td>SC1</td>
                  <td>ALW OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<p>TCS_143 All EF structures shall be transparent.</p>
<p>TCS_144 The Master File MF shall have the following data structure:</p>

<p>TCS_145 The elementary file EF DIR shall contain the following application related data objects: ‘61 08 4F 06 FF 54 41 43 48 4F 61 08 4F 06 FF 53 4D 52 44 54’</p>
<p>TCS_146 The elementary file EF ATR/INFO shall be present if the tachograph card indicates in its ATR that it supports extended length fields. In this case the EF ATR/INFO shall contain the extended length information data object (DO‘7F66’) as specified in ISO/IEC 7816-4:2013 clause 12.7.1.</p>
<p>TCS_147 The elementary file EF Extended_Length shall be present if the tachograph card indicates in its ATR that it supports extended length fields. In this case the EF shall contain the following data object: ‘02 01 xx’ where the value ‘xx’ indicates whether extended length fields are supported for the T = 1 and / or T = 0 protocol.</p>
<p>The value ‘01’ indicates extended length field support for the T = 1 protocol.</p>
<p>The value ‘10’ indicates extended length field support for the T = 0 protocol.</p>
<p>The value ‘11’ indicates extended length field support for the T = 1 and the T = 0 protocol.</p>
<p>4.2.   <strong>Driver card applications</strong>
            </p>
<p>4.2.1   <strong>Driver card application generation 1</strong>
            </p>
<p>TCS_148 After its personalisation, the driver card application generation 1 shall have the following permanent file structure and file access rules:</p>

<p>The following abbreviations for the security conditions are used in this table:</p>
<table>
               <tbody><tr>
                  <td>SC1</td>
                  <td>ALW OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC2</td>
                  <td>ALW OR SM-MAC-G1 OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC3</td>
                  <td>SM-MAC-G1 OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<p>TCS_149 All EF structures shall be transparent.</p>
<p>TCS_150 The driver card application generation 1 shall have the following data structure:</p>
<p>►(1)(2) M3</p>

<p>TCS_151 The following values, used to provide sizes in the table above, are the minimum and maximum record number values the driver card data structure must use for a generation 1 application:</p>

<p>4.2.2   <strong>Driver card application generation 2</strong>
            </p>
<p>▼M3</p>
<p>TCS_152 After its personalisation, the driver card application generation 2 shall have the following permanent file structure and file access rules:</p>
<p>
               <em>Notes:</em>
            </p>
<dl><dt>—</dt><dd>The short EF identifier SFID is given as decimal number, e.g. the value 30 corresponds to 11110 in binary.</dd><dt>—</dt><dd>EF Application_Identification_V2, EF Places_Authentication, EF GNSS_Places_Authentication, EF Border_Crossings, EF Load_Unload_Operations, EF VU_Configuration and EF Load_Type_Entries are only present in version 2 of the generation 2 driver card.</dd><dt>—</dt><dd>cardStructureVersion in EF Application_Identification is equal to {01 01} for version 2 of the generation 2 driver card, while it was equal to {01 00} for version 1 of the generation 2 driver card.</dd></dl>



<p>The following abbreviations for the security condition are used in this table:</p>
<table>
               <tbody><tr>
                  <td>SC1</td>
                  <td>ALW OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC5</td>
                  <td>
                     <p>For the Read Binary command with even INS byte: SM-C-MAC-G2 AND SM-R-ENC-MAC-G2</p>
                     <p>For the Read Binary command with odd INS byte (if supported): NEV</p>
                  </td>
               </tr>
            </tbody></table>
<p>▼B</p>
<p>TCS_153 All EF structures shall be transparent.</p>
<p>▼M3</p>
<p>TCS_154 The driver card application generation 2 shall have the following data structure:</p>



<p>▼B</p>
<p>TCS_155 The following values, used to provide sizes in the table above, are the minimum and maximum record number values the driver card data structure must use for a generation 2 application:</p>
<p>▼M3</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>Min</td>
                        <td>Max</td>
                     </tr>
                     <tr>
                        <td>n1</td>
                        <td>NoOfEventsPerType</td>
                        <td>12</td>
                        <td>12</td>
                     </tr>
                     <tr>
                        <td>n2</td>
                        <td>NoOfFaultsPerType</td>
                        <td>24</td>
                        <td>24</td>
                     </tr>
                     <tr>
                        <td>n3</td>
                        <td>NoOfCardVehicleRecords</td>
                        <td>200</td>
                        <td>200</td>
                     </tr>
                     <tr>
                        <td>n4</td>
                        <td>NoOfCardPlaceRecords</td>
                        <td>112</td>
                        <td>112</td>
                     </tr>
                     <tr>
                        <td>n6</td>
                        <td>CardActivityLengthRange</td>
                        <td>
                           <p>13776 Bytes</p>
                           <p>(56 days * 117 activity changes)</p>
                        </td>
                        <td>
                           <p>13776 Bytes</p>
                           <p>(56 days * 117 activity changes)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>n7</td>
                        <td>NoOfCardVehicleUnitRecords</td>
                        <td>200</td>
                        <td>200</td>
                     </tr>
                     <tr>
                        <td>n8</td>
                        <td>NoOfGNSSADRecords</td>
                        <td>336</td>
                        <td>336</td>
                     </tr>
                     <tr>
                        <td>n9</td>
                        <td>NoOfSpecificConditionRecords</td>
                        <td>112</td>
                        <td>112</td>
                     </tr>
                     <tr>
                        <td>n10</td>
                        <td>NoOfBorderCrossingRecords</td>
                        <td>1120</td>
                        <td>1120</td>
                     </tr>
                     <tr>
                        <td>n11</td>
                        <td>NoOfLoadUnloadRecords</td>
                        <td>1624</td>
                        <td>1624</td>
                     </tr>
                     <tr>
                        <td>n12</td>
                        <td>NoOfLoadTypeEntryRecords</td>
                        <td>336</td>
                        <td>336</td>
                     </tr>
                     <tr>
                        <td>n13</td>
                        <td>VuConfigurationLengthRange</td>
                        <td>3072 Bytes</td>
                        <td>3072 Bytes</td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>
<p>4.3.   <strong>Workshop card applications</strong>
            </p>
<p>4.3.1   <strong>Workshop card application generation 1</strong>
            </p>
<p>TCS_156 After its personalisation, the workshop card application generation 1 shall have the following permanent file structure and file access rules:</p>

<p>The following abbreviations for the security conditions are used in this table:</p>
<table>
               <tbody><tr>
                  <td>SC1</td>
                  <td>ALW OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC2</td>
                  <td>ALW OR SM-MAC-G1 OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC3</td>
                  <td>SM-MAC-G1 OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<p>▼M1</p>
<table>
               <tbody><tr>
                  <td>SC4</td>
                  <td>
                     <p>For the READ BINARY command with even INS byte:</p>
                     <div>(SM-C-MAC-G1 AND SM-R-ENC-MAC-G1) OR</div>
                     <div>(SM-C-MAC-G2 AND SM-R-ENC-MAC-G2)</div>
                     <div>For the READ BINARY command with odd INS byte (if supported): NEV</div>
                  </td>
               </tr>
            </tbody></table>
<p>▼B</p>
<p>TCS_157 All EF structures shall be transparent.</p>
<p>TCS_158 The workshop card application generation 1 shall have the following data structure:</p>



<p>TCS_159 The following values, used to provide sizes in the table above, are the minimum and maximum record number values the workshop card data structure must use for a generation 1 application:</p>

<p>4.3.2   <strong>Workshop card application generation 2</strong>
            </p>
<p>▼M3</p>
<p>TCS_160 After its personalisation, the workshop card application generation 2 shall have the following permanent file structure and file access rules.</p>
<p>
               <em>Notes:</em>
            </p>
<dl><dt>—</dt><dd>The short EF identifier SFID is given as decimal number, e.g. the value 30 corresponds to 11110 in binary.</dd><dt>—</dt><dd>EF Application_Identification_V2, EF Places_Authentication, EF GNSS_Places_Authentication, EF Border_Crossings, EF Load_Unload_Operations, EF Load_Type_Entries, EF VU_Configuration and EF Calibration_Add_Data are only present in version 2 of the generation 2 workshop card.</dd><dt>—</dt><dd>cardStructureVersion in EF Application_Identification is equal to {01 01} for version 2 of the generation 2 workshop card, while it was equal to {01 00} for version 1 of the generation 2 workshop card.</dd></dl>



<p>The following abbreviations for the security conditions are used in this table:</p>
<table>
               <tbody><tr>
                  <td>SC1</td>
                  <td>ALW OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC5</td>
                  <td>
                     <p>For the Read Binary command with even INS byte: SM-C-MAC-G2 AND SM-R-ENC-MAC-G2</p>
                     <p>For the Read Binary command with odd INS byte (if supported): NEV</p>
                  </td>
               </tr>
            </tbody></table>
<p>▼B</p>
<p>TCS_161 All EFs structures shall be transparent.</p>
<p>TCS_162 The workshop card application generation 2 shall have the following data structure:</p>




<p>▼B</p>
<p>TCS_163 The following values, used to provide sizes in the table above, are the minimum and maximum record number values the workshop card data structure must use for a generation 2 application:</p>
<p>▼M3</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>Min</td>
                        <td>Max</td>
                     </tr>
                     <tr>
                        <td>n1</td>
                        <td>NoOfEventsPerType</td>
                        <td>3</td>
                        <td>3</td>
                     </tr>
                     <tr>
                        <td>n2</td>
                        <td>NoOfFaultsPerType</td>
                        <td>6</td>
                        <td>6</td>
                     </tr>
                     <tr>
                        <td>n3</td>
                        <td>NoOfCardVehicleRecords</td>
                        <td>8</td>
                        <td>8</td>
                     </tr>
                     <tr>
                        <td>n4</td>
                        <td>NoOfCardPlaceRecords</td>
                        <td>8</td>
                        <td>8</td>
                     </tr>
                     <tr>
                        <td>n5</td>
                        <td>NoOfCalibrationRecords</td>
                        <td>255</td>
                        <td>255</td>
                     </tr>
                     <tr>
                        <td>n6</td>
                        <td>CardActivityLengthRange</td>
                        <td>492 bytes (1 day * 240 activity changes)</td>
                        <td>
                           <p>492 bytes (1 day *</p>
                           <p>240 activity changes)</p>
                        </td>
                     </tr>
                     <tr>
                        <td>n7</td>
                        <td>NoOfCardVehicleUnitRecords</td>
                        <td>8</td>
                        <td>8</td>
                     </tr>
                     <tr>
                        <td>n8</td>
                        <td>NoOfGNSSADRecords</td>
                        <td>24</td>
                        <td>24</td>
                     </tr>
                     <tr>
                        <td>n9</td>
                        <td>NoOfSpecificConditionRecords</td>
                        <td>4</td>
                        <td>4</td>
                     </tr>
                     <tr>
                        <td>n10</td>
                        <td>NoOfBorderCrossingRecords</td>
                        <td>4</td>
                        <td>4</td>
                     </tr>
                     <tr>
                        <td>n11</td>
                        <td>NoOfLoadUnloadRecords</td>
                        <td>8</td>
                        <td>8</td>
                     </tr>
                     <tr>
                        <td>n12</td>
                        <td>NoOfLoadTypeEntryRecords</td>
                        <td>4</td>
                        <td>4</td>
                     </tr>
                     <tr>
                        <td>n13</td>
                        <td>VuConfigurationLengthRange</td>
                        <td>3072 Bytes</td>
                        <td>3072 Bytes</td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>
<p>4.4.   <strong>Control card applications</strong>
            </p>
<p>4.4.1   <strong>Control Card application generation 1</strong>
            </p>
<p>TCS_164 After its personalisation, the control card application generation 1 shall have the following permanent file structure and file access rules:</p>

<p>The following abbreviations for the security conditions are used in this table:</p>
<table>
               <tbody><tr>
                  <td>SC1</td>
                  <td>ALW OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC2</td>
                  <td>ALW OR SM-MAC-G1 OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC3</td>
                  <td>SM-MAC-G1 OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC6</td>
                  <td>EXT-AUT-G1 OR SM-MAC-G1 OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<p>TCS_165 All EF structures shall be transparent.</p>
<p>TCS_166 The control card application generation 1 shall have the following data structure:</p>

<p>TCS_167 The following values, used to provide sizes in the table above, are the minimum and maximum record number values the control card data structure must use for a generation 1 application:</p>

<p>4.4.2   <strong>Control card application generation 2</strong>
            </p>
<p>▼M3</p>
<p>TCS_168 After its personalisation, the control card application generation 2 shall have the following permanent file structure and file access rules.</p>
<p>
               <em>Notes:</em>
            </p>
<dl><dt>—</dt><dd>the short EF identifier SFID is given as decimal number, e.g. the value 30 corresponds to 11110 in binary,</dd><dt>—</dt><dd>EF Application_Identification_V2, and EF VU_Configuration are only present in version 2 of the generation 2 control card,</dd><dt>—</dt><dd>cardStructureVersion in EF Application_Identification is equal to {01 01} for version 2 of the generation 2 control card, while it was equal to {01 00} for version 1 of the generation 2 control card.</dd></dl>



<p>The following abbreviations for the security condition are used in this table:</p>
<table>
               <tbody><tr>
                  <td>SC1</td>
                  <td>ALW OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC5</td>
                  <td>
                     <p>For the Read Binary command with even INS byte: SM-C-MAC-G2 AND SM-R-ENC-MAC-G2</p>
                     <p>For the Read Binary command with odd INS byte (if supported): NEV</p>
                  </td>
               </tr>
            </tbody></table>
<p>▼B</p>
<p>TCS_169 All EF structures shall be transparent.</p>
<p>TCS_170 The control card application generation2 shall have the following data structure:</p>


<p>▼B</p>
<p>TCS_171 The following values, used to provide sizes in the table above, are the minimum and maximum record number values the control card data structure must use for a generation 2 application:</p>
<p>▼M3</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>Min</td>
                        <td>Max</td>
                     </tr>
                     <tr>
                        <td>n7</td>
                        <td>NoOfControlActivityRecords</td>
                        <td>230</td>
                        <td>520</td>
                     </tr>
                     <tr>
                        <td>n13</td>
                        <td>VuConfigurationLengthRange</td>
                        <td>3072 Bytes</td>
                        <td>3072 Bytes</td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>
<p>4.5.   <strong>Company card applications</strong>
            </p>
<p>4.5.1   <strong>Company card application generation 1</strong>
            </p>
<p>TCS_172 After its personalisation, the company card application generation 1 shall have the following permanent file structure and file access rules:</p>

<p>The following abbreviations for the security conditions are used in this table:</p>
<table>
               <tbody><tr>
                  <td>SC1</td>
                  <td>ALW OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC2</td>
                  <td>ALW OR SM-MAC-G1 OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC3</td>
                  <td>SM-MAC-G1 OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC6</td>
                  <td>EXT-AUT-G1 OR SM-MAC-G1 OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<p>TCS_173 All EF structures shall be transparent.</p>
<p>TCS_174 The company card application generation 1 shall have the following data structure:</p>

<p>TCS_175 The following values, used to provide sizes in the table above, are the minimum and maximum record number values the company card data structure must use for a generation 1 application:</p>

<p>4.5.2   <strong>Company card application generation 2</strong>
            </p>
<p>▼M3</p>
<p>TCS_176 After its personalisation, the company card application generation 2 shall have the following permanent file structure and file access rules.</p>
<p>
               <em>Notes:</em>
            </p>
<dl><dt>—</dt><dd>the short EF identifier SFID is given as decimal number, e.g. the value 30 corresponds to 11110 in binary,</dd><dt>—</dt><dd>EF Application_Identification_V2, and EF VU_Configuration are only present in version 2 of the generation 2 company card,</dd><dt>—</dt><dd>cardStructureVersion in EF Application_Identification is equal to {01 01} for version 2 of the generation 2 company card, while it was equal to {01 00} for version 1 of the generation 2 company card.</dd></dl>



<p>The following abbreviations for the security condition are used in this table:</p>
<table>
               <tbody><tr>
                  <td>SC1</td>
                  <td>ALW OR SM-MAC-G2</td>
               </tr>
            </tbody></table>
<table>
               <tbody><tr>
                  <td>SC5</td>
                  <td>
                     <p>For the Read Binary command with even INS byte: SM-C-MAC-G2 AND SM-R-ENC-MAC-G2</p>
                     <p>For the Read Binary command with odd INS byte (if supported):NEV</p>
                  </td>
               </tr>
            </tbody></table>
<p>▼B</p>
<p>TCS_177 All EF structures shall be transparent.</p>
<p>TCS_178 The company card application generation 2 shall have the following data structure:</p>

<p>▼B</p>
<p>TCS_179 The following values, used to provide sizes in the table above, are the minimum and maximum record number values the company card data structure must use for a generation 2 application:</p>
<p>▼M3</p>
<p></p>
<p></p><table>
                  <tbody>
                     <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td></td>
                        <td>Min</td>
                        <td>Max</td>
                     </tr>
                     <tr>
                        <td>n8</td>
                        <td>NoOfCompanyActivityRecords</td>
                        <td>230</td>
                        <td>520</td>
                     </tr>
                     <tr>
                        <td>n13</td>
                        <td>VuConfigurationLengthRange</td>
                        <td>3072 Bytes</td>
                        <td>3072 Bytes</td>
                     </tr>
                  </tbody>
               </table>
<p>▼B</p>

</body></html>